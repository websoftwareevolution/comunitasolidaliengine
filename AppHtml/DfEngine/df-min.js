"use strict";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}var df={psVersionId:df&&df.psVersionId||"",pnDataFlexVersion:function(){var aV;if(df&&df.psVersionId){aV=df.psVersionId.split(".");if(aV.length>1){return parseFloat(aV[0]+"."+aV[1]);}else{return 0.0;}}}(),ciTypeText:0,ciTypeBCD:1,ciTypeDate:2,ciTypeDateTime:3,ciTypeTime:4,ciRegionCenter:0,ciRegionLeft:1,ciRegionRight:2,ciRegionTop:3,ciRegionBottom:4,ciLabelLeft:0,ciLabelTop:1,ciLabelRight:2,ciLabelFloat:3,ciAlignLeft:0,ciAlignCenter:1,ciAlignRight:2,ciDirGT:0,ciDirLT:1,ciOpenSameWindow:0,ciOpenNewTab:1,ciOpenNewWindow:2,cwiActual:0,cwiStretch:1,cwiStretchHoriz:2,cwiCenter:3,cwiFit:4,cwiCover:5,csUnsorted:0,csDescription:1,csValue:2,cCrumbHorizontal:0,cCrumbDropDown:1,cCrumbCaption:2,tUnknown:0,tString:1,tInt:2,tNumber:3,tDate:4,tBool:5,tAdv:6,gtAutomatic:0,gtAllData:1,gtManual:2,cCallModeDefault:1,cCallModeWait:2,cCallModeProgress:3,smFind:0,smValidationTable:1,smCustom:2,ctExecDefault:0,ctExecEarly:1,ctExecViewLoad:2,modeDesktop:10,modeTablet:20,modeTabletLandscape:21,modeTabletPortrait:22,modeMobile:30,modeMobileLandscape:31,modeMobilePortrait:32,adActionBar:1,adMenu:2,adBoth:3,wbNone:0,wbWrap:1,wbPre:2,wbPreWrap:3,wbEllipsis:4,dropPositions:{ciDropUnknown:0,ciDropOn:1,ciDropBefore:2,ciDropAfter:3,ciDropOnEmpty:4},dragActions:{WebList:{ciDragRow:111},WebTreeView:{ciDragFolder:121,ciDragItem:122},WebTagsForm:{ciDragTag:131}},dropActions:{WebControl:{ciDropOnControl:201},WebList:{ciDropOnRow:211},WebTreeView:{ciDropOnRoot:221,ciDropOnFolder:222,ciDropOnItem:223},WebTagsForm:{ciDropOnInput:231}},WebUIContext:{WebUIContextCustom:0,WebUIContextListRow:1,WebUIContextTreeviewFolder:2,WebUIContextTreeviewItem:3,WebUIContextTagsFormTag:4},CssEnabled:'Web_Enabled',CssDisabled:'Web_Disabled',CssHit:'Web_Hit',hitTimeout:1000,psIncludeLocation:function(){var aScripts;aScripts=document.getElementsByTagName("script");return aScripts[aScripts.length-1].src;}(),psRootPath:function(){var aScripts,sPath;aScripts=document.getElementsByTagName("script");sPath=aScripts[aScripts.length-1].src;if(sPath&&sPath.indexOf('DfEngine')>0){return sPath.substr(0,sPath.indexOf('DfEngine'));}return null;}(),ajax:{},lang:{monthsLong:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysLong:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},gui:{aZReservations:[true],reserveZIndex:function reserveZIndex(){return this.aZReservations.push(true)-1;},freeZIndex:function freeZIndex(iIndex){var iRes;this.aZReservations[iIndex]=false;for(iRes=this.aZReservations.length-1;iRes>=0;iRes--){if(!this.aZReservations[iRes]){this.aZReservations.pop();}else{break;}}},dragMask:function dragMask(){var eMask;eMask=df.dom.create('<div class="WebApp_DragMask"></div>');document.body.appendChild(eMask);return eMask;}},defineClass:function defineClass(constructor,sSuper,oProto){var fConstructor,fSuper,oPrototype,FTemp,sProp;if(typeof constructor==="string"){if(df.sys){fConstructor=df.sys.ref.getNestedProp(constructor);}else{fConstructor=eval(constructor);}}else{fConstructor=constructor;}if(arguments.length>2){oPrototype=arguments[arguments.length-1];if(typeof arguments[1]==="string"){if(df.sys){fSuper=df.sys.ref.getNestedProp(arguments[1]);}else{fSuper=eval(arguments[1]);}}else{fSuper=arguments[1];}if(typeof fSuper!=='function'){alert("Super class for '"+constructor+"' must be defined first ('"+arguments[1]+"')");}oPrototype=arguments[2];FTemp=function FTemp(){};FTemp.prototype=fSuper.prototype;fConstructor.prototype=new FTemp();for(sProp in oPrototype){if(oPrototype.hasOwnProperty(sProp)){fConstructor.prototype[sProp]=oPrototype[sProp];}}fConstructor.base=fSuper.prototype;}if(arguments.length===2){oPrototype=arguments[1];fConstructor.prototype=oPrototype;}fConstructor.prototype.constructor=fConstructor;},mixin:function mixin(sMixin,sSuper){var fSuper,fMixin,fConstructor,FTemp,sProp,sMixinName=sMixin;fSuper=df.sys.ref.getNestedProp(sSuper);fMixin=df.sys.ref.getNestedProp(sMixin);if(typeof fSuper!=='function'){alert("Super class for new mixed base class must be defined first ('"+sSuper+"')");return;}if(typeof fMixin!=='function'){alert("Mixin class for new mixed base class must be defined first ('"+sMixin+"')");return;}fConstructor=function fConstructor(){fMixin.apply(this,arguments);};FTemp=function FTemp(){};FTemp.prototype=fSuper.prototype;fConstructor.prototype=new FTemp();for(sProp in fMixin.prototype){if(fMixin.prototype.hasOwnProperty(sProp)){fConstructor.prototype[sProp]=fMixin.prototype[sProp];}}fConstructor.prototype.getBase=function(sOptClass){if(!sOptClass||sOptClass===sMixinName){return fSuper.prototype;}return fSuper.prototype.getBase.call(this,sOptClass);};fConstructor.prototype.constructor=fMixin;return fConstructor;},toBool:function toBool(val){return val==="0"||val==="-1"||val==="false"?false:!!val;},fromBool:function fromBool(bVal){return bVal?"1":"0";},fromDate:function fromDate(dDate){return df.sys.data.dateToString(dDate,"yyyy/mm/dd","-");},fromNumber:function fromNumber(nNumber){return nNumber.toString();},toInt:function toInt(val){return parseInt(val,10);},toNumber:function toNumber(val){return parseFloat(val);},toDate:function toDate(val){return df.sys.data.stringToDate(val,"yyyy/mm/dd","-");},toDateTime:function toDateTime(val){return df.sys.data.stringToDate(val,"yyyy/mm/ddThh:mm:ss.fff");},fromDateTime:function fromDateTime(dDate){return df.sys.data.dateToString(this._tValue,"yyyy/mm/ddThh:mm:ss.fff","-",":");},timeValues:{},timeStart:function timeStart(sLbl,sLog){sLog=sLbl+":: Timing Start * "+sLog;df.log(sLog);this.timeValues[sLbl]=new Date().getTime();},timeStop:function timeStop(sLbl,sLog){var time=new Date().getTime();if(this.timeValues[sLbl]){time=(time-this.timeValues[sLbl])/1000;sLog=sLbl+":: "+time+" * Timing Stop * "+sLog;}else{sLog=sLbl+":: <NAV> * Timing Stop * "+sLog;}df.log(sLog);},log:function log(sLog){if((typeof console==="undefined"?"undefined":_typeof(console))==="object"&&console.log){console.log(sLog);}},pbDebugging:typeof bDfDebug==="boolean"&&bDfDebug||document.location.href.toLowerCase().indexOf('dfdebug=true')>0,debug:function debug(sLog){if(this.pbDebugging){df.log(sLog);}},handleError:function handleError(oError,oOptSource){var oWebApp=null,oSource;if(oError instanceof df.Error){oSource=oOptSource||oError.oSource||null;if(oSource&&oSource.getWebApp){oSource=oSource.getWebApp();}if(oSource&&oSource instanceof df.WebApp){oWebApp=oSource;}if(oWebApp){oWebApp.handleError(oError);}else{alert(oError.iNumber+": "+oError.sText+"\n\r Line: "+oError.iLine+"\n\r Target: "+oError.sTarget+"\n\r User error: "+oError.bUserError);}}else{throw oError;}},classWordBreak:function classWordBreak(eMode){switch(eMode){case df.wbWrap:return"WebWrp_Wrap";case df.wbPre:return"WebWrp_Pre";case df.wbPreWrap:return"WebWrp_PreWrap";case df.wbEllipsis:return"WebWrp_Ellipsis";}return"WebWrp_None";}};df.Error=function Error(iNumber,sText,oOptSource,aOptReplacements,sOptDetailHtml,bOptSrv,bOptUsr,sOptCaption,oOptTarget,iOptLine){this.iNumber=iNumber;this.sText=sText;this.bUserError=!!bOptUsr;this.sCaption=sOptCaption||null;this.oSource=oOptSource||null;this.oTarget=oOptTarget||null;this.bServer=!!bOptSrv;this.iLine=iOptLine;this.sDetailHtml=sOptDetailHtml||null;if(aOptReplacements){this.sText=df.sys.data.format(this.sText,aOptReplacements);}};df.settings={formKeys:{findGT:{iKeyCode:119,bCtrl:false,bShift:false,bAlt:false},findLT:{iKeyCode:118,bCtrl:false,bShift:false,bAlt:false},findGE:{iKeyCode:120,bCtrl:false,bShift:false,bAlt:false},findFirst:{iKeyCode:36,bCtrl:true,bShift:false,bAlt:false},findLast:{iKeyCode:35,bCtrl:true,bShift:false,bAlt:false},save:{iKeyCode:113,bCtrl:false,bShift:false,bAlt:false},clear:{iKeyCode:116,bCtrl:false,bShift:false,bAlt:false},clearAll:{iKeyCode:116,bCtrl:true,bShift:false,bAlt:false},remove:{iKeyCode:113,bCtrl:false,bShift:true,bAlt:false},prompt:{iKeyCode:115,bCtrl:false,bShift:false,bAlt:false},tabOut:{iKeyCode:9,bCtrl:false,bShift:false,bAlt:false},submit:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false},escape:{iKeyCode:27,bCtrl:false,bShift:false,bAlt:false}},listKeys:{scrollUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},scrollDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},scrollPageUp:{iKeyCode:33,bCtrl:false,bShift:false,bAlt:false},scrollPageDown:{iKeyCode:34,bCtrl:false,bShift:false,bAlt:false},scrollTop:[{iKeyCode:36,bCtrl:true,bShift:false,bAlt:false},{iKeyCode:38,bCtrl:true,bShift:false,bAlt:false}],scrollBottom:[{iKeyCode:35,bCtrl:true,bShift:false,bAlt:false},{iKeyCode:40,bCtrl:true,bShift:false,bAlt:false}],search:{iKeyCode:70,bCtrl:true,bShift:false,bAlt:false},leftSwipeBtns:{iKeyCode:39},rightSwipeBtns:{iKeyCode:37}},gridKeys:{nextCol:{iKeyCode:9,bCtrl:false,bShift:false,bAlt:false},prevCol:{iKeyCode:9,bCtrl:false,bShift:true,bAlt:false},newRow:{iKeyCode:121,bCtrl:false,bShift:true,bAlt:false}},tabKeys:{enter:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false}},calendarKeys:{dayUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},dayDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},dayLeft:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},dayRight:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false},monthUp:{iKeyCode:33,bCtrl:false,bShift:false,bAlt:false},monthDown:{iKeyCode:34,bCtrl:false,bShift:false,bAlt:false},yearUp:{iKeyCode:33,bCtrl:true,bShift:false,bAlt:false},yearDown:{iKeyCode:34,bCtrl:true,bShift:false,bAlt:false},enter:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false},close:{iKeyCode:27,bCtrl:false,bShift:false,bAlt:false}},treeKeys:{moveUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},moveDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},collapse:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},extend:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false},moveFirst:{iKeyCode:36,bCtrl:false,bShift:false,bAlt:false},moveLast:{iKeyCode:35,bCtrl:false,bShift:false,bAlt:false},enter:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false}},sliderKeys:{sliderUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},sliderDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},sliderLeft:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},sliderRight:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false}},menuKeys:{moveUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},moveDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},moveLeft:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},moveRight:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false}},spinKeys:{moveUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},moveDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false}},suggestionKeys:{backSpace:{iKeyCode:8,bCtrl:false,bShift:false,bAlt:false},moveUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},moveDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},select:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false},escape:[{iKeyCode:27,bCtrl:false,bShift:false,bAlt:false},{iKeyCode:9,bCtrl:false,bShift:false,bAlt:false}],forceDisplay:{iKeyCode:32,bCtrl:true,bShift:false,bAlt:false}}};df.events={keys:{modifier:["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Meta","NumLock","ScrollLock","Shift","Symbol","SymbolLock"],legacyModifier:["Hyper","Super"],whiteSpace:["Enter","Tab"],navigation:["ArrowDown","Down","ArrowLeft","Left","ArrowRight","Right","ArrowUp","Up","End","Home","PageDown","PageUp"],editing:["Backspace","Clear","Copy","CrSel","Cut","Delete","Del","EraseEof","ExSel","Insert","Paste","Redo","Undo"],ui:["Accept","Again","Attn","Cancel","ContextMenu","Escape","Esc","Execute","Find","Help","Pause","Play","Props","Select","ZoomIn","ZoomOut"],device:["BrightnessDown","BrightnessUp","Eject","LogOff","Power","PowerOff","PrintScreen","Hibernate","Standby","WakeUp"],imeCompositionKeys:["AllCandidates","Alphanumeric","CodeInput","Compose","Convert","Dead","FinalMode","GroupFirst","GroupLast","GroupNext","GroupPrevious","ModeChange","NextCandidate","NonConvert","PreviousCandidate","Process","SingleCandidate"],koreanSpecific:["HangulMode","HanjaMode","JunjaMode"],japaneseSpecific:["Eisu","Hankaku","Hiragana","HiraganaKatakana","KanaMode","KanjiMode","Katakana","Romaji","Zenkaku","ZenkakuHankaku"],commonFunction:["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Soft1","Soft2","Soft3","Soft4"],multimedia:["ChannelDown","ChannelUp","Close","MailForward","MailReply","MailSend","MediaClose","MediaFastForward","MediaPause","MediaPlay","MediaPlayPause","MediaRecord","MediaRewind","MediaStop","MediaTrackNext","MediaTrackPrevious","New","Open","Print","Save","SpellCheck"],multimediaNumpad:["Key11","Key12"],audio:["AudioBalanceLeft","AudioBalanceRight","AudioBassBoostDown","AudioBassBoostToggle","AudioBassBoostUp","AudioFaderFront","AudioFaderRear","AudioSurroundModeNext","AudioTrebleDown","AudioTrebleUp","AudioVolumeDown","AudioVolumeUp","AudioVolumeMute","MicrophoneToggle","MicrophoneVolumeDown","MicrophoneVolumeUp","MicrophoneVolumeMute"],speech:["SpeechCorrectionList","SpeechInputToggle"],application:["LaunchApplication1","LaunchApplication2","LaunchCalendar","LaunchContacts","LaunchMail","LaunchMediaPlayer","LaunchMusicPlayer","LaunchPhone","LaunchScreenSaver","LaunchSpreadsheet","LaunchWebBrowser","LaunchWebCam","LaunchWordProcessor"],browser:["BrowserBack","BrowserFavorites","BrowserForward","BrowserHome","BrowserRefresh","BrowserSearch","BrowserStop"],mobilePhone:["AppSwitch","Call","Camera","CameraFocus","EndCall","GoBack","GoHome","HeadsetHook","LastNumberRedial","Notification","MannerMode","VoiceDial"],tv:["TV","TV3DMode","TVAntennaCable","TVAudioDescription","TVAudioDescriptionMixDown","TVAudioDescriptionMixUp","TVContentsMenu","TVDataService","TVInput","TVInputComponent1","TVInputComponent2","TVInputComposite1","TVInputComposite2","TVInputHDMI1","TVInputHDMI2","TVInputHDMI3","TVInputHDMI4","TVInputVGA1","TVMediaContext","TVNetwork","TVNumberEntry","TVPower","TVRadioService","TVSatellite","TVSatelliteBS","TVSatelliteCS","TVSatelliteToggle","TVTerrestrialAnalog","TVTerrestrialDigital","TVTimer"],mediaControls:["AVRInput","AVRPower","ColorF0Red","ColorF1Green","ColorF2Yellow","ColorF3Blue","ColorF4Grey","ColorF5Brown","ClosedCaptionToggle","Dimmer","DisplaySwap","DVR","Exit","FavoriteClear0","FavoriteClear1","FavoriteClear2","FavoriteClear3","FavoriteRecall0","FavoriteRecall1","FavoriteRecall2","FavoriteRecall3","FavoriteStore0","FavoriteStore1","FavoriteStore2","FavoriteStore3","Guide","GuideNextDay","GuidePreviousDay","Info","InstantReplay","Link","ListProgram","LiveContent","Lock","MediaApps","MediaAudioTrack","MediaLast","MediaSkipBackward","MediaSkipForward","MediaStepBackward","MediaStepForward","MediaTopMenu","NavigateIn","NavigateNext","NavigateOut","NavigatePrevious","NextFavoriteChannel","NextUserProfile","OnDemand","Pairing","PinPDown","PinPMove","PinPToggle","PinPUp","PlaySpeedDown","PlaySpeedReset","PlaySpeedUp","RandomToggle","RcLowBattery","RecordSpeedNext","RfBypass","ScanChannelsToggle","ScreenModeNext","Settings","SplitScreenToggle","STBInput","STBPower","Subtitle","Teletext","VideoModeNext","Wink","ZoomToggle"]},allKeys:null,insertInputTypes:["insertText","insertReplacementText","insertLineBreak","insertParagraph","insertOrderedList","insertUnorderedList","insertHorizontalRule","insertFromYank","insertFromDrop","insertFromPaste","insertFromPasteAsQuotation","insertTranspose","insertCompositionText","insertLink"],KEY_CODE_TAB:9,KEY_CODE_NON_EDIT:{37:1,38:1,39:1,40:1,35:1,36:1,9:1},KEY_CODE_SPECIAL:{37:1,38:1,39:1,40:1,35:1,36:1,46:1,8:1,9:1},addDomCaptureListener:function addDomCaptureListener(sEvent,eElement,fListener,oEnvironment){if(window.addEventListener){sEvent="capture_"+sEvent;}this.addDomListener(sEvent,eElement,fListener,oEnvironment);},removeDomCaptureListener:function removeDomCaptureListener(sEvent,eElement,fListener){if(window.addEventListener){sEvent="capture_"+sEvent;}this.removeDomListener(sEvent,eElement,fListener);},addDomListener:function addDomListener(sEvent,eElement,fListener,oEnvironment){var oDOMHandler;if(eElement._oDfDomH===undefined||!eElement._oDfDomH[sEvent]){oDOMHandler=new df.events.DOMHandler(sEvent,eElement);}else{oDOMHandler=eElement._oDfDomH[sEvent];}oDOMHandler.addListener(fListener,oEnvironment);},removeDomListener:function removeDomListener(sEvent,eElement,fListener){if(eElement._oDfDomH!==undefined&&eElement._oDfDomH[sEvent]){eElement._oDfDomH[sEvent].removeListener(fListener);}},addDomKeyListener:function addDomKeyListener(eElement,fListener,oEnvironment){df.events.addDomListener("keydown",eElement,fListener,oEnvironment);},removeDomKeyListener:function removeDomKeyListener(eElement,fListener){df.events.removeDomListener("keydown",eElement,fListener);},addDomMouseWheelListener:function addDomMouseWheelListener(eElement,fListener,oEnvironment){if(df.sys.isMoz){df.events.addDomListener("DOMMouseScroll",eElement,fListener,oEnvironment);}else{df.events.addDomListener("mousewheel",eElement,fListener,oEnvironment);}},removeDomMouseWheelListener:function removeDomMouseWheelListener(eElement,fListener){if(df.sys.isMoz){df.events.removeDomListener("DOMMouseScroll",eElement,fListener);}else{df.events.removeDomListener("mousewheel",eElement,fListener);}},stop:function stop(oEvent){oEvent.stop();},iDOMHandlers:0,oDOMHandlers:{},clearDomHandlers:function clearDomHandlers(){var iHandlerId;for(iHandlerId in df.events.oDOMHandlers){if(df.events.oDOMHandlers.hasOwnProperty(iHandlerId)){if(df.events.oDOMHandlers[iHandlerId].__DOMHandler){df.events.oDOMHandlers[iHandlerId].clear();}}}},clearDomListeners:function clearDomListeners(eElement,bRecursive){var sEvent;if(eElement._oDfDomH){for(sEvent in eElement._oDfDomH){if(eElement._oDfDomH.hasOwnProperty(sEvent)){eElement._oDfDomH[sEvent].clear();}}}if(bRecursive){df.dom.visit(eElement,function(eChild){df.events.clearDomListeners(eChild,true);});}}};df.events.DOMHandler=function DOMHandler(sEvent,eElement){this.sEvent=sEvent;this.eElement=eElement;this.aListeners=[];this.aRemoveListeners=[];this.bFiring=false;this.fHandler=null;this.__DOMHandler=true;this.iHandlerId=df.events.iDOMHandlers++;this.attach();};df.defineClass("df.events.DOMHandler",{attach:function attach(){var oDOMHandler,fHandler;oDOMHandler=this;fHandler=function fHandler(e){return oDOMHandler.fire(e);};if(window.addEventListener){if(this.sEvent.substr(0,8)==="capture_"){this.eElement.addEventListener(this.sEvent.substr(8),fHandler,true);}else{this.eElement.addEventListener(this.sEvent,fHandler,false);}}else{this.eElement.attachEvent("on"+this.sEvent,fHandler);}if(!this.eElement._oDfDomH){this.eElement._oDfDomH={};}this.eElement._oDfDomH[this.sEvent]=this;df.events.oDOMHandlers[this.iHandlerId]=this;this.fHandler=fHandler;},clear:function clear(){if(window.addEventListener){if(this.sEvent.substr(0,8)==="capture_"){this.eElement.removeEventListener(this.sEvent.substr(8),this.fHandler,true);}else{this.eElement.removeEventListener(this.sEvent,this.fHandler,false);}}else{this.eElement.detachEvent("on"+this.sEvent,this.fHandler);}delete this.eElement._oDfDomH[this.sEvent];delete df.events.oDOMHandlers[this.iHandlerId];},addListener:function addListener(fListener,oEnvironment){if(typeof fListener!=="function"){throw new df.Error(5131,"Listener must be a function (event: {{0}})",oEnvironment||null,[this.sEvent]);}this.aListeners.push({"fListener":fListener,"oEnvironment":oEnvironment});},removeListener:function removeListener(fListener){var i;for(i=0;i<this.aListeners.length;i++){if(this.aListeners[i].fListener===fListener){if(this.bFiring){this.aListeners[i].fListener=null;this.aRemoveListeners.push(fListener);}else{if(this.aListeners.length>1){this.aListeners.splice(i,1);}else{this.clear();}}break;}}},fire:function fire(e){var i,oEvent;oEvent=new df.events.DOMEvent(e,this.eElement,this.sEvent);this.bFiring=true;for(i=0;i<this.aListeners.length&&!oEvent.bCanceled;i++){if(typeof this.aListeners[i].fListener==="function"){try{if(this.aListeners[i].fListener.call(this.aListeners[i].oEnvironment!==undefined?this.aListeners[i].oEnvironment:this.eElement,oEvent)===false){oEvent.stop();}}catch(oError){df.handleError(oError);}}}this.bFiring=false;while(this.aRemoveListeners.length>0){this.removeListener(this.aRemoveListeners.pop());}if(oEvent.bCanceled){if(e.preventDefault){e.preventDefault();}e.returnValue=false;return false;}return true;}});df.events.DOMEvent=function DOMEvent(e,eSource,sName){this.eSource=eSource;if(!e){this.e=window.event;}else{this.e=e;}this.sName=sName;this.bCanceled=false;};df.defineClass("df.events.DOMEvent",{getTarget:function getTarget(){var eTarget;if(this.e.target){eTarget=this.e.target;}else if(this.e.srcElement){eTarget=this.e.srcElement;}if(eTarget.nodeType===3){eTarget=eTarget.parentNode;}return eTarget;},getMouseX:function getMouseX(){return this.e.clientX;},getMouseY:function getMouseY(){return this.e.clientY;},getKeyCode:function getKeyCode(){return this.e.keyCode;},isSpecialKey:function isSpecialKey(){var iKeyCode=this.getKeyCode();if((df.sys.isIE||df.sys.isSafari)&&this.e.type==="keypress"){return false;}return this.getAltKey()||this.getCtrlKey()||df.events.KEY_CODE_SPECIAL[iKeyCode]&&iKeyCode!==0;},isKeyPrintable:function isKeyPrintable(){return!this.getCtrlKey()&&!this.getAltKey()&&df.events.allKeys.indexOf(this.e.key)===-1;},key:function key(){return this.e.key;},inputIsInsert:function inputIsInsert(){return df.events.insertInputTypes.indexOf(this.e.inputType)!==-1;},getCharCode:function getCharCode(){if(this.e.charCode){return this.e.charCode;}if(typeof this.e.charCode!=="number"){return this.e.keyCode;}return 0;},getCtrlKey:function getCtrlKey(){return this.e.ctrlKey;},getShiftKey:function getShiftKey(){return this.e.shiftKey;},getAltKey:function getAltKey(){return this.e.altKey;},getMouseButton:function getMouseButton(){if(this.e.which){switch(this.e.which){case 0:return 1;case 1:return 4;case 2:return 2;default:return 0;}}else{return this.e.button;}},getMouseWheelDelta:function getMouseWheelDelta(){var iDelta=0;if(this.e.detail){iDelta=-this.e.detail/3;}else if(this.e.wheelDelta){iDelta=this.e.wheelDelta/120;}return iDelta;},stop:function stop(){this.bCanceled=true;this.e.returnValue=false;this.e.cancelBubble=true;this.e.canceled=true;if(this.e.preventDefault){this.e.preventDefault();}if(this.e.stopPropagation){this.e.stopPropagation();}},stopPropagation:function stopPropagation(){if(this.e.stopPropagation){this.e.stopPropagation();}else if(this.e.cancelBubble!==undefined){this.e.cancelBubble=true;}},matchKey:function matchKey(keydef){var i;if(keydef){if(keydef instanceof Array){for(i=0;i<keydef.length;i++){if(keydef[i].iKeyCode===this.getKeyCode()&&!!keydef[i].bCtrl===this.getCtrlKey()&&!!keydef[i].bShift===this.getShiftKey()&&!!keydef[i].bAlt===this.getAltKey()){return true;}}}else{return keydef.iKeyCode===this.getKeyCode()&&!!keydef.bCtrl===this.getCtrlKey()&&!!keydef.bShift===this.getShiftKey()&&!!keydef.bAlt===this.getAltKey();}}return false;}});df.events.addDomListener("unload",window,df.events.clearDomHandlers);df.events.JSHandler=function JSHandler(sOptServerName){this.sServerName=sOptServerName||null;this.aListeners=[];this.aRemoveListeners=[];this.bFiring=false;};df.defineClass("df.events.JSHandler",{addListener:function addListener(fListener,oEnvironment){this.on(fListener,oEnvironment);},on:function on(fListener,oEnv){if(typeof fListener!=="function"){throw new df.Error(5131,"Listener must be a function",oEnv||null,[this.sEvent]);}this.aListeners.push({"fListener":fListener,"oEnvironment":oEnv});},off:function off(fListener,oEnv){var iListener;for(iListener=0;iListener<this.aListeners.length;iListener++){if(this.aListeners[iListener].fListener===fListener&&this.aListeners[iListener].oEnvironment===oEnv){if(this.bFiring){this.aRemoveListeners.push(this.aListeners[iListener]);}else{this.aListeners.splice(iListener,1);}}}},removeListener:function removeListener(fListener,oEnv){this.off(fListener,oEnv);},fire:function fire(oSource,oOptions){if(this.aListeners.length>0){var iListener,oEvent;oEvent=oOptions instanceof df.events.JSEvent?oOptions:new df.events.JSEvent(oSource,oOptions);this.bFiring=true;for(iListener=0;iListener<this.aListeners.length&&!oEvent.bCanceled;iListener++){if(typeof this.aListeners[iListener].fListener==="function"){try{if(this.aListeners[iListener].fListener.call(this.aListeners[iListener].oEnvironment!==undefined?this.aListeners[iListener].oEnvironment:this.eElement,oEvent)===false){oEvent.stop();}}catch(oError){df.handleError(oError,oSource);}}}this.bFiring=false;while(this.aRemoveListeners.length>0){var oListener=this.aRemoveListeners.pop();this.off(oListener.fListener,oListener.oEnvironment);}return!oEvent.bCanceled;}return true;}});df.events.JSEvent=function JSEvent(oSource,oOptions){var sProp;this.oSource=oSource;this.bCanceled=false;if(_typeof(oOptions)==="object"){for(sProp in oOptions){if(oOptions.hasOwnProperty(sProp)){this[sProp]=oOptions[sProp];}}}};df.defineClass("df.events.JSEvent",{getTarget:function getTarget(){return this.oSource;},stop:function stop(){this.bCanceled=true;}});df.events.allKeys=Object.keys(df.events.keys).reduce(function(acc,sKey){return acc.concat(df.events.keys[sKey]);},[]);df.dom={cFocusSelector:'a, button, textarea, input, iframe, select, *[tabindex]',piDomCounter:0,on:function on(sEvent,eElem,fHan,oEnv){var aEv;if(eElem instanceof Array||eElem instanceof NodeList){eElem.forEach(function(eItem){this.on(sEvent,eItem,fHan,oEnv);},this);return;}if(sEvent instanceof Array){aEv=sEvent;}else{aEv=sEvent.split(' ');}aEv.forEach(function(sItem){df.events.addDomListener(sItem,eElem,fHan,oEnv);});},off:function off(sEvent,eElem,fHan){var aEv;if(eElem instanceof Array){eElem.forEach(function(eItem){this.off(eItem,sEvent,fHan);},this);return;}if(sEvent instanceof Array){aEv=sEvent;}else{aEv=sEvent.split(' ');}aEv.forEach(function(sItem){df.events.removeDomListener(sItem,eElem,fHan);});},clear:function clear(eElem,bRecursive){if(eElem instanceof Array){eElem.forEach(function(eItem){this.clear(eItem,bRecursive);},this);return;}df.events.clearDomListeners(eElem,bRecursive);},genDomId:function genDomId(){return"_df_"+this.piDomCounter++;},addClass:function addClass(eElem,sClass){var aClasses,sClassName,i,bFound=false;if(!eElem)return;if(eElem.className){aClasses=(sClass||"").split(/\s+/);sClassName=" "+eElem.className+" ";for(i=0;i<aClasses.length;i++){if(sClassName.indexOf(" "+aClasses[i]+" ")<0){sClassName+=" "+aClasses[i];bFound=true;}}if(bFound){eElem.className=sClassName.trim();}}else{eElem.className=sClass;}},removeClass:function removeClass(eElem,sClass){var aClasses,sClassName,i,bFound=false;if(!eElem)return;if(eElem.className){sClass=" "+sClass+" ";aClasses=eElem.className.split(/\s+/);sClassName="";for(i=0;i<aClasses.length;i++){if(sClass.indexOf(" "+aClasses[i]+" ")<0){sClassName+=" "+aClasses[i];bFound=true;}}if(bFound){eElem.className=sClassName.trim();}}},toggleClass:function toggleClass(eElem,sClass,bVal){if(bVal){this.addClass(eElem,sClass);}else{this.removeClass(eElem,sClass);}},createCSSElem:function createCSSElem(sFile){var eStyle=document.createElement('link');eStyle.rel='stylesheet';eStyle.type='text/css';eStyle.href=sFile;return eStyle;},setText:function setText(eElem,sValue){if(sValue===" "){eElem.innerHTML="&nbsp;";}else{sValue=sValue.toString().replace(/\\n\\r/gi,'\n');if("innerText"in eElem){eElem.innerText=sValue;}else{eElem.textContent=sValue;}}},getText:function getText(eElem){if(eElem.innerText!==undefined){return eElem.innerText;}return eElem.textContent;},getOuterHTML:function getOuterHTML(eElem){var eParent,eFake,sHTML;if(eElem.outerHTML){return eElem.outerHTML;}if(eElem.parentNode){eParent=eElem.parentNode;eFake=document.createElement(eParent.tagName);eFake.appendChild(eElem);sHTML=eFake.innerHTML;eParent.appendChild(eElem);return sHTML;}return null;},deepClone:function deepClone(eOrig){var eClone,_fChecker;eClone=eOrig.cloneNode(true);_fChecker=function fChecker(eClone,eOrig){var iChild;if(eClone.tagName==="SELECT"||eClone.tagName==="TEXTAREA"){eClone.value=eOrig.value;}for(iChild=0;iChild<eClone.childNodes.length;iChild++){if(eClone.childNodes[iChild].nodeType!==3&&eClone.childNodes[iChild].nodeType!==8){_fChecker(eClone.childNodes[iChild],eOrig.childNodes[iChild]);}}};_fChecker(eClone,eOrig);return eClone;},swapNodes:function swapNodes(eOrig,eNew){if(eOrig){if(eNew){if(eOrig.replaceNode!==undefined){eOrig.replaceNode(eNew);}else{eOrig.parentNode.replaceChild(eNew,eOrig);}}}},insertAfter:function insertAfter(eNewElement,eElem){if(eElem.nextSibling!==null){eElem.parentNode.insertBefore(eNewElement,eElem.nextSibling);}else{eElem.parentNode.appendChild(eNewElement);}},isParent:function isParent(eStart,eSearch){if(eStart===null){return false;}if(eStart===eSearch){return true;}if(eStart.parentNode!==undefined){return this.isParent(eStart.parentNode,eSearch);}return false;},searchParent:function searchParent(eElem,sTagName){sTagName=sTagName.toUpperCase();if(eElem.tagName===sTagName){return eElem;}if(eElem.parentNode!==undefined&&eElem!==document){return this.searchParent(eElem.parentNode,sTagName);}return null;},focus:function focus(eElem,bSelect){try{eElem.focus();if(bSelect&&eElem.select){eElem.select();}if(typeof eElem.setActive==="function"){eElem.setActive();}}catch(err){}},getCaretPosition:function getCaretPosition(eField){return this.getSelection(eField).start;},getSelectionLength:function getSelectionLength(eField){return this.getSelection(eField).length;},getSelection:function getSelection(eField){var iStart=0,iEnd=0,iLen,sNormalizedValue,oRange,oTextInputRange,oEndRange;if("selectionStart"in eField&&/text|password|search|tel|url/.test(eField.type)){iStart=eField.selectionStart;iEnd=eField.selectionEnd;}else if(document.selection){try{oRange=document.selection.createRange();if(oRange&&oRange.parentElement()===eField){iLen=eField.value.length;sNormalizedValue=eField.value.replace(/\r\n/g,"\n");oTextInputRange=eField.createTextRange();oTextInputRange.moveToBookmark(oRange.getBookmark());oEndRange=eField.createTextRange();oEndRange.collapse(false);if(oTextInputRange.compareEndPoints("StartToEnd",oEndRange)>-1){iStart=iEnd=iLen;}else{iStart=-oTextInputRange.moveStart("character",-iLen);iStart+=sNormalizedValue.slice(0,iStart).split("\n").length-1;if(oTextInputRange.compareEndPoints("EndToEnd",oEndRange)>-1){iEnd=iLen;}else{iEnd=-oTextInputRange.moveEnd("character",-iLen);iEnd+=sNormalizedValue.slice(0,iEnd).split("\n").length-1;}}}}catch(e){}}return{start:iStart,end:iEnd,length:iEnd-iStart};},setCaretPosition:function setCaretPosition(eField,iCaretPos){try{if(document.selection){eField.focus();var oSel=document.selection.createRange();oSel.moveStart('character',-eField.value.length);oSel.moveEnd('character',-eField.value.length);oSel.moveStart('character',iCaretPos);oSel.select();}else if(/text|password|search|tel|url/.test(eField.type)&&eField.selectionStart||eField.selectionStart===0){eField.selectionStart=iCaretPos;eField.selectionEnd=iCaretPos;eField.focus();}}catch(e){}},getFirstFocusChild:function getFirstFocusChild(eElem){var aElems,i;aElems=df.dom.query(eElem,df.dom.cFocusSelector,true);for(i=0;i<aElems.length;i++){if(aElems[i].tabIndex>=0&&aElems[i].type!=="hidden"){return aElems[i];}}return null;},visit:function visit(eElem,fWorker,oEnv){var iChild;if(eElem.childNodes){for(iChild=0;iChild<eElem.childNodes.length;iChild++){if(eElem.childNodes[iChild].nodeType!==3&&eElem.childNodes[iChild].nodeType!==8){if(fWorker.call(oEnv||this,eElem.childNodes[iChild])===false){return false;}}}}return true;},disableTextSelection:function disableTextSelection(eElem){eElem.unselectable="on";eElem.style.MozUserSelect="none";eElem.style.webkitUserSelect="none";},enableTextSelection:function enableTextSelection(eElem){eElem.unselectable="off";eElem.style.MozUserSelect="text";eElem.style.webkitUserSelect="text";},ready:function ready(fWorker,oEnv){function call(){fWorker.call(oEnv||null);if(window.addEventListener){window.removeEventListener("load",call,false);}else{window.detachEvent("onload",call);}}if(document.readyState==="complete"){call();}else{if(window.addEventListener){window.addEventListener("load",call,false);}else{window.attachEvent("onload",call);}}},create:function create(sHtml){var eWrapper=document.createElement("div");eWrapper.innerHTML=sHtml;return eWrapper.firstChild;},query:function query(eElem,sSelect,bOptMulti){if(!bOptMulti&&eElem.querySelector){return eElem.querySelector(sSelect);}if(eElem.querySelectorAll){var aRes=eElem.querySelectorAll(sSelect);if(bOptMulti){return aRes;}return aRes.length>0?aRes[0]:null;}throw new df.Error(999,"This browser doesn't support querySelectorAll");},translateY:function translateY(eElem,iY,bTopFB){var sPre=df.sys.gui.getTransformProp();if(sPre){eElem.style[sPre]='translateY('+iY+'px)';return true;}if(bTopFB){eElem.style.top=iY+'px';return true;}return false;},translateX:function translateX(eElem,iX,bLeftFB){var sPre=df.sys.gui.getTransformProp();if(sPre){if(iX!==null){eElem.style[sPre]='translateX('+iX+'px)';}else{eElem.style[sPre]='';}return true;}if(bLeftFB){if(iX!==null){eElem.style.left=iX+'px';}else{eElem.style.left='';}return true;}return false;},transition:function transition(eElem,sTransition,fFinish,oEnv){function transEnd(oEv){df.dom.off("transitionend",eElem,transEnd);eElem.style.transition="";if(fFinish){fFinish.call(oEnv||this);}}df.dom.on("transitionend",eElem,transEnd,this);eElem.style.transition=sTransition;},encodeHtml:function encodeHtml(sValue){return(sValue||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");},encodeAttr:function encodeAttr(sValue){return(sValue||"").replace(/\"/g,'&quot;');},windowWidth:function windowWidth(){return Math.max(document.body&&Math.max(document.body.scrollWidth,document.body.offsetWidth)||0,document.documentElement&&Math.max(document.documentElement.scrollWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)||0);},windowHeight:function windowHeight(){return Math.max(document.body&&Math.max(document.body.scrollHeight,document.body.offsetHeight)||0,document.documentElement&&Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)||0);},animFrame:function animFrame(fCallback,oEnv){if(window.requestAnimationFrame){window.requestAnimationFrame(function aniFrmCallback(){fCallback.call(oEnv||this);});}else{setTimeout(function aniFrmCallback(){fCallback.call(oEnv||this);},40);}},offsetHeight:function offsetHeight(eElem){return(eElem===null||eElem===void 0?void 0:eElem.getBoundingClientRect().height)||0;},clientHeight:function clientHeight(eElem){return df.dom.offsetHeight(eElem)-(((eElem===null||eElem===void 0?void 0:eElem.offsetHeight)||0)-((eElem===null||eElem===void 0?void 0:eElem.clientHeight)||0));},offsetWidth:function offsetWidth(eElem){return(eElem===null||eElem===void 0?void 0:eElem.getBoundingClientRect().width)||0;},clientWidth:function clientWidth(eElem){return df.dom.offsetWidth(eElem)-(((eElem===null||eElem===void 0?void 0:eElem.offsetWidth)||0)-((eElem===null||eElem===void 0?void 0:eElem.clientWidth)||0));}};df.sys={isSafari:false,isChrome:false,isOpera:false,isMoz:false,isIE:false,isEdge:false,isWebkit:false,isMobile:false,isIOS:false,iVersion:0,ref:{getType:function getType(oObject){var sType=_typeof(oObject);if(sType==="object"){if(oObject===null||oObject===undefined){sType="null";}else if(oObject.constructor===Array){sType="array";}else if(oObject.constructor===Date){sType="date";}else{sType=this.getConstructorName(oObject);}}return sType;},getConstructorName:function getConstructorName(oObject){var sName=this.getMethodName(oObject.constructor);if(sName===""){sName="object";}return sName;},getMethodName:function getMethodName(fFunction){var sString;try{sString=fFunction.toString();return sString.substring(sString.indexOf("function")+8,sString.indexOf('(')).replace(/ /g,'');}catch(e){return"";}},getGlobalObj:function getGlobalObj(){return window;},getNestedProp:function getNestedProp(sPath){var aParts,oProp,iPart;aParts=sPath.split(".");oProp=df.sys.ref.getGlobalObj();for(iPart=0;iPart<aParts.length;iPart++){if(_typeof(oProp)==="object"&&oProp!==null){oProp=oProp[aParts[iPart]];}else{return null;}}return oProp;}},math:{padZero:function padZero(iNum,iDigits){var sResult=iNum.toString();while(sResult.length<iDigits){sResult="0"+sResult;}return sResult;}},data:{stringToNum:function stringToNum(sVal,sDecSep,sOptThousSepp){return sVal&&parseFloat(sVal.replace(sOptThousSepp||"","").replace(sDecSep,"."));},numToString:function numToString(nVal,sDecSep,iPrecision){var aVal,sVal;nVal=nVal||0.0;sVal=nVal.toString().replace(".",sDecSep);if(iPrecision>0){aVal=sVal.split(sDecSep);if(aVal.length<2){aVal[1]="";}aVal[1]=(aVal[1]+"0000000000000000000").substr(0,iPrecision);sVal=aVal[0]+sDecSep+aVal[1];}return sVal;},applyDateMask:function applyDateMask(dValue,sMask,sDateSeparator,sOptTimeSeparator){var bMinute=false;return sMask.replace(/(m{1,4}|d{1,4}|yyyy|yy|\/|hh|ss|fff|f|\:)/gi,function(sValue,iPos){switch(sValue.toLowerCase()){case"m":bMinute=true;return dValue.getMonth()+1;case"mm":if(bMinute){bMinute=false;return df.sys.math.padZero(dValue.getMinutes(),2);}bMinute=true;return df.sys.math.padZero(dValue.getMonth()+1,2);case"mmm":bMinute=true;return df.sys.string.copyCase(df.lang.monthsShort[dValue.getMonth()],sValue);case"mmmm":bMinute=true;return df.sys.string.copyCase(df.lang.monthsLong[dValue.getMonth()],sValue);case"d":bMinute=false;return dValue.getDate();case"dd":bMinute=false;return df.sys.math.padZero(dValue.getDate(),2);case"ddd":bMinute=false;return df.sys.string.copyCase(df.lang.daysShort[dValue.getDay()],sValue);case"dddd":bMinute=false;return df.sys.string.copyCase(df.lang.daysLong[dValue.getDay()],sValue);case"yy":bMinute=false;return df.sys.math.padZero(dValue.getFullYear()%100,2);case"yyyy":bMinute=false;return df.sys.math.padZero(dValue.getFullYear(),4);case"/":bMinute=false;return sDateSeparator;case"hh":bMinute=true;return df.sys.math.padZero(dValue.getHours(),2);case"ss":bMinute=true;return df.sys.math.padZero(dValue.getSeconds(),2);case"f":bMinute=true;return dValue.getMilliseconds();case"fff":bMinute=true;return df.sys.math.padZero(dValue.getMilliseconds(),3);case":":bMinute=true;return sOptTimeSeparator||":";}return sValue;});},applyNumMask:function applyNumMask(nValue,sMask,sDecSep,sThousSep,sCurSym){var aParts,aResult=[],sChar,bEscape,iChar,iNumChar,iCount,sBefore,sDecimals,sMaskBefore,sMaskDecimals=null,sValue,iMaskBefore=0,iMaskDecimals=0,bThousands=false,bBefore=true;sMask=sMask.replace(/&curren;/g,sCurSym);if(sMask.charAt(0)==="Z"){if(nValue===0.0){return"";}sMask=sMask.substr(1);}aParts=sMask.split(";");if(nValue<0.0){if(aParts.length>1){sMask=aParts[1];}else{sMask="-"+aParts[0];}}else{sMask=aParts[0];}aParts=sMask.split(".");sMaskBefore=aParts[0];if(aParts.length>1){sMaskDecimals=aParts[1];}for(iChar=0;iChar<sMask.length;iChar++){switch(sMask.charAt(iChar)){case"\\":iChar++;break;case"#":case"0":if(bBefore){if(iMaskBefore>=0){iMaskBefore++;}}else{if(iMaskDecimals>=0){iMaskDecimals++;}}break;case"*":if(bBefore){iMaskBefore=-1;}else{iMaskDecimals=-1;}break;case",":bThousands=true;break;case".":bBefore=false;break;}}if(iMaskDecimals>=0){nValue=nValue.toFixed(iMaskDecimals);}sValue=nValue===0.0?"":String(nValue);aParts=sValue.split(".");sBefore=aParts[0];if(aParts.length>1){sDecimals=aParts[1];}else{sDecimals="";}if(sBefore.charAt(0)==="-"){sBefore=sBefore.substr(1);}iChar=sMaskBefore.length-1;iNumChar=sBefore.length-1;iCount=0;while(iChar>=0){sChar=sMaskBefore.charAt(iChar);bEscape=iChar>0&&sMaskBefore.charAt(iChar-1)==="\\";if(!bEscape&&(sChar==="#"||sChar==="*"||sChar==="0")){while(iNumChar>=0||sChar==="0"){if(iCount>=3){iCount=0;if(bThousands){aResult.unshift(sThousSep);}}aResult.unshift(iNumChar>=0?sBefore.charAt(iNumChar):"0");iNumChar--;iCount++;if(sChar==="#"||sChar==="0"){break;}}}else{if(sChar!==","&&sChar!=="\\"||bEscape){aResult.unshift(sChar);}}iChar--;}if(sMaskDecimals!==null){var aAfter=[];iNumChar=0;for(iChar=0;iChar<sMaskDecimals.length;iChar++){sChar=sMaskDecimals.charAt(iChar);bEscape=iChar>0&&sMaskBefore.charAt(iChar-1)==="\\";if(!bEscape&&(sChar==="#"||sChar==="*"||sChar==="0")){while(iNumChar<sDecimals.length||sChar==="0"){aAfter.push(iNumChar>=0?sDecimals.charAt(iNumChar):"0");iNumChar++;if(sChar==="#"||sChar==="0"){break;}}}else{if(sChar!=="\\"||bEscape){aAfter.push(sChar);}}}if(aAfter.length){aResult.push(sDecSep,aAfter.join(""));}}return aResult.join("");},applyWinMask:function applyWinMask(sValue,sMask){var iChar=0,iValChar=0,aResult=[],bFound,sChar;if(sValue===""){return"";}if(sMask===""){return sValue;}while(iChar<sMask.length){sChar=sMask.charAt(iChar);if(sChar==="\\"&&sMask.length>iChar+1){aResult.push(sMask.charAt(iChar+1));}else{if(sChar==="#"||sChar==="@"||sChar==="!"||sChar==="*"){bFound=false;while(iValChar<sValue.length&&!bFound){if(this.acceptWinMaskChar(sValue.charAt(iValChar),sChar)){aResult.push(sValue.charAt(iValChar));bFound=true;}iValChar++;}if(!bFound){break;}}else{aResult.push(sChar);}}iChar++;}return aResult.join("");},acceptWinMaskChar:function acceptWinMaskChar(sValChar,sChar){return sChar==="#"&&sValChar.match(/[0-9]/)||sChar==="@"&&sValChar.match(/[a-zA-Z]/)||sChar==="!"&&sValChar.match(/[^a-zA-Z0-9]/)||sChar==="*";},stringToDate:function stringToDate(sValue,sFormat){var aValues=[],aFormat=[],bMinute=false,i,sV,iDate=0,iMonth=0,iYear=0,iHour=0,iSecond=0,iMinute=0,iFraction=0,dToday=new Date(),dResult;if(sValue.trim()===""){return null;}aValues=sValue.split(/[^0-9]+/gi);aFormat=sFormat.split(/[^mdyhmsf]+/gi);for(i=0;i<aValues.length;i++){sV=aValues[i];switch(aFormat[i]){case"d":case"dd":iDate=parseInt(sV,10);bMinute=false;break;case"m":iMonth=parseInt(sV,10);bMinute=true;break;case"mm":if(bMinute){iMinute=parseInt(sV,10);}else{iMonth=parseInt(sV,10);}break;case"yy":case"yyyy":iYear=parseInt(sV,10);if(sV.length===2){iYear=iYear>50?iYear+1900:iYear+2000;}else if(sV.length===0){iYear=dToday.getFullYear();}bMinute=false;break;case"hh":iHour=parseInt(sV,10);bMinute=true;break;case"ss":iSecond=parseInt(sV,10);bMinute=true;break;case"f":case"fff":iFraction=parseInt(sV,10);break;}}if(!iYear){iYear=dToday.getFullYear();}else{iYear=iYear>0?iYear<9999?iYear:9999:0;}if(!iMonth){iMonth=dToday.getMonth();}else{iMonth=iMonth>0?iMonth<=12?iMonth-1:11:0;}if(!iDate){iDate=dToday.getDate();}else{iDate=iDate>0?iDate<=32?iDate:31:1;}iHour=iHour>0?iHour<=23?iHour:iHour===24?0:23:0;iMinute=iMinute>0?iMinute<60?iMinute:59:0;iSecond=iSecond>0?iSecond<60?iSecond:59:0;iFraction=iFraction>0?iFraction<999?iFraction:999:0;dResult=new Date(iYear,iMonth,iDate,iHour,iMinute,iSecond,iFraction);while(dResult.getMonth()!==iMonth){iDate--;dResult=new Date(iYear,iMonth,iDate,iHour,iMinute,iSecond,iFraction);}return dResult;},dateToString:function dateToString(dValue,sFormat,sDateSeparator){return this.applyDateMask(dValue,sFormat,sDateSeparator||"/");},dateToWeek:function dateToWeek(dDate){var week1,date;date=new Date(dDate.getTime());date.setHours(0,0,0,0);date.setDate(date.getDate()+3-(date.getDay()+6)%7);week1=new Date(date.getFullYear(),0,4);return 1+Math.round(((date.getTime()-week1.getTime())/86400000-3+(week1.getDay()+6)%7)/7);},removeFromArray:function removeFromArray(aArray,oObj){var i;for(i=0;i<aArray.length;i++){if(aArray[i]===oObj){aArray.splice(i,1);}}},formatRegExp:/\{\{([0-9a-zA-Z]+)\}\}/gi,format:function format(sStr,oReps){var reps=oReps||{};return sStr.replace(this.formatRegExp,function(str,p1,offset,s){if(reps.hasOwnProperty(p1)){return reps[p1];}return str;});},markupDataSize:function markupDataSize(iBytes){var nVal;if(iBytes<1024){return iBytes+" B";}nVal=iBytes/1024;if(nVal<2048){return Math.round(nVal)+" kB";}nVal=nVal/1024;if(nVal<2048){if(nVal<100){return Math.round(nVal)*10/10+" MB";}return Math.round(nVal)+" MB";}nVal=nVal/1024;if(nVal<2048){if(nVal<100){return Math.round(nVal)*10/10+" GB";}return Math.round(nVal)+" GB";}nVal=nVal/1024;if(nVal<2048){if(nVal<100){return Math.round(nVal)*10/10+" TB";}return Math.round(nVal)+" TB";}nVal=nVal/1024;if(nVal<100){return Math.round(nVal)*10/10+" PB";}return Math.round(nVal)+" PB";},escapeRegExp:function escapeRegExp(sStr){return sStr.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");},compareText:function compareText(sVal1,sVal2){return sVal1.localeCompare(sVal2);},compareBCD:function compareBCD(sVal1,sVal2){return parseFloat(sVal1)-parseFloat(sVal2);},compareDate:function compareDate(sVal1,sVal2){return df.sys.data.stringToDate(sVal1,"yyyy/mm/dd","-")<df.sys.data.stringToDate(sVal2,"yyyy/mm/dd","-")?-1:1;},compareDateTime:function compareDateTime(sVal1,sVal2){return df.sys.data.stringToDate(sVal1,"yyyy/mm/ddThh:mm:ss.fff","-")<df.sys.data.stringToDate(sVal2,"yyyy/mm/ddThh:mm:ss.fff","-")?-1:1;},compareTime:function compareTime(sVal1,sVal2){return df.sys.data.stringToDate(sVal1,"hh:mm:ss","-")<df.sys.data.stringToDate(sVal2,"hh:mm:ss","-")?-1:1;},compareFunction:function compareFunction(eDataType){switch(eDataType){case df.ciTypeBCD:return this.compareBCD;case df.ciTypeDate:return this.compareDate;case df.ciTypeDateTime:return this.compareDateTime;case df.ciTypeTime:return this.compareTime;default:return this.compareText;}},serverToType:function serverToType(sVal,eDataType){var tVal=sVal;if(eDataType===df.ciTypeBCD){tVal=df.sys.data.stringToNum(sVal,".");}else if(eDataType===df.ciTypeDate){tVal=df.sys.data.stringToDate(sVal,"yyyy/mm/dd","-");}else if(eDataType===df.ciTypeDateTime){tVal=df.sys.data.stringToDate(sVal,"yyyy/mm/ddThh:mm:ss.fff");}else if(eDataType===df.ciTypeTime){tVal=df.sys.data.stringToDate(sVal,"hh:mm:ss");}return tVal;},typeToDisplay:function typeToDisplay(tVal,eDataType,oWebApp,bInputMask,sMask,iPrecision){var sVal=tVal;if(!bInputMask&&sMask&&eDataType!==df.ciTypeText){if(eDataType===df.ciTypeDate||eDataType===df.ciTypeDateTime||eDataType===df.ciTypeTime){sVal=tVal&&df.sys.data.applyDateMask(tVal,sMask,oWebApp.psDateSeparator,oWebApp.psTimeSeparator)||"";}else if(eDataType===df.ciTypeBCD){sVal=tVal!==null&&df.sys.data.applyNumMask(tVal||0.0,sMask,oWebApp.psDecimalSeparator,oWebApp.psThousandsSeparator,oWebApp.psCurrencySymbol)||"";}}else if(sMask&&eDataType===df.ciTypeText){sVal=df.sys.data.applyWinMask(sVal,sMask);}else{if(tVal!==""){if(eDataType===df.ciTypeBCD){sVal=tVal!==null&&df.sys.data.numToString(tVal,oWebApp.psDecimalSeparator,iPrecision);}else if(eDataType===df.ciTypeDate){sVal=tVal&&df.sys.data.dateToString(tVal,oWebApp.psDateFormat,oWebApp.psDateSeparator,oWebApp.psTimeSeparator)||"";}else if(eDataType===df.ciTypeDateTime){sVal=tVal&&df.sys.data.dateToString(tVal,oWebApp.psDateTimeFormat,oWebApp.psDateSeparator,oWebApp.psTimeSeparator)||"";}else if(eDataType===df.ciTypeTime){sVal=tVal&&df.sys.data.dateToString(tVal,oWebApp.psTimeFormat,oWebApp.psDateSeparator,oWebApp.psTimeSeparator)||"";}}}return sVal;}},cookie:{set:function set(sVar,sValue,iExpires,sOptPath){var date=new Date(),sParams="";if(iExpires){date.setHours(date.getHours()+iExpires);sParams+="; expires="+date.toGMTString();}if(sOptPath){sParams+="; path="+sOptPath;}document.cookie=sVar+"="+sValue+sParams;},del:function del(sVar){var date=new Date();date.setTime(date.getTime()-1);document.cookie=sVar+"=; expires="+date.toGMTString();},get:function get(sVar,sDefault){var sResult=null,aVars,aVar,iVar;if(document.cookie){aVars=document.cookie.split(';');for(iVar=0;iVar<aVars.length&&sResult===null;iVar++){aVar=aVars[iVar].split('=');if(aVar.length>1){if(aVar[0].trim()===sVar.trim()){sResult=aVar[1];}}}}if(sResult!==null){return sResult;}return sDefault;}},gui:{disableTabIndexes:function disableTabIndexes(eParent){var iElem,aElems,eElem;aElems=df.dom.query(eParent,df.dom.cFocusSelector,true);for(iElem=0;iElem<aElems.length;iElem++){eElem=aElems[iElem];if(eElem.getAttribute("data-dfOrigTabIndex")===null){eElem.setAttribute("data-dfTabIndexCount",1);eElem.setAttribute("data-dfOrigTabIndex",eElem.tabIndex);eElem.tabIndex="-1";}else{eElem.setAttribute("data-dfTabIndexCount",parseInt(eElem.getAttribute("data-dfTabIndexCount"),10)+1);}}},restoreTabIndexes:function restoreTabIndexes(eParent){var iElem,aElems,eElem;aElems=df.dom.query(eParent,df.dom.cFocusSelector,true);for(iElem=0;iElem<aElems.length;iElem++){eElem=aElems[iElem];if(parseInt(eElem.getAttribute("data-dfTabIndexCount"),10)!==null){if(eElem.getAttribute("data-dfTabIndexCount")<=1){eElem.tabIndex=eElem.getAttribute("data-dfOrigTabIndex");eElem.removeAttribute("data-dfOrigTabIndex");eElem.removeAttribute("data-dfTabIndexCount");}else{eElem.setAttribute("data-dfTabIndexCount",parseInt(eElem.getAttribute("data-dfTabIndexCount"),10)-1);}}}},hidePlugins:function hidePlugins(eElem){var aElems,i,aHidden=[];if(df.sys.isIE){aElems=df.dom.query(eElem,"iframe, object, embed",true);for(i=0;i<aElems.length;i++){eElem=aElems[i];if(eElem.getAttribute("data-df-hiddenplugin")!=="yes"){aHidden.push(eElem);eElem.style.display="none";eElem.setAttribute("data-df-hiddenplugin","yes");}}}return aHidden;},restorePlugins:function restorePlugins(aHidden){var i;for(i=0;i<aHidden.length;i++){aHidden[i].style.display="";aHidden[i].removeAttribute("data-df-hiddenplugin");}},getAbsoluteOffset:function getAbsoluteOffset(eElement){var oReturn={left:0,top:0},bFirst=true;if(eElement.offsetParent){while(eElement&&(bFirst||df.sys.gui.getCurrentStyle(eElement).position!=="absolute")&&df.sys.gui.getCurrentStyle(eElement).position!=="fixed"&&df.sys.gui.getCurrentStyle(eElement).position!=="relative"){bFirst=false;oReturn.top+=eElement.offsetTop;oReturn.left+=eElement.offsetLeft;eElement=eElement.offsetParent;}}else if(eElement.y){oReturn.left+=eElement.x;oReturn.top+=eElement.y;}return oReturn;},getViewportHeight:function getViewportHeight(){if(window.innerHeight!==undefined){return window.innerHeight;}if(document.compatMode==="CSS1Compat"){return document.documentElement.clientHeight;}if(document.body){return document.body.clientHeight;}return null;},getViewportWidth:function getViewportWidth(){if(document.compatMode==='CSS1Compat'){return document.documentElement.clientWidth;}if(document.body){return document.body.clientWidth;}if(window.innerWidth!==undefined){return window.innerWidth;}return null;},getSize:function getSize(eElem){if(df.sys.isIE||df.sys.isWebkit){return{width:eElem.offsetWidth,height:eElem.offsetHeight};}var oStyle=df.sys.gui.getCurrentStyle(eElem);return{width:parseInt(oStyle.getPropertyValue("width"),10),height:parseInt(oStyle.getPropertyValue("height"),10)};},getCurrentStyle:function getCurrentStyle(eElem){return typeof window.getComputedStyle==="function"?window.getComputedStyle(eElem,null):eElem.currentStyle;},getVertBoxDiff:function getVertBoxDiff(eElem,iOptType){var iDiff=0,oStyle=df.sys.gui.getCurrentStyle(eElem);iOptType=iOptType||0;if(iOptType===0||iOptType===1||iOptType===3){iDiff+=parseFloat(oStyle.marginTop)||0;}if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.borderTopWidth)||0;}if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingTop)||0;}if(iOptType===0||iOptType===1||iOptType===3){iDiff+=parseFloat(oStyle.marginBottom)||0;}if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.borderBottomWidth)||0;}if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingBottom)||0;}return iDiff;},getHorizBoxDiff:function getHorizBoxDiff(eElem,iOptType){var iDiff=0,oStyle=df.sys.gui.getCurrentStyle(eElem);iOptType=iOptType||0;if(iOptType===0||iOptType===1||iOptType===3){iDiff+=parseFloat(oStyle.marginLeft)||0;}if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.borderLeftWidth)||0;}if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingLeft)||0;}if(iOptType===0||iOptType===1||iOptType===3){iDiff+=parseFloat(oStyle.marginRight)||0;}if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.borderRightWidth)||0;}if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingRight)||0;}return iDiff;},isSizedByContent:function isSizedByContent(eElem){var iCH,bRes;iCH=eElem.clientHeight;eElem.appendChild(df.dom.create('<div style="width: 100%; height: 20px;">&nbsp</div>'));bRes=iCH!==eElem.clientHeight;eElem.removeChild(eElem.lastChild);return bRes;},getBoundRect:function getBoundRect(eElem){var oR=eElem.getBoundingClientRect();if(typeof oR.width!=='number'){return{top:oR.top,right:oR.right,bottom:oR.bottom,left:oR.left,width:oR.right-oR.left,height:oR.bottom-oR.top};}return oR;},rectToObj:function rectToObj(oR){return{top:oR.top,right:oR.right,bottom:oR.bottom,left:oR.left,width:oR.width,height:oR.height};},getTransformProp:function(){var sPrefix=null;function getTrans(){var i,aPre=['transform','WebkitTransform','MozTransform','OTransform','msTransform'];for(i=0;i<aPre.length;i++){if(document.createElement('div').style[aPre[i]]!==undefined){return aPre[i];}}return false;}return function(){if(sPrefix===null){sPrefix=getTrans();}return sPrefix;};}(),initCSS:function initCSS(){var aC,sB=document.body.className;if(sB){sB=sB.replace(/\bdf-ie*|df-safari|df-chrome|df-opera|df-mozilla|df-webkit|df-mobile\b/g,"").trim();aC=sB.split(' ');}else{aC=[];}if(df.sys.isIE){aC.push("df-ie");aC.push(df.sys.iVersion<=6?" df-ie6":" df-ie"+df.sys.iVersion);}else if(df.sys.isSafari){aC.push("df-safari");}else if(df.sys.isChrome){aC.push("df-chrome");}else if(df.sys.isOpera){aC.push("df-opera");}else if(df.sys.isMoz){aC.push("df-mozilla");}if(df.sys.isWebkit){aC.push("df-webkit");}if(df.sys.isMobile){aC.push("df-mobile");}document.body.className=aC.join(" ");},isOnScreen:function isOnScreen(el){var rect=el.getBoundingClientRect(),top=rect.top,height=rect.height,left=rect.left,width=rect.width;el=el.offsetParent;while(el&&el!=document.body){rect=el.getBoundingClientRect();if(top>rect.bottom){return false;}if(left>rect.right){return false;}if(top+height<=rect.top){return false;}if(left+width<=rect.left){return false;}el=el.offsetParent;}return top<=document.documentElement.clientHeight;},addScrollListeners:function addScrollListeners(eElem,fListen,oEnv){var aElems=[];while(eElem){aElems.push(eElem);df.dom.on("scroll",eElem,fListen,oEnv);eElem=eElem.offsetParent;}return aElems;},removeScrollListeners:function removeScrollListeners(aElems,fListen){var eElem;while(eElem=aElems.shift()){df.dom.off("scroll",eElem,fListen);}},cssTextAlign:function cssTextAlign(eAlign){switch(eAlign){case df.ciAlignLeft:return"left";case df.ciAlignCenter:return"center";case df.ciAlignRight:return"right";}return"";}},string:{trim:function trim(sString){return sString.trim();},ltrim:function ltrim(sString){return sString.replace(/^\s+/,"");},rtrim:function rtrim(sString){return sString.replace(/\s+$/,"");},copyCase:function copyCase(sValue,sSample){var bUpper,iChar,sResult="";for(iChar=0;iChar<sValue.length;iChar++){bUpper=iChar<sSample.length?sSample.charAt(iChar)===sSample.charAt(iChar).toUpperCase():bUpper;sResult+=bUpper?sValue.charAt(iChar).toUpperCase():sValue.charAt(iChar).toLowerCase();}return sResult;},encodeHtml:df.dom.encodeHtml},supportHtml5Input:function(){var oCache={};return function test(sType){var eElem;if(typeof oCache[sType]==="boolean"){return oCache[sType];}eElem=document.createElement("input");eElem.setAttribute("type",sType);oCache[sType]=eElem.type===sType;return oCache[sType];};}(),detectDevice:function detectDevice(){if(this._sPrevUA!==navigator.userAgent){this._sPrevUA=navigator.userAgent;this.isSafari=false;this.isChrome=false;this.isOpera=false;this.isMoz=false;this.isIE=false;this.isEdge=false;this.isWebkit=false;this.isMobile=false;this.isIOS=false;if(navigator.userAgent.indexOf("Trident")>=0){df.sys.isIE=true;if(document.documentMode){df.sys.iVersion=document.documentMode;}else if(navigator.appVersion.indexOf("MSIE")>=0){df.sys.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("MSIE")+4),10);}else{df.sys.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("rv:")+3),10);}}else if(navigator.userAgent.indexOf("Edge/")>=0){df.sys.isEdge=true;df.sys.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Edge/")+5));}else if(navigator.userAgent.indexOf("Chrome")>=0){df.sys.isChrome=true;df.sys.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Chrome/")+7));}else if(navigator.userAgent.indexOf("Safari")>=0){df.sys.isSafari=true;df.sys.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Version/")+8));}else if(navigator.product==="Gecko"){df.sys.isMoz=true;df.sys.iVersion=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Firefox/")+8));}else if(navigator.userAgent.indexOf("Opera")>=0){df.sys.isOpera=true;df.sys.iVersion=parseFloat(navigator.appVersion);}else{df.sys.isIE=true;df.sys.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("MSIE")+4),10);if(document.documentMode){df.sys.iVersion=document.documentMode;}}if(/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/i.test(navigator.userAgent)){df.sys.isMobile=true;}if(/(iPad|iPhone|iPod)/g.test(navigator.userAgent)){df.sys.isIOS=true;}if(navigator.userAgent.indexOf("AppleWebKit")>=0){df.sys.isWebkit=true;}df.dom.ready(df.sys.gui.initCSS);}}};df.sys.detectDevice();if(!Array.prototype.find){Array.prototype.find=function(callback){if(this===null){throw new TypeError('Array.prototype.find called on null or undefined');}else if(typeof callback!=='function'){throw new TypeError('callback must be a function');}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];for(var i=0;i<length;i++){var element=list[i];if(callback.call(thisArg,element,i,list)){return element;}}};}if(window.NodeList&&!NodeList.prototype.forEach){NodeList.prototype.forEach=function(callback,thisArg){thisArg=thisArg||window;for(var i=0;i<this.length;i++){callback.call(thisArg,this[i],i,this);}};}if(!Object.values){Object.values=function values(obj){var vals=[];for(var key in obj){if(obj.hasOwnProperty(key)&&obj.propertyIsEnumerable(key)){vals.push(obj[key]);}}return vals;};}if(!String.prototype.replaceAll){String.prototype.replaceAll=function(search,replacement){return this.split(search).join(replacement);};}if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;}if(!Element.prototype.closest){Element.prototype.closest=function(s){var el=this;do{if(Element.prototype.matches.call(el,s))return el;el=el.parentElement||el.parentNode;}while(el!==null&&el.nodeType===1);return null;};}df.sys.json={parse:function parse(sString){if((typeof JSON==="undefined"?"undefined":_typeof(JSON))==="object"&&typeof JSON.parse==="function"){return JSON.parse(sString);}this.oDecodeRegex.lastIndex=0;if(this.oDecodeRegex.test(sString)){sString=sString.replace(this.oDecodeRegex,function(sVal,iPos){return"\\u"+('0000'+sVal.charCodeAt(0).toString(16)).slice(-4);});}if(this.validate(sString)){return eval("("+sString+")");}throw new SyntaxError('JSON.parse');},validate:function validate(sJSON){return /^[\],:{}\s]*$/.test(sJSON.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''));},stringify:function stringify(oObject){if((typeof JSON==="undefined"?"undefined":_typeof(JSON))==="object"&&typeof JSON.stringify==="function"&&(!df.sys.isIE||df.sys.iVersion>8)){return JSON.stringify(oObject,function(sKey,sValue){return typeof sKey==="string"&&sKey.substr(0,2)==="__"?undefined:sValue;});}var aResult=[];this.switchToJson(oObject,aResult);return aResult.join("");},switchToJson:function switchToJson(object,aResult){switch(df.sys.ref.getType(object)){case"array":this.arrayToJson(object,aResult);break;case"string":this.stringToJson(object,aResult);break;case"number":this.numberToJson(object,aResult);break;case"boolean":this.booleanToJson(object,aResult);break;case"date":this.dateToJson(object,aResult);break;case"null":aResult.push("null");break;default:this.objectToJson(object,aResult);break;}},objectToJson:function objectToJson(oObj,aResult){var sProp,bFirst=true;if(oObj!==null&&oObj!==undefined){aResult.push("{");for(sProp in oObj){if(typeof oObj[sProp]!=="function"&&sProp.substr(0,2)!=="__"){if(!bFirst){aResult.push(",");}aResult.push('"');aResult.push(sProp);aResult.push('":');this.switchToJson(oObj[sProp],aResult);bFirst=false;}}aResult.push("}");}},arrayToJson:function arrayToJson(aArray,aResult){var iItem,bFirst=true;aResult.push("[");for(iItem=0;iItem<aArray.length;iItem++){if(!bFirst){aResult.push(",");}this.switchToJson(aArray[iItem],aResult);bFirst=false;}aResult.push("]");},oEncodeChars:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},stringToJson:function stringToJson(sString,aResult){aResult.push('"');this.oEncodeRegex.lastIndex=0;if(this.oEncodeRegex.test(sString)){sString=sString.replace(this.oEncodeRegex,function(sValue,iPos){var sRep=df.sys.json.oEncodeChars[sValue];return typeof sRep==="string"?sRep:"\\u"+('0000'+sValue.charCodeAt(0).toString(16)).slice(-4);});}aResult.push(sString);aResult.push('"');},booleanToJson:function booleanToJson(bBool,aResult){aResult.push(String(bBool));},numberToJson:function numberToJson(nNumber,aResult){aResult.push(isFinite(nNumber)?String(nNumber):nNumber);},dateToJson:function dateToJson(dDate,aResult){aResult.push('"');aResult.push(dDate.getUTCFullYear());aResult.push("-");aResult.push(df.sys.math.padZero(dDate.getUTCMonth()+1,2));aResult.push('-');aResult.push(df.sys.math.padZero(dDate.getUTCDate(),2));aResult.push('T');aResult.push(df.sys.math.padZero(dDate.getUTCHours(),2));aResult.push(':');aResult.push(df.sys.math.padZero(dDate.getUTCMinutes(),2));aResult.push(':');aResult.push(df.sys.math.padZero(dDate.getUTCSeconds(),2));aResult.push('Z');aResult.push('"');}};df.sys.json.oEncodeRegex=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;df.sys.json.oDecodeRegex=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;df.sys.vt={generateDeserializer:function generateDeserializer(tDef){var aCode=[],iFC=0,aObjs=[];function parseObj(sC,tDef){var sM,i=0,iFunc,aFunc=[];iFunc=aObjs.indexOf(tDef);if(iFunc<0){iFunc=iFC++;aObjs[iFunc]=tDef;aFunc.push('function p',iFunc,'(tVT){','return {');for(sM in tDef){if(tDef.hasOwnProperty(sM)){if(i>0){aFunc.push(',');}aFunc.push(sM,':',switchType('tVT.c['+i+']',tDef[sM]));i++;}}aFunc.push('};','}');aCode.push(aFunc.join(''));}return'p'+iFunc+'('+sC+')';}function parseArray(sC,tDef){var iFunc=iFC++,aFunc=[];aFunc.push('function p',iFunc,'(tVT){','var a = [], i; ','for(i = 0; i < tVT.c.length; i++){');aFunc.push('a.push(',switchType('tVT.c[i]',tDef[0]),');');aFunc.push('}','return a;','}');aCode.push(aFunc.join(''));return'p'+iFunc+'('+sC+')';}function parseEndNode(sC,tDef){switch(tDef){case df.tBool:return'df.toBool('+sC+'.v)';case df.tInt:return'df.toInt('+sC+'.v)';case df.tNumber:return'df.toNumber('+sC+'.v)';case df.tDate:return'df.toDate('+sC+'.v)';default:return sC+'.v';}}function switchType(sC,tDef){if(typeof tDef==="number"){return parseEndNode(sC,tDef);}if(tDef instanceof Array){return parseArray(sC,tDef);}return parseObj(sC,tDef);}aCode.push('try{','return ',switchType("tVT",tDef),';','}catch(oErr){','throw new df.Error(999, "Unable to deserialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}", this, [ oErr.message ]);','}');return new Function("tVT",aCode.join(''));},generateSerializer:function generateSerializer(tDef){var aCode=[],iFC=0;function parseObj(sC,tDef){var sM,i=0,iFunc=iFC++,aFunc=[];aFunc.push('function p',iFunc,'(oObj){','return {','v : "",','c : [');for(sM in tDef){if(tDef.hasOwnProperty(sM)){if(i>0){aFunc.push(',');}aFunc.push(switchType('oObj["'+sM+'"]',tDef[sM]));i++;}}aFunc.push(']','};','}');aCode.push(aFunc.join(''));return'p'+iFunc+'('+sC+')';}function parseArray(sC,tDef){var iFunc=iFC++,aFunc=[];aFunc.push('function p',iFunc,'(aArray){','var tVT = { v : "", c : [] }, i;','for(i = 0; i < aArray.length; i++){');aFunc.push('tVT.c.push(',switchType('aArray[i]',tDef[0]),');');aFunc.push('}','return tVT;','}');aCode.push(aFunc.join(''));return'p'+iFunc+'('+sC+')';}function parseEndNode(sC,tDef){switch(tDef){case df.tBool:return'{ v : df.fromBool('+sC+'), c : [] }';case df.tDate:return'{ v : df.fromDate('+sC+'), c : [] }';default:return'{ v : '+sC+'.toString(), c : [] }';}}function switchType(sC,tDef){if(typeof tDef==="number"){return parseEndNode(sC,tDef);}if(tDef instanceof Array){return parseArray(sC,tDef);}return parseObj(sC,tDef);}aCode.push('try{','return ',switchType("tStruct",tDef),';','}catch(oErr){','throw new df.Error(999, "Unable to serialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}", this, [ oErr.message ]);','}');return new Function("tStruct",aCode.join(''));},deserialize:function deserialize(tVT,tDef){function parseObj(tVT,tDef){var sM,i=0,oRes={};for(sM in tDef){if(tDef.hasOwnProperty(sM)){oRes[sM]=switchType(tVT.c[i],tDef[sM]);i++;}}return oRes;}function parseArray(tVT,tDef){var i,aRes=[];for(i=0;i<tVT.c.length;i++){aRes.push(switchType(tVT.c[i],tDef[0]));}return aRes;}function parseEndNode(tVT,tDef){switch(tDef){case df.tBool:return df.toBool(tVT.v);case df.tInt:return df.toInt(tVT.v);case df.tNumber:return df.toNumber(tVT.v);case df.tDate:return df.toDate(tVT.v);default:return tVT.v;}}function switchType(tVT,tDef){if(typeof tDef==="number"){return parseEndNode(tVT,tDef);}if(tDef instanceof Array){return parseArray(tVT,tDef);}return parseObj(tVT,tDef);}try{return switchType(tVT,tDef);}catch(oErr){throw new df.Error(999,"Unable to deserialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}",this,[oErr.message]);}},serialize:function serialize(tStruct){function parseObj(oObj){var sM,oRes={v:"",c:[]};for(sM in oObj){if(oObj.hasOwnProperty(sM)){oRes.c.push(switchType(oObj[sM]));}}return oRes;}function parseArray(aArray){var i,oRes={v:"",c:[]};for(i=0;i<aArray.length;i++){oRes.c.push(switchType(aArray[i]));}return oRes;}function parseEndNode(oObj){if(typeof oObj==="boolean"){return{v:df.fromBool(oObj),c:[]};}if(oObj instanceof Date){return{v:df.fromDate(oObj),c:[]};}return{v:oObj.toString(),c:[]};}function switchType(tStruct){if(_typeof(tStruct)==="object"){if(tStruct instanceof Array){return parseArray(tStruct);}if(tStruct instanceof Date){return parseEndNode(tStruct);}return parseObj(tStruct);}return parseEndNode(tStruct);}try{return switchType(tStruct);}catch(oErr){throw new df.Error(999,"Unable to serialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}",this,[oErr.message]);}}};df.ajax.REQUEST_STATE_UNITIALIZED=0;df.ajax.REQUEST_STATE_LOADING=1;df.ajax.REQUEST_STATE_LOADED=2;df.ajax.REQUEST_STATE_INTERACTIVE=3;df.ajax.REQUEST_STATE_COMPLETE=4;df.ajax.HttpRequest=function HttpRequest(sUrl,sData,oSource){if(sData===undefined){sData=null;}this.sUrl=sUrl;this.pbWithCredentials=false;this.sData=sData;this.bAsynchronous=true;this.onFinished=new df.events.JSHandler();this.onError=new df.events.JSHandler();this.onClose=new df.events.JSHandler();this.oLoader=null;this.oSource=oSource||null;this.bSilent=false;};df.defineClass("df.ajax.HttpRequest",{send:function send(bAsynchronous){var that=this,sData;if(typeof bAsynchronous==="boolean"){this.bAsynchronous=bAsynchronous;}this.oLoader=new XMLHttpRequest();sData=this.getData();if(this.bAsynchronous){this.oLoader.onreadystatechange=function(){that.onReadyStateChange();};}try{this.oLoader.open(sData?"POST":"GET",this.getRequestUrl(),this.bAsynchronous);this.oLoader.withCredentials=this.pbWithCredentials;this.setHeaders(this.oLoader);this.oLoader.send(sData);}catch(oErr){throw new df.Error(5121,"The application was unable to communicate with the server.",this);}if(!this.bAsynchronous){this.onReadyStateChange();}},onReadyStateChange:function onReadyStateChange(){try{if(this.oLoader.readyState===df.ajax.REQUEST_STATE_COMPLETE){if(this.oLoader.status>0){this.onClose.fire(this);this.checkErrors();this.onFinished.fire(this,this.getFinishedDetails());}else{throw new df.Error(5121,"The application was unable to communicate with the server.",this);}}}catch(e){if(!this.bSilent){df.handleError(e,this);}this.onError.fire(this,{oError:e});}},getFinishedDetails:function getFinishedDetails(){return{oResponseXml:this.getResponseXml(),sResponseText:this.getResponseText()};},checkErrors:function checkErrors(bSkip500){if(this.oLoader.status>=300&&(!bSkip500||this.oLoader.status!==500)){var sDetailHtml=this.oLoader.responseText;throw new df.Error(5120,"Received HTTP error '{{0}} {{1}}' while loading URL '{{2}}'.",this,[this.oLoader.status,this.oLoader.statusText,this.getRequestUrl()],sDetailHtml);}},setHeaders:function setHeaders(oLoader){},getRequestUrl:function getRequestUrl(){return this.sUrl;},getResponseXml:function getResponseXml(){return this.oLoader.responseXML;},getResponseText:function getResponseText(){return this.oLoader.responseText;},getData:function getData(){return this.sData;},cancel:function cancel(){if(this.oLoader!==null){this.onClose.fire(this);this.oLoader.onreadystatechange=function(){};this.oLoader.abort();this.oLoader=null;}else if(df.ajax.oDefaultQueue&&this.bAsynchronous){df.ajax.oDefaultQueue.removeCall(this);}this.onFinished.aListener=[];},destroy:function destroy(){try{if(this.bAsynchronous&&this.oLoader&&this.oLoader.onreadystatechange){this.oLoader.onreadstatechange=null;}}catch(oErr){}this.oLoader=null;},getWebApp:function getWebApp(){if(this.oSource&&this.oSource.getWebApp){return this.oSource.getWebApp();}return null;}});df.ajax.JSONCall=function JSONCall(sFunction,oParams,sUrl,oSource){if(sUrl===undefined||sUrl===null){sUrl="WebService.wso";}df.ajax.JSONCall.base.constructor.call(this,sUrl,null,oSource);this.sFunction=sFunction;this.oParams=oParams||{};this.bUsePOST=true;this.bExtendURL=true;this._oJSON=null;};df.defineClass("df.ajax.JSONCall","df.ajax.HttpRequest",{addParam:function addParam(sName,sValue){this.oParams[sName]=sValue;},setHeaders:function setHeaders(oLoader){df.ajax.JSONCall.base.setHeaders.call(this,oLoader);if(this.bUsePOST){oLoader.setRequestHeader("Content-Type","application/json");}},getData:function getData(){if(this.bUsePOST){return df.sys.json.stringify(this.oParams);}return null;},getRequestUrl:function getRequestUrl(){var sUrl,sParam,aParams=[];sUrl=df.ajax.JSONCall.base.getRequestUrl.call(this);if(sUrl.indexOf("/JSON")>=0){sUrl=sUrl.replace("/JSON","/"+this.sFunction+"/JSON");}else{if(sUrl.indexOf("?")>=0){sUrl=sUrl.replace("?","/"+this.sFunction+"/JSON");}else{sUrl=sUrl+(sUrl.charAt(sUrl.length-1)!=="/"?"/":"")+this.sFunction+"/JSON";}}if(!this.bUsePOST){for(sParam in this.oParams){if(this.oParams.hasOwnProperty(sParam)){aParams.push(aParams.length<=0&&sUrl.indexOf("?")<0?"?":"&");aParams.push(encodeURIComponent(sParam));aParams.push("=");aParams.push(encodeURIComponent(String(this.oParams[sParam])));}}return sUrl+aParams.join("");}return sUrl;},getResponseXml:function getResponseXml(){return null;},checkErrors:function checkErrors(){var tError;if(this.oLoader.status>=400&&this.oLoader.status<600){try{tError=df.sys.json.parse(this.getResponseText());}catch(oErr){}if(tError&&tError.errorCode){throw new df.Error(5122,tError.errorDescription,this,[],null,false,false,"Server returned HTTP error 500");}if(tError&&tError.error){throw new df.Error(5122,tError.error.message,this,[],null,false,false,"HTTP Status "+this.oLoader.status+": "+(tError.error.reason||this.oLoader.statusText||""));}}df.ajax.JSONCall.base.checkErrors.call(this);},getResponseValue:function getResponseValue(){var sJSON=this.getResponseText();try{return df.sys.json.parse(sJSON);}catch(oErr){throw new df.Error(5123,"Received invalid JSON from the server.",this,[],oErr.message);}}});df.ServerAction=function ServerAction(){this.oWO=null;this.sAction="";this.aParams=[];this.tData={v:"",c:[]};this.aViews=[];this.eCallMode=df.cCallModeDefault;this.sProcessMessage="";this.fHandler=null;this.oHandlerEnv=null;this.sReturnValue=null;};df.ServerCall=function(){this.aActions=[];this.eCallMode=df.cCallModeDefault;this.sProcessMessage="";this.sFocus="";this.aWaiters=[];this.bSending=false;};df.InfoBalloon=function(oControl,sCssClass,sMessage){this.psMessage=sMessage;this.piHideDelay=6000;this.pbShowOnHover=true;this.psCSSClass=sCssClass;this.poTarget=oControl;this._eElem=null;this._eEventElem=null;this._eParentRef=null;this._bFirstPos=true;this._bTopTooltip=false;this._tHideTimeout=null;this._tPositionInterval=null;};df.defineClass("df.InfoBalloon",{update:function update(){if(this._eElem){this._eElem.innerHTML=this.psMessage;this._eElem.className="WebInfoBalloon "+this.psCSSClass;this._eElem.style.bottom="";this._eElem.style.top="";this._eElem.style.left="";this._bTopTooltip=false;this._bFirstPos=true;this.position();}},init:function init(){var eRef,eTarget=this.getTargetElem();if(!this._eElem&&eTarget){this._eElem=df.dom.create('<div class="WebInfoBalloon WebInfoBalloonHidden '+this.psCSSClass+'"></div>');this._eElem.innerHTML=this.psMessage;document.body.appendChild(this._eElem);this._bTopTooltip=false;this._bFirstPos=true;this.position();if(this.pbShowOnHover){df.dom.on("mouseover",eTarget,this.onMouseOver,this);df.dom.on("mouseout",eTarget,this.onMouseOut,this);this._eEventElem=eTarget;}}},destroy:function destroy(){if(this._eElem&&this._eElem.parentNode){this._eElem.parentNode.removeChild(this._eElem);}this._eElem=null;},show:function show(){if(!this._eElem){this.init();}else{if(this._eElem.parentNode.lastChild!==this._eElem){this._eElem.parentNode.appendChild(this._eElem);}}this._show();this.setTimeout();},_show:function _show(){var that=this;if(this._eElem){df.dom.addClass(this._eElem,"WebInfoBalloonVisible");df.dom.removeClass(this._eElem,"WebInfoBalloonHidden");if(!this._tPositionInterval){this._tPositionInterval=setInterval(function(){that.position();},300);}}},getTargetElem:function getTargetElem(){var eElem=this.poTarget._eElem;if(this.poTarget.getTooltipElem){eElem=this.poTarget.getTooltipElem()||eElem;}return eElem;},hide:function hide(){var eElem=this._eElem;if(this._eElem){this._hide();if(this._eEventElem){df.dom.off("mouseover",this._eEventElem,this.onMouseOver);df.dom.off("mouseout",this._eEventElem,this.onMouseOut);this._eEventElem=null;}if(this._tHideTimeout){clearTimeout(this._tHideTimeout);this._tHideTimeout=null;}setTimeout(function(){if(eElem.parentNode){eElem.parentNode.removeChild(eElem);}},3000);this._eElem=null;}},_hide:function _hide(){if(this._eElem){df.dom.addClass(this._eElem,"WebInfoBalloonHidden");df.dom.removeClass(this._eElem,"WebInfoBalloonVisible");}if(this._tPositionInterval){clearInterval(this._tPositionInterval);this._tPositionInterval=null;}},position:function position(){var iTop=0,iLeft=0,iHeight,iBottom,iWidth,eTarget,eTool,oRectT;eTarget=this.getTargetElem();eTool=this._eElem;if(eTool&&eTarget){var iScreenWidth=df.dom.windowWidth();if(!df.sys.gui.isOnScreen(eTarget)){eTool.style.display="none";return;}else{eTool.style.display="";}oRectT=df.sys.gui.getBoundRect(eTarget);iTop=oRectT.top+oRectT.height;iLeft=oRectT.left+Math.max(Math.round((oRectT.width-70)/2),0);iHeight=eTool.clientHeight+df.sys.gui.getVertBoxDiff(eTool);iWidth=eTool.clientWidth+df.sys.gui.getHorizBoxDiff(eTool);iBottom=iTop+eTarget.offsetHeight;if(this._bFirstPos){if(screen.height<iTop+iHeight&&screen.height>iBottom+iHeight){this._bTopTooltip=true;df.dom.addClass(this._eElem,"WebInfoBalloon_Top");}this._bFirstPos=false;}if(iScreenWidth<iLeft+iWidth){iLeft=Math.max(oRectT.left-10,0);}if(this._bTopTooltip){eTool.style.bottom=iBottom+"px";}else{eTool.style.top=iTop+"px";}eTool.style.left=iLeft+"px";}},setTimeout:function(_setTimeout){function setTimeout(){return _setTimeout.apply(this,arguments);}setTimeout.toString=function(){return _setTimeout.toString();};return setTimeout;}(function(){var that=this;if(this.piHideDelay>0){if(this._tHideTimeout){clearTimeout(this._tHideTimeout);}this._tHideTimeout=setTimeout(function(){that._hide();},this.piHideDelay);}}),onMouseOver:function onMouseOver(oEvent){this._show();if(this._tHideTimeout){clearTimeout(this._tHideTimeout);this._tHideTimeout=null;}},onMouseOut:function onMouseOut(oEvent){this.setTimeout();},resize:function resize(){this.position();}});df.MobRuleController=function(oWebApp){this._oWebApp=oWebApp;this.peMode=-1;this.pbActive=true;this._aWOs=[];this._aModes=[{eM:df.modeDesktop,sCSS:"df-ModeDesktop"},{eM:df.modeTablet,sCSS:"df-ModeTablet"},{eM:df.modeTabletLandscape,sCSS:"df-ModeTabletLandscape"},{eM:df.modeTabletPortrait,sCSS:"df-ModeTabletPortrait"},{eM:df.modeMobile,sCSS:"df-ModeMobile"},{eM:df.modeMobileLandscape,sCSS:"df-ModeMobileLandscape "},{eM:df.modeMobilePortrait,sCSS:"df-ModeMobilePortrait"}];this.init();};df.defineClass("df.MobRuleController",{init:function init(){this.detectMode();df.dom.ready(function(){df.dom.on("resize",window,this.onWindowResize,this);df.dom.on("orientationchange",document,this.onWindowResize,this);this.detectMode();},this);},destroy:function destroy(){df.dom.off("resize",window,this.onWindowResize);df.dom.off("orientationchange",document,this.onWindowResize);},regWO:function regWO(oWO){this._aWOs.push(oWO);},remWO:function remWO(oWO){var i=this._aWOs.indexOf(oWO);if(i>=0){this._aWOs.splice(i,1);}},enforceMode:function enforceMode(eMode){var i,oWO,sProp,that=this;this.peMode=eMode;df.dom.ready(function(){var i,eMode=that.pbActive?that.peMode:0;for(i=0;i<that._aModes.length;i++){df.dom.toggleClass(document.body,that._aModes[i].sCSS,that._aModes[i].eM<=eMode);}that._oWebApp.sizeChanged();});for(i=0;i<this._aWOs.length;i++){oWO=this._aWOs[i];for(sProp in oWO._oPropRuleStore){if(oWO._oPropRuleStore.hasOwnProperty(sProp)){this.enforceRule(oWO,sProp);}}}},enforceRule:function enforceRule(oWO,sProp){var i,tDet,eMode=this.pbActive?this.peMode:0;if(eMode>=0){tDet=oWO._oPropRuleStore[sProp];if(!oWO._oSynced[sProp]){if(tDet.sDefault===null){tDet.sDefault=oWO.get(sProp);}for(i=0;i<tDet.aRules.length;i++){if(tDet.aRules[i].eM<=eMode){oWO._set(sProp,tDet.aRules[i].sV,true,false);tDet.bActive=true;return;}}if(tDet.bActive){oWO.set(sProp,tDet.sDefault,true);tDet.bActive=false;}}}},detectMode:function detectMode(){var eMode=df.modeDesktop,iWidth,iHeight,bLandscape;df.sys.detectDevice();if(df.sys.isMobile){eMode=this.detectOrientation();bLandscape=eMode==df.modeMobileLandscape;iWidth=window.screen.width;iHeight=window.screen.height;}else{iWidth=df.dom.windowWidth();iHeight=df.dom.windowHeight();bLandscape=iWidth>iHeight;}if(iWidth<580||bLandscape&&iHeight<420){eMode=bLandscape?df.modeMobileLandscape:df.modeMobilePortrait;}else if(iWidth<1100||df.sys.isMobile){eMode=bLandscape?df.modeTabletLandscape:df.modeTabletPortrait;}if(eMode!==this.peMode&&this.pbActive){this.enforceMode(eMode);}},detectOrientation:function detectOrientation(){var dfOrientation=df.modeMobilePortrait;if(window.screen.orientation){if(window.screen.orientation.type.indexOf("portrait")>=0){dfOrientation=df.modeMobilePortrait;}else if(window.screen.orientation.type.indexOf("landscape")>=0){dfOrientation=df.modeMobileLandscape;}}else if(window.orientation){if(window.orientation==90||window.orientation==-90){dfOrientation=df.modeMobileLandscape;}}return dfOrientation;},onWindowResize:function onWindowResize(oEvent){this.detectMode();},activate:function activate(){if(!this.pbActive){this.pbActive=true;this.enforceMode(this.peMode);}},deactivate:function deactivate(){if(this.pbActive){this.pbActive=false;this.enforceMode(this.peMode);}}});df.GroupHub=function GroupHub(){this._oGroups={};};df.defineClass("df.GroupHub",{addListener:function addListener(sGroup,oListener){var aData;sGroup=sGroup.toLowerCase();if(!this._oGroups[sGroup]){this._oGroups[sGroup]={aListeners:[],aProviders:[]};}this._oGroups[sGroup].aListeners.push(oListener);aData=this.collectGroup(sGroup);oListener.groupUpdate(aData);},remListener:function remListener(sGroup,oListener){sGroup=sGroup.toLowerCase();if(this._oGroups[sGroup]){var i=this._oGroups[sGroup].aListeners.indexOf(oListener);if(i>=0){this._oGroups[sGroup].aListeners.splice(i,1);}}},addProvider:function addProvider(sGroup,oProv){sGroup=sGroup.toLowerCase();if(!this._oGroups[sGroup]){this._oGroups[sGroup]={aListeners:[],aProviders:[]};}this._oGroups[sGroup].aProviders.push(oProv);this.updateGroup(sGroup);},remProvider:function remProvider(sGroup,oProv){var i;sGroup=sGroup.toLowerCase();if(this._oGroups[sGroup]){i=this._oGroups[sGroup].aProviders.indexOf(oProv);if(i>=0){this._oGroups[sGroup].aProviders.splice(i,1);this.updateGroup(sGroup);}}},updateGroup:function updateGroup(sGroup){var aL,i,aData;sGroup=sGroup.toLowerCase();if(this._oGroups[sGroup]&&this._oGroups[sGroup].aListeners.length>0){aData=this.collectGroup(sGroup);aL=this._oGroups[sGroup].aListeners;for(i=0;i<aL.length;i++){aL[i].groupUpdate(aData);}}},collectGroup:function collectGroup(sGroup){var aData=[],aP,i;sGroup=sGroup.toLowerCase();aP=this._oGroups[sGroup].aProviders;for(i=0;i<aP.length;i++){aP[i].groupCollect(aData);}return aData;},getListeners:function getListeners(sGroup){if(this._oGroups[sGroup]){return this._oGroups[sGroup].aListeners.slice();}return[];}});df.WebObject=function WebObject(sName,oParent){this._sName=sName;this._oParent=oParent||null;this._oTypes={};this._oSynced={};this._aChildren=[];this._oServerActionModes={};this._oServerWaitMsg={};this._tActionData=null;this._oPropRuleStore=null;this._bStandalone=!sName;this._oWebApp=null;this._oView=null;this._bIsWO=true;};df.defineClass("df.WebObject",{create:function create(tDef){},destroy:function destroy(){var oWO;if(this._oPropRuleStore){this.getWebApp()._oModeControl.remWO(this);}while(oWO=this._aChildren.pop()){oWO.destroy();}this._oWebApp=null;this._oView=null;if(this._oParent){delete this._oParent[this._sName];}this._oParent=null;},addChild:function addChild(oChild){this._aChildren.push(oChild);},prop:function prop(eType,sName,sVal){this[sName]=sVal;this._oTypes[sName]=eType;},toLocalType:function toLocalType(val,eType){switch(eType){case df.tString:return val;case df.tBool:return df.toBool(val);case df.tInt:return df.toInt(val);case df.tNumber:return df.toNumber(val);case df.tAdv:return val;default:return val;}},toServerType:function toServerType(val,eType){switch(eType){case df.tString:if(typeof val==="string"){return val;}if(val){return val.toString();}return"";case df.tBool:return df.fromBool(val);case df.tNumber:return df.fromNumber(val);case df.tAdv:return val;default:if(val!==null){return val.toString();}else{return val;}}},get:function get(sProp){if(this['get_'+sProp]){return this['get_'+sProp]();}return this[sProp];},set:function set(sProp,val,bOptNoSync){var bRes;if(this['set_'+sProp]){bRes=this['set_'+sProp](val);}if(this[sProp]!==undefined&&bRes!==false){this[sProp]=val;}if(bOptNoSync!==true){this.addSync(sProp);}},_set:function _set(sProp,val,bSetter,bSync){var bRes;if(this._oTypes[sProp]){val=this.toLocalType(val,this._oTypes[sProp]);}if(bSetter){if(this['set_'+sProp]){bRes=this['set_'+sProp](val,true);}}this[sProp]=val;if(bSync){this.addSync(sProp);}},addSync:function addSync(sProp){if(!this._oSynced.hasOwnProperty(sProp)){this._oSynced[sProp]=true;}},unSync:function unSync(sProp){if(this._oSynced.hasOwnProperty(sProp)){delete this._oSynced[sProp];}},getSynced:function getSynced(aObjs,aAdvProps){var i,sProp,aProps=[],val,sObj=this.getLongName();for(sProp in this._oSynced){if(this._oSynced.hasOwnProperty(sProp)){val=this.get(sProp);if(this._oTypes[sProp]){val=this.toServerType(val,this._oTypes[sProp]);}if(val===undefined){val=null;}if(this._oTypes[sProp]===df.tAdv){aAdvProps.push({sO:sObj,sP:sProp,tV:val});}else{aProps.push({sN:sProp,sV:val});}}}if(aProps.length>0){aObjs.push({sO:sObj,aP:aProps});}for(i=0;i<this._aChildren.length;i++){this._aChildren[i].getSynced(aObjs,aAdvProps);}},getLongName:function getLongName(){if(this._oParent){return this._oParent.getLongNamePrnt()+this._sName;}return this._sName;},getLongNamePrnt:function getLongNamePrnt(){return this.getLongName()+".";},getWebApp:function getWebApp(){if(this._oWebApp){return this._oWebApp;}this._oWebApp=this instanceof df.WebApp&&this||this._oParent&&this._oParent.getWebApp&&this._oParent.getWebApp()||null;return this._oWebApp;},getView:function getView(){if(this._oView){return this._oView;}this._oView=this instanceof df.WebView&&this||this._oParent&&this._oParent.getView&&this._oParent.getView()||null;return this._oView;},getObjectLevel:function getObjectLevel(){var oObj=this,oView=this.getView(),iLevel=0;while(oObj!==oView){oObj=oObj._oParent;iLevel++;}return iLevel;},serverAction:function serverAction(sMethod,aOptParams,tOptData,fOptHandler,oOptEnv){this.serverActionEx({sMethod:sMethod,aParams:aOptParams||[],tData:tOptData||null,fHandler:fOptHandler,oHandlerEnv:oOptEnv});},serverActionEx:function serverActionEx(oConf){var oView,sMethod,oAction=new df.ServerAction();oAction.oWO=this;oAction.sAction=sMethod=oConf.sMethod;oAction.aParams=oConf.aParams||[];oAction.tData=oConf.tData||null;oAction.fHandler=oConf.fHandler||null;oAction.oHandlerEnv=oConf.oHandlerEnv||this;oAction.aViews=oConf.aViews||[];oView=this.getView();if(oView){oAction.aViews.push(oView);}if(oConf.eCallMode){oAction.eCallMode=oConf.eCallMode;}else{oAction.eCallMode=this._oServerActionModes[sMethod.toLowerCase()]||df.cCallModeDefault;if(oAction.eCallMode===df.cCallModeProgress&&this._oServerWaitMsg[sMethod.toLowerCase()]){oAction.sProcessMessage=this._oServerWaitMsg[sMethod.toLowerCase()];}}this.getWebApp().handleAction(oAction);},cancelServerAction:function cancelServerAction(sMethod){this.getWebApp().cancelAction(this,sMethod);},hasPendingServerAction:function hasPendingServerAction(sMethod){return this.getWebApp().hasPendingAction(this,sMethod);},callBack:function callBack(sFunction){var i,aParams=[];for(i=1;i<arguments.length;i++){aParams.push(arguments[i]);}this.serverAction(sFunction,aParams,this._tActionData);},setActionMode:function setActionMode(sMethod,eMode,sOptWaitMessage){if(eMode){this._oServerActionModes[sMethod.toLowerCase()]=df.toInt(eMode);if(sOptWaitMessage){this._oServerWaitMsg[sMethod.toLowerCase()]=sOptWaitMessage;}}else{throw new df.Error(999,"Assertion: Invalid server-action mode '{{0}}' for message '{{1}}'",this,[eMode,sMethod]);}},getActionMode:function getActionMode(sMethod){return this._oServerActionModes[sMethod.toLowerCase()]||df.cCallModeDefault;},event:function event(sName,eOptMode,sOptServerName){this.setActionMode(sName,arguments.length>1?eOptMode:df.cCallModeDefault);this[sName]=new df.events.JSHandler(sOptServerName||sName);this.prop(df.tBool,"pbServer"+sName,false);this.prop(df.tString,"psClient"+sName,"");},fire:function fire(sName,aOptParams,fOptHandler,oOptEnv){return this.fireEx({sEvent:sName,aParams:aOptParams,fHandler:fOptHandler,oEnv:oOptEnv});},fireEx:function fireEx(oConf){var oEvent,bResult=false,bASync=false,oFunc,sName,oJsHandler=null;sName=oConf.sEvent;if(!sName){throw new df.Error(999,"Event name missing in fireEx.",this);}if(!oConf.aParams||!(oConf.aParams instanceof Array)){oConf.aParams=[];}oEvent=new df.events.JSEvent(this,{aParams:oConf.aParams,oConf:oConf,bClient:false,bServer:false,sReturnVal:null,aViews:oConf.aView||[]});if(this['psClient'+sName]&&!oConf.bSkipClient){oFunc=this.findFunc(this['psClient'+sName]);if(typeof oFunc.fFunc==='function'){oEvent.bClient=bResult=true;try{if(oFunc.fFunc.call(oFunc.oEnv,oEvent)===false){oEvent.stop();}}catch(oError){this.getWebApp().handleError(oError);}}else{this.getWebApp().handleError(new df.Error(999,"Event handler function '{{0}}' set as 'psClient{{1}}' not found.",this,[this['psClient'+sName],sName]));}}if(!oEvent.bCanceled){if(this[sName]instanceof df.events.JSHandler){oJsHandler=this[sName];oEvent.bClient=bResult=bResult||oJsHandler.aListeners.length>0;oJsHandler.fire(this,oEvent);}}if(!oEvent.bCanceled){var sServerName=oConf.sAltServerName||oJsHandler&&oJsHandler.sServerName||sName;if(this['pbServer'+sName]&&df.toBool(this['pbServer'+sName])&&!oConf.bSkipServer){bResult=true;bASync=true;this.serverAction(sServerName,oConf.aParams,oConf.tActionData||null,function(oActEvent){oEvent.sReturnValue=oActEvent.sReturnValue;oEvent.bServer=true;if(oConf.fHandler){oConf.fHandler.call(oConf.oEnv||this,oEvent);}},this);}}if(!bASync){if(oConf.fHandler){oConf.fHandler.call(oConf.oEnv||this,oEvent);}}return bResult;},insertChild:function insertChild(oChild,iIndex){this._aChildren.splice(iIndex,0,oChild);},renderChild:function renderChild(oChild,eOptChild){},removeChild:function removeChild(oChild){var iIndex=this._aChildren.indexOf(oChild);if(iIndex!==-1){this._aChildren.splice(iIndex,1);}},unrenderChild:function unrenderChild(oChild){},propRule:function propRule(sProp,eMode,sValue){var oWebApp=this.getWebApp(),bFound=false,i;eMode=df.toInt(eMode);if(!this._oPropRuleStore){this._oPropRuleStore={};if(oWebApp._oModeControl){oWebApp._oModeControl.regWO(this);}else{throw new df.Error(999,"Mobile mode controller not available!",this);}}if(!this._oPropRuleStore[sProp]){this._oPropRuleStore[sProp]={sDefault:null,aRules:[],bActive:false};}else{for(i=0;i<this._oPropRuleStore[sProp].aRules.length;i++){if(this._oPropRuleStore[sProp].aRules[i].eM===eMode){bFound=true;this._oPropRuleStore[sProp].aRules[i].sV=sValue;}}}if(!bFound){this._oPropRuleStore[sProp].aRules.push({eM:eMode,sV:sValue});this._oPropRuleStore[sProp].aRules.sort(function(a,b){return b.eM-a.eM;});}oWebApp._oModeControl.enforceRule(this,sProp);},findFunc:function findFunc(sFunc){var aParts,fFunc=null,sCur,oCur=null,oGlob;if(sFunc){aParts=sFunc.split(".");while(aParts.length>1){sCur=aParts.shift();if(!oCur){if(sCur==="window"){oCur=window;}else if(sCur==="this"){oCur=this;}else{if(_typeof(this[sCur])==="object"){oCur=this[sCur];}else{oGlob=df.sys.ref.getGlobalObj();if(_typeof(oGlob[sCur])==="object"){oCur=oGlob[sCur];}}}}else{oCur=oCur[sCur];}}sCur=aParts[0];if(oCur){fFunc=oCur[sCur];}else if(typeof this[sCur]==="function"){fFunc=this[sCur];oCur=this;}else{oGlob=df.sys.ref.getGlobalObj();if(typeof oGlob[sCur]==="function"){fFunc=oGlob[sCur];oCur=oGlob;}}}return{fFunc:fFunc,oEnv:oCur};},isParent:function isParent(oPrnt){var oObj=this;while(oObj){if(oObj==oPrnt){return true;}oObj=oObj._oParent;}return false;}});df.WebDragDrop_Mixin=function WebDragDrop_Mixin(sName,oParent){this.getBase("df.WebDragDrop_Mixin").constructor.call(this,sName,oParent);this.prop(df.tBool,"pbDragDropEnabled",false);this._sRawDragData="";this._aDragDropHelpers=new Set();this._aDropZones=[];this._aDragActions=new Set();this._aDropActions=new Set();this.event("OnDragStart",df.cCallModeWait);this.event("OnDrop",df.cCallModeDefault);};df.defineClass("df.WebDragDrop_Mixin",{addDragDropEventListeners:function addDragDropEventListeners(){if(this._aDragActions.size>0){df.dom.on("dragstart",this._eElem,this.onDragStart,this);df.dom.on("dragend",this._eElem,this.onDragEnd,this);}},registerDragSource:function registerDragSource(oHelper,eAction){this._aDragDropHelpers.add(oHelper);this._aDragActions.add(eAction);this.resize();},registerDropTarget:function registerDropTarget(oHelper,eAction){if(this._aDropActions.size>0){if(eAction==df.dropActions.WebControl.ciDropOnControl||this._aDropActions.has(df.dropActions.WebControl.ciDropOnControl)){throw new df.Error(999,'Drop Action "DropOnControl" cannot be used in conjunction with other Drop Actions. Ensure only "DropOnControl" or any of the other actions are registered exclusively.',this);}}this._aDragDropHelpers.add(oHelper);this._aDropActions.add(eAction);if(this._eElem){this.initDropZones();}},initDropZones:function initDropZones(){},addDropZone:function addDropZone(eZone){var oDropZone=new df.WebDropZone(eZone,this);this._aDropZones.push(oDropZone);},removeDropZone:function removeDropZone(oDropZone){this._aDropZones=this._aDropZones.filter(function(DropZone){return DropZone!==oDropZone;});},removeDropZoneByElem:function removeDropZoneByElem(eZone){this._aDropZones=this._aDropZones.filter(function(DropZone){return DropZone._eZone!==eZone;});},initDraggableElements:function initDraggableElements(){},dragDropInit:function dragDropInit(){this._aDropZones=[];this.addDragDropEventListeners();this.initDropZones();},dragDropCleanup:function dragDropCleanup(){},onDragStart:function onDragStart(oEv){var _this=this;var _this$getDragData=this.getDragData(oEv,oEv.e.target),_this$getDragData2=_slicedToArray(_this$getDragData,2),oDragData=_this$getDragData2[0],eDragAction=_this$getDragData2[1];if(oDragData&&eDragAction){oEv.e.stopPropagation();this._aDragDropHelpers.forEach(function(oHelper){oHelper.onDragStart(oEv,_this,oEv.e.target,oDragData,eDragAction);});}},onDragEnd:function onDragEnd(oEv){this._aDragDropHelpers.forEach(function(oHelper){oHelper.onDragEnd(oEv);});},onDrop:function onDrop(oEv,oDropZone,eDropAction){var _this2=this;this._aDragDropHelpers.forEach(function(oHelper){oHelper.onDrop(oEv,_this2,oDropZone,eDropAction);});},onControlDragOver:function onControlDragOver(oEv,oDropZone,eDropElem){},getDragData:function getDragData(oEv,eElem){var oData,eDragAction;return[oData,eDragAction];},getDropData:function getDropData(oDropZone){return[];},highlightDropZones:function highlightDropZones(oHelper){this._aDropZones.forEach(function(dropZone){dropZone.highlight(oHelper);});},cleanupDropZones:function cleanupDropZones(){this._aDropZones.forEach(function(dropZone){dropZone.unhighlight();dropZone.removeDropElemInteractions();});},hasData:function hasData(){return false;},determineDropCandidate:function determineDropCandidate(oEv,aHelpers){var eDropElem,eDropAction;return[eDropElem,eDropAction];},determineDropPosition:function determineDropPosition(oEv,eElem){return df.dropPositions.ciDropUnknown;},interactWithDropElem:function interactWithDropElem(dropZone,eElem){dropZone.highlightElement(eElem);},doEmptyInteraction:function doEmptyInteraction(dropZone){},isSupportedDragAction:function isSupportedDragAction(eAction){return this._aDragActions.has(eAction);},isSupportedDropAction:function isSupportedDropAction(eAction){return this._aDropActions.has(eAction);}});df.WebBaseUIObjectBase=df.mixin("df.WebDragDrop_Mixin","df.WebObject");df.WebBaseUIObject=function WebBaseUIObject(sName,oParent){df.WebBaseUIObject.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCSSClass","");this.prop(df.tString,"psHtmlId","");this.prop(df.tString,"psTextColor","");this.prop(df.tString,"psBackgroundColor","");this.prop(df.tBool,"pbRender",true);this.prop(df.tBool,"pbVisible",true);this.prop(df.tBool,"pbEnabled",true);this.event("OnRender",df.cCallModeDefault);this.OnAfterShow=new df.events.JSHandler();this.OnAfterHide=new df.events.JSHandler();this._eElem=null;this._bWrapDiv=false;this._bRenderChildren=false;this._bFocusAble=false;this._sControlClass="";this._sBaseClass="WebUIObj";this._aKeyHandlers=[];this._bShown=false;};df.defineClass("df.WebBaseUIObject","df.WebBaseUIObjectBase",{openHtml:function openHtml(aHtml){if(this._bWrapDiv){aHtml.push('<div class="',this.genClass(),'"');if(this.psHtmlId){aHtml.push(' id="',this.psHtmlId,'"');}aHtml.push(' data-dfobj="',this.getLongName(),'"');aHtml.push(' tabindex="-1" style=" ',this.pbRender?'':'display: none;',this.pbVisible?'':'visibility: hidden;','"');aHtml.push('>');}},closeHtml:function closeHtml(aHtml){if(this._bWrapDiv){aHtml.push('</div>');}},render:function render(){var aHtml=[];this.openHtml(aHtml);this.closeHtml(aHtml);this._eElem=df.dom.create(aHtml.join(""));this.getRef();if(this._bRenderChildren){this.renderChildren();}return this._eElem;},getRef:function getRef(){},afterRender:function afterRender(){if(this._bRenderChildren){this.afterRenderChildren();}if(this._aKeyHandlers.length>0){df.dom.on("keydown",this._eElem,this.onKeyDownHandler,this);}this.fire("OnRender");this.attachFocusEvents();this.set_psTextColor(this.psTextColor);if(this.psBackgroundColor){this.set_psBackgroundColor(this.psBackgroundColor);}this.dragDropInit();},destroy:function destroy(){df.WebBaseUIObject.base.destroy.call(this);if(this._eElem){df.dom.clear(this._eElem,true);if(this._eElem.parentNode){this._eElem.parentNode.removeChild(this._eElem);}}this._eElem=null;},afterShow:function afterShow(){var i;this._bShown=true;this.OnAfterShow.fire(this);if(this._bRenderChildren){for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&this._aChildren[i].pbRender){this._aChildren[i].afterShow();}}}},afterHide:function afterHide(){var i;this._bShown=false;this.OnAfterHide.fire(this);if(this._bRenderChildren){for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&this._aChildren[i].pbRender){this._aChildren[i].afterHide();}}}},attachFocusEvents:function attachFocusEvents(){},renderChildren:function renderChildren(eContainer){var i,eChild,oChild;eContainer=eContainer||this._eElem;for(i=0;i<this._aChildren.length;i++){oChild=this._aChildren[i];if(oChild instanceof df.WebBaseUIObject){eChild=oChild.render();if(eChild){eContainer.appendChild(eChild);}}}},afterRenderChildren:function afterRenderChildren(){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject){this._aChildren[i].afterRender();}}},isActive:function isActive(){return this.pbRender&&this.pbVisible&&this.isEnabled();},isEnabled:function isEnabled(){if(!this.pbEnabled){return false;}else if(this._oParent instanceof df.WebBaseUIObject){return this._oParent.isEnabled();}return true;},updateEnabled:function updateEnabled(){var i;this.applyEnabled(this.isEnabled());if(this._bRenderChildren){for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject){this._aChildren[i].updateEnabled();}}}},applyEnabled:function applyEnabled(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,df.CssDisabled,!bVal);df.dom.toggleClass(this._eElem,df.CssEnabled,bVal);}},genClass:function genClass(){return this._sBaseClass+" "+this._sControlClass+" "+(this.isEnabled()?df.CssEnabled:df.CssDisabled)+(this.psCSSClass?" "+this.psCSSClass:"");},set_psTextColor:function set_psTextColor(sVal){if(this._eElem){this._eElem.style.color=sVal||'';}},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eElem){this._eElem.style.background=sVal||'';}},set_pbVisible:function set_pbVisible(bVal){if(this._eElem){this._eElem.style.visibility=bVal?'':'hidden';}},set_pbRender:function set_pbRender(bVal){if(this._eElem){this._eElem.style.display=bVal?'':'none';if(this.pbRender!==bVal){this.pbRender=bVal;if(this.pbRender){this.afterShow();}else{this.afterHide();}this.sizeChanged(true);}}},set_pbEnabled:function set_pbEnabled(bVal){if(bVal!==this.pbEnabled){this.pbEnabled=bVal;this.updateEnabled();}},set_psCSSClass:function set_psCSSClass(sVal){this.psCSSClass=sVal;if(this._eElem){this._eElem.className=this.genClass();}},set_psHtmlId:function set_psHtmlId(sVal){if(this._eElem){this._eElem.id=sVal;}},addKeyHandler:function addKeyHandler(sServerMsg,iKeyCode,bShift,bAlt,bCtrl){var i,oKH;iKeyCode=df.toInt(iKeyCode);bShift=df.toBool(bShift);bAlt=df.toBool(bAlt);bCtrl=df.toBool(bCtrl);oKH=this.findKeyHandler(iKeyCode,bShift,bAlt,bCtrl);if(oKH){for(i=0;i<oKH.aMsg.length;i++){if(oKH.aMsg[i]===sServerMsg){return;}}oKH.aMsg.push(sServerMsg);}else{if(this._aKeyHandlers.length===0&&this._eElem){df.dom.on("keydown",this._eElem,this.onKeyDownHandler,this);}this._aKeyHandlers.push({iKey:iKeyCode,aMsg:[sServerMsg],bShift:bShift,bAlt:bAlt,bCtrl:bCtrl});}},removeKeyHandler:function removeKeyHandler(sServerMsg,iKeyCode,bShift,bAlt,bCtrl){var i,oKH;iKeyCode=df.toInt(iKeyCode);bShift=df.toBool(bShift);bAlt=df.toBool(bAlt);bCtrl=df.toBool(bCtrl);oKH=this.findKeyHandler(iKeyCode,bShift,bAlt,bCtrl);if(oKH){for(i=0;i<oKH.aMsg.length;i++){if(oKH.aMsg[i]===sServerMsg){oKH.aMsg.splice(i,1);i--;}}if(!oKH.aMsg.length){this._aKeyHandlers.slice(oKH.iIndex,1);}}if(this._aKeyHandlers.length===0&&this._eElem){df.dom.off("keydown",this._eElem,this.onKeyDownHandler);}},findKeyHandler:function findKeyHandler(iKeyCode,bShift,bAlt,bCtrl,iIndexOut){var i,oH;for(i=0;i<this._aKeyHandlers.length;i++){oH=this._aKeyHandlers[i];if(oH.iKey===iKeyCode&&oH.bShift===bShift&&oH.bAlt===bAlt&&oH.bCtrl===bCtrl){oH.iIndex=i;return oH;}}return null;},onKeyDownHandler:function onKeyDownHandler(oEvent){var oKH,i;oKH=this.findKeyHandler(oEvent.getKeyCode(),oEvent.getShiftKey(),oEvent.getAltKey(),oEvent.getCtrlKey());if(oKH){for(i=0;i<oKH.aMsg.length;i++){this.serverAction(oKH.aMsg[i],[oKH.iKey,df.fromBool(oKH.bShift),df.fromBool(oKH.bAlt),df.fromBool(oKH.bCtrl)]);}oEvent.stop();}},svrFocus:function svrFocus(){this.focus();},onFocus:function onFocus(oEvent){this.objFocus();},objFocus:function objFocus(){var oV=this.getView(),oW=this.getWebApp();if(oV){oV.objFocus(this);}if(oW){oW.objFocus(this);}},focus:function focus(bOptSelect){if(this._bFocusAble&&this.isEnabled()&&this._eElem&&this._eElem.focus){this._eElem.focus();this.objFocus();return true;}return false;},conditionalFocus:function conditionalFocus(bOptSelect){if(!df.sys.isMobile){return this.focus(bOptSelect);}if(this._bFocusAble&&this.isEnabled()){this.objFocus();return true;}return false;},focusNext:function focusNext(bOptSelect){var oC=this,oP,i;while(oP=oC._oParent){for(i=oP._aChildren.indexOf(oC)+1;i>0&&i<oP._aChildren.length;i++){if(oP._aChildren[i].focus(bOptSelect)){return true;}}oC=oP;}},onBlur:function onBlur(oEvent){var oWebApp=this.getWebApp();if(oWebApp){oWebApp.objBlur(this);}},sizeChanged:function sizeChanged(bPosition){var oWebApp=this.getWebApp(),oObj=this;if(bPosition){if(this._oParent&&this._oParent._bIsContainer){this._oParent._bPositionChanged=true;}if(this._bIsContainer){this._bPositionChanged=true;}}if(oWebApp){oWebApp.objSizeChanged(this);oWebApp.notifyLayoutChange(this);}else{while(oObj._oParent&&!(oObj instanceof df.WebView||oObj instanceof df.WebApp)){oObj=oObj._oParent;}if(oObj&&oObj.resize){oObj.resize();}}},fireSubmit:function fireSubmit(){return this._oParent&&this._oParent.fireSubmit&&this._oParent.fireSubmit();},makeVisible:function makeVisible(){var oControl=this;while(oControl){if(oControl instanceof df.WebCard){oControl.show();}oControl=oControl._oParent;}},determineSelectorForWebUIContext:function determineSelectorForWebUIContext(eContext){return null;},verifyElementForWebUIContext:function verifyElementForWebUIContext(eElem,eContext){return true;},retrieveValueFromWebUIContext:function retrieveValueFromWebUIContext(eElem,eContext){return null;},getDropData:function getDropData(oDropZone,oPosition){if(oDropZone&&oDropZone._eDropElem){var dropData={data:this.getControlValue&&this.getControlValue()||"",action:df.dropActions.WebTagsForm.ciDropOnControl};return dropData;}return null;},initDropZones:function initDropZones(){if(this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)){this.addDropZone(this._eElem);}},determineDropCandidate:function determineDropCandidate(oEv,aHelpers){var _this3=this;if(aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this3,df.dropActions.WebControl.ciDropOnControl);})){return[this._eElem,df.dropActions.WebControl.ciDropOnControl];}return[null,null];},determineDropPosition:function determineDropPosition(oEv,eElem){return df.dropPositions.ciDropOn;},interactWithDropElem:function interactWithDropElem(dropZone,eElem){dropZone.highlightElement();},doEmptyInteraction:function doEmptyInteraction(dropZone){dropZone.highlightElement();return df.dropActions.WebTagsForm.ciDropOnControl;},hasData:function hasData(){return true;}});df.WebBaseContainer_mixin=function WebBaseContainer_mixin(sName,oParent){this.getBase("df.WebBaseContainer_mixin").constructor.call(this,sName,oParent);this.prop(df.tInt,"piColumnCount",1);this.prop(df.tInt,"piWidth",0);this.prop(df.tInt,"piMinWidth",0);this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tBool,"pbScroll",false);this._oRegionTop=null;this._oRegionLeft=null;this._oRegionCenter=null;this._oRegionRight=null;this._oRegionBottom=null;this._eRegionTop=null;this._eMainArea=null;this._eRegionLeft=null;this._eRegionCenter=null;this._eContent=null;this._eRegionRight=null;this._eRegionBottom=null;this._eContainer=null;this._aUIObjects=[];this._aPanels=[];this._aFloats=[];this._bHasFill=false;this._iContentHeight=null;this._bRendered=false;this._bPanels=false;this._bPositionChanged=true;this._bIsContainer=true;this._iWantedHeight=null;this._bWantedChanged=false;this._bRenderChildren=true;this._sBaseClass="WebContainer";};df.defineClass("df.WebBaseContainer_mixin",{openHtml:function openHtml(aHtml){this.getBase("df.WebBaseContainer_mixin").openHtml.call(this,aHtml);this.wrpOpenHtml(aHtml);aHtml.push('<div class="WebCon_Sizer">');},closeHtml:function closeHtml(aHtml){if(this._bPanels){aHtml.push('<div class="WebCon_Main">');}else{aHtml.push('<div class="WebCon_Content">');}aHtml.push('</div></div>');this.wrpCloseHtml(aHtml);this.getBase("df.WebBaseContainer_mixin").closeHtml.call(this,aHtml);},wrpOpenHtml:function wrpOpenHtml(aHtml){},wrpCloseHtml:function wrpCloseHtml(aHtml){},afterRender:function afterRender(){this.getBase("df.WebBaseContainer_mixin").afterRender.call(this);this._bRendered=true;df.events.addDomListener("scroll",this._eElem,this.onScroll,this);},render:function render(){var eElem;this._bRenderChildren=false;eElem=this.getBase("df.WebBaseContainer_mixin").render.call(this);this._bRenderChildren=true;this._eSizer=df.dom.query(this._eElem,"div.WebCon_Sizer");if(this._bPanels){this._eMainArea=df.dom.query(this._eElem,"div.WebCon_Main");}else{this._eContent=df.dom.query(this._eElem,"div.WebCon_Content");}this._eContainer=df.dom.query(this._eElem,"div.WebContainer")||this._eElem;this.renderChildren();this.position();return eElem;},renderChildren:function renderChildren(){var i,eChild;for(i=0;i<this._aFloats.length;i++){eChild=this._aFloats[i].render();if(eChild){this._eSizer.appendChild(eChild);}}if(this._bPanels){if(this._aUIObjects.length>0){throw new df.Error(999,"Web controls and panels cannot be siblings within the same container object '{{0}}'. Consider placing them within a panel.",this,[this.getLongName()||'oWebApp']);}this._eMainArea.style.position="relative";this._eMainArea.appendChild(df.dom.create('<div style="clear: both;"></div>'));for(i=0;i<this._aPanels.length;i++){eChild=this._aPanels[i].render();}this.placePanels();this._bPositionChanged=false;}else{for(i=0;i<this._aUIObjects.length;i++){eChild=this._aUIObjects[i].render();if(eChild){this._eContent.appendChild(eChild);}}this._eContent.appendChild(df.dom.create('<div style="clear: both;"></div>'));}},addChild:function addChild(oChild){if(oChild instanceof df.WebBaseUIObject){if(oChild._bFloating){this._aFloats.push(oChild);}else if(oChild.peRegion!==undefined){this._bPanels=true;this._aPanels.push(oChild);}else{this._aUIObjects.push(oChild);}}this.getBase("df.WebBaseContainer_mixin").addChild.call(this,oChild);},insertChild:function insertChild(oChild,iIndex){if(oChild instanceof df.WebBaseUIObject){if(oChild._bFloating){this._aFloats.push(oChild);}else if(oChild.peRegion!==undefined){this._bPanels=true;this._aPanels.push(oChild);}else{this._aUIObjects.splice(iIndex,0,oChild);}}this.getBase("df.WebBaseContainer_mixin").insertChild.call(this,oChild,iIndex);},renderChild:function renderChild(oChild,eOptChild){var eChild,oInsertAfter,eBefore,iIndex,bMoveOperation;if(eOptChild){bMoveOperation=true;}iIndex=this._aUIObjects.indexOf(oChild);oInsertAfter=iIndex>=1?this._aUIObjects[iIndex-1]:null;eChild=eOptChild||oChild.render();if(oChild instanceof df.WebPanel){switch(oChild.peRegion){case df.ciRegionBottom:this._eRegionBottom=eChild;this._oRegionBottom=oChild;break;case df.ciRegionCenter:this._eRegionCenter=eChild;this._oRegionCenter=oChild;break;case df.ciRegionLeft:this._eRegionLeft=eChild;this._oRegionLeft=oChild;break;case df.ciRegionRight:this._eRegionRight=eChild;this._oRegionRight=oChild;break;case df.ciRegionTop:this._eRegionTop=eChild;this._oRegionTop=oChild;break;}this.placePanels();}else if(this._eContent){if(eChild){if(oInsertAfter!==null){eBefore=oInsertAfter._eElem.nextElementSibling;}else{eBefore=this._eContent.firstElementChild;if(eBefore){while(!eBefore.getAttribute("data-dfobj")){if(!eBefore.nextElementSibling)throw new df.Error(4394,"Could not find next element, try to refresh.");eBefore=eBefore.nextElementSibling;}}}this._eContent.insertBefore(eChild,eBefore);}}if(!bMoveOperation){oChild.afterRender();}this.position();this.getBase("df.WebBaseContainer_mixin").renderChild.call(this,oChild,eOptChild);},removeChild:function removeChild(oChild){var iIndex;if(oChild instanceof df.WebBaseUIObject){if(oChild._bFloating){iIndex=this._aFloats.indexOf(oChild);this._aFloats.splice(iIndex,1);}else if(oChild.peRegion!==undefined){iIndex=this._aPanels.indexOf(oChild);if(this._aPanels.length===0){this._bPanels=false;}this._aPanels.splice(iIndex,1);}else{iIndex=this._aUIObjects.indexOf(oChild);this._aUIObjects.splice(iIndex,1);}}this.getBase("df.WebBaseContainer_mixin").removeChild.call(this,oChild);},unrenderChild:function unrenderChild(oChild){var eChild;eChild=oChild._eElem;if(oChild instanceof df.WebPanel){switch(oChild.peRegion){case df.ciRegionBottom:this._eRegionBottom=null;this._oRegionBottom=null;break;case df.ciRegionCenter:this._eRegionCenter=null;this._oRegionCenter=null;break;case df.ciRegionLeft:this._eRegionLeft=null;this._oRegionLeft=null;break;case df.ciRegionRight:this._eRegionRight=null;this._oRegionRight=null;break;case df.ciRegionTop:this._eRegionTop=null;this._oRegionTop=null;break;}}else{this._eContent.removeChild(eChild);}this.position();this.getBase("df.WebBaseContainer_mixin").unrenderChild.call(this,oChild);},placePanels:function placePanels(){var i,oPnl,ePnl;this._oRegionTop=null;this._oRegionLeft=null;this._oRegionCenter=null;this._oRegionRight=null;this._oRegionBottom=null;this._eRegionTop=null;this._eRegionLeft=null;this._eRegionCenter=null;this._eRegionRight=null;this._eRegionBottom=null;for(i=0;i<this._aPanels.length;i++){oPnl=this._aPanels[i];if(oPnl.peRegion===df.ciRegionCenter){if(this._oRegionCenter){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oPnl._sName,this._oRegionCenter._sName]);}this._oRegionCenter=oPnl;this._eRegionCenter=ePnl=oPnl._eElem;if(ePnl.parentNode!=this._eMainArea){this._eMainArea.appendChild(ePnl);}ePnl.style.position="absolute";ePnl.style.top="0px";ePnl.style.right="0px";ePnl.style.left="0px";ePnl.style.bottom="0px";}else if(oPnl.peRegion===df.ciRegionTop){if(this._oRegionTop){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oPnl._sName,this._oRegionTop._sName]);}this._oRegionTop=oPnl;this._eRegionTop=ePnl=oPnl._eElem;if(ePnl.parentNode!=this._eMainArea.parentNode||ePnl.nextElementSibling!=this._eMainArea){this._eMainArea.parentNode.insertBefore(ePnl,this._eMainArea);}ePnl.style.position="";ePnl.style.top="";ePnl.style.left="";ePnl.style.right="";ePnl.style.bottom="";}else if(oPnl.peRegion===df.ciRegionLeft){if(this._oRegionLeft){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oPnl._sName,this._oRegionLeft._sName]);}this._oRegionLeft=oPnl;this._eRegionLeft=ePnl=oPnl._eElem;if(ePnl.parentNode!=this._eMainArea){this._eMainArea.appendChild(ePnl);}ePnl.style.position="absolute";ePnl.style.top="0px";ePnl.style.left="0px";ePnl.style.right="";ePnl.style.bottom="0px";}else if(oPnl.peRegion===df.ciRegionRight){if(this._oRegionRight){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oPnl._sName,this._oRegionRight._sName]);}this._oRegionRight=oPnl;this._eRegionRight=ePnl=oPnl._eElem;if(ePnl.parentNode!=this._eMainArea){this._eMainArea.appendChild(ePnl);}ePnl.style.position="absolute";ePnl.style.top="0px";ePnl.style.left="";ePnl.style.right="0px";ePnl.style.bottom="0px";}else if(oPnl.peRegion===df.ciRegionBottom){if(this._oRegionBottom){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oPnl._sName,this._oRegionBottom._sName]);}this._oRegionBottom=oPnl;this._eRegionBottom=ePnl=oPnl._eElem;if(ePnl.parentNode!=this._eMainArea.parentNode||ePnl.previousElementSibling!=this._eMainArea){this._eMainArea.parentNode.appendChild(ePnl);}ePnl.style.position="";ePnl.style.top="";ePnl.style.left="";ePnl.style.right="";ePnl.style.bottom="";}else{throw new df.Error(999,"Invalid value for peRegion of '{{0}}'",this,[oPnl._sName]);}}},genClass:function genClass(){var sClass=this.getBase("df.WebBaseContainer_mixin").genClass.apply(this,arguments);if(this.pbScroll){sClass+=" WebScroll";}return sClass;},prepareSize:function prepareSize(){var iHeight=0,iMiddle=0,iCur,i,iPrevWanted=this._iWantedHeight;this._bStretch=false;for(i=0;i<this._aFloats.length;i++){if(this._aFloats[i].prepareSize){this._aFloats[i].prepareSize();}}if(this._bPanels){if(this._bPositionChanged){this.placePanels();this._bPositionChanged=false;}if(this._oRegionTop&&this._oRegionTop.pbRender){iHeight+=this._oRegionTop.prepareSize();}if(this._oRegionCenter&&this._oRegionCenter.pbRender){iMiddle=this._oRegionCenter.prepareSize();this._bStretch=this._oRegionCenter._bStretch||this._bStretch;}if(this._oRegionLeft&&this._oRegionLeft.pbRender){iCur=this._oRegionLeft.prepareSize();iMiddle=iCur>iMiddle?iCur:iMiddle;this._bStretch=this._oRegionLeft._bStretch||this._bStretch;}if(this._oRegionRight&&this._oRegionRight.pbRender){iCur=this._oRegionRight.prepareSize();iMiddle=iCur>iMiddle?iCur:iMiddle;this._bStretch=this._oRegionRight._bStretch||this._bStretch;}iHeight+=iMiddle;if(this._oRegionBottom&&this._oRegionBottom.pbRender){iHeight+=this._oRegionBottom.prepareSize();}iHeight+=this.getHeightDiff(true,true,true,true);}else{if(this._bPositionChanged){this.position();this._iContentHeight=null;this._bPositionChanged=false;}for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i].prepareSize&&!(this._aChildren[i]instanceof df.WebView)){this._aChildren[i].prepareSize();}}if(this._bHasFill){if(!this._iContentHeight){this.resizeColumnLayout();}iHeight+=this._iContentHeight+this.getHeightDiff(true,true,true,true);}else{iHeight+=df.dom.clientHeight(this._eContent)+this.getHeightDiff(true,true,true,false);}}this._iMinHeight=iHeight;if(this.piHeight>0){this._iWantedHeight=this.piHeight;}else{this._iWantedHeight=iHeight>this.piMinHeight?iHeight:this.piMinHeight;}this._bWantedChanged=iPrevWanted!==this._iWantedHeight;if(this.peRegion!==df.ciRegionTop&&this.peRegion!==df.ciRegionBottom){if(this.piHeight<=0&&this._bHasFill||this instanceof df.WebView&&this.pbFillHeight){this._bStretch=true;}}this._bSizePrep=true;return this._iWantedHeight;},resizeHorizontal:function resizeHorizontal(){var i,iWidth=0;if(this._eElem){if(this._bPanels){if(this._oRegionLeft){if(this._oRegionLeft.piWidth>0){iWidth=this._oRegionLeft.piWidth;}else if(this._oRegionRight&&this._oRegionRight.pbRender){iWidth=(this._eMainArea.clientWidth-(this._oRegionRight.piWidth||this._eMainArea.clientWidth/3))/2;}else{iWidth=this._eMainArea.clientWidth/2;}this._oRegionLeft.setOuterWidth(iWidth);if(this._eRegionCenter){this._eRegionCenter.style.left=this._oRegionLeft.pbRender?iWidth+"px":"0px";}}if(this._oRegionRight){if(this._oRegionRight.piWidth>0){iWidth=this._oRegionRight.piWidth;}else if(this._oRegionLeft&&this._oRegionLeft.pbRender){iWidth=(this._eMainArea.clientWidth-(this._oRegionLeft.piWidth||this._eMainArea.clientWidth/3))/2;}else{iWidth=this._eMainArea.clientWidth/2;}this._oRegionRight.setOuterWidth(iWidth);if(this._eRegionCenter){this._eRegionCenter.style.right=this._oRegionRight.pbRender?iWidth+"px":"0px";}}}else{this.updateMinWidth();}for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&!(this._aChildren[i]instanceof df.WebView)){if(this._aChildren[i].pbRender&&this._aChildren[i].resizeHorizontal){this._aChildren[i].resizeHorizontal();}}}}},resizeVertical:function resizeVertical(){var iHeight,iMiddle,iMiddleSpace=0,iMiddleWanted=0,iCenter=0,iLeft=0,iRight=0,iVSpace,iPanelHeight,bStretch=false,i;if(this._eElem){if(!this._bSizePrep){this.prepareSize();}if(this.piHeight>0){iHeight=this.piHeight;bStretch=true;}else if(this._bStretch||this instanceof df.WebPanel&&(this.peRegion===df.ciRegionLeft||this.peRegion===df.ciRegionCenter||this.peRegion===df.ciRegionRight)){iHeight=df.dom.clientHeight(this._eContainer)+this.getHeightDiff(true,false,false,false);bStretch=true;if(iHeight<this._iMinHeight){iHeight=this._iMinHeight;}}else{iHeight=this._iWantedHeight;}if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;bStretch=true;}if(this._bPanels){iVSpace=iHeight;if(this._oRegionTop&&this._oRegionTop.pbRender){iPanelHeight=this._oRegionTop._iWantedHeight;if(iPanelHeight>iVSpace){iHeight=iHeight+this._oRegionTop._iWantedHeight-iVSpace;iVSpace=iPanelHeight;}iVSpace-=iPanelHeight;this._oRegionTop.setOuterHeight(iPanelHeight);}if(this._oRegionBottom&&this._oRegionBottom.pbRender){iPanelHeight=this._oRegionBottom._iWantedHeight;if(iPanelHeight>iVSpace){iHeight=iHeight+iPanelHeight-iVSpace;iVSpace=iPanelHeight;}iVSpace-=iPanelHeight;this._oRegionBottom.setOuterHeight(iPanelHeight);}iMiddleSpace=iVSpace-this.getHeightDiff(true,true,true,true);if(this._oRegionLeft&&this._oRegionLeft.pbRender){iLeft=this._oRegionLeft._iWantedHeight;}if(this._oRegionCenter&&this._oRegionCenter.pbRender){iCenter=this._oRegionCenter._iWantedHeight;}if(this instanceof df.WebApp){iCenter=this._oCurrentView&&this._oCurrentView._iWantedHeight||0;}if(this._oRegionRight&&this._oRegionRight.pbRender){iRight=this._oRegionRight._iWantedHeight;}iMiddleWanted=Math.max(iLeft,iCenter,iRight);if(bStretch||this._oRegionLeft&&this._oRegionLeft._bStretch||this._oRegionCenter||this._oRegionRight&&this._oRegionRight._bStretch){iMiddle=iMiddleSpace;}else{iMiddle=iMiddleWanted;}if(iMiddle>0){this._eMainArea.style.height=iMiddle+"px";}this._iMiddleHeight=iMiddle;}else{this.resizeColumnLayout();this.setInnerHeight(iHeight);}for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&!(this._aChildren[i]instanceof df.WebView)){if(this._aChildren[i].pbRender){if(this._aChildren[i].resizeVertical){this._aChildren[i].resizeVertical();}else if(this._aChildren[i].resize){this._aChildren[i].resize();}}}}this._bSizePrep=false;}},setOuterHeight:function setOuterHeight(iHeight){iHeight-=this.getHeightDiff(true,false,false,false);this._eElem.style.height=iHeight>0?iHeight+"px":"";},setInnerHeight:function setInnerHeight(iHeight){if(iHeight>0){if(iHeight!==this._iLastInnerHeight){this._iLastInnerHeight=iHeight;iHeight-=this.getHeightDiff(true,true,false,false);this._eSizer.style.minHeight=iHeight>0?iHeight+"px":"";}}else if(this._iLastInnerHeight>0){this._eSizer.style.minHeight="";}},setOuterWidth:function setOuterWidth(iWidth){iWidth-=df.sys.gui.getHorizBoxDiff(this._eElem,1);this._eElem.style.width=iWidth>0?iWidth+"px":"";},setInnerWidth:function setInnerWidth(iWidth){iWidth-=df.sys.gui.getHorizBoxDiff(this._eElem,0);iWidth-=df.sys.gui.getHorizBoxDiff(this._eSizer,1);this._eSizer.style.width=iWidth>0?iWidth+"px":"";},updateMinWidth:function updateMinWidth(){var iWidth=this.piMinWidth;iWidth-=df.sys.gui.getHorizBoxDiff(this._eElem,0);iWidth-=df.sys.gui.getHorizBoxDiff(this._eSizer,1);this._eSizer.style.minWidth=iWidth>0?iWidth+"px":"";},resizeColumnLayout:function resizeColumnLayout(){var oChild,i,x,iHeight=0,iCol=0,iRowHeight=0,iMinHeight,iSpace,aStretch=[],iSize,oStretch,iCount=this.piColumnCount,iIndex,iSpan;if(df.sys.isIE&&df.sys.iVersion<=8){iHeight=3;}if(this._bHasFill){for(i=0;i<this._aUIObjects.length;i++){oChild=this._aUIObjects[i];if(oChild.pbRender){iIndex=oChild.piColumnIndex+oChild.piColumnSpan<=iCount?oChild.piColumnIndex:0;if(iIndex+oChild.piColumnSpan>iCount||oChild.piColumnSpan<=0){iSpan=iCount-iIndex;}else{iSpan=oChild.piColumnSpan;}if(iCol>iIndex||iCol+iSpan>iCount){if(oStretch){oStretch.iHeight=iRowHeight;aStretch.push(oStretch);oStretch=null;}else{iHeight=iHeight+iRowHeight;}iRowHeight=0;iCol=0;}if(oChild.pbFillHeight){if(oStretch){oStretch.aItems.push(oChild);}else{oStretch={aItems:[oChild],iHeight:0};}if(oChild.getMinHeight){iMinHeight=oChild.getMinHeight();}else{iMinHeight=oChild.piMinHeight;}if(iRowHeight<iMinHeight){iRowHeight=iMinHeight;}}else{var nOffset=df.dom.offsetHeight(oChild._eElem);if(nOffset>iRowHeight){iRowHeight=nOffset;}}iCol=iIndex+(iSpan||1);}}if(oStretch){oStretch.iHeight=iRowHeight;aStretch.push(oStretch);}else{iHeight+=iRowHeight;}this._iContentHeight=iHeight;iSpace=df.dom.clientHeight(this._eContainer);if(iSpace<this.piMinHeight){iSpace=this.piMinHeight;}iSpace=iSpace-this.getHeightDiff(false,true,true,true);iSpace=iSpace-iHeight;for(i=0;i<aStretch.length;i++){oStretch=aStretch[i];iSize=iSpace/(aStretch.length-i);iSize--;this._iContentHeight=this._iContentHeight+oStretch.iHeight;if(iSize<oStretch.iHeight){iSize=oStretch.iHeight;}for(x=0;x<oStretch.aItems.length;x++){oStretch.aItems[x].sizeHeight(iSize);}iSpace-=iSize;}}},position:function position(){var i,oChild,iCol=0,iCount=this.piColumnCount,iIndex,iSpan;if(iCount<=0){throw new df.Error(999,"Invalid column count on '{{0}}'",this,[this.getLongName()||"oWebApp"]);}this._bHasFill=false;for(i=0;i<this._aUIObjects.length;i++){oChild=this._aUIObjects[i];if(oChild._eElem&&oChild.pbRender&&oChild instanceof df.WebBaseControl){iIndex=oChild.piColumnIndex+(oChild.piColumnSpan||1)<=iCount?oChild.piColumnIndex:0;if(iIndex+oChild.piColumnSpan>iCount||oChild.piColumnSpan<=0){iSpan=iCount-iIndex;}else{iSpan=oChild.piColumnSpan;}oChild._eElem.style.styleFloat="left";oChild._eElem.style.cssFloat="left";if(iCol>iIndex||iCol+iSpan>iCount){oChild._eElem.style.clear="left";iCol=0;}else{oChild._eElem.style.clear="none";}oChild._eElem.style.marginLeft=Math.floor(10000/iCount)/100*(iIndex-iCol)+"%";iCol=iIndex+(iSpan||1);if(iSpan===iCount){oChild._eElem.style.width="100%";}else{oChild._eElem.style.width=Math.floor(10000/iCount)/100*iSpan+"%";}}this._bHasFill=this._bHasFill||oChild.pbFillHeight;}},getRequiredHeight:function getRequiredHeight(){if(!this._bSizePrep){this.prepareSize();}this._bSizePrep=false;return this._iWantedHeight;},getHeightDiff:function getHeightDiff(bOut,bIn,bContentOut,bContentIn){var iHeight=0;if(bOut){if(this._eContainer){iHeight+=df.sys.gui.getVertBoxDiff(this._eContainer,3);}}if(bIn){if(this._eContainer){iHeight+=df.sys.gui.getVertBoxDiff(this._eContainer,2);iHeight+=this._eContainer.offsetHeight-this._eContainer.clientHeight;}if(this._eSizer){iHeight+=df.sys.gui.getVertBoxDiff(this._eSizer,1);}}if(bContentOut){if(this._eSizer){iHeight+=df.sys.gui.getVertBoxDiff(this._eSizer,2);}if(this._eMainArea){iHeight+=df.sys.gui.getVertBoxDiff(this._eMainArea,2);}if(this._eContent){iHeight+=df.sys.gui.getVertBoxDiff(this._eContent,1);}}if(bContentIn){if(this._eContent){iHeight+=df.sys.gui.getVertBoxDiff(this._eContent,2);iHeight+=1;}}return iHeight;},getWidthDiff:function getWidthDiff(bOut,bIn,bContentOut,bContentIn){var iWidth=0;if(bOut&&this._eElem){iWidth+=df.sys.gui.getHorizBoxDiff(this._eElem,0);}if((bOut||bIn)&&this._eContainer){iWidth+=df.sys.gui.getHorizBoxDiff(this._eContainer,bOut&&bIn?0:bOut?1:2);}if((bIn||bContentOut)&&this._eSizer){iWidth+=df.sys.gui.getHorizBoxDiff(this._eSizer,bIn&&bContentOut?0:bIn?1:2);}if(bContentOut&&this._eMainArea){iWidth+=df.sys.gui.getHorizBoxDiff(this._eMainArea,2);}if((bContentOut||bContentIn)&&this._eContent){iWidth+=df.sys.gui.getHorizBoxDiff(this._eContent,bContentOut&&bContentIn?0:bContentOut?1:2);}return iWidth;},getContentWidthDiff:function getContentWidthDiff(){var iWidth=0;if(this._eContent){iWidth+=df.sys.gui.getHorizBoxDiff(this._eContent);}return iWidth;},onScroll:function onScroll(oEvent){var oWebApp=this.getWebApp();if(oWebApp){oWebApp.notifyScroll(this);}},focus:function focus(bOptSelect){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i].focus){if(this._aChildren[i].focus(bOptSelect)){return true;}}}return false;},conditionalFocus:function conditionalFocus(bOptSelect){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i].conditionalFocus){if(this._aChildren[i].conditionalFocus(bOptSelect)){return true;}}}return false;},set_piWidth:function set_piWidth(iVal){this.piWidth=iVal;if(this._eElem){this.sizeChanged();}},set_piHeight:function set_piHeight(iVal){this.piHeight=iVal;if(this._eElem){this.sizeChanged();}},set_piMinHeight:function set_piMinHeight(iVal){this.piMinHeight=iVal;if(this._eElem){this.sizeChanged();}},set_piMinWidth:function set_piMinWidth(iVal){this.piMinWidth=iVal;if(this._eElem){this.sizeChanged();}},set_piColumnCount:function set_piColumnCount(iVal){this.piColumnCount=iVal;if(this._eElem){this.sizeChanged(true);}},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eContainer){this._eContainer.style.background=sVal||'';}},set_pbScroll:function set_pbScroll(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebScroll",bVal);}}});df.WebBaseContainer=df.mixin("df.WebBaseContainer_mixin","df.WebBaseUIObject");df.WebBaseControl=function WebBaseControl(sName,oParent){df.WebBaseControl.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piColumnIndex",0);this.prop(df.tInt,"piColumnSpan",1);this.prop(df.tBool,"pbShowLabel",true);this.prop(df.tString,"psLabel","");this.prop(df.tInt,"peLabelPosition",0);this.prop(df.tInt,"peLabelAlign",-1);this.prop(df.tInt,"piLabelOffset",-1);this.prop(df.tString,"psLabelColor","");this.prop(df.tString,"psToolTip","");this.prop(df.tBool,"pbFillHeight",false);this.prop(df.tInt,"piHeight",-1);this.prop(df.tInt,"piMinHeight",0);this.event("OnFocus",df.cCallModeDefault);this.event("OnBlur",df.cCallModeDefault);this._eInner=null;this._eLbl=null;this._eControlWrp=null;this._eControl=null;this._oInfoBalloon=null;this._sControlId=df.dom.genDomId();this._bFocusAble=true;this._bHasFocus=false;this._sBaseClass="WebControl";};df.defineClass("df.WebBaseControl","df.WebBaseUIObject",{openHtml:function openHtml(aHtml){aHtml.push('<div class="',this.genClass(),'"');if(this.psHtmlId){aHtml.push(' id="',this.psHtmlId,'"');}aHtml.push(' data-dfobj="',this.getLongName(),'"');aHtml.push(' style=" ',this.pbRender?'':'display: none;',this.pbVisible?'':'visibility: hidden;','"');aHtml.push('>');if(this.pbShowLabel){aHtml.push('<div class="WebCon_Inner">');if(!df.sys.isMobile){aHtml.push('<label for="',this._sControlId,'" class="',this.peLabelPosition==df.ciLabelFloat&&this.psValue==''?'WebCon_Unfloat':'WebCon_Float','" >',df.dom.encodeHtml(this.psLabel),'</label>');}else{aHtml.push('<label>',df.dom.encodeHtml(this.psLabel),'</label>');}}else{aHtml.push('<div class="WebCon_Inner">');}aHtml.push('<div>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div></div></div>');},afterRender:function afterRender(){this._eInner=df.dom.query(this._eElem,"div.WebCon_Inner");this._eControlWrp=df.dom.query(this._eElem,"div.WebCon_Inner > div");if(this.pbShowLabel){this._eLbl=df.dom.query(this._eElem,"div > label");}df.WebBaseControl.base.afterRender.call(this);if(this._eLbl){df.dom.on("click",this._eLbl,this.onLblClick,this);}this.posLabel(true);this.set_psLabelColor(this.psLabelColor);this.set_peLabelAlign(this.peLabelAlign);this.set_psToolTip(this.psToolTip);this.sizeHeight(-1);if(this._oInfoBalloon){this._oInfoBalloon.init();if(this._bShowInfoBallon){this._oInfoBalloon.show();}}},destroy:function destroy(){df.WebBaseControl.base.destroy.call(this);this._eLbl=null;this._eControlWrp=null;this._eInner=null;this._eControl=null;if(this._oInfoBalloon){this._oInfoBalloon.destroy();this._oInfoBalloon=null;}},onLblClick:function onLblClick(oEvent){if(!df.sys.isMobile){this.focus();}},set_psLabel:function set_psLabel(sVal){if(this._eLbl){if(!sVal){sVal=" ";}df.dom.setText(this._eLbl,sVal);}},set_pbShowLabel:function set_pbShowLabel(bVal){this.pbShowLabel=bVal;this.posLabel(false);},set_psLabelColor:function set_psLabelColor(sVal){if(this._eLbl){this._eLbl.style.color=sVal;}},set_peLabelAlign:function set_peLabelAlign(iVal){if(this._eLbl){this._eLbl.style.textAlign=iVal===df.ciAlignLeft?"left":iVal===df.ciAlignCenter?"center":iVal===df.ciAlignRight?"right":"";}},set_piLabelOffset:function set_piLabelOffset(iVal){this.piLabelOffset=iVal;this.posLabel(false);},set_peLabelPosition:function set_peLabelPosition(iVal){this.peLabelPosition=iVal;this.posLabel(false);},set_psToolTip:function set_psToolTip(sVal){if(this._eControl){this._eControl.title=sVal;}},set_piColumnIndex:function set_piColumnIndex(iVal){if(this.piColumnIndex!==iVal){this.piColumnIndex=iVal;this.sizeChanged(true);}},set_piColumnSpan:function set_piColumnSpan(iVal){if(this.piColumnSpan!==iVal){this.piColumnSpan=iVal;this.sizeChanged(true);}},set_psTextColor:function set_psTextColor(sVal){if(this._eControl){this._eControl.style.color=sVal||'';}},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eControl){this._eControl.style.background=sVal||'';}},set_piMinHeight:function set_piMinHeight(iVal){if(this._eControl){if(this.piMinHeight!==iVal){this.piMinHeight=iVal;if(!this.pbFillHeight){this.sizeHeight(-1);}this.sizeChanged();}}},set_piHeight:function set_piHeight(iVal){if(this._eControl){if(this.piHeight!==iVal){this.piHeight=iVal;if(!this.pbFillHeight){this.sizeHeight(-1);}this.sizeChanged();}}},set_pbFillHeight:function set_pbFillHeight(bVal){if(this._eControl){if(this.pbFillHeight!==bVal){this.pbFillHeight=bVal;if(!this.pbFillHeight){this.sizeHeight(-1);}this.sizeChanged(true);}}},sizeHeight:function sizeHeight(iExtHeight){var iHeight=-1,bSense=false;if(this.pbFillHeight){iHeight=iExtHeight;bSense=iExtHeight>0;}else if(this.piHeight>0){iHeight=this.piHeight;bSense=true;}if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;bSense=bSense||!this.pbFillHeight;}this.setHeight(iHeight,bSense);if(iHeight>0){return iHeight;}},setHeight:function setHeight(iHeight,bSense){if(this._eControl){if(iHeight>0){iHeight-=this.getVertHeightDiff();iHeight=iHeight<0?0:iHeight;this._eControl.style.height=iHeight+"px";}else{this._eControl.style.height="";}}},getVertHeightDiff:function getVertHeightDiff(){var iResult=0;if((this.peLabelPosition===df.ciLabelTop||this.peLabelPosition===df.ciLabelFloat)&&this._eLbl){iResult+=this._eLbl.offsetHeight;}iResult+=df.sys.gui.getVertBoxDiff(this._eInner);iResult+=df.sys.gui.getVertBoxDiff(this._eControlWrp);iResult+=df.sys.gui.getVertBoxDiff(this._eControl);return iResult;},posLabel:function posLabel(bFirst){var iPos=this.peLabelPosition,sClass,sOffset,iOffset=this.piLabelOffset,iMargin,sMargin,oStyle;if(this._eElem){if(!bFirst){df.dom.removeClass(this._eInner,"WebCon_HasLabel WebCon_TopLabel WebCon_RightLabel WebCon_LeftLabel");}if(!this.pbShowLabel){if(this._eLbl){df.dom.off("click",this._eLbl,this.onLblClick);this._eLbl.parentNode.removeChild(this._eLbl);this._eLbl=null;}this._eControlWrp.style.marginLeft="";this._eControlWrp.style.marginTop="";this._eControlWrp.style.marginRight="";}else{if(!this._eLbl){if(!df.sys.isMobile){this._eLbl=df.dom.create('<label for="'+this._sControlId+'" class="'+(this.peLabelPosition==df.ciLabelFloat&&this.psValue==''?'unfloat':'float')+'">&nbsp;</label>');}else{this._eLbl=df.dom.create('<label>&nbsp;</label>');}this.set_psLabel(this.psLabel);this.set_psLabelColor(this.psLabelColor);this.set_peLabelAlign(this.peLabelAlign);this._eInner.insertBefore(this._eLbl,this._eInner.firstChild);df.dom.on("click",this._eLbl,this.onLblClick,this);}if(!bFirst){df.dom.addClass(this._eInner,"WebCon_HasLabel");}if(this.peLabelPosition<0){oStyle=df.sys.gui.getCurrentStyle(this._eLbl);iPos=oStyle.marginLeft>0?df.ciLabelLeft:oStyle.marginRight>0?df.ciLabelRight:df.ciLabelLeft;}switch(iPos){case df.ciLabelLeft:sClass="WebCon_LeftLabel";iMargin=iOffset>0?iOffset+df.sys.gui.getHorizBoxDiff(this._eLbl,1):0;break;case df.ciLabelTop:case df.ciLabelFloat:sClass=iPos==df.ciLabelFloat?"WebCon_TopLabel WebCon_FloatEnabled":"WebCon_TopLabel";iMargin=iOffset>0?iOffset+df.sys.gui.getVertBoxDiff(this._eLbl,1):0;break;case df.ciLabelRight:sClass="WebCon_RightLabel";iMargin=iOffset>0?iOffset+df.sys.gui.getHorizBoxDiff(this._eLbl,1):0;break;}sOffset=iOffset>0?iOffset+"px":"";sMargin=iMargin>0?iMargin+"px":"";this._eControlWrp.style.marginLeft=iPos===df.ciLabelLeft?sMargin:"";this._eControlWrp.style.marginTop=iPos===df.ciLabelTop?sMargin:"";this._eControlWrp.style.marginRight=iPos===df.ciLabelRight?sMargin:"";this._eLbl.style.width=iPos===df.ciLabelLeft||iPos===df.ciLabelRight?sOffset:"";this._eLbl.style.height=iPos===df.ciLabelTop?sOffset:"";df.dom.addClass(this._eInner,sClass);}}},getTooltipElem:function getTooltipElem(){return this._eControlWrp;},showInfoBalloon:function showInfoBalloon(sCssClass,sText,bShow){bShow=df.toBool(bShow);if(this._oInfoBalloon){this._oInfoBalloon.psCssClass=sCssClass;this._oInfoBalloon.psMessage=sText;this._oInfoBalloon.update();}else{this._oInfoBalloon=new df.InfoBalloon(this,sCssClass,sText);}if(this._eElem){this._oInfoBalloon.init();if(bShow){this._oInfoBalloon.show();}}else{this._bShowInfoBallon=bShow;}},hideInfoBalloon:function hideInfoBalloon(){if(this._oInfoBalloon){this._oInfoBalloon.hide();}},resize:function resize(){if(this._oInfoBalloon){this._oInfoBalloon.resize();}this._aChildren.forEach(function(oC){if(oC.resize){oC.resize();}});},focus:function focus(){if(this._bFocusAble&&this.isEnabled()&&this._eControl&&this._eControl.focus){try{this._eControl.focus();}catch(oErr){}this.objFocus();return true;}return false;},attachFocusEvents:function attachFocusEvents(){df.dom.on("focusin",this._eElem,this.onFocus,this);df.dom.on("focusout",this._eElem,this.onBlur,this);},onFocus:function onFocus(oEvent){df.WebBaseControl.base.onFocus.call(this,oEvent);if(this._eElem){df.dom.addClass(this._eElem,"WebCon_Focus");}this.fire("OnFocus");this._bHasFocus=true;},onBlur:function onBlur(oEvent){df.WebBaseControl.base.onBlur.call(this,oEvent);if(this._eElem){df.dom.removeClass(this._eElem,"WebCon_Focus");}this.fire("OnBlur");this._bHasFocus=false;}});df.WebBaseDEO=function WebBaseDEO(sName,oParent){df.WebBaseDEO.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psValue","");this.prop(df.tBool,"pbChanged",false);this.prop(df.tInt,"peDataType",df.ciTypeText);this.prop(df.tInt,"piPrecision",0);this.prop(df.tInt,"piMaxLength",0);this.prop(df.tBool,"pbCapslock",false);this.prop(df.tBool,"pbRequired",false);this.prop(df.tInt,"peAlign",-1);this.prop(df.tString,"psMask","");this.event("OnAutoFind",df.cCallModeDefault);this.event("OnChange",df.cCallModeDefault);this.event("OnValidate",df.cCallModeDefault);this._tValue=null;this._sOrigValue="";this._sPrevChangeVal=null;this._bMasks=true;this._oMask=null;this._bAutoFind=false;this._bReplaceDecSepp=false;this._oErrorBalloon=null;this._aErrors=[];this.addSync("psValue");this.addSync("pbChanged");};df.defineClass("df.WebBaseDEO","df.WebBaseControl",{afterRender:function afterRender(){this._bRendering=true;df.WebBaseDEO.base.afterRender.call(this);var sVal=this.psValue;this.set_peDataType(this.peDataType);this.set_psValue(sVal);this.set_pbCapslock(this.pbCapslock);this.set_peAlign(this.peAlign);df.dom.enableTextSelection(this._eControlWrp);if(this._eControl){df.dom.on("change",this._eControl,this.onChange,this);df.events.addDomKeyListener(this._eControl,this.onKey,this);df.dom.enableTextSelection(this._eControl);}this.updateErrorDisp();this._bRendering=false;},destroy:function destroy(){if(this._oErrorBalloon){this._oErrorBalloon.destroy();this._oErrorBalloon=null;}if(this._oMask){this._oMask.detach();this._oMask=null;}df.WebBaseDEO.base.destroy.call(this);},attachFocusEvents:function attachFocusEvents(){if(this._eControl){df.dom.on("focus",this._eControl,this.onFocus,this);df.dom.on("blur",this._eControl,this.onBlur,this);}},applyEnabled:function applyEnabled(bVal){df.WebBaseDEO.base.applyEnabled.call(this,bVal);if(this._eControl){this._eControl.disabled=!bVal;this._eControl.tabIndex=bVal?0:-1;}},get_pbChanged:function get_pbChanged(){if(!this.pbChanged&&this._eElem){this.updateTypeVal();}return this.pbChanged||this._sOrigValue!==this.getServerVal();},set_psValue:function set_psValue(sVal){this._tValue=df.sys.data.serverToType(sVal,this.peDataType);this.psValue=sVal;this._sPrevChangeVal=this._sOrigValue=this.getServerVal();this.refreshDisplay(this._tValue);if(!this._bRendering){this.hideAllControlErrors();}},get_psValue:function get_psValue(){if(this._eElem){this.updateTypeVal();}return this.getServerVal();},set_peDataType:function set_peDataType(iVal,bSvr){var sValue;if(this._eControl){if(bSvr){sValue=this.get_psValue();}this.peDataType=iVal;this.initMask();if(bSvr){this.set_psValue(sValue);}df.dom.removeClass(this._eControl,"dfData_BCD dfData_Date dfDate_Text");if(iVal===df.ciTypeBCD){df.dom.addClass(this._eControl,"dfData_BCD");}else if(iVal===df.ciTypeDate){df.dom.addClass(this._eControl,"dfData_Date");}else{df.dom.addClass(this._eControl,"dfData_Text");}}},set_psMask:function set_psMask(sVal){this.updateTypeVal();this.psMask=sVal;this.initMask();this.refreshDisplay(this._tValue);},set_pbCapslock:function set_pbCapslock(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"Web_Uppercase",bVal);}},set_peAlign:function set_peAlign(eVal){if(this._eControl){this._eControl.style.textAlign=df.sys.gui.cssTextAlign(eVal);}},refreshDisplay:function refreshDisplay(tVal){var sVal;if(this._eElem){sVal=this.typeToDisplay(tVal);this.setControlValue(sVal);}},serverToType:function serverToType(sVal){return df.sys.data.serverToType(sVal,this.peDataType);},typeToDisplay:function typeToDisplay(tVal){return df.sys.data.typeToDisplay(tVal,this.peDataType,this.getWebApp(),this._bHasFocus,this.psMask,this.piPrecision);},dateFormat:function dateFormat(){return this.getWebApp().psDateFormat;},dateTimeFormat:function dateTimeFormat(){return this.getWebApp().psDateTimeFormat;},timeFormat:function timeFormat(){return this.getWebApp().psTimeFormat;},dateSep:function dateSep(){return this.getWebApp().psDateSeparator;},decSep:function decSep(){return this.getWebApp().psDecimalSeparator;},thousSep:function thousSep(){return this.getWebApp().psThousandsSeparator;},timeSep:function timeSep(){return this.getWebApp().psTimeSeparator;},updateTypeVal:function updateTypeVal(){var sVal=this.getControlValue();if(this.pbCapslock){sVal=sVal.toUpperCase();}if(this.peDataType===df.ciTypeText&&this.psMask){this.psValue=this._tValue=this.clearWinMask(sVal);}else if(this._bHasFocus||!this.psMask){this.psValue=sVal;if(this.peDataType===df.ciTypeBCD){this._tValue=df.sys.data.stringToNum(sVal,this.decSep(),this.thousSep());if(isNaN(this._tValue)){this._tValue=0;}}else if(this.peDataType===df.ciTypeDate){this._tValue=df.sys.data.stringToDate(sVal,this.dateFormat(),this.dateSep());}else if(this.peDataType===df.ciTypeDateTime){this._tValue=df.sys.data.stringToDate(sVal,this.dateTimeFormat(),this.dateSep(),this.timeSep());}else if(this.peDataType===df.ciTypeTime){this._tValue=df.sys.data.stringToDate(sVal,this.timeFormat(),this.dateSep(),this.timeSep());}else{this._tValue=sVal;}}},getServerVal:function getServerVal(){if(this._tValue!==null){if(this.peDataType===df.ciTypeBCD){return this._tValue.toString();}if(this.peDataType===df.ciTypeDate){return this._tValue instanceof Date&&df.sys.data.dateToString(this._tValue,"yyyy/mm/dd","-")||"";}if(this.peDataType===df.ciTypeDateTime){return this._tValue instanceof Date&&df.sys.data.dateToString(this._tValue,"yyyy/mm/ddThh:mm:ss.fff","-",":")||"";}if(this.peDataType===df.ciTypeTime){return this._tValue instanceof Date&&df.sys.data.dateToString(this._tValue,"hh:mm:ss","-",":")||"";}}return this.psValue;},getControlValue:function getControlValue(){if(this._eControl){return this._eControl.value;}return this.psValue;},setControlValue:function setControlValue(sVal){if(this._eControl&&this._eControl.value!==sVal){this._eControl.value=sVal;}},initMask:function initMask(){if(this._bMasks&&this._eControl){if(this._oMask){this._oMask.detach();this._oMask=null;}if(this.peDataType===df.ciTypeBCD){this._oMask=this.genNumMask();}else if(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime||this.peDataType===df.ciTypeTime){this._oMask=this.genDateMask(this.peDataType);}else if(this.peDataType===df.ciTypeText&&this.psMask){this._oMask=this.genWinMask(this.psMask);}}},genWinMask:function genWinMask(sMask){var aMask=[];var that=this;for(var i=0;i<sMask.length;i++){var sChar=sMask.charAt(i);if(sChar==="\\"&&i+1<this.sMask.length&&(sMask.charAt(i+1)==="#"||sMask.charAt(i+1)==="@"||sMask.charAt(i+1)==="!"||sMask.charAt(i+1)==="*")){i++;aMask.push({bEnter:false,bNumeric:false,bAlpha:false,bPunct:false,sChar:sMask.charAt(i+1)});}else{aMask.push({bEnter:sChar==="#"||sChar==="@"||sChar==="!"||sChar==="*",bNumeric:sChar==="#"||sChar==="*",bAlpha:sChar==="@"||sChar==="*",bPunct:sChar==="!"||sChar==="*",sChar:sChar});}}function filterWinMask(oEv){var iPos,iNewPos,sChar,sValue,oSel,sOrig;if(oEv.isKeyPrintable()){sOrig=sValue=this._eControl.value;oSel=df.dom.getSelection(this._eControl);iPos=oSel.start;sChar=oEv.key();if(oSel.length>0){sValue=sValue.substr(0,oSel.start)+sValue.substr(oSel.end);}iNewPos=iPos;while(iNewPos<aMask.length&&!aMask[iNewPos].bEnter){if(sValue.length<=iNewPos){sValue=sValue+aMask[iNewPos].sChar;}iNewPos++;}if(sValue!==sOrig){this._eControl.value=sValue;}if(iPos!==iNewPos&&iNewPos<aMask.length){df.dom.setCaretPosition(this._eControl,iNewPos);iPos=iNewPos;}if(iPos>=aMask.length||!df.sys.data.acceptWinMaskChar(sChar,aMask[iPos].sChar)){oEv.stop();}}}df.dom.on("keydown",this._eControl,filterWinMask,this);function correctWinMask(oEv){var iMaskPos=0,sNew="",iAdded=0;var sOrig=this._eControl.value;for(var iPos=0;iPos<sOrig.length&&iMaskPos<aMask.length;iPos++){var _sChar=sOrig.charAt(iPos);if(aMask[iMaskPos].bEnter){if(df.sys.data.acceptWinMaskChar(_sChar,aMask[iMaskPos].sChar)){sNew+=_sChar;iMaskPos++;}}else{sNew+=aMask[iMaskPos].sChar;iMaskPos++;}}if(oEv.inputIsInsert()){while(iMaskPos<aMask.length&&!aMask[iMaskPos].bEnter){sNew+=aMask[iMaskPos].sChar;iMaskPos++;iAdded++;}}if(sNew!==this._eControl.value){var _iPos=df.dom.getCaretPosition(this._eControl);this._eControl.value=sNew;df.dom.setCaretPosition(this._eControl,_iPos+iAdded);}}df.dom.on("input",this._eControl,correctWinMask,this);return{clearVal:function clearVal(sVal){var i=0,sResult="";while(i<sVal.length&&i<aMask.length){if(aMask[i].bEnter||sVal.charAt(i)!==aMask[i].sChar){sResult+=sVal.charAt(i);}i++;}return sResult;},detach:function detach(){if(that._eControl){df.dom.off("keydown",that._eControl,filterWinMask);df.dom.off("input",that._eControl,correctWinMask);}}};},clearWinMask:function clearWinMask(sVal){if(this._oMask){return this._oMask.clearVal(sVal);}return sVal;},genDateMask:function genDateMask(eDataType){var aFormat,regex=null;var that=this;function updateFormat(){var sFormat;if(eDataType===df.ciTypeDateTime){sFormat=this.dateTimeFormat();}else if(eDataType===df.ciTypeTime){sFormat=this.timeFormat();}else{sFormat=this.dateFormat();}var sDateSepp=this.dateSep();var sTimeSepp=this.timeSep();var asFormat=sFormat.match(/([^mdyhsf]+)|([mdyhsf]+)/gi)||[];var sRegex="";aFormat=[];asFormat.forEach(function(sPart){var oNew={oNext:null,bVal:true};switch(sPart.toLowerCase()){case"yyyy":oNew.iMax=4;sRegex+="(\\d{1,4})?";break;case"dd":case"mm":case"yy":case"hh":case"ss":oNew.iMax=2;sRegex+="(\\d{1,2})?";break;case"fff":oNew.iMax=3;sRegex+="(\\d{1,3})?";break;default:oNew.bVal=false;oNew.sText=sPart.replace("/",sDateSepp).replace(":",sTimeSepp);oNew.iMax=oNew.sText.length;sRegex+="(\\D{1"+(oNew.iMax>1?","+oNew.iMax:"")+"})?";}if(aFormat.length){aFormat[aFormat.length-1].oNext=oNew;}aFormat.push(oNew);});regex=new RegExp(sRegex,"");}updateFormat.call(this);df.dom.on("focus",this._eControl,updateFormat,this);function parseValue(sValue){var match=regex.exec(sValue);var iOffset=0;var bDirty=false;aFormat.forEach(function(oPart,iIndex){oPart.iStart=iOffset;oPart.sVal=match[iIndex+1]||"";if(oPart.sVal){iOffset+=oPart.sVal.length;oPart.bFound=true;}else{bDirty=true;oPart.bFound=false;}oPart.bDirty=bDirty;oPart.iEnd=iOffset;oPart.bAdd=false;});}function filterDate(oEv){if(oEv.isKeyPrintable()){var bAllow=false,iMoveCarret=0;var sChar=oEv.key();var oSel=df.dom.getSelection(this._eControl);var iCarret=oSel.start;var bNum="0123456789".indexOf(sChar)!==-1;var sValue=this._eControl.value;if(oSel.length>0){sValue=sValue.substr(0,oSel.start)+sValue.substr(oSel.end);}var bAppend=iCarret==sValue.length;parseValue(sValue);var oCP=aFormat[0];while(oCP.oNext&&oCP.iEnd<iCarret){oCP=oCP.oNext;}if(bAppend){if(bNum){if(oCP.bVal&&oCP.sVal.length<oCP.iMax){bAllow=true;}else{oCP=oCP.oNext;while(oCP&&!oCP.bVal){oCP.bAdd=!oCP.bFound;oCP=oCP.oNext;}bAllow=oCP&&oCP.bVal;}}else{if(oCP.bVal&&oCP.sVal.length>0&&oCP.oNext){oCP=oCP.oNext;if(!oCP.bVal&&oCP.sText.charAt(0)==sChar){bAllow=true;}}}}else{if(bNum){if(oCP.bVal){if(oCP.sVal.length<oCP.iMax){bAllow=true;}}else if(oCP.iEnd==iCarret&&oCP.oNext){oCP=oCP.oNext;bAllow=oCP.bVal&&oCP.sVal.length<oCP.iMax;}else if(oCP.bDirty){bAllow=true;}}else{if(oCP.bVal){if(oCP.sVal.length>0&&iCarret-oCP.iStart>0&&iCarret-oCP.iStart<=oCP.iMax&&oCP.oNext){oCP=oCP.oNext;if(!oCP.bVal&&oCP.sText.charAt(0)==sChar){if(!oCP.bFound){bAllow=true;}else{var oNext=oCP.oNext;while(oNext){if(!oNext.bVal&&!oNext.bFound&&oNext.sText==oCP.sText){bAllow=true;}oNext=oNext.oNext;}}}}}}}if(aFormat.reduce(function(bVal,oPart){return bVal||oPart.bAdd;},false)){var sNewVal="";aFormat.forEach(function(oPart){if(oPart.bVal){sNewVal+=oPart.sVal;}else if(oPart.bFound||oPart.bAdd){sNewVal+=oPart.sText;iMoveCarret+=oPart.sText.length-oPart.sVal.length;}});this._eControl.value=sNewVal;}if(iMoveCarret){df.dom.setCaretPosition(this._eControl,iCarret+iMoveCarret);}if(!bAllow){oEv.stop();}}}df.dom.on("keydown",this._eControl,filterDate,this);function correctDate(oEv){if(oEv.inputIsInsert()){var iMoveCarret=0;var oSel=df.dom.getSelection(this._eControl);var iCarret=oSel.start;var sValue=this._eControl.value;parseValue(sValue);var sNewVal="";aFormat.forEach(function(oPart){if(oPart.bVal){sNewVal+=oPart.sVal;}else if(oPart.bFound||oPart.oNext&&oPart.oNext.bFound){sNewVal+=oPart.sText;iMoveCarret+=oPart.sText.length-oPart.sVal.length;}});if(sNewVal!==sValue){this._eControl.value=sNewVal;df.dom.setCaretPosition(this._eControl,iCarret+iMoveCarret);}}}df.dom.on("input",this._eControl,correctDate,this);return{detach:function detach(){if(that._eControl){df.dom.off("keydown",that._eControl,filterDate);df.dom.off("input",that._eControl,correctDate);df.dom.off("focus",that._eControl,updateFormat);}}};},genNumMask:function genNumMask(){var sDecSepp,sDecSepparators,iLength,iPrecision;var that=this;function updateFormat(){sDecSepp=this.decSep();sDecSepparators=sDecSepp+".,";iPrecision=this.piPrecision;iLength=this.piMaxLength-this.piPrecision;}updateFormat.call(this);df.dom.on("focus",this._eControl,updateFormat,this);var bNegative,sNum,bHasDecSep,iDecSepOffset,sDec;function parseValue(sValue){bNegative=false;sNum="";bHasDecSep=false;iDecSepOffset=0;sDec="";for(var iOffset=0;iOffset<sValue.length;iOffset++){var sChar=sValue.charAt(iOffset);var bNum="0123456789".indexOf(sChar)!==-1;if(bNum){if(!bHasDecSep&&sNum.length<iLength){sNum+=sChar;}else if(iPrecision>0&&sDec.length<iPrecision){sDec+=sChar;}}else if(sChar=="-"){bNegative=true;}else if(sDecSepparators.indexOf(sChar)!=-1){if(iPrecision>0){bHasDecSep=true;iDecSepOffset=iOffset;}}}}function filterNumeric(oEv){if(oEv.isKeyPrintable()){var bAllow=false,bAdjust=false,iMoveCarret=0;var sChar=oEv.key();var oSel=df.dom.getSelection(this._eControl);var iCarret=oSel.start;var bNum="0123456789".indexOf(sChar)!==-1;var sOrig=this._eControl.value;var sValue=sOrig;if(oSel.length>0){sValue=sValue.substr(0,oSel.start)+sValue.substr(oSel.end);}var bAppend=iCarret==sValue.length;parseValue(sValue);if(bNum){if(!bHasDecSep||iCarret<=iDecSepOffset){if(sNum.length<iLength){if(bNegative&&iCarret==0){iMoveCarret+=1;}bAllow=true;}else if(bAppend&&!bHasDecSep&&iPrecision>0){bHasDecSep=true;bAdjust=true;iMoveCarret+=1;bAllow=true;}}else{if(sDec.length<iPrecision){bAllow=true;}}}else if(sChar=="-"){if(iCarret==0){if(!bNegative){bAllow=true;}else{iMoveCarret+=1;}}}else if(sDecSepparators.indexOf(sChar)!=-1){if(!bHasDecSep&&iPrecision>0){bAllow=true;}}if(bAdjust){sValue=(bNegative?"-":"")+sNum+(bHasDecSep?sDecSepp:"")+sDec;if(sOrig!=sValue){this._eControl.value=sValue;}}if(iMoveCarret||bAdjust){df.dom.setCaretPosition(this._eControl,iCarret+iMoveCarret);}if(!bAllow){oEv.stop();}}}df.dom.on("keydown",this._eControl,filterNumeric,this);function correctNumeric(oEv){var oSel=df.dom.getSelection(this._eControl);var iCarret=oSel.start;var sValue=this._eControl.value;parseValue(sValue);var sNewVal=(bNegative?"-":"")+sNum+(bHasDecSep?sDecSepp:"")+sDec;if(sNewVal!==sValue){this._eControl.value=sNewVal;df.dom.setCaretPosition(this._eControl,iCarret);}}df.dom.on("input",this._eControl,correctNumeric,this);return{detach:function detach(){if(that._eControl){df.dom.off("keydown",that._eControl,filterNumeric);df.dom.off("input",that._eControl,correctNumeric);df.dom.off("focus",that._eControl,updateFormat);}}};},validate:function validate(){var bResult=true,sVal;if(this.pbRequired){sVal=this.get_psValue();if(this.peDataType===df.ciTypeBCD&&parseFloat(sVal)===0.0||sVal===""){bResult=false;this.showControlError(13,this.getWebApp().getTrans("err_entry_required"));}else{this.hideControlError(13);}}if(bResult){this.fireChange();this.fireAutoFind();this.fire("OnValidate",[],function(oEvent){if(oEvent.bServer){if(oEvent.sReturnValue==="0"){if(this.selectAndFocus){this.selectAndFocus();}else{this.focus();}}else{this.hideAllControlErrors();}}else{if(oEvent.bCanceled){bResult=false;}}});}return bResult;},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.formKeys.tabOut)){if(!this.validate()){oEvent.stop();}}},onFocus:function onFocus(oEvent){df.WebBaseDEO.base.onFocus.call(this,oEvent);this.refreshDisplay(this._tValue);},onBlur:function onBlur(oEvent){this.updateTypeVal();this.fireAutoFind();df.WebBaseDEO.base.onBlur.call(this,oEvent);this.refreshDisplay(this._tValue);},fireChange:function fireChange(){var sNewVal;this.updateTypeVal();sNewVal=this.getServerVal();if(this._sPrevChangeVal!==sNewVal){this.pbChanged=true;this.fire('OnChange',[sNewVal,this._sPrevChangeVal]);this._bAutoFind=true;this._sPrevChangeVal=sNewVal;}},fireAutoFind:function fireAutoFind(){if(this._bAutoFind){this.fire('OnAutoFind');this._bAutoFind=false;}},onChange:function onChange(oEvent){this.fireChange();},showControlError:function showControlError(iErrNum,sErrText){var i;iErrNum=parseInt(iErrNum,10);for(i=0;i<this._aErrors.length;i++){if(this._aErrors[i].iNumber===iErrNum){this._aErrors[i].sText=sErrText;this.updateErrorDisp();return;}}this._aErrors.push({iNumber:iErrNum,sText:sErrText});this.updateErrorDisp();},hideControlError:function hideControlError(iErrNum){var i;iErrNum=df.toInt(iErrNum);for(i=0;i<this._aErrors.length;i++){if(this._aErrors[i].iNumber===iErrNum){this._aErrors.splice(i,1);this.updateErrorDisp();break;}}},hideAllControlErrors:function hideAllControlErrors(){this._aErrors=[];this.updateErrorDisp();},updateErrorDisp:function updateErrorDisp(){var i,aHtml=[];if(this._aErrors.length>0){this.makeVisible();for(i=0;i<this._aErrors.length;i++){if(i>0){aHtml.push('<br>');}aHtml.push(this._aErrors[i].sText);}if(!this._oErrorBalloon){this._oErrorBalloon=new df.InfoBalloon(this,"WebErrorTooltip",aHtml.join(''));}else{this._oErrorBalloon.psMessage=aHtml.join('');this._oErrorBalloon.update();}this._oErrorBalloon.show();if(this.getErrorElem()){df.dom.addClass(this.getErrorElem(),"WebError");}this.focus();}else{if(this._oErrorBalloon){this._oErrorBalloon.hide();df.dom.removeClass(this.getErrorElem(),"WebError");}}},getErrorElem:function getErrorElem(){return this._eElem;},resize:function resize(){df.WebBaseDEO.base.resize.call(this);if(this._oErrorBalloon){this._oErrorBalloon.resize();}}});df.WebBaseForm=function WebBaseForm(sName,oParent){df.WebBaseForm.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbReadOnly",false);this.prop(df.tString,"psAutoComplete","off");this.event("OnKey",df.cCallModeDefault);this.event("OnInput",df.cCallModeDefault);};df.defineClass("df.WebBaseForm","df.WebBaseDEO",{afterRender:function afterRender(){df.WebBaseForm.base.afterRender.apply(this,arguments);this.set_pbReadOnly(this.pbReadOnly);df.dom.on("keydown",this._eControl,this.onKeyDownSrv,this);df.dom.on("input",this._eControl,this.onInputSrv,this);if(this._eLbl&&this.peLabelPosition===df.ciLabelFloat){this.floatLabel(false);df.dom.on("click",this._eLbl,this.onFocus,this);this.checkAutoFill();}},initMask:function initMask(){df.WebBaseForm.base.initMask.call(this);if(this._eControl){if(this.peDataType===df.ciTypeText&&!this.psMask){this._eControl.maxLength=this.piMaxLength>0?this.piMaxLength:0;}else{this._eControl.maxLength=1048576;}}},set_pbReadOnly:function set_pbReadOnly(bVal){if(this._eControl){this._eControl.readOnly=bVal;df.dom.toggleClass(this._eElem,"Web_ReadOnly",bVal);}},set_piMaxLength:function set_piMaxLength(iVal){this.piMaxLength=iVal;this.initMask();},set_psAutoComplete:function set_psAutoComplete(sVal){if(this._eControl){this._eControl.autocomplete=sVal;}},set_peLabelPosition:function set_peLabelPosition(iVal){this.peLabelPosition=iVal;this.posLabel(false);if(this._eLbl){df.dom.off("click",this._eLbl,this.onFocus,this);if(iVal===df.ciLabelFloat){df.dom.on("click",this._eLbl,this.onFocus,this);this.floatLabel(false);}}},onKeyDownSrv:function onKeyDownSrv(oEv){this.fire("OnKey",[oEv.isKeyPrintable(),oEv.key()]);},onInputSrv:function onInputSrv(oEv){this.fire("OnInput",[oEv.inputIsInsert(),oEv.e.inputType||"Undefined"]);},onFocus:function onFocus(oEvent){df.WebBaseForm.base.onFocus.call(this,oEvent);if(this.peLabelPosition===df.ciLabelFloat){this.floatLabel(true);}},onBlur:function onBlur(oEvent){df.WebBaseForm.base.onBlur.call(this,oEvent);if(this.peLabelPosition===df.ciLabelFloat){this.floatLabel(false);}},floatLabel:function floatLabel(bFocus){if(this.getControlValue()!=''||bFocus&this.isEnabled()||this.matchSelector(this._eControl,":-webkit-autofill")){if(this._eLbl!=null){df.dom.addClass(this._eLbl,"WebCon_Float");df.dom.removeClass(this._eLbl,"WebCon_Unfloat");}}else{if(this._eLbl!=null){df.dom.addClass(this._eLbl,"WebCon_Unfloat");df.dom.removeClass(this._eLbl,"WebCon_Float");}}},setControlValue:function setControlValue(sVal){df.WebBaseForm.base.setControlValue.call(this,sVal);if(this._eControl){if(this.peLabelPosition===df.ciLabelFloat){this.floatLabel(false);}}},checkAutoFill:function checkAutoFill(){var that=this,iTries=20;function doCheckAutoFill(){iTries--;if(that._eControl&&that.matchSelector(that._eControl,":-webkit-autofill")){that.floatLabel(false);}else if(iTries>0){setTimeout(doCheckAutoFill,100);}}doCheckAutoFill();},matchSelector:function matchSelector(el,selector){if(df.sys.isChrome){return(el.matches||el.matchesSelector||el.msMatchesSelector||el.mozMatchesSelector||el.webkitMatchesSelector||el.oMatchesSelector).call(el,selector);}return false;}});df.dragdrop=function dragdrop(){var aHandlers=[],aZones=[],bInDrag=false,iEnterCount=0,tResizeInt;var aHelpers=new Set();function initDropZones(){if(bInDrag){return;}aHandlers.forEach(function(oHandler){var eZone,oDropDetails=oHandler.getDropDetails();if(oDropDetails){eZone=df.dom.create('<div data-dropzone="yes" class="WebDropZone '+oDropDetails.sDropClass+'"><div>'+oDropDetails.sDropContent+'</div></div>');eZone.style.width=oDropDetails.oRect.width+"px";eZone.style.height=oDropDetails.oRect.height+"px";eZone.style.left=oDropDetails.oRect.left+"px";eZone.style.top=oDropDetails.oRect.top+"px";document.body.appendChild(eZone);aZones.push({oObj:oHandler,oDetails:oDropDetails,eZone:eZone});}});tResizeInt=setInterval(repositionDropZones,300);bInDrag=true;}function repositionDropZones(){aZones.forEach(function(oZone){var oDropDetails=oZone.oDetails=oZone.oObj.getDropDetails();oZone.eZone.style.width=oDropDetails.oRect.width+"px";oZone.eZone.style.height=oDropDetails.oRect.height+"px";oZone.eZone.style.left=oDropDetails.oRect.left+"px";oZone.eZone.style.top=oDropDetails.oRect.top+"px";});}function stopDropZones(){if(!bInDrag){return;}aZones.forEach(function(oZone){oZone.eZone.parentNode.removeChild(oZone.eZone);oZone.eZone=null;});aHelpers.forEach(function(oHelper){oHelper.cleanupHelper();});aZones=[];bInDrag=false;iEnterCount=0;clearInterval(tResizeInt);}function onWindowEnter(oEvent){iEnterCount++;if(!bInDrag){if(containsFiles(oEvent.e)){initDropZones();aHelpers.forEach(function(oHelper){oHelper.onFileDrag(oEvent);});}}bInDrag=true;oEvent.stop();}function onWindowOver(oEvent){var eElem=oEvent.getTarget();while(eElem&&eElem!==document.body){if(eElem.hasAttribute("data-dropzone")){oEvent.e.dataTransfer.dropEffect="copy";oEvent.stop();return;}eElem=eElem.parentNode;}oEvent.e.dataTransfer.dropEffect="none";oEvent.stop();}function onWindowDrop(oEvent){var eElem=oEvent.getTarget();while(eElem&&eElem!==document.body){if(eElem.hasAttribute("data-dropzone")){break;}eElem=eElem.parentNode;}if(eElem){aZones.forEach(function(oZone){if(oZone.eZone===eElem){oZone.oObj.handleDrop(oEvent);stopDropZones();oEvent.stop();return false;}});}}function onWindowLeave(oEvent){iEnterCount--;if(iEnterCount<=0){stopDropZones();iEnterCount=0;}}function containsFiles(event){if(event.dataTransfer.types){for(var i=0;i<event.dataTransfer.types.length;i++){if(event.dataTransfer.types[i]=="Files"){return true;}}}return false;}df.dom.ready(function(){df.dom.on("dragenter",document,onWindowEnter,this);df.dom.on("dragover",document,onWindowOver,this);df.dom.on("drop",document,onWindowDrop,this);df.dom.on("dragleave",document,onWindowLeave,this);});return{addHandler:function addHandler(oObj){aHandlers.push(oObj);},remHandler:function remHandler(oObj){var i;while((i=aHandlers.indexOf(oObj))>=0){aHandlers.splice(i,1);}},registerHelper:function registerHelper(oHelper){aHelpers.add(oHelper);},removeHelper:function removeHelper(oHelper){aHelpers.remove(oHelper);},containsFiles:containsFiles,stopDropZones:stopDropZones};}();df.uploadFiles=function uploadFile(oOpts){var i,fEmpty,aFiles,oWO,aRows=[],bCanceled,bUploading=true,oCurRec;aFiles=oOpts.aFiles;oWO=oOpts.oWO;oOpts.iTotal=0;oOpts.iLoaded=0;fEmpty=function fEmpty(){};oOpts.displayStartWorking=oOpts.displayStartWorking||fEmpty;oOpts.displayProgress=oOpts.displayProgress||fEmpty;oOpts.displayFinishWorking=oOpts.displayFinishWorking||fEmpty;oOpts.displayFinished=oOpts.displayFinished||fEmpty;function uploadFileHtml5(oFile,iFile,fFinished){var oData,oReq;oOpts.displayProgress.call(oWO,iFile,aFiles.length,0,oFile.oFile.size,oOpts.iLoaded,oOpts.iTotal);oCurRec=oReq=new XMLHttpRequest();oReq.upload.addEventListener('progress',function(ev){var iTotal=oOpts.iLoaded+ev.loaded;iTotal=iTotal<oOpts.iTotal?iTotal:oOpts.iTotal;oOpts.displayProgress.call(oWO,iFile,aFiles.length,ev.loaded,ev.total,iTotal,oOpts.iTotal);},false);oReq.onreadystatechange=function(ev){try{if(oReq.readyState===df.ajax.REQUEST_STATE_COMPLETE){if(!bCanceled){if(oReq.status===201){oFile.bFinished=true;oOpts.iLoaded+=oFile.oFile.size;fFinished(true);oReq.onreadystatechange=null;}else{throw new df.Error(999,"Received HTTP error '{{0}} {{1}}' while uploading file.",this,[oReq.status,oReq.statusText],oReq.responseText);}}oReq=null;}}catch(oErr){fFinished(false);oWO.getWebApp().handleError(oErr);oReq=null;}};oReq.open('POST',oWO.psUploadUrl,true);oData=new FormData();oData.append('hash',oFile.sResourceId);oData.append('v','html5');oData.append('file',oFile.oFile);oReq.send(oData);}function uploadFilesHtml5(){var i,bLast=true,oFile=null,iIndex;if(bCanceled){return;}for(i=0;i<aFiles.length;i++){if(!aFiles[i].bFinished){if(!oFile){oFile=aFiles[i];iIndex=i;}else{bLast=false;break;}}}uploadFileHtml5(oFile,iIndex,function(bSuccess){var i;if(bSuccess){if(bLast){oOpts.displayFinishWorking.call(oWO);}if(oWO.pbNotifyIndividualFile){oWO.serverAction("DoFileFinished",[oFile.oFile.name,oFile.sResourceId],null,function(oEvent){oFile.sFinishedResult=oEvent.sReturnValue;if(!bLast){uploadFilesHtml5();}},oWO);}else{if(bLast){for(i=0;i<aFiles.length;i++){oWO.serverAction("DoFileFinished",[aFiles[i].oFile.name,aFiles[i].sResourceId],null,function(oEvent){oFile.sFinishedResult=oEvent.sReturnValue;});}}else{uploadFilesHtml5();}}if(bLast){oWO.fire("OnUploadFinished",[],function(oEvent){oOpts.displayFinished.call(oWO,true);bUploading=false;if(oOpts.finished){oOpts.finished.call(oWO,true,aFiles);}});oWO.processUpload=null;}}else{if(oWO._eControl){oWO._eControl.value="";}oOpts.displayFinished.call(oWO,false);bUploading=false;}});}oOpts.cancel=function(){bCanceled=true;aFiles=[];if(oCurRec){oCurRec.abort();}oOpts.displayFinished.call(oWO,false);bUploading=false;};var fUploadCallback=function fUploadCallback(oEv){var i,aRows=JSON.parse(oEv.sReturnValue);for(i=0;i<aRows.length;i++){if(aRows[i].length>=2&&aFiles[aRows[i][0]]){aFiles[aRows[i][0]].sResourceId=aRows[i][1];}else{throw new df.Error(999,"Received invalid resource id from the server.",this);}}oOpts.iTotal=0;oOpts.iLoaded=0;for(i=0;i<aFiles.length;i++){if(!aFiles[i].sResourceId){aFiles.splice(i,1);i--;}else{oOpts.iTotal+=aFiles[i].oFile.size;}}if(aFiles.length>0){bCanceled=false;uploadFilesHtml5();}else{oOpts.displayFinished.call(oWO,false);bUploading=false;}};if(aFiles&&aFiles.length>0){for(i=0;i<aFiles.length;i++){var oCurFile=aFiles[i].oFile;aRows.push([i,oCurFile.name||"Unknown",oCurFile.size||0,oCurFile.type||"Unknown"]);oOpts.iTotal+=oCurFile.size||0;}oOpts.displayStartWorking.call(oWO);oWO.doStartUpload(fUploadCallback,aRows);}else{throw new df.Error(999,"No file details found to start upload.",this);}};df.uploadFilesProgressDialog=function(oOpts){var oDialog,oMainPnl,oLbl,oFileLbl,oRemLbl,oSpacer,oTotalPrg,oFilePrg,oBtnPnl,oCancelBtn,oWO;oWO=oOpts.oWO;var sFilesTrans=oWO.getWebApp().getTrans("files");var sFileTrans=oWO.getWebApp().getTrans("file");function onCancel(oEvent){oOpts.cancel();}oOpts.displayStartWorking=function(){var iWindowWidth=df.dom.windowWidth();oDialog=new df.WebModalDialog(null,oWO);oDialog.psCaption=oWO.getWebApp().getTrans("file_cap_uploading");oDialog.pbShowClose=this.pbAllowCancel;oDialog.piMinWidth=iWindowWidth>520?500:iWindowWidth-20;oDialog.OnEscape.addListener(onCancel,this);oMainPnl=new df.WebPanel(null,oDialog);oMainPnl.peRegion=df.ciRegionCenter;oMainPnl.piColumnCount=10;oDialog.addChild(oMainPnl);oLbl=new df.WebLabel(null,oMainPnl);oLbl.psCaption=sFileTrans+":";oLbl.piColumnSpan=2;oLbl.peAlign=df.ciAlignRight;oMainPnl.addChild(oLbl);oFileLbl=new df.WebLabel(null,oMainPnl);oFileLbl.psCaption="...";oFileLbl.piColumnSpan=0;oFileLbl.piColumnIndex=2;oMainPnl.addChild(oFileLbl);oLbl=new df.WebLabel(null,oMainPnl);oLbl.psCaption=oWO.getWebApp().getTrans("file_remain");+":";oLbl.piColumnSpan=2;oLbl.peAlign=df.ciAlignRight;oMainPnl.addChild(oLbl);oRemLbl=new df.WebLabel(null,oMainPnl);oRemLbl.psCaption=oOpts.aFiles.length+" "+sFilesTrans+" ("+df.sys.data.markupDataSize(oOpts.iTotal)+")";oRemLbl.piColumnSpan=0;oRemLbl.piColumnIndex=2;oMainPnl.addChild(oRemLbl);oSpacer=new df.WebSpacer(null,oMainPnl);oMainPnl.addChild(oSpacer);if(oWO.pbMultiFile){oTotalPrg=new df.WebProgressBar(null,oMainPnl);oTotalPrg.piMaxValue=oOpts.iTotal>0?oOpts.iTotal:oOpts.aFiles.length;oMainPnl.addChild(oTotalPrg);}oFilePrg=new df.WebProgressBar(null,oMainPnl);oMainPnl.addChild(oFilePrg);if(oWO.pbAllowCancel){oBtnPnl=new df.WebPanel(null,oDialog);oBtnPnl.peRegion=df.ciRegionBottom;oBtnPnl.piColumnCount=12;oDialog.addChild(oBtnPnl);oCancelBtn=new df.WebButton(null,oBtnPnl);oCancelBtn.psCaption=oWO.getWebApp().getTrans("cancel");oCancelBtn.piColumnIndex=9;oCancelBtn.piColumnSpan=3;oCancelBtn.OnClick.addListener(onCancel,this);oBtnPnl.addChild(oCancelBtn);}oDialog.show();oWO.getWebApp().ready(function(){oDialog.resize();if(oCancelBtn){oCancelBtn.focus();}});};oOpts.displayProgress=function(iFile,iFiles,iFileLoaded,iFileTotal,iTotalLoaded,iTotal){oFileLbl.set("psCaption",oOpts.aFiles[iFile]&&oOpts.aFiles[iFile].oFile&&oOpts.aFiles[iFile].oFile.name||"");var iRem=iFiles-(iFile+1);var iBytesRem=iTotal-iTotalLoaded;oRemLbl.set("psCaption",iRem>0?iRem.toString()+" "+sFilesTrans+" ("+df.sys.data.markupDataSize(iBytesRem)+")":df.sys.data.markupDataSize(iBytesRem));if(oWO.pbMultiFile){oTotalPrg.set("piMaxValue",iTotal);oTotalPrg.set("piValue",iTotalLoaded);}oFilePrg.set("piMaxValue",iFileTotal);oFilePrg.set("piValue",iFileLoaded);};oOpts.displayFinishWorking=function(){oFilePrg.set("piValue",oFilePrg.get("piMaxValue"));if(oWO.pbMultiFile){oTotalPrg.set("piValue",oTotalPrg.get("piMaxValue"));}oRemLbl.set("psCaption","0 KB");};oOpts.displayFinished=function(bSuccess){if(oDialog){oDialog.hide();oDialog.destroy();oDialog.OnEscape.removeListener(onCancel,this);if(oCancelBtn){oCancelBtn.OnClick.removeListener(onCancel,this);}oDialog=null;}};df.uploadFiles(oOpts);};df.WebFileUpload_Mixin=function WebFileUpload_Mixin(sName,oParent){this.getBase("df.WebFileUpload_Mixin").constructor.call(this,sName,oParent);this.prop(df.tBool,"pbShowDialog",true);this.prop(df.tBool,"pbCapture",false);this.prop(df.tString,"psAccept","");this.event("OnUploadFinished",df.cCallModeWait);};df.defineClass("df.WebFileUpload_Mixin",{initFiles:function initFiles(aFiles){var i;if(this._bUploading){return;}this._aFiles=[];for(i=0;i<aFiles.length&&(this.pbMultiFile||this._aFiles.length<1);i++){if(this.validate(aFiles[i])){this._aFiles.push({bFinished:false,sResourceId:null,oFile:aFiles[i]});}}if(this._aFiles.length>0){this.displaySelectedFileDetails();if(this.pbAutoStart){this.startUpload();}}},validate:function validate(oFile){var aAllowed,i,sAccept,aMime,aFileMime,bExt=false;if(this.psAccept){aAllowed=this.psAccept.toLowerCase().split(",");for(i=0;i<aAllowed.length;i++){sAccept=aAllowed[i].trim();if(sAccept.charAt(0)==="."){if(oFile.name.substr(oFile.name.lastIndexOf("."),sAccept.length).toLowerCase()===sAccept){return true;}bExt=true;}else{if(oFile.type){aMime=sAccept.split("/");aFileMime=oFile.type.split("/");if(aMime.length>1&&aFileMime.length>1&&(aMime[0]===aFileMime[0]||aMime[0]==="*")&&(aMime[1]===aFileMime[1]||aMime[1]==="*")){return true;}}}}if(!oFile.type&&!bExt){return true;}return false;}return true;},startUpload:function startUpload(){var oOpts={oWO:this,aFiles:this._aFiles,finished:function finished(bSuccess,aFiles){if(this._eInput){this._eInput.value="";}},displayStartWorking:this.displayStartWorking,displayProgress:this.displayProgress,displayFinishWorking:this.displayFinishWorking,displayFinished:this.displayFinished};if(this.pbShowDialog){df.uploadFilesProgressDialog(oOpts);}else{df.uploadFiles(oOpts);}},doStartUpload:function doStartUpload(fCallBack,aRows){this.serverAction("DoStartUpload",[],df.sys.vt.serialize(aRows),fCallBack);},processUpload:function processUpload(){},displaySelectedFileDetails:function displaySelectedFileDetails(){},displayStartWorking:function displayStartWorking(){},displayProgress:function displayProgress(iFile,iFiles,iFileLoaded,iFileTotal,iTotalLoaded,iTotal){},displayFinishWorking:function displayFinishWorking(){},displayFinished:function displayFinished(bSuccess){},set_psAccept:function set_psAccept(sVal){if(this._eInput){this._eInput.accept=sVal;}},set_pbCapture:function set_pbCapture(bVal){if(this._eInput){this._eInput.capture=bVal;}}});df.WebFileUploadBase=df.mixin("df.WebFileUpload_Mixin","df.WebBaseControl");df.WebBaseFileUpload=function WebBaseFileUpload(sName,oParent){df.WebBaseFileUpload.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbMultiFile",false);this.prop(df.tBool,"pbAutoStart",true);this.prop(df.tBool,"pbAllowCancel",true);this.prop(df.tBool,"pbNotifyIndividualFile",false);this.prop(df.tString,"psDropZoneObjName","");this._oDragArea=null;this._eDragArea=null;};df.defineClass("df.WebBaseFileUpload","df.WebFileUploadBase",{fileHtml:function fileHtml(aHtml){aHtml.push('<div style="display: none">');aHtml.push('<input type="file" name="',this._sName,'" id="',this._sControlId,'"',this.pbMultiFile?' multiple':'',' accept="',this.psAccept,'"',this.pbCapture?' capture':'','>');aHtml.push('</div>');},afterRender:function afterRender(){this._eInput=df.dom.query(this._eElem,'input[type="file"]');df.WebBaseFileUpload.base.afterRender.call(this);df.dom.on("change",this._eInput,this.onFileChange,this);},selectFiles:function selectFiles(){if(!(window.File&&window.FileList&&window.FileReader)){throw new df.Error(999,"HTML5 Upload is not supported by this browser.",this);}this._eInput.click();},afterShow:function afterShow(){df.WebBaseFileUpload.base.afterShow.call(this);df.dragdrop.addHandler(this);},afterHide:function afterHide(){df.WebBaseFileUpload.base.afterHide.call(this);df.dragdrop.remHandler(this);},getDropDetails:function getDropDetails(){var oDropObj,eDropElem,oWebApp=this.getWebApp();if(this.isEnabled()){oDropObj=oWebApp.findObj(this.psDropZoneObjName);if(oDropObj instanceof df.WebBaseUIObject){if(oDropObj===oWebApp){eDropElem=document.body;}else{eDropElem=oDropObj._eElem;}if(eDropElem){return{sDropContent:this.getWebApp().getTrans("file_drop"),sDropClass:"",oRect:eDropElem.getBoundingClientRect()};}}}return null;},handleDrop:function handleDrop(oEvent){var aFiles;aFiles=oEvent.e.dataTransfer&&oEvent.e.dataTransfer.files||null;if(aFiles&&aFiles.length>0){oEvent.stop();this.initFiles(aFiles);}},onFileChange:function onFileChange(oEvent){var sFileName;if(this._eInput.files.length>0){this.initFiles(this._eInput.files);}oEvent.stop();}});df.tWebMenuItem={sId:df.tString,sCaption:df.tString,sTooltip:df.tString,sGroupCaption:df.tString,bEnabled:df.tBool,sCSSClass:df.tString,sHtmlId:df.tString,bBeginGroup:df.tBool,sImage:df.tString,eCheckbox:df.tInt,sTextColor:df.tString,sBackgroundColor:df.tString,eActionDisplay:df.tString,aChildren:[]};df.tWebMenuItem.aChildren.push(df.tWebMenuItem);df.WebMenuProvider_mixin=function WebMenuProvider_mixin(sName,oParent){this.getBase("df.WebMenuProvider_mixin").constructor.apply(this,arguments);this.prop(df.tBool,"pbAllowHtml");this.prop(df.tString,"psGroupName");this.OnUiUpdate=new df.events.JSHandler();this._aMenu=null;this._aDynamicMenu=null;this._bIsMenuProv=true;this._bIsMenuListener=false;};df.defineClass("df.WebMenuProvider_mixin",{create:function create(){this.getBase("df.WebMenuProvider_mixin").create.apply(this,arguments);if(this.psGroupName){this.getHub().addProvider(this.psGroupName,this);if(this._bIsMenuListener){this.getHub().addListener(this.psGroupName,this);}}},destroy:function destroy(){if(this.psGroupName){if(this._bIsMenuListener){this.getHub().remListener(this.psGroupName,this);}this.getHub().remProvider(this.psGroupName,this);}this.getBase("df.WebMenuProvider_mixin").destroy.call(this);},groupCollect:function groupCollect(aData){return this.genMenuData(aData);},groupUpdate:function groupUpdate(aData){this._aMenu=aData;this.updatePaths();this.refreshMenu();},genMenuData:function genMenuData(aData){var aMen,i;if(this._aDynamicMenu){aMen=this._aDynamicMenu;for(i=0;i<aMen.length;i++){aMen[i]._oHandler=this;aData.push(aMen[i]);}}function visit(oParent,aItems){var oItem,tItem,i;for(i=0;i<oParent._aChildren.length;i++){oItem=oParent._aChildren[i];if(oItem instanceof df.WebMenuItem&&oItem.pbRender&&oItem.pbVisible){tItem={sId:"",hRef:oItem,sCaption:oItem.psCaption,sTooltip:oItem.psToolTip,sGroupCaption:oItem.psGroupCaption,bEnabled:oItem.isEnabled(),sCSSClass:oItem.psCSSClass,sHtmlId:oItem.psHtmlId,bBeginGroup:oItem.pbBeginGroup,sImage:oItem.psImage,eCheckbox:oItem instanceof df.WebMenuItemCheckbox?oItem.isChecked()?1:-1:0,sTextColor:oItem.psTextColor,sBackgroundColor:oItem.psBackgroundColor,eActionDisplay:oItem.peActionDisplay,aChildren:[],_oHandler:oItem};aItems.push(tItem);visit(oItem,tItem.aChildren);}}}visit(this,aData);},set_psGroupName:function set_psGroupName(sVal){if(this.psGroupName){this.getHub().remProvider(this.psGroupName,this);}this.getHub().addProvider(this.psGroupName,this);},set_pbAllowHtml:function set_pbAllowHtml(bVal){this.pbAllowHtml=bVal;this.refreshMenu();},deserializeVT:df.sys.vt.generateDeserializer([df.tWebMenuItem]),refresh:function refresh(){var i,aMenu=this.deserializeVT(this._tActionData);for(i=0;i<aMenu.length;i++){this.initDynamic(aMenu[i]);}this._aDynamicMenu=aMenu;this.notifyChange();},itemClick:function itemClick(tItem,fReturn,oEnv){if(tItem.aChildren.length>0){fReturn.call(oEnv,false);return false;}else{return this.fire('OnItemClick',[tItem.sId,tItem.sCaption],function(oEvent){fReturn.call(oEnv,oEvent.bClient||oEvent.bServer);});}},updateItem:function updateItem(sId,bOverwriteSubs){var tCur,tNew;tNew=df.sys.vt.deserialize(this._tActionData,df.tWebMenuItem);tCur=this.getItemById(sId);if(tCur){tCur.sId=tNew.sId;tCur.sCaption=tNew.sCaption;tCur.sTooltip=tNew.sToolTip;tCur.sGroupCaption=tNew.sGroupCaption;tCur.bEnabled=tNew.bEnabled;tCur.sCSSClass=tNew.sCSSClass;tCur.sHtmlId=tNew.sHtmlId;tCur.bBeginGroup=tNew.bBeginGroup;tCur.sImage=tNew.sImage;tCur.eCheckbox=tNew.eCheckbox;tCur.sTextColor=tNew.sTextColor;tCur.sBackgroundColor=tNew.sBackgroundColor;tCur.eActionDisplay=tNew.eActionDisplay;if(df.toBool(bOverwriteSubs)){tCur.aChildren=tNew.aChildren;this.initDynamic(tCur);}this.notifyChange();}},insertItem:function insertItem(sParentId){var tParent,tNew;tNew=df.sys.vt.deserialize(this._tActionData,df.tWebMenuItem);tParent=this.getItemById(sParentId);if(tParent){this.initDynamic(tNew);tParent.aChildren.push(tNew);this.notifyChange();}},removeItem:function removeItem(sId){function find(aMen){for(var i=0;i<aMen.length;i++){if(aMen[i].sId===sId){aMen.splice(i,1);return true;}if(find(aMen[i].aChildren)){return true;}}return false;}if(find(this._aDynamicMenu)){this.notifyChange();}},initDynamic:function initDynamic(tItem){var i;tItem._oHandler=this;for(i=0;i<tItem.aChildren.length;i++){this.initDynamic(tItem.aChildren[i]);}},notifyChange:function notifyChange(){this.getWebApp().waitForCall(this.performUpdate,this);},updateEnabled:function updateEnabled(){this.getBase("df.WebMenuProvider_mixin").updateEnabled.call(this);this.notifyChange();},performUpdate:function performUpdate(){this._aMenu=null;if(this.psGroupName){this.getHub().updateGroup(this.psGroupName);}else{this.refreshMenu();}this.OnUiUpdate.fire(this,{bUiDriven:false});},getMenu:function getMenu(){if(!this._aMenu){this._aMenu=[];if(!this.psGroupName||!this._bIsMenuListener){this.genMenuData(this._aMenu);this.updatePaths();}}return this._aMenu;},getItemByPath:function getItemByPath(sPath){var tItem=null,aPath,aMen,i;aPath=sPath.split(".");aMen=this.getMenu();for(i=0;i<aPath.length;i++){if(aMen[aPath[i]]){tItem=aMen[aPath[i]];aMen=tItem.aChildren;}else{tItem=null;}}return tItem;},getItemById:function getItemById(sId){function find(aMen){for(var i=0;i<aMen.length;i++){if(aMen[i].sId===sId){return aMen[i];}var oSub=find(aMen[i].aChildren);if(oSub){return oSub;}}return null;}return find(this.getMenu());},getItemByHandler:function getItemByHandler(oObj){function find(aMen){var oRes=null,i;for(i=0;i<aMen.length;i++){if(aMen[i]._oHandler===oObj){return aMen[i];}oRes=find(aMen[i].aChildren);if(oRes){return oRes;}}return null;}return find(this.getMenu());},getItemElemByPath:function getItemElemByPath(sPath){return this._eControl&&df.dom.query(this._eControl,'li[data-df-path="'+sPath+'"]')||null;},getItemElemByHandler:function getItemElemByHandler(oObj){var tItm=this.getItemByHandler(oObj);if(tItm){return this.getItemElemByPath(tItm._sPath);}return null;},genItemHtml:function genItemHtml(aHtml,tItem,bSub){var aClassNames,i,sTooltip;aClassNames=['WebMenuItem',tItem.sCSSClass,tItem.bEnabled?df.CssEnabled:df.CssDisabled];if(tItem.aChildren.length>0){aClassNames.push('WebItm_HasSub');}if(tItem.bBeginGroup){aClassNames.push('WebItm_BgnGroup');}if(tItem.sImage){aClassNames.push('WebItm_HasIcon');}if(tItem.eCheckbox<0||tItem.eCheckbox>0){aClassNames.push('WebItm_HasCheckbox');}aHtml.push('<li class="',df.dom.encodeAttr(aClassNames.join(" ")),'" data-df-path="',tItem._sPath,'"');if(tItem.sHtmlId){aHtml.push(' id="',df.dom.encodeAttr(tItem.sHtmlId),'"');}if(tItem.sBackgroundColor||tItem.sTextColor){aHtml.push(' style="');if(tItem.sTextColor){aHtml.push('color: ',df.dom.encodeAttr(tItem.sTextColor),';');}if(tItem.sBackgroundColor){aHtml.push('background-color: ',df.dom.encodeAttr(tItem.sBackgroundColor),';');}aHtml.push('"');}aHtml.push('>');tItem.sCaption=tItem.sCaption.replace("&","");if(!this.pbShowLabel&&tItem._sPath.indexOf(".")<0){sTooltip=tItem.sTooltip||df.dom.encodeHtml(tItem.sCaption);}else{sTooltip=tItem.sTooltip;}aHtml.push('<div title="',df.dom.encodeAttr(sTooltip),'">');if(tItem.sImage){aHtml.push('<span class="WebItm_Icon" style="background-image: url('+"'"+df.dom.encodeAttr(tItem.sImage)+"'"+');">&nbsp;</span>');}else{aHtml.push('<span class="WebItm_Icon">&nbsp;</span>');}if(tItem.eCheckbox<0){aHtml.push('<input class="WebItm_CheckBox" type="checkbox"></input>');}else if(tItem.eCheckbox>0){aHtml.push('<input class="WebItm_CheckBox" type="checkbox" checked></input>');}aHtml.push('<a tabindex="-1" href="javascript: void(0);">',this.pbAllowHtml?tItem.sCaption:df.dom.encodeHtml(tItem.sCaption),'</a></div>');if(bSub&&tItem.aChildren.length>0){aHtml.push('<ul>');for(i=0;i<tItem.aChildren.length;i++){this.genItemHtml(aHtml,tItem.aChildren[i],bSub);}aHtml.push('</ul>');}aHtml.push('</li>');},updatePaths:function updatePaths(){var i;function genID(tItem,sPath){var i;tItem._sPath=sPath;for(i=0;i<tItem.aChildren.length;i++){genID(tItem.aChildren[i],sPath+"."+i.toString());}}for(i=0;i<this._aMenu.length;i++){genID(this._aMenu[i],i.toString());}},refreshMenu:function refreshMenu(){},expandItem:function expandItem(tItem){},showItem:function showItem(tItem){this.expandItem(tItem);},getHub:function getHub(){var oWA=this.getWebApp();if(oWA){if(!oWA._oMenuHub){oWA._oMenuHub=new df.GroupHub();}return oWA._oMenuHub;}return null;},isInCommandBar:function isInCommandBar(){var oC=this;while(oC instanceof df.WebBaseMenu){oC=oC._oParent;if(oC instanceof df.WebCommandBar){return true;}}return false;}});df.WebBaseMenu=df.mixin("df.WebMenuProvider_mixin","df.WebBaseControl");df.WebPanel=function WebPanel(sName,oParent){df.WebPanel.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peRegion",0);this.prop(df.tBool,"pbResizable",false);this._eDivider=null;this._bWrapDiv=true;this._sControlClass="WebPanel";};df.defineClass("df.WebPanel","df.WebBaseContainer",{afterRender:function afterRender(){df.WebPanel.base.afterRender.call(this);this.set_pbResizable(this.pbResizable);},set_pbResizable:function set_pbResizable(bVal){if(this._eElem){if(bVal&&this.peRegion!==df.ciRegionCenter){if(!this._eDivider){this._eDivider=df.dom.create('<div></div>');this._eElem.appendChild(this._eDivider);df.dom.on("mousedown",this._eDivider,this.onResize,this);}this._eDivider.className=this.peRegion===df.ciRegionLeft||this.peRegion===df.ciRegionRight?'WebPanel_DividerVertical':'WebPanel_DividerHorizontal';this._eDivider.style.right="";this._eDivider.style.left="";this._eDivider.style.top="";this._eDivider.style.bottom="";if(this.peRegion===df.ciRegionLeft){this._eDivider.style.right="0px";}else if(this.peRegion===df.ciRegionRight){this._eDivider.style.left="0px";}else if(this.peRegion===df.ciRegionBottom){this._eDivider.style.top="0px";}else if(this.peRegion===df.ciRegionTop){this._eDivider.style.bottom="0px";}}else{if(this._eDivider){df.dom.off("mousedown",this._eDivider,this.onResize);this._eElem.removeChild(this._eDivider);this._eDivider=null;}}}},set_peRegion:function set_peRegion(eVal){if(this._eElem&&this.peRegion!==eVal){this.peRegion=eVal;this.setOuterWidth(0);this.setOuterHeight(0);this.sizeChanged(true);this.set_pbResizable(this.pbResizable);}},onResize:function onResize(oEvent){var eMask,eGhost,iCurLeft,iStartLeft,iMin=0,iMax=0,iCurTop,iStartTop,iStartMouseY,iStartMouseX;if(!this.isEnabled()){return;}eGhost=df.dom.create('<div class="'+(this.peRegion===df.ciRegionLeft||this.peRegion===df.ciRegionRight?'WebPanel_DividerVertical_Ghost':'WebPanel_DividerHorizontal_Ghost')+'"></div>');eMask=eMask=df.gui.dragMask();if(this.peRegion===df.ciRegionTop||this.peRegion===df.ciRegionBottom){eMask.style.cursor="n-resize";if(this.peRegion===df.ciRegionTop){iCurTop=this._eElem.clientHeight;iMin=this.piMinHeight>2?this.piMinHeight:2;iMax=iCurTop+this._oParent._eMainArea.clientHeight;if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinHeight>0){iMax=iMax-this._oParent._oRegionCenter.piMinHeight;}}else{iCurTop=this._oParent._eMainArea.clientHeight;if(this._oParent._eRegionTop){iCurTop+=this._oParent._eRegionTop.clientHeight;iMin=this._oParent._eRegionTop.clientHeight;}if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinHeight>0){iMin+=this._oParent._oRegionCenter.piMinHeight;}iMax=iCurTop+this._eElem.clientHeight-(this.piMinHeight>0?this.piMinHeight:0)-10;}eGhost.style.top=iCurTop+"px";this._oParent._eMainArea.parentNode.appendChild(eGhost);}else{eMask.style.cursor="e-resize";if(this.peRegion===df.ciRegionLeft){iCurLeft=this._eElem.clientWidth;iMin=this.piMinWidth>2?this.piMinWidth:2;iMax=iCurLeft+this._oParent._eRegionCenter.clientWidth;if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinWidth>0){iMax=iMax-this._oParent._oRegionCenter.piMinWidth;}else{iMax=iMax-4;}}else{iCurLeft=this._oParent._eMainArea.clientWidth-this._eElem.clientWidth;if(this._oParent._eRegionLeft){iMin=this._oParent._eRegionLeft.clientWidth;}if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinWidth>0){iMin+=this._oParent._oRegionCenter.piMinWidth;}iMax=iCurLeft+this._eElem.clientWidth-(this.piMinWidth>0?this.piMinWidth:0)-10;}eGhost.style.left=iCurLeft+"px";this._oParent._eMainArea.appendChild(eGhost);}iStartLeft=iCurLeft;iStartTop=iCurTop;iStartMouseX=oEvent.getMouseX();iStartMouseY=oEvent.getMouseY();function onResize(oEvent){if(this.peRegion===df.ciRegionTop||this.peRegion===df.ciRegionBottom){iCurTop=iStartTop-(iStartMouseY-oEvent.getMouseY());iCurTop=iCurTop<iMax?iCurTop>iMin?iCurTop:iMin:iMax;eGhost.style.top=iCurTop+"px";}else{iCurLeft=iStartLeft-(iStartMouseX-oEvent.getMouseX());iCurLeft=iCurLeft<iMax?iCurLeft>iMin?iCurLeft:iMin:iMax;eGhost.style.left=iCurLeft+"px";}}function onStopResize(oEvent){df.dom.off("mouseup",eMask,onStopResize);df.dom.off("mouseup",window,onStopResize);df.dom.off("mousemove",eMask,onResize);eMask.parentNode.removeChild(eMask);if(eGhost){eGhost.parentNode.removeChild(eGhost);}if(this.peRegion===df.ciRegionTop){this.piHeight=iCurTop;this._eElem.style.height=this.piHeight+"px";}else if(this.peRegion===df.ciRegionBottom){this.piHeight=this._eElem.clientHeight+(iStartTop-iCurTop);this._eElem.style.height=this.piHeight+"px";}else if(this.peRegion===df.ciRegionLeft){this.piWidth=iCurLeft;this._eElem.style.width=this.piWidth+"px";}else if(this.peRegion===df.ciRegionRight){this.piWidth=this._eElem.clientWidth+(iStartLeft-iCurLeft);this._eElem.style.width=this.piWidth+"px";}this.sizeChanged();}df.dom.on("mousemove",eMask,onResize,this);df.dom.on("mouseup",window,onStopResize,this);df.dom.on("mouseup",eMask,onStopResize,this);oEvent.stop();}});df.WebApp=function WebApp(sOptWebService){df.WebApp.base.constructor.call(this,"oWebApp",null);this.psWebService=sOptWebService||"WebServiceDispatcher.wso";this.pbXHRWithCredentials=false;this.pbCheckVersion=true;this.prop(df.tString,"psTheme",typeof sDfPreloadTheme==="string"&&sDfPreloadTheme||"Df_Web_Creme");this.prop(df.tString,"psVersionID","");this.prop(df.tString,"psDecimalSeparator",",");this.prop(df.tString,"psThousandsSeparator",".");this.prop(df.tString,"psDateFormat","dd/mm/yyyy");this.prop(df.tString,"psDateSeparator","-");this.prop(df.tString,"psDateTimeFormat","dd/mm/yyyy hh:mm:ss");this.prop(df.tString,"psTimeFormat","hh:mm:ss");this.prop(df.tString,"psTimeSeparator",":");this.prop(df.tString,"psCurrencySymbol","$");this.prop(df.tInt,"peAlignView",df.ciAlignCenter);this.prop(df.tInt,"piScreenWidth",screen.width);this.prop(df.tInt,"piScreenHeight",screen.height);this.prop(df.tInt,"piWindowWidth",0);this.prop(df.tInt,"piWindowHeight",0);this.prop(df.tInt,"peMode",0);this.prop(df.tBool,"pbResponsive",true);this.prop(df.tBool,"pbIsMobile",true);this.prop(df.tString,"psLocationHash","");this.prop(df.tAdv,"pasBrowserLanguages",null);this.prop(df.tInt,"piBrowserTimezoneOffset",0);this.prop(df.tBool,"pbUpdateApplicationTitle",true);this.prop(df.tString,"psApplicationTitle","");this.event("OnOrientationChange",df.cCallModeWait);this.event("OnResizeWindow",df.cCallModeDefault);this.OnError=new df.events.JSHandler();this.OnShowProgress=new df.events.JSHandler();this.OnShowWindow=new df.events.JSHandler();this.OnHideWindow=new df.events.JSHandler();this.OnHideProgress=new df.events.JSHandler();this._oPreLoaded={};this._oModeControl=new df.MobRuleController(this);this._oMenuHub=null;this._aSyncPropCache=[];this._aAdvSyncPropCache=[];this._oCurrentWindow=null;this._oCurrentView=null;this._oCurrentObj=null;this._aViews=[];this._aFocussed=[];this._bReady=false;this._aLoadQueue=[];this._oLoadViewQueue={};this._aPreLoadViewActions=[];this._bInitStarted=false;this._bCallTimeout=false;this._oPendingCall=null;this._oSendingCall=null;this._eLocked=-1;this._aLockwaiters=[];this._eStyleSystem=null;this._eStyleTheme=null;this._eStyleApplication=null;this._sRootPath=df.psRootPath;this._oTranslations={};this._aModalQueue=[];this._tResizeTimer=null;this._bSizeChanged=false;this._bContainerStretch=false;this._aResponseAttachments=null;this._bWrapDiv=true;this._sControlClass="WebApp";this._bPanels=true;this._eViewPort=null;this.addSync("peMode");this.addSync("pbIsMobile");this.addSync("piScreenWidth");this.addSync("piScreenHeight");this.addSync("piWindowWidth");this.addSync("piWindowHeight");this.addSync("psLocationHash");this.addSync("pasBrowserLanguages");this.addSync("piBrowserTimezoneOffset");this.setActionMode("loadView",df.cCallModeWait);this.ready(this.attachGlobalHandlers);df.log("DataFlex Web Application Framework "+df.psVersionId);df.log("Copyright 2005-2022 Data Access Corporation. All rights reserved.");};df.defineClass("df.WebApp","df.WebBaseContainer",{create:function create(){df.WebApp.base.create.apply(this,arguments);this.set_pbResponsive(this.pbResponsive);},placePanels:function placePanels(){df.WebApp.base.placePanels.call(this);if(!this._eViewRegion){this._eViewRegion=df.dom.create('<div class="WebApp_ViewRegion" style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px"></div>');}this._eRegionCenter=this._eViewRegion;if(this._eRegionCenter.parentNode!=this._eMainArea||this._eRegionCenter.nextElementSibling!=this._eMainArea.lastChild){this._eMainArea.insertBefore(this._eRegionCenter,this._eMainArea.lastChild);}},attachGlobalHandlers:function attachGlobalHandlers(){df.dom.on("resize",window,this.onWindowResize,this);df.dom.on("scroll",window,this.onScroll,this);df.dom.on("orientationchange",window,this.onOrientationChange,this);df.dom.on("popstate",window,this.onPopState,this);df.dom.on("hashchange",window,this.onHashChange,this);this.piScreenHeight=screen.height;this.piScreenWidth=screen.width;},destroy:function destroy(){df.dom.off("resize",window,this.onWindowResize,this);df.dom.off("scroll",window,this.onScroll,this);df.dom.off("orientationchange",window,this.onOrientationChange,this);df.WebApp.base.destroy.call(this);if(this._oModeControl){this._oModeControl.destroy();this._oModeControl=null;}},addChild:function addChild(oChild){if(!(oChild instanceof df.WebView)){if(oChild.peRegion===df.ciRegionCenter){throw new df.Error(999,"The 'oWebApp' object should not have panels set to the center region, this space is reserved for the WebView.",this,[oChild.getLongName()]);}df.WebApp.base.addChild.call(this,oChild);}else{this._aViews.push(oChild);}},updateEnabled:function updateEnabled(){var i;df.WebApp.base.updateEnabled.call(this);for(i=0;i<this._aViews.length;i++){if(this._aViews[i]instanceof df.WebBaseUIObject){this._aViews[i].updateEnabled();}}},initialize:function initialize(bLoadDefault){this._bInitStarted=true;try{if(this.checkBrowser()){this.serverAction("LoadWebApp",[df.fromBool(!!bLoadDefault)],null,function(oEvent){this.updateCSS(false);df.dom.ready(function(){this.testCSS(function(){var i;this._bCallTimeout=true;try{if(this.pbCheckVersion){this.checkVersion();}this._bReady=true;for(i=0;i<this._aLoadQueue.length;i++){this._aLoadQueue[i].fHandler.call(this._aLoadQueue[i].oEnv||this);}}catch(oErr){this.handleError(oErr);}});},this);});}}catch(oErr){this.handleError(oErr);}},checkBrowser:function checkBrowser(){if(df.sys.isIE&&df.sys.iVersion<11){alert("Unfortunately the browser you are using is not supported by this framework. Please upgrade to a more modern browser.\n\r\n\rThe minimal version required is Internet Explorer 11. We advise to use the latest version of Microsoft Edge, Google Chrome or Mozilla FireFox.");return false;}return true;},checkVersion:function checkVersion(){var aPartsServer,aPartsClient,i;if(this.psVersionID!==df.psVersionId){aPartsServer=(this.psVersionID||"").split(".");aPartsClient=(df.psVersionId||"").split(".");if(aPartsServer.length===aPartsClient.length){for(i=0;i<aPartsServer.length;i++){if(parseInt(aPartsServer[i],10)<parseInt(aPartsClient[i],10)){this.handleError(new df.Error(999,"The server application ('{{1}}') is running an older version than the javascript-engine ('{{0}}'). Consider recompiling the server application.",this,[df.psVersionId,this.psVersionID]));return false;}if(parseInt(aPartsServer[i],10)>parseInt(aPartsClient[i],10)){this.handleError(new df.Error(999,"The server application ('{{1}}') is running a newer version than the javascript-engine ('{{0}}'). This might be a caching issue, consider clearing your browser cache.",this,[df.psVersionId,this.psVersionID]));return false;}}}else{throw new df.Error(999,"There is a version number mismatch between the javascript-engine ('{{0}}') and the server application ('{{1}}') version numbers.",this,[df.psVersionId,this.psVersionID]);}}return true;},ready:function ready(sView,fHandler,oOptEnv){if(typeof sView==="string"){this.ready(function(){if(this[sView]instanceof df.WebView){fHandler.call(oOptEnv||this);}else{if(!this._oLoadViewQueue[sView]){this._oLoadViewQueue[sView]={aWaiters:[],bLoading:false};}this._oLoadViewQueue[sView].aWaiters.push({fHandler:fHandler,oEnv:oOptEnv});}});}else{oOptEnv=fHandler;fHandler=sView;if(!this._bReady){this._aLoadQueue.push({fHandler:fHandler,oEnv:oOptEnv});}else{fHandler.call(oOptEnv||this);}}},displayApp:function displayApp(oRenderTo){if(!this._bInitStarted){this.initialize(true);}this.ready(function(){var eContent,eRenderTo;try{if(typeof oRenderTo==="string"){eRenderTo=df.dom.query(document.body,oRenderTo);}else{eRenderTo=oRenderTo;}if(!eRenderTo){throw new df.Error(999,"No proper element passed",this);}this._eViewPort=eRenderTo;this._bContainerStretch=!df.sys.gui.isSizedByContent(eRenderTo);eContent=this.render();this.afterRender();eContent.style.visibility="hidden";eRenderTo.appendChild(eContent);this.afterShow();this.forceResize();eContent.style.visibility="";}catch(oErr){this.handleError(oErr);}});},displayView:function displayView(sView,oRenderTo){if(!this._bInitStarted){this.initialize(false);}this.ready(function(){var eRenderTo;try{if(typeof oRenderTo==="string"){eRenderTo=df.dom.query(document.body,oRenderTo);}else{eRenderTo=oRenderTo;}if(!eRenderTo){throw new df.Error(999,"No proper element passed",this);}this._eViewPort=eRenderTo;this.serverActionEx({sMethod:"ShowView_FromClient",aParams:[sView,df.fromBool(true)],aViews:[sView],fHandler:function fHandler(oEv){var oView;oView=this[sView];if(oView&&oView instanceof df.WebView){oView._show(eRenderTo);}},oHandlerEnv:this});}catch(oErr){this.handleError(oErr);}});},renderView:function renderView(sView){this.ready(function(){var oView=this[sView];if(!oView){throw new df.Error(999,"Cannot render view '{{0}}' as it is not initialized.",this,[sView]);}if(!oView._bRendered){if(oView instanceof df.WebWindow){if(oView instanceof df.WebModalDialog){oView.psInvokingView=this._oCurrentWindow&&this._oCurrentWindow._sName||"";if(oView.psInvokingView){oView.addSync("psInvokingView");}this.queueModal(function(){oView._show(this._eRegionCenter);this.forceResize();},this);}else{this.hideView(this._oCurrentView,oView===this._oCurrentView);oView._show(this._eRegionCenter);this.forceResize();this._oCurrentView=oView;}this._oCurrentWindow=oView;}}});},showView:function showView(sView,sOptCallbackMsg,sOptCallbackObj){var aParams=[sView,df.fromBool(false)];if(sOptCallbackMsg){aParams.push(sOptCallbackMsg);aParams.push(sOptCallbackObj);}this.serverActionEx({sMethod:"ShowView_FromClient",aParams:aParams,aViews:[sView]});},hideView:function hideView(sView,bOptNoServerEvents){var oView,oInvoking;oView=typeof sView==="string"?this[sView]:sView;if(oView instanceof df.WebView){oInvoking=oView.getInvoking();oView._hide(df.toBool(bOptNoServerEvents));if(this._oCurrentWindow===oView){this._oCurrentWindow=null;}if(this._oCurrentView===oView){this._oCurrentView=null;}if(oView instanceof df.WebModalDialog){if(oInvoking){this._oCurrentWindow=oInvoking;}}}},loadView:function loadView(sName,bPreLoaded,sOptInvoker,fHandler,oEnv){if(bPreLoaded){this._oPreLoaded[sName]=[];}this.ready(function(){if(this[sName]&&this[sName]instanceof df.WebView){if(fHandler){fHandler.call(oEnv||this,this[sName]);}}else{if(!this._oLoadViewQueue[sName]){this._oLoadViewQueue[sName]={aWaiters:[],bLoading:false};}if(this._oLoadViewQueue[sName].bLoading){return;}this._oLoadViewQueue[sName].bLoading=true;if(fHandler){this._oLoadViewQueue[sName].aWaiters.push({fHandler:fHandler,oEnv:oEnv});}var oAction=new df.ServerAction();oAction.oWO=this;oAction.sAction="loadView";oAction.aParams=[sName,sOptInvoker||"",df.fromBool(bPreLoaded)];oAction.eCallMode=df.cCallModeWait;oAction.fHandler=function(oEvent){var tAct,aWaiters,i,oView=this[sName];if(df.toBool(oEvent.sReturnValue)){try{if(oView instanceof df.WebView){if(bPreLoaded&&this._oPreLoaded[sName]){while(tAct=this._oPreLoaded[sName].shift()){this.execClientAction(tAct);}delete this._oPreLoaded[sName];}aWaiters=this._oLoadViewQueue[sName].aWaiters;for(i=0;i<aWaiters.length;i++){aWaiters[i].fHandler.call(aWaiters[i].oEnv||this,oView);}this._oLoadViewQueue[sName]=null;}else{this._oLoadViewQueue[sName].bLoading=false;throw new df.Error(999,"No view definition received for '{{0}}'",this,[sName]);}}catch(oErr){this.handleError(oErr);}}};oAction.oHandlerEnv=this;oAction.aViews.push(sOptInvoker||null);oAction.aViews.push(sName);this.handleAction(oAction);}},this);},unloadView:function unloadView(sView,bDefinition){var oView,i;bDefinition=df.toBool(bDefinition);if(this[sView]&&this[sView]instanceof df.WebView){oView=this[sView];if(oView._bRendered){this.hideView(sView,true);}if(this._oCurrentObj&&this._oCurrentObj.getView()===oView){this._oCurrentObj=null;}oView.destroy();i=this._aChildren.indexOf(oView);if(i>=0){this._aChildren.splice(i,1);}}if(bDefinition&&this._oWODefStore[sView]){delete this._oWODefStore[sView];}},objFocus:function objFocus(oObj){var oWin=oObj.getView();if(oWin&&!oWin._bStandalone&&oWin._bRendered){this._oCurrentWindow=oWin;}if(!oWin||oWin._bRendered){this._oCurrentObj=oObj;}},objBlur:function objBlur(oObj){},returnFocus:function returnFocus(){if(this._oCurrentObj){this._oCurrentObj.conditionalFocus();}},getFocusObjName:function getFocusObjName(){if(this._oCurrentObj instanceof df.WebBaseUIObject&&!this._oCurrentObj._bStandalone){return this._oCurrentObj.getLongName();}return"";},set_pbMDI:function set_pbMDI(bVal){if(this._eRegionCenter){this._eRegionCenter.style.position=bVal?"relative":"";}},notifyScroll:function notifyScroll(oWO){this.notifyPosChange(oWO);},notifyLayoutChange:function notifyLayoutChange(oWO){this.notifyPosChange(oWO);},notifyPosChange:function notifyPosChange(oWO){},initJSON:function initJSON(tDef){function initObj(tDef,oContext){var i,sP,oObj,FConstructor;if(tDef.sType==="df.WebApp"){oObj=this;}else{if(!oContext[tDef.sName]){FConstructor=this.getConstructor(tDef.sType,tDef);if(typeof FConstructor==="function"){oContext[tDef.sName]=oObj=new FConstructor(tDef.sName,oContext);}else{throw new df.Error(999,"Could not find class '{{0}}'",this,[tDef.sType]);}}else{throw new df.Error(999,"Naming conflict with child object '{{0}}'",this,[tDef.sName]);}}for(i=0;i<tDef.aProps.length;i++){sP=tDef.aProps[i].sN;if(sP.charAt(0)!=="_"){if(!oObj[sP]||_typeof(oObj[sP])!=="object"&&typeof oObj[sP]!=="function"){oObj._set(sP,tDef.aProps[i].sV,false,false);}else{throw new df.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[sP,tDef.sName]);}}else{throw new df.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[tDef.aProps[i].sV,tDef.sName]);}}if(tDef.aAdvP){for(i=0;i<tDef.aAdvP.length;i++){sP=tDef.aAdvP[i].sN;if(sP.charAt(0)!=="_"){if(!oObj[sP]||_typeof(oObj[sP])!=="object"&&typeof oObj[sP]!=="function"){if(!oObj._oTypes[sP]){oObj._oTypes[sP]=df.tAdv;}oObj._set(sP,tDef.aAdvP[i].tV,false,false);}else{throw new df.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[sP,tDef.sName]);}}else{throw new df.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[tDef.aAdvP[i].sV,tDef.sName]);}}}this.newWebObject(oObj,oContext,tDef);for(i=0;i<tDef.aObjs.length;i++){initObj.call(this,tDef.aObjs[i],oObj);}oObj.create(tDef);return oObj;}return initObj.call(this,tDef,this);},newWebObject:function newWebObject(oObj,oParent,tDef){if(oParent.addChild&&oParent!==oObj){oParent.addChild(oObj);}},getConstructor:function getConstructor(sType){return df.sys.ref.getNestedProp(sType);},findObj:function findObj(sName){var i,aParts,oObj;if(sName===""){return this;}aParts=sName.split(/[\. | \$]/);oObj=this;for(i=0;i<aParts.length&&oObj;i++){oObj=oObj[aParts[i]];}return _typeof(oObj)==="object"&&oObj||null;},waitForCall:function waitForCall(fFunc,oEnv){var i;if(this._eLocked>=df.cCallModeDefault){for(i=0;i<this._aLockwaiters.length;i++){if(this._aLockwaiters[i].fFunc===fFunc&&this._aLockwaiters[i].oEnv===oEnv){return;}}this._aLockwaiters.push({fFunc:fFunc,oEnv:oEnv});}else{fFunc.call(oEnv);}},lock:function lock(eCallMode,sWaitMessage){var oDialog,oLabel,that=this;this._eLocked=eCallMode;if(document&&document.body){if(eCallMode>=df.cCallModeWait){if(!this._eLockMask){this._eLockMask=df.gui.dragMask();this._tLockCursor=setTimeout(function(){if(that._eLockMask){that._eLockMask.style.cursor="wait";}that._tLockCursor=null;},140);}df.events.addDomCaptureListener("keydown",document.body,this.onBlockKey,this);}if(eCallMode>=df.cCallModeProgress&&!this._bLockWait){this._bLockWait=true;if(this.OnShowProgress.fire(this,{sMessage:sWaitMessage})){this._aModalQueue.push(this._oLockModalBlock={fFunc:null,bFinished:false,bDisplayed:true});this._oLockDialog=oDialog=new df.WebModalDialog(null,this);oDialog.psCaption="";oDialog.pbResizable=false;oDialog.pbShowClose=false;oDialog.psCSSClass="WebMsgBox WebMsgBoxProgress";oLabel=new df.WebLabel(null,oDialog);oLabel.psCaption=sWaitMessage||this.getTrans("loading")+"..";oLabel.psCSSClass="WebMsgBoxProgress";oDialog.addChild(oLabel);oDialog.show();oDialog._oPrevFocus=null;}}}},unlock:function unlock(){var oHandler;this._eLocked=-1;if(this._eLockMask){this._eLockMask.style.cursor="";this._eLockMask.parentNode.removeChild(this._eLockMask);this._eLockMask=null;if(this._tLockCursor){clearTimeout(this._tLockCursor);this._tLockCursor=null;}}if(document&&document.body){df.events.removeDomCaptureListener("keydown",document.body,this.onBlockKey);}if(this._bLockWait){this._bLockWait=false;this.OnHideProgress.fire(this,{});if(this._oLockDialog){this._oLockDialog.hide();this._oLockDialog=null;this._oLockModalBlock.bFinished=true;this.processModal();}}while(oHandler=this._aLockwaiters.pop()){oHandler.fFunc.call(oHandler.oEnv);}},onBlockKey:function onBlockKey(oEvent){if(this._eLocked>=df.cCallModeWait){oEvent.stop();return false;}},handleAction:function handleAction(oAction){this.lock(oAction.eCallMode,oAction.sProcessMessage);oAction.aViews.push(this._oCurrentWindow);if(this._oPendingCall){this._oPendingCall.aActions.push(oAction);if(this._oPendingCall.eCallMode<oAction.eCallMode){this._oPendingCall.eCallMode=oAction.eCallMode;}}else{this._oPendingCall=new df.ServerCall();this._oPendingCall.aActions.push(oAction);this._oPendingCall.sFocus=this.getFocusObjName();this._oPendingCall.eCallMode=oAction.eCallMode;}this.processCall();},cancelAction:function cancelAction(oWO,sAction){var aActions,i;if(this._oPendingCall){aActions=this._oPendingCall.aActions;for(i=0;i<aActions.length;i++){if(aActions[i].oWO===oWO&&aActions[i].sAction===sAction){aActions.splice(i,1);i--;}if(aActions.length===0){this._oPendingCall=null;break;}}}},hasPendingAction:function hasPendingAction(oWO,sAction){var aActions,i;if(this._oPendingCall){aActions=this._oPendingCall.aActions;for(i=0;i<aActions.length;i++){if(aActions[i].oWO===oWO&&aActions[i].sAction===sAction){return true;}}}return false;},processCall:function processCall(){var that=this;function process(){try{if(that._oPendingCall){if(!that._oSendingCall){that.sendCall(that._oPendingCall);that._oPendingCall=null;}}}catch(oErr){that.unlock();that._oPendingCall=null;that._oSendingCall=null;that.handleError(oErr);}}if(this._bCallTimeout){setTimeout(process,10);}else{process();}},sendCall:function sendCall(oCall){var aViews,aActions,aAttachments,oAction,oData,i,oRequest;this._oSendingCall=oCall;aViews=[];aActions=[];aAttachments=[];for(i=0;i<oCall.aActions.length;i++){oAction=oCall.aActions[i];aActions.push({sTarget:oAction.oWO.getLongName(),sAction:oAction.sAction,aParams:oAction.aParams,iAttached:oAction.tData&&aAttachments.push(oAction.tData)||0});aViews=aViews.concat(oAction.aViews);}oData={v:df.psVersionId,r:{Header:this.getHeader(aViews,oCall.sFocus),aActions:aActions},a:aAttachments};function handleCall(oEvent,bSuccess){var tData,tResponse;try{if(bSuccess){tData=oEvent.oSource.getResponseValue();if(tData&&tData.r&&tData.a&&tData.r.Header&&tData.r.asReturnValues){tResponse=tData.r;this._aResponseAttachments=tData.a;this.handleHeader(tResponse.Header);if(oCall.aActions.length===tResponse.asReturnValues.length){for(i=0;i<oCall.aActions.length;i++){oEvent.sReturnValue=tResponse.asReturnValues[i];if(oCall.aActions[i].fHandler){oCall.aActions[i].fHandler.call(oCall.aActions[i].oHandlerEnv||null,oEvent);}}}this._aResponseAttachments=null;}else{throw new df.Error(5123,"Unexpected response format.",this);}if(this._bSizeChanged){this.resize();}}}catch(oErr){this.handleError(oErr);}finally{if(!this._oPendingCall){this.unlock();}this._oSendingCall=null;this.processCall();}}oRequest=new df.ajax.JSONCall("CallAction",oData,this.psWebService,this);oRequest.pbWithCredentials=this.pbXHRWithCredentials;oRequest.onFinished.addListener(function(oEvent){oEvent.bError=false;handleCall.call(this,oEvent,true);},this);oRequest.onError.addListener(function(oEvent){oEvent.bError=true;handleCall.call(this,oEvent,false);},this);oRequest.send(true);},getHeader:function getHeader(oView,sFocus){var oDone={},tHead,i;tHead={sFocus:sFocus,aDDOViews:[],aSyncProps:[],aAdvSyncP:[]};this.getSynced(tHead.aSyncProps,tHead.aAdvSyncP);function addView(oView){var oViewObj,oInvoking,sViewName;if(typeof oView==="string"){oViewObj=this.findObj(oView);sViewName=oView;}else{oViewObj=oView;sViewName=oViewObj._sName;}if(!oDone[sViewName]){oDone[sViewName]=true;if(oViewObj instanceof df.WebView){oInvoking=oViewObj.getInvoking();if(oInvoking){addView.call(this,oInvoking);}oViewObj.getSynced(tHead.aSyncProps,tHead.aAdvSyncP);tHead.aDDOViews.push(sViewName);}else{this.getCachedSyncProps(oView,tHead.aSyncProps,tHead.aAdvSyncP);tHead.aDDOViews.push(sViewName);}}}if(oView instanceof Array){for(i=0;i<oView.length;i++){if(oView[i]){addView.call(this,oView[i]);}}}else if(oView){addView.call(this,oView);}return tHead;},handleHeader:function handleHeader(oHeader){var i;for(i=0;i<oHeader.aActions.length;i++){if(oHeader.aActions[i].eType===df.ctExecEarly){this.execClientAction(oHeader.aActions[i]);}}for(i=0;i<oHeader.aObjectDefs.length;i++){this.initJSON(oHeader.aObjectDefs[i]);}this.handleSyncProps(oHeader.aSyncProps);this.handleAdvSyncProps(oHeader.aAdvSyncP);for(i=0;i<oHeader.aActions.length;i++){if(oHeader.aActions[i].eType!==df.ctExecEarly){this.execClientAction(oHeader.aActions[i]);}}},handleSyncProps:function handleSyncProps(aProps){var i,oWO,tObj,x;for(i=0;i<aProps.length;i++){tObj=aProps[i];oWO=this.findObj(tObj.sO);if(oWO){for(x=0;x<tObj.aP.length;x++){oWO._set(tObj.aP[x].sN,tObj.aP[x].sV,true,true);}}else{this.cacheSyncProps(tObj);}}},handleAdvSyncProps:function handleAdvSyncProps(aAdvSyncP){var i,tP,oWO;for(i=0;i<aAdvSyncP.length;i++){tP=aAdvSyncP[i];oWO=this.findObj(tP.sO);if(oWO){oWO._set(tP.sP,tP.tV,true,true);}else{this.cacheAdvProp(tP);}}},execClientAction:function execClientAction(tAct){var oFunc,oWO=this.findObj(tAct.sTarget),sViewName;if(oWO){oFunc=oWO.findFunc(tAct.sName);if(typeof oFunc.fFunc==="function"){if(tAct.iAttached>0){if(tAct._tActionData){oWO._tActionData=tAct._tActionData;}else{oWO._tActionData=this.responseAttachment(tAct.iAttached);}}try{oFunc.fFunc.apply(oFunc.oEnv,tAct.aParams);}catch(oErr){this.handleError(oErr);}oWO._tActionData=null;}else{this.handleError(new df.Error(999,"Action method not found '{{0}}' on object '{{1}}'",this,[tAct.sName,tAct.sTarget]));}}else{sViewName=tAct.sTarget;if(sViewName.indexOf('.')>0){sViewName=sViewName.substr(0,sViewName.indexOf('.'));}if(this._oPreLoaded[sViewName]){if(tAct.iAttached){tAct._tActionData=this.responseAttachment(tAct.iAttached);}this._oPreLoaded[sViewName].push(tAct);}else{this.handleError(new df.Error(999,"Could not find object '{{0}}'",this,[tAct.sTarget]));}}},responseAttachment:function responseAttachment(iIndex){if(this._aResponseAttachments&&this._aResponseAttachments.length>iIndex-1){return this._aResponseAttachments[iIndex-1];}throw new df.Error(999,"Invalid response attachment index.",this);},cacheSyncProps:function cacheSyncProps(tObj){var i,x,y,tCacheObj,bFound;for(i=0;i<this._aSyncPropCache.length;i++){if(this._aSyncPropCache[i].sO===tObj.sO){tCacheObj=this._aSyncPropCache[i];for(x=0;x<tObj.aP.length;x++){bFound=false;for(y=0;y<tCacheObj.aP.length&&!bFound;y++){if(tCacheObj.aP[y].sN===tObj.aP[x].sN){tCacheObj.aP[y].sV=tObj.aP[x].sV;bFound=true;}}if(!bFound){tCacheObj.aP.push(tObj.aP[x]);}}return;}}this._aSyncPropCache.push(tObj);},cacheAdvProp:function cacheAdvProp(tP){var i;for(i=0;i<this._aAdvSyncPropCache.length;i++){if(this._aAdvSyncPropCache[i].sO===tP.sO&&this._aAdvSyncPropCache[i].sP===tP.sP){this._aAdvSyncPropCache[i].tV=tP.tV;return;}}this._aAdvSyncPropCache.push(tP);},getCachedSyncProps:function getCachedSyncProps(sView,aSyncProps,aAdvSyncP){var i,sStart,iLen;sStart=sView+'.';iLen=sStart.length;for(i=0;i<this._aSyncPropCache.length;i++){if(this._aSyncPropCache[i].sO===sView||this._aSyncPropCache[i].sO.substr(0,iLen)===sStart){aSyncProps.push(this._aSyncPropCache[i]);this._aSyncPropCache.splice(i,1);i--;}}for(i=0;i<this._aAdvSyncPropCache.length;i++){if(this._aAdvSyncPropCache[i].sO===sView||this._aAdvSyncPropCache[i].sO.substr(0,iLen)===sStart){aAdvSyncP.push(this._aAdvSyncPropCache[i]);this._aAdvSyncPropCache.splice(i,1);i--;}}},position:function position(){},set_psTheme:function set_psTheme(sVal){if(this.psTheme!==sVal){if(document.body){df.dom.removeClass(document.body,this.psTheme);}this.psTheme=sVal;this.updateCSS(true);}},set_pbResponsive:function set_pbResponsive(bVal){if(this._oModeControl){if(bVal){this._oModeControl.activate();}else{this._oModeControl.deactivate();}}},set_peAlignView:function set_peAlignView(iVal){this.peAlignView=iVal;this.sizeChanged();},updateCSS:function updateCSS(bResize){var aStyles,i,eHead,that=this,sV,sTheme=this.psTheme.trim();if(!this._eStyleSystem||!this._eStyleTheme||!this._eStyleApplication){sV="?v="+df.psVersionId;if(typeof sDfBuildNr==="string"&&sDfBuildNr){sV+="."+sDfBuildNr;}aStyles=df.dom.query(document,"link",true);for(i=0;i<aStyles.length;i++){if(aStyles[i].href.indexOf("DfEngine/system.css")>0){this._eStyleSystem=aStyles[i];}if(aStyles[i].href.indexOf("CssThemes/")>0&&aStyles[i].href.indexOf("theme.css")>0){this._eStyleTheme=aStyles[i];}if(aStyles[i].href.indexOf("CssStyle/application.css")>0){this._eStyleApplication=aStyles[i];}}if(!this._eStyleSystem){this._eStyleSystem=df.dom.createCSSElem(this._sRootPath+"DfEngine/system.css"+sV);eHead=document.head||document.getElementsByTagName("head")[0];if(eHead.firstChild){eHead.insertBefore(this._eStyleSystem,eHead.firstChild);}else{eHead.appendChild(this._eStyleSystem);}}if(!this._eStyleTheme){this._eStyleTheme=df.dom.createCSSElem(this._sRootPath+"CssThemes/"+sTheme+"/theme.css"+sV);df.dom.insertAfter(this._eStyleTheme,this._eStyleSystem);}if(!this._eStyleApplication){this._eStyleApplication=df.dom.createCSSElem(this._sRootPath+"CssStyle/application.css"+sV);df.dom.insertAfter(this._eStyleApplication,this._eStyleTheme);}if(document.body){document.body.id="OWEBAPP";}}if(document.body){df.dom.addClass(document.body,this.psTheme);}if(this._eStyleTheme.href.indexOf(this._sRootPath+"CssThemes/"+sTheme+"/theme.css")<0){this._eStyleTheme.href=this._sRootPath+"CssThemes/"+sTheme+"/theme.css";}if(bResize){this.testCSS(function(){this.resize();setTimeout(function(){try{that.resize();}catch(oErr){that.handleError(oErr);}},200);});}},testCSS:function testCSS(fHandler){var eTest,that=this,iCount=0;eTest=df.dom.create('<div id="df_load_test" style="position: absolute"></div>');document.body.appendChild(eTest);function check(){if(eTest&&eTest.clientHeight>=1||iCount>100){document.body.removeChild(eTest);fHandler.call(that);}else{setTimeout(check,20);iCount++;}}check();},onWindowResize:function onWindowResize(oEvent){var that=this;if(this._tResizeTimeout){clearTimeout(this._tResizeTimeout);this._tResizeTimeout=null;}this._tResizeTimeout=setTimeout(function(){try{that._tResizeTimeout=null;that.resize();that.windowResize();}catch(oErr){that.handleError(oErr);}},50);if(this.piScreenHeight===screen.width&&this.piScreenWidth===screen.height){if(df.sys.isIE){this.onOrientationChange(oEvent);}}},windowResize:function windowResize(){var i;this.fire("OnResizeWindow",[this.get_piWindowWidth(),this.get_piWindowHeight()]);for(i=0;i<this._aViews.length;i++){this._aViews[i].windowResize(this.get_piWindowWidth(),this.get_piWindowHeight());}},onScroll:function onScroll(oEvent){this.notifyScroll(this);},prepareSize:function prepareSize(){var iRes=df.WebApp.base.prepareSize.call(this);this._bStretch=this._bContainerStretch;return iRes;},resize:function resize(){var iMxVwH,i,oView;this.resizeHorizontal();this.resizeVertical();if(this._eElem){iMxVwH=this._iMiddleHeight-df.sys.gui.getVertBoxDiff(this._eRegionCenter,0);}for(i=0;i<this._aViews.length;i++){oView=this._aViews[i];if(!this._eElem&&oView._eRenderTo){iMxVwH=df.dom.clientHeight(oView._eRenderTo)-df.sys.gui.getVertBoxDiff(oView._eRenderTo,2);}if(oView._bRendered){oView.viewResize(iMxVwH);}}this.notifyPosChange(this);this._bSizeChanged=false;},objSizeChanged:function objSizeChanged(oSrcWO){var that=this;this._bSizeChanged=true;if(!this._tResizeTimer){that._tResizeTimer=setTimeout(function(){try{that.resize();that._tResizeTimer=null;}catch(oErr){that.handleError(oErr);}},30);}},forceResize:function forceResize(){var that=this;this.sizeChanged(true);setTimeout(function(){that.sizeChanged(true);},60);},onOrientationChange:function onOrientationChange(oEvent){var iOrientation;this.piScreenHeight=screen.height;this.piScreenWidth=screen.width;if(typeof window.orientation==="number"){iOrientation=window.orientation;}else{iOrientation=screen.height>screen.width?90:0;}this.fire("OnOrientationChange",[iOrientation]);},showInfoBox:function showInfoBox(sMessage,sCaption){function showInfo(tDetails){var that=this,oDialog,oLabel,oCloseBtn,oContentPnl,oButtonPnl,iWindowWidth=this.get_piWindowWidth();oDialog=new df.WebModalDialog(null,this);oDialog.psCaption=sCaption;oDialog.piMinWidth=iWindowWidth>420?400:iWindowWidth-20;oDialog.piMinHeight=80;oDialog.psCSSClass="WebMsgBox WebMsgBoxInfo";var iViewArrayPos=this._aViews.length;that._aViews.push(oDialog);oDialog.OnSubmit.addListener(function(oEvent){oDialog.hide();},this);oDialog.OnHide.addListener(function(oEvent){tDetails.bFinished=true;setTimeout(function(){try{that.processModal();oDialog.destroy();that._aViews.splice(iViewArrayPos,1);}catch(oErr){that.handleError(oErr);}},20);},this);oContentPnl=new df.WebPanel(null,oDialog);oContentPnl.peRegion=df.ciRegionCenter;oDialog.addChild(oContentPnl);oLabel=new df.WebLabel(null,oDialog);oLabel.psCaption=sMessage;oLabel.psCSSClass="WebMsgBox_Text";oContentPnl.addChild(oLabel);oButtonPnl=new df.WebPanel(null,oDialog);oButtonPnl.peRegion=df.ciRegionBottom;oButtonPnl.piColumnCount=3;oButtonPnl.psCSSClass="WebMsgBoxOneBtn";oDialog.addChild(oButtonPnl);oCloseBtn=new df.WebButton(null,oDialog);oCloseBtn.psCaption=this.getTrans("ok");oCloseBtn.piColumnIndex=2;oCloseBtn.pbShowLabel=false;oCloseBtn.OnClick.addListener(function(oEvent){oDialog.hide();},this);oButtonPnl.addChild(oCloseBtn);oDialog.show();this.ready(function(){oDialog.resize();oCloseBtn.focus();});}this._aModalQueue.push({fFunc:showInfo,bFinished:false,bDisplayed:false});this.processModal();},showMessageBox:function showMessageBox(sReturnObj,sReturnMsg,sMessage,sCaption,sLabelCSSClass,iDefaultButton){var oReturnObj,aButtons;oReturnObj=this.findObj(sReturnObj);if(!oReturnObj){throw new df.Error(999,"Return WebObject not found '{{0}}'",this,[sReturnObj]);}aButtons=this._tActionData;if(!aButtons){throw new df.Error(999,"No buttons specified",this);}this.showMsgBox(sMessage,sCaption,sLabelCSSClass,aButtons,iDefaultButton,function(iBtn,oDialog){if(oReturnObj.getActionMode(sReturnMsg)<df.cCallModeWait){oReturnObj.setActionMode(sReturnMsg,df.cCallModeWait);}oReturnObj.serverAction(sReturnMsg,[iBtn],null,function(){oDialog.hide();});});},showMsgBox:function showMsgBox(sMessage,sCaption,sLabelCSSClass,aButtons,iDefaultButton,fHandler){function showInfo(tDetails){var that=this,oDialog,oLabel,oBtn,oContentPnl,oButtonPnl,i,oDefaultBtn=null,iWindowWidth=this.get_piWindowWidth();oDialog=new df.WebModalDialog(null,this);oDialog.psCaption=sCaption;oDialog.piMinWidth=iWindowWidth>500?480:iWindowWidth-20;oDialog.piMinHeight=100;oDialog.pbShowClose=false;oDialog.psCSSClass="WebMsgBox "+sLabelCSSClass;var iViewArrayPos=this._aViews.length;that._aViews.push(oDialog);oDialog.OnHide.addListener(function(oEvent){tDetails.bFinished=true;setTimeout(function(){try{that.processModal();oDialog.destroy();that._aViews.splice(iViewArrayPos,1);}catch(oErr){that.handleError(oErr);}},20);},this);oContentPnl=new df.WebPanel(null,oDialog);oContentPnl.peRegion=df.ciRegionCenter;oDialog.addChild(oContentPnl);oLabel=new df.WebLabel(null,oDialog);oLabel.psCaption=sMessage;oLabel.psCSSClass="WebMsgBox_Text";oContentPnl.addChild(oLabel);oButtonPnl=new df.WebPanel(null,oDialog);oButtonPnl.peRegion=df.ciRegionBottom;oButtonPnl.piColumnCount=aButtons.length*2+2;if(df.sys.isMobile){if(aButtons.length===2){oButtonPnl.piColumnCount=aButtons.length*2;}else if(aButtons.length>2){oButtonPnl.piColumnCount=1;}}if(aButtons.length===1){oButtonPnl.psCSSClass="WebMsgBoxOneBtn";}else if(aButtons.length===2){oButtonPnl.psCSSClass="WebMsgBoxTwoButtons";}else{oButtonPnl.psCSSClass="WebMsgBoxButtons";}oDialog.addChild(oButtonPnl);function handleBtnClick(oEvent){fHandler.call(this,oEvent.oSource._iConfirmId,oDialog);}iDefaultButton=parseInt(iDefaultButton,10);for(i=0;i<aButtons.length;i++){oBtn=new df.WebButton(null,oDialog);oBtn.psCaption=aButtons[i];oBtn.piColumnIndex=i*2+1;oBtn.piColumnSpan=2;oBtn.pbShowLabel=false;oBtn._iConfirmId=i+1;oBtn.OnClick.addListener(handleBtnClick);if(df.sys.isMobile){if(aButtons.length===2){oBtn.piColumnIndex=i*2;}else if(aButtons.length>2){oBtn.piColumnIndex=0;oBtn.piColumnSpan=0;}}else{if(i===0){oBtn.psCSSClass="WebMsgBoxFirstBtn";}else if(i===aButtons.length-1){oBtn.psCSSClass="WebMsgBoxLastBtn";}}oButtonPnl.addChild(oBtn);if(oBtn._iConfirmId===iDefaultButton){oDefaultBtn=oBtn;}}oDialog.show();this.ready(function(){oDialog.resize();if(oDefaultBtn){oDefaultBtn.focus();}});}this._aModalQueue.push({fFunc:showInfo,bFinished:false,bDisplayed:false});this.processModal();},showYesNo:function showYesNo(sMessage,fHandler,oOptEnv){this.showMsgBox(sMessage,this.getTrans("confirm"),"WebMsgBoxConfirm",[this.getTrans("yes"),this.getTrans("no")],0,function(iBtn,oDialog){try{if(fHandler){fHandler.call(oOptEnv||this,iBtn===1);}}catch(oErr){this.handleError(oErr);}oDialog.hide();});},processModal:function processModal(){if(this._aModalQueue.length>0){while(this._aModalQueue[0]&&this._aModalQueue[0].bFinished){this._aModalQueue.shift();}if(this._aModalQueue.length>0&&!this._aModalQueue[0].bDisplayed){this._aModalQueue[0].bDisplayed=true;this._aModalQueue[0].fFunc.call(this,this._aModalQueue[0]);}}},queueModal:function queueModal(_fFunc,oEnv){this._aModalQueue.push({fFunc:function fFunc(tDetails){_fFunc.call(oEnv||null);tDetails.bFinished=true;this.processModal();},bFinished:false,bDisplayed:false});this.processModal();},log:function log(sText){df.log(sText);},getTrans:function getTrans(sLbl,bOptNull){if(this._oTranslations[sLbl]){return this._oTranslations[sLbl];}if(bOptNull){return null;}return"{{"+sLbl+"}}";},getLongName:function getLongName(){return"";},getLongNamePrnt:function getLongNamePrnt(){return"";},initTranslations:function initTranslations(){this.initTrans(this._tActionData);},initTrans:function initTrans(aTrans){var i;for(i=0;i<aTrans.length;i++){this._oTranslations[aTrans[i].sN]=aTrans[i].sV;}df.lang={monthsLong:[this.getTrans("january"),this.getTrans("february"),this.getTrans("march"),this.getTrans("april"),this.getTrans("may"),this.getTrans("june"),this.getTrans("july"),this.getTrans("august"),this.getTrans("september"),this.getTrans("october"),this.getTrans("november"),this.getTrans("december")],monthsShort:[this.getTrans("jan"),this.getTrans("feb"),this.getTrans("mar"),this.getTrans("apr"),this.getTrans("mayShort"),this.getTrans("jun"),this.getTrans("jul"),this.getTrans("aug"),this.getTrans("sep"),this.getTrans("oct"),this.getTrans("nov"),this.getTrans("dec")],daysShort:[this.getTrans("sun"),this.getTrans("mon"),this.getTrans("tue"),this.getTrans("wed"),this.getTrans("thu"),this.getTrans("fri"),this.getTrans("sat")],daysLong:[this.getTrans("sunday"),this.getTrans("monday"),this.getTrans("tuesday"),this.getTrans("wednesday"),this.getTrans("thursday"),this.getTrans("friday"),this.getTrans("saturday")]};},showError:function showError(iErrNum,iErrLine,sErrText,sCaption,bUserError){this.handleError(new df.Error(df.toInt(iErrNum),sErrText,this,null,null,true,df.toBool(bUserError),sCaption,null,df.toInt(iErrLine)));},handleError:function handleError(oError){function displayError(tDetails){var that=this,oLabel,oDialog,oCloseBtn,oContentPnl,oButtonPnl,aDetails=[],oDetailsBox,sCaption,iWindowWidth=this.get_piWindowWidth();if(!oError.bServer){sCaption=oError.sCaption||this.getTrans("error_title_client",true)||"Unhandled Program Error on the client";}else{sCaption=oError.sCaption||this.getTrans("error_title_server");}oDialog=new df.WebModalDialog(null,this);oDialog.psCaption=sCaption;oDialog.piMinWidth=iWindowWidth>520?500:iWindowWidth-20;oDialog.piMinHeight=oError.bUserError?80:180;oDialog.psCSSClass=oError.bUserError?"WebMsgBox WebMsgBoxWarning":"WebMsgBox WebMsgBoxError";var iViewArrayPos=this._aViews.length;that._aViews.push(oDialog);oDialog.OnSubmit.addListener(function(oEvent){try{oDialog.hide();}catch(oErr){that.handleError(oErr);}},this);oDialog.OnHide.addListener(function(oEvent){tDetails.bFinished=true;setTimeout(function(){try{that.processModal();oDialog.destroy();that._aViews.splice(iViewArrayPos,1);}catch(oErr){that.handleError(oErr);}},20);},this);oContentPnl=new df.WebPanel(null,oDialog);oContentPnl.peRegion=df.ciRegionCenter;oDialog.addChild(oContentPnl);oLabel=new df.WebLabel(null,oContentPnl);oLabel.psCaption=oError.sText;oLabel.psCSSClass="WebMsgBox_Text";oContentPnl.addChild(oLabel);if(!oError.bUserError){oLabel=new df.WebLabel(null,oContentPnl);aDetails.push('Error: ',oError.iNumber);if(oError.bServer){if(oError.iLine){aDetails.push('\nLine:',oError.iLine);}}else{if(oError.oSource){if(oError.oSource instanceof df.WebObject){aDetails.push('\nObject:',oError.oSource.getLongName());}}}oLabel.psCaption=aDetails.join("");oContentPnl.addChild(oLabel);if(oError.sDetailHtml){oDialog.piMinHeight=300;oDialog.piHeight=400;if(oError.sDetailHtml.match(/<body*>|<html*>/gi)){oDetailsBox=new df.WebIFrame(null,oContentPnl);oDetailsBox.pbFillHeight=true;oDetailsBox.pbShowLabel=false;oDetailsBox.psCSSClass="WebErrorDetails";oDetailsBox.setHtmlContent(oError.sDetailHtml);oContentPnl.addChild(oDetailsBox);}else{oDetailsBox=new df.WebHtmlBox(null,oContentPnl);oDetailsBox.pbFillHeight=true;oDetailsBox.pbShowBox=true;oDetailsBox.pbScroll=true;oDetailsBox.pbShowLabel=false;oDetailsBox.psCSSClass="WebErrorDetails";oDetailsBox.psHtml=oError.sDetailHtml;oContentPnl.addChild(oDetailsBox);}}}oButtonPnl=new df.WebPanel(null,oDialog);oButtonPnl.peRegion=df.ciRegionBottom;oButtonPnl.piColumnCount=3;oButtonPnl.psCSSClass="WebMsgBoxOneBtn";oDialog.addChild(oButtonPnl);oCloseBtn=new df.WebButton(null,oDialog);oCloseBtn.psCaption=this.getTrans("ok",true)||"OK";oCloseBtn.piColumnIndex=2;oCloseBtn.pbShowLabel=false;oCloseBtn.OnClick.addListener(function(oEvent){oDialog.hide();},this);oButtonPnl.addChild(oCloseBtn);oDialog.show();this.ready(function(){oDialog.resize();oCloseBtn.focus();});}if(oError instanceof df.Error){if(this.OnError.fire(this,{oError:oError})){if(oError.oTarget&&oError.oTarget.displayError&&oError.oTarget.pbRender&&oError.oTarget.pbVisible){oError.oTarget.displayError(oError.iNumber,oError.sText);}else{this._aModalQueue.push({fFunc:displayError,bFinished:false,bDisplayed:false});this.processModal();}}}else{throw oError;}},setPageTitle:function setPageTitle(sTitle){document.title=sTitle;},navigateToPage:function navigateToPage(sUrl,eMode){this.queueModal(function(){eMode=parseInt(eMode,10);if(eMode===df.ciOpenSameWindow){window.location.href=sUrl;}else{if(eMode===df.ciOpenNewWindow){window.open(sUrl,'_blank_'+df.dom.piDomCounter++,'width=700, height=500, resizable=yes');}else{window.open(sUrl,'_blank');}}},this);},navigateNewWindow:function navigateNewWindow(sUrl,iWidth,iHeight){this.queueModal(function(){window.open(sUrl,'_blank_'+df.dom.piDomCounter++,'width='+iWidth+', height='+iHeight+', resizable=yes, location=yes');});},navigateRefresh:function navigateRefresh(){this.queueModal(function(){window.location.reload();});},historyPushState:function historyPushState(sUrl,sTitle){var state={df:true,vt:this._tActionData};if(history&&history.pushState){history.pushState(state,sTitle||null,sUrl||null);}},historyReplaceState:function historyReplaceState(sUrl,sTitle){var state={df:true,vt:this._tActionData};if(history&&history.replaceState){history.replaceState(state,sTitle||null,sUrl||null);}},onPopState:function onPopState(oEvent){var state=oEvent.e.state,vt=null;if(state&&state.df){if(state.vt&&typeof state.vt.v!=="undefined"&&state.vt.c){vt=state.vt;}}this.serverAction("HistoryPopState",[document.title,document.location.href],vt);oEvent.stop();},onHashChange:function onHashChange(oEvent){this.cancelServerAction("HistoryPopState");this.serverAction("LocationHashChange",[document.location.hash]);},get_piWindowWidth:function get_piWindowWidth(){return df.dom.windowWidth();},get_piWindowHeight:function get_piWindowHeight(){return df.dom.windowHeight();},get_peMode:function get_peMode(){if(this._oModeControl){return this._oModeControl.peMode;}},get_pbIsMobile:function get_pbIsMobile(){return df.sys.isMobile;},get_psLocationHash:function get_psLocationHash(){return window.location.hash;},get_piBrowserTimezoneOffset:function get_piBrowserTimezoneOffset(){return new Date().getTimezoneOffset();},get_pasBrowserLanguages:function(){var vt=df.sys.vt.serialize(navigator.languages||navigator.language&&[navigator.language]||["en-US"]);return function(){return vt;};}()});df.WebWindow=function WebWindow(sName,oParent){df.WebWindow.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tBool,"pbShowCaption",true);this.prop(df.tBool,"pbResizable",true);this.prop(df.tBool,"pbShowClose",true);this.prop(df.tBool,"pbFocusFirstOnShow",true);this.prop(df.tInt,"piMaxWidth",0);this.prop(df.tInt,"piMinWidth",0);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tInt,"piLeft",0);this.prop(df.tInt,"piTop",0);this.pbFloating=false;this.pbModal=false;this._eLbl=null;this._aModalHiddenPlugins=null;this._aHiddenPlugins=null;this._bWrapDiv=false;this._sBaseClass="WebWindow";this._bRendered=false;this._bHasLeft=false;this._bHasTop=false;this._eRenderTo=null;this._eMask=null;this._oPrevFocus=null;};df.defineClass("df.WebWindow","df.WebBaseContainer",{create:function create(){this._bHasLeft=this.piLeft>0;this._bHasTop=this.piTop>0;},openHtml:function openHtml(aHtml){aHtml.push('<div class="',this.genClass(),'"');if(this.psHtmlId){aHtml.push(' id="',this.psHtmlId,'"');}aHtml.push(' data-dfobj="',this.getLongName(),'"');aHtml.push(' style=" ',this.pbRender?'':'display: none;',this.pbVisible?'':'visibility: hidden;',this.pbFloating?'top:10px;':'','"');aHtml.push('>');if(!this.pbFloating){aHtml.push('<div class="WebContainer">');}else{aHtml.push('<div class="WebWin_top_l">','<div class="WebWin_top_r">','<div class="WebWin_top_c">','</div>','</div>','</div>','<div class="WebWin_main_l">','<div class="WebWin_main_r">','<div class="WebWin_header">','<div class="WebWin_header_r">','<div class="WebWin_header_c">');if(this.pbShowCaption){aHtml.push('<label class="WebWin_title">',df.dom.encodeHtml(this.psCaption),'</label>');}aHtml.push('<div class="WebWin_controls">');aHtml.push('<div class="WebWin_close" tabindex="0"',this.pbShowClose?'':' style="display:none"','></div>');aHtml.push('</div>','<div style="clear: both;"></div>','</div>','</div>','</div>','<div class="WebWin_main_c">','<div class="WebContainer">');}df.WebWindow.base.openHtml.call(this,aHtml);if(!this.pbFloating){aHtml.push('<div class="WebCon_Inner">');if(this.psCaption&&this.pbShowCaption){aHtml.push('<label class="WebWin_title">',df.dom.encodeHtml(this.psCaption),'</label>');}aHtml.push('<div class="WebCon_ContentWrp">');}},closeHtml:function closeHtml(aHtml){df.WebWindow.base.closeHtml.call(this,aHtml);if(!this.pbFloating){aHtml.push('</div></div></div></div>');}else{aHtml.push('</div>','</div>','</div>','</div>','<div class="WebWin_bottom_l">','<div class="WebWin_bottom_r">','<div class="WebWin_bottom_c">','</div>','<div class="WebWin_resizer">','</div>','</div>','</div>');}},afterRender:function afterRender(){if(this.pbFloating){this._eLbl=df.dom.query(this._eElem,"label.WebWin_title");this._eHeader=df.dom.query(this._eElem,"div.WebWin_header");this._eHeaderContent=df.dom.query(this._eElem,"div.WebWin_header_c");this._eControlWrap=df.dom.query(this._eElem,"div.WebWin_main_c");this._eMainRight=df.dom.query(this._eElem,"div.WebWin_main_r");this._eMainLeft=df.dom.query(this._eElem,"div.WebWin_main_l");this._eTopLeft=df.dom.query(this._eElem,"div.WebWin_top_l");this._eTopRight=df.dom.query(this._eElem,"div.WebWin_top_r");this._eTopContent=df.dom.query(this._eElem,"div.WebWin_top_c");this._eBottomLeft=df.dom.query(this._eElem,"div.WebWin_bottom_l");this._eBottomRight=df.dom.query(this._eElem,"div.WebWin_bottom_r");this._eResizer=df.dom.query(this._eElem,"div.WebWin_resizer");this._eBottomContent=df.dom.query(this._eElem,"div.WebWin_bottom_c");this._eCloseBtn=df.dom.query(this._eElem,"div.WebWin_close");}else{this._eInner=df.dom.query(this._eElem,"div.WebCon_Inner");this._eContentWrap=df.dom.query(this._eElem,"div.WebCon_ContentWrp");this._eLbl=df.dom.query(this._eElem,"label.WebWin_title");}df.WebWindow.base.afterRender.call(this);this.set_piHeight(this.piHeight);this.set_piWidth(this.piWidth);this.set_piMaxWidth(this.piMaxWidth);if(this.pbFloating){df.dom.on("mousedown",this._eHeader,this.onStartDrag,this);df.dom.on("mousedown",this._eMainRight,this.onStartResize,this);df.dom.on("mousedown",this._eMainLeft,this.onStartResize,this);df.dom.on("mousedown",this._eTopLeft,this.onStartResize,this);df.dom.on("mousedown",this._eBottomLeft,this.onStartResize,this);df.dom.on("mousedown",this._eCloseBtn,function(oEvent){oEvent.stop();});df.dom.on("click",this._eCloseBtn,this.onCloseClick,this);if(this._bStandalone){df.dom.on("resize",window,this.onWindowResize,this);}}else{this.set_piMinWidth(this.piMinWidth);}df.events.addDomKeyListener(this._eElem,this.onKey,this);},genClass:function genClass(){this._sBaseClass=this.pbFloating?"WebWindow"+(this.pbResizable?" WebWin_Resizable":""):"WebInlineView";return df.WebWindow.base.genClass.call(this);},_show:function _show(eRenderTo){var eElem,bRender=!this._eElem,eViewPort,oW,that=this;if(bRender){eElem=this.render();df.dom.addClass(eElem,"WebWin_Hidden");}if(this.pbFloating&&this.pbModal){eViewPort=document.body;this._oPrevFocus=this.getWebApp()._oCurrentObj;if(this._eElem.parentNode){this._eElem.parentNode.removeChild(this._eElem);}df.sys.gui.disableTabIndexes(document.body);this._aModalHiddenPlugins=df.sys.gui.hidePlugins(document.body);this._eMask=df.dom.create('<div class="WebWindow_Mask">&nbsp;</div>');eViewPort.appendChild(this._eMask);eViewPort.appendChild(this._eElem);this._eRenderTo=this._eMask;}else{if(!eRenderTo){throw new df.Error(999,"Unable to show view without provided render object.",this);}if(this._eElem.parentNode!==eRenderTo){eRenderTo.appendChild(this._eElem);this._eRenderTo=eRenderTo;}}df.dom.removeClass(this._eElem,"WebWin_Hidden");if(this._aHiddenPlugins){df.sys.gui.restorePlugins(this._aHiddenPlugins);this._aHiddenPlugins=null;}if(bRender){this.afterRender();}this._bRendered=true;if(this.pbFloating){this.resize();this.centerWindow();}this.afterShow();this._oCurrentObj=null;oW=this.getWebApp();if(oW){oW.objFocus(this);}setTimeout(function(){var oWebApp=that.getWebApp();if(oWebApp&&that._bRendered){if(that.pbFocusFirstOnShow&&!that._oCurrentObj){that.conditionalFocus(true);}df.dom.addClass(that._eElem,"WebWin_Visible");oWebApp.OnShowWindow.fire(oWebApp,{oWindow:that,eElem:that._eElem,bModal:that.pbModal});}},20);},_hide:function _hide(bNoServerEvents){var that=this,oInvoking,oWebApp=this.getWebApp(),bCanceled;if(this._bRendered){if(this.pbFloating&&this.pbModal){var _this$_eMask$parentNo;df.sys.gui.restoreTabIndexes(document.body);if(this._aModalHiddenPlugins){df.sys.gui.restorePlugins(this._aModalHiddenPlugins);this._aModalHiddenPlugins=null;}(_this$_eMask$parentNo=this._eMask.parentNode)===null||_this$_eMask$parentNo===void 0?void 0:_this$_eMask$parentNo.removeChild(this._eMask);oInvoking=this.getInvoking()||oWebApp._oCurrentWindow;if(oInvoking){oInvoking.returnFocus();}else if(this._oPrevFocus){this._oPrevFocus.conditionalFocus();}this._eRenderTo=null;}df.dom.addClass(this._eElem,"WebWin_Hidden");df.dom.removeClass(this._eElem,"WebWin_Visible");this._aHiddenPlugins=df.sys.gui.hidePlugins(this._eElem);if(oWebApp){bCanceled=!oWebApp.OnHideWindow.fire(oWebApp,{oWindow:this,eElem:this._eElem,bModal:this.pbModal});}}this._bRendered=false;this.afterHide();if(this._bStandalone){if(bCanceled){setTimeout(function(){if(that._eElem&&that._eElem.parentNode){that._eElem.parentNode.removeChild(that._eElem);}},5000);}else{if(this._eElem&&this._eElem.parentNode){this._eElem.parentNode.removeChild(this._eElem);}}}},set_piMinWidth:function set_piMinWidth(iVal){if(!this.pbFloating){if(this._eSizer){if(iVal>0){iVal-=this.getWidthDiff(true,true,false,false);this._eSizer.style.minWidth=iVal+"px";}else{this._eSizer.style.minWidth="";}}this.sizeChanged();}this.piMinWidth=iVal;this.set_piWidth(this.piWidth);},set_piWidth:function set_piWidth(iVal){var sWidth,iDiff;if(this.pbFloating){iVal=iVal>this.piMinWidth?iVal:this.piMinWidth;this.piWidth=iVal;if(this.pbFloating){sWidth=iVal>0?parseInt(iVal,10)+'px':'';if(this._eControlWrap){this._eControlWrap.style.width=sWidth;this._eHeader.style.width=sWidth;}}else{sWidth=iVal>0?parseInt(iVal,10)+'px':'';if(this._eElem){this._eElem.style.width=sWidth;}}}else{if(this._eSizer){iDiff=this.getWidthDiff(true,true,false,false);iVal-=iDiff;this._eSizer.style.width=iVal>0?iVal+"px":"";}this.sizeChanged();}},set_piMaxWidth:function set_piMaxWidth(iVal){if(!this.pbFloating){if(this._eSizer){if(iVal>0){iVal-=this.getWidthDiff(true,true,false,false);this._eSizer.style.maxWidth=iVal+"px";}else{this._eSizer.style.maxWidth="";}}this.sizeChanged();}},set_piHeight:function set_piHeight(iVal){if(!this.pbFloating){this.piHeight=iVal;iVal=iVal>this.piMinHeight?iVal:this.piMinHeight;if(iVal>0){if(this._eElem){this.setInnerHeight(iVal);}}this.sizeChanged();}else{df.WebWindow.base.set_piHeight.call(this,iVal);}},set_piTop:function set_piTop(iVal){this._bHasTop=true;if(this._eElem){this._eElem.style.top=parseInt(iVal,10)+'px';}},set_piLeft:function set_piLeft(iVal){this._bHasLeft=true;if(this._eElem){this._eElem.style.left=parseInt(iVal,10)+'px';}},set_psCaption:function set_psCaption(sVal){this.psCaption=sVal;this.updateCaption();},set_pbShowCaption:function set_pbShowCaption(bVal){this.pbShowCaption=bVal;this.updateCaption();},set_pbResizable:function set_pbResizable(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebWin_Resizable",bVal);}},set_pbShowClose:function set_pbShowClose(bVal){if(this._eCloseBtn){this._eCloseBtn.style.display=bVal?'':'none';}},updateCaption:function updateCaption(){if(this._eElem){if(this.psCaption&&this.pbShowCaption){if(!this._eLbl){this._eLbl=df.dom.create('<label class="WebWin_title">&nbsp;</label>');if(this.pbFloating){this._eHeaderContent.insertBefore(this._eLbl,this._eHeaderContent.firstChild);}else{this._eInner.insertBefore(this._eLbl,this._eContentWrap);}}df.dom.setText(this._eLbl,this.psCaption);}else{if(this._eLbl){this._eLbl.parentNode.removeChild(this._eLbl);this._eLbl=null;}}}},createGhost:function createGhost(){var eGhost,eGhostContent,eGhostHeader,oSize,aHtml=[],sOrigId;sOrigId=this.psHtmlId;this.psHtmlId="";this._bWrapDiv=false;this.openHtml(aHtml);this.closeHtml(aHtml);this._bWrapDiv=true;this.psHtmlId=sOrigId;eGhost=df.dom.create(aHtml.join(''));eGhost.className=this.genClass()+" WebWin_ghost";this._eElem.parentNode.appendChild(eGhost);df.dom.disableTextSelection(eGhost);eGhostContent=df.dom.query(eGhost,".WebWin_main_c");eGhostHeader=df.dom.query(eGhost,".WebWin_header");oSize=df.sys.gui.getSize(this._eControlWrap);eGhostHeader.style.width=oSize.width+'px';eGhostContent.style.width=oSize.width+'px';eGhostContent.style.height=oSize.height+'px';eGhost.style.top=this.piTop+'px';eGhost.style.left=this.piLeft+'px';return eGhost;},onStartDrag:function onStartDrag(oEvent){var eMask,eGhost,oSize,iTopLim,iLeftLim,iDragOffsetTop,iDragOffsetLeft,aHiddenPlugins=null;if(!this.isEnabled()){return;}eMask=df.gui.dragMask();eMask.style.cursor="move";iDragOffsetTop=oEvent.getMouseY()-this.piTop;iDragOffsetLeft=oEvent.getMouseX()-this.piLeft;oSize=df.sys.gui.getSize(this._eElem);if(this._eCloseBtn){if(this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth>oSize.width){oSize.width=this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth;}}iLeftLim=this.getViewportWidth()-oSize.width-1;iTopLim=this.getViewportHeight()-oSize.height-1;function onDrag(oEvent){this.piTop=oEvent.getMouseY()-iDragOffsetTop;this.piLeft=oEvent.getMouseX()-iDragOffsetLeft;this.piTop=this.piTop<=0?1:this.piTop>=iTopLim?iTopLim:this.piTop;this.piLeft=this.piLeft<=0?1:this.piLeft>=iLeftLim?iLeftLim:this.piLeft;if(eGhost){eGhost.style.top=this.piTop+'px';eGhost.style.left=this.piLeft+'px';}else{eGhost=this.createGhost();aHiddenPlugins=df.sys.gui.hidePlugins(this._eElem);this._eElem.style.display="none";}}function onStopDrag(oEvent){df.dom.off("mouseup",eMask,onStopDrag);df.dom.off("mouseup",window,onStopDrag);df.dom.off("mousemove",eMask,onDrag);eMask.parentNode.removeChild(eMask);if(eGhost){this._eElem.parentNode.removeChild(eGhost);}this._eElem.style.top=this.piTop+'px';this._eElem.style.left=this.piLeft+'px';this._eElem.style.display="";this.resize();if(aHiddenPlugins){df.sys.gui.restorePlugins(aHiddenPlugins);}}df.dom.on("mouseup",eMask,onStopDrag,this);df.dom.on("mouseup",window,onStopDrag,this);df.dom.on("mousemove",eMask,onDrag,this);},onStartResize:function onStartResize(oEvent){if(this.pbResizable&&this.isEnabled()){var eTar=oEvent.getTarget();if(eTar===this._eMainRight){this.resizeDrag(oEvent,true,false,false,false,"e-resize");oEvent.stop();}else if(eTar===this._eMainLeft){this.resizeDrag(oEvent,true,true,false,false,"e-resize");oEvent.stop();}else if(eTar===this._eTopRight){this.resizeDrag(oEvent,true,false,true,true,"ne-resize");oEvent.stop();}else if(eTar===this._eTopLeft){this.resizeDrag(oEvent,true,true,true,true,"nw-resize");oEvent.stop();}else if(eTar===this._eTopContent){this.resizeDrag(oEvent,false,false,true,true,"n-resize");oEvent.stop();}else if(eTar===this._eBottomRight||eTar===this._eResizer){this.resizeDrag(oEvent,true,false,true,false,"nw-resize");oEvent.stop();}else if(eTar===this._eBottomLeft){this.resizeDrag(oEvent,true,true,true,false,"ne-resize");oEvent.stop();}else if(eTar===this._eBottomContent){this.resizeDrag(oEvent,false,false,true,false,"n-resize");oEvent.stop();}}},resizeDrag:function resizeDrag(oEvent,bWidth,bLeft,bHeight,bTop,sCursor){var eMask,eGhost,eGhostContent,eGhostHeader,oSize,iStartWidth,iStartLeft,iStartMouseX,iStartHeight,iStartMouseY,iStartTop,iMarginRight=0,aHiddenPlugins;eMask=df.gui.dragMask();eMask.style.cursor=sCursor;aHiddenPlugins=df.sys.gui.hidePlugins(this._eElem);oSize=df.sys.gui.getSize(this._eControlWrap);iStartWidth=oSize.width;iStartMouseX=oEvent.getMouseX();iStartLeft=this.piLeft;iStartHeight=oSize.height;iStartMouseY=oEvent.getMouseY();iStartTop=this.piTop;this.piHeight=this.piHeight>0?this.piHeight:this._eControlWrap.clientHeight;if(this._eCloseBtn){if(this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth>oSize.width){iMarginRight=this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth-oSize.width;}}function onResize(oEvent){if(!eGhost){eGhost=this.createGhost();eGhostContent=df.dom.query(eGhost,".WebWin_main_c");eGhostHeader=df.dom.query(eGhost,".WebWin_header");}if(bWidth){if(bLeft){this.piWidth=iStartWidth-(oEvent.getMouseX()-iStartMouseX);this.piWidth=this.piWidth>this.piMinWidth?this.piWidth:this.piMinWidth;this.piLeft=iStartLeft-(this.piWidth-iStartWidth);}else{this.piWidth=iStartWidth+(oEvent.getMouseX()-iStartMouseX);this.piWidth=this.piWidth>this.piMinWidth?this.piWidth:this.piMinWidth;if(this.piWidth+this.piLeft>this.getViewportWidth()-iMarginRight){this.piWidth=this.getViewportWidth()-iMarginRight-this.piLeft;}}eGhost.style.left=this.piLeft+"px";eGhostContent.style.width=this.piWidth+"px";eGhostHeader.style.width=this.piWidth+"px";}if(bHeight){if(bTop){this.piHeight=iStartHeight-(oEvent.getMouseY()-iStartMouseY);this.piHeight=this.piHeight>this.piMinHeight?this.piHeight:this.piMinHeight;this.piTop=iStartTop-(this.piHeight-iStartHeight);}else{this.piHeight=iStartHeight+(oEvent.getMouseY()-iStartMouseY);this.piHeight=this.piHeight>this.piMinHeight?this.piHeight:this.piMinHeight;}eGhost.style.top=this.piTop+"px";eGhostContent.style.height=this.piHeight+"px";}}function onStopResize(oEvent){df.dom.off("mouseup",eMask,onStopResize);df.dom.off("mouseup",window,onStopResize);df.dom.off("mousemove",eMask,onResize);eMask.parentNode.removeChild(eMask);if(eGhost){this._eElem.parentNode.removeChild(eGhost);}if(aHiddenPlugins){df.sys.gui.restorePlugins(aHiddenPlugins);}this._eControlWrap.style.width=this.piWidth+"px";this._eHeader.style.width=this.piWidth+"px";this._eElem.style.left=this.piLeft+"px";this._eElem.style.top=this.piTop+"px";this._eElem.style.display="";this.setOuterHeight(this.piHeight);this.resize();}df.dom.on("mousemove",eMask,onResize,this);df.dom.on("mouseup",window,onStopResize,this);df.dom.on("mouseup",eMask,onStopResize,this);},getInvoking:function getInvoking(){return null;},getViewportElem:function getViewportElem(){if(this.pbFloating&&this.pbModal){return document.body;}return this._eRenderTo;},blur:function blur(){},doClose:function doClose(){if(this.pbShowClose){this.hide();}},resize:function resize(){this.updateAlign();this.resizeHorizontal();this.resizeVertical();if(this._eControlWrap&&!this.piHeight&&!this.piWidth&&this.pbFloating){this.piHeight=df.dom.clientHeight(this._eControlWrap);this.piWidth=df.dom.clientWidth(this._eControlWrap);this._eControlWrap.style.width=this.piWidth+"px";this._eHeader.style.width=this.piWidth+"px";this._eControlWrap.style.height=this.piHeight+"px";}},updateAlign:function updateAlign(){var eAlign;if(!this.pbFloating&&this._eSizer){eAlign=this.getWebApp().peAlignView;this._eSizer.style.marginLeft=eAlign===df.ciAlignCenter||eAlign===df.ciAlignRight?"auto":"";this._eSizer.style.marginRight=eAlign===df.ciAlignCenter?"auto":"";}},resizeHorizontal:function resizeHorizontal(){if(!this.pbFloating){this.setOuterWidth(this.piWidth);}df.WebWindow.base.resizeHorizontal.call(this);},setOuterHeight:function setOuterHeight(iHeight){if(!this.pbFloating){iHeight-=this.getHeightDiff(true,false,false,false);this._eContainer.style.height=iHeight>0?iHeight+'px':'';}else{if(iHeight>0){this._eControlWrap.style.height=iHeight+'px';iHeight-=this.getHeightDiff(true,true,false,false);this._eContainer.style.height=iHeight+'px';}else{this._eControlWrap.style.height='';this._eContainer.style.height='';}}},setInnerHeight:function setInnerHeight(iHeight){if(!this.pbFloating&&!this._bPanels&&(this.pbFillHeight||this.piHeight>0)){iHeight-=this.getHeightDiff(true,true,true,false);iHeight+=df.sys.gui.getVertBoxDiff(this._eContent,1);if(iHeight>0&&this._eContent.offsetHeight<=iHeight){this._eContentWrap.style.height=iHeight+"px";}else{this._eContentWrap.style.height="";}}else{df.WebWindow.base.setInnerHeight.call(this,iHeight);}},setOuterWidth:function setOuterWidth(iWidth){},viewResize:function viewResize(iMaxH){var iDiff,iHeight,oWebApp=this.getWebApp();this.prepareSize();if(!this.pbFloating){if(this.piHeight>0&&this.piHeight<iMaxH){this.setOuterHeight(this.piHeight);}else if(this._bStretch||this.pbScroll&&oWebApp._eElem){this.setOuterHeight(iMaxH);}}else{iDiff=df.dom.offsetHeight(this._eHeader)+df.dom.offsetHeight(this._eBottomLeft);iMaxH=df.dom.windowHeight()-20;if(this.piHeight<=0){iHeight=this._iWantedHeight;}else{iHeight=this.piHeight;}if(iHeight>0&&iHeight+iDiff<iMaxH){this.setOuterHeight(iHeight);}else{this.setOuterHeight(iMaxH-iDiff);}}this.resize();},getHeightDiff:function getHeightDiff(bOut,bIn,bContentOut,bContentIn){var iHeight=df.WebWindow.base.getHeightDiff.call(this,bOut,bIn,bContentOut,bContentIn);if(!this.pbFloating&&this._eLbl){if(bContentOut){iHeight+=df.sys.gui.getVertBoxDiff(this._eInner,0);iHeight+=this._eLbl.offsetHeight;iHeight+=df.sys.gui.getVertBoxDiff(this._eLbl,1);iHeight+=df.sys.gui.getVertBoxDiff(this._eContentWrap,0);}}return iHeight;},getViewportWidth:function getViewportWidth(){if(this.pbModal){return df.sys.gui.getViewportWidth();}return this.getViewportElem().clientWidth;},getViewportHeight:function getViewportHeight(){if(this.pbModal){return df.sys.gui.getViewportHeight();}return this.getViewportElem().clientHeight;},onCloseClick:function onCloseClick(oEvent){if(this.isEnabled()){this.doClose();}},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.formKeys.escape)&&this.pbFloating){this.doClose();}},onWindowResize:function onWindowResize(oEvent){this.centerWindow();},windowResize:function windowResize(iWindowWidth,iWindowHeight){this.centerWindow();},centerWindow:function centerWindow(){if(this._bRendered&&this._eElem&&this.pbFloating){if(!this._bHasTop){this.piTop=this.getViewportHeight()/2-(this._eElem.clientHeight||this.piHeight)/2;if(df.sys.isMobile){this.piTop=this.piTop*0.65;}this.piTop=this.piTop>0?this.piTop:0;}if(!this._bHasLeft){this.piLeft=this.getViewportWidth()/2-(this._eElem.clientWidth||this.piWidth)/2;this.piLeft=this.piLeft>0?this.piLeft:0;}this._eElem.style.top=parseInt(this.piTop,10)+'px';this._eElem.style.left=parseInt(this.piLeft,10)+'px';}}});df.WebView=function WebView(sName,oParent){df.WebView.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbFillHeight",false);this.event("OnSubmit",df.cCallModeWait);this.event("OnShow",df.cCallModeWait);this.event("OnHide",df.cCallModeDefault);this.event("OnResizeWindow",df.cCallModeDefault);this.setActionMode("HandleDeleteKey",df.cCallModeWait);this.setActionMode("HandleSaveKey",df.cCallModeWait);this._bFireOnResize=false;this._oCurrentObj=null;this.pbScroll=true;this._sControlClass="WebView";};df.defineClass("df.WebView","df.WebWindow",{_show:function _show(eRenderTo){var oWebApp=this.getWebApp();this.fireEx({sEvent:"OnShow"});if(this._bFireOnResize){this.fire("OnResizeWindow",[oWebApp.get_piWindowWidth(),oWebApp.get_piWindowHeight()]);}df.WebView.base._show.call(this,eRenderTo);},_hide:function _hide(bNoServerEvents){if(this._bRendered&&!bNoServerEvents){this.fire("OnHide",[]);}df.WebView.base._hide.call(this,bNoServerEvents);},show:function show(){if(this._bStandalone){this._show();}else{this.getWebApp().showView(this._sName,false);}},hide:function hide(){if(this._bStandalone){this._hide(false);}else{this.getWebApp().hideView(this._sName);}},navigateBackToHere:function navigateBackToHere(bCancel,bCallback,sCallback){this.serverAction("NavigateBackToHere_Callback",[bCancel,bCallback,sCallback],this._tActionData);},destroy:function destroy(){var i,oWebApp=this.getWebApp();if(oWebApp){i=oWebApp._aViews.indexOf(this);if(i>=0){oWebApp._aViews.splice(i,1);}}df.WebView.base.destroy.call(this);},closePanel:function closePanel(){this.close();},resize:function resize(){if(this._bRendered){df.WebView.base.resize.call(this);}},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.formKeys.submit)){if(this.fire('OnSubmit')){oEvent.stop();}}else{df.WebView.base.onKey.call(this,oEvent);}},fireSubmit:function fireSubmit(){return this.fire('OnSubmit');},set_pbFillHeight:function set_pbFillHeight(bVal){this.pbFillHeight=bVal;this.sizeChanged();},getInvoking:function getInvoking(){var oWebApp;if(this.psInvokingView){oWebApp=this.getWebApp();if(oWebApp[this.psInvokingView]instanceof df.WebView){return oWebApp[this.psInvokingView];}}return null;},windowResize:function windowResize(iBrowserWidth,iBrowserHeight){if(this._bRendered){this.fire("OnResizeWindow",[iBrowserWidth,iBrowserHeight],function(){this.centerWindow();});}else{this._bFireOnResize=true;}df.WebView.base.windowResize.apply(this,arguments);},objFocus:function objFocus(oObj){this._oCurrentObj=oObj;},returnFocus:function returnFocus(){if(this._oCurrentObj){this._oCurrentObj.conditionalFocus();}else{this.conditionalFocus();}}});df.WebModalDialog=function WebModalDialog(sName,oParent){df.WebModalDialog.base.constructor.call(this,sName,oParent);this.event("OnEscape",df.cCallModeWait);this.pbFloating=true;this.pbModal=true;};df.defineClass("df.WebModalDialog","df.WebView",{doClose:function doClose(){if(!this.fire('OnEscape')){df.WebModalDialog.base.doClose.call(this);}}});df.WebButton=function WebButton(sName,oParent){df.WebButton.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tString,"psTextColor","");this.prop(df.tString,"psWaitMessage","");this.prop(df.tBool,"pbShowWaitDialog",false);this.prop(df.tInt,"peAlign",-1);this.event("OnClick",df.cCallModeWait);this.pbShowLabel=false;this._sControlClass="WebButton";};df.defineClass("df.WebButton","df.WebBaseControl",{create:function create(){df.WebButton.base.create.apply(this,arguments);this.set_pbShowWaitDialog(this.pbShowWaitDialog);},openHtml:function openHtml(aHtml){df.WebButton.base.openHtml.call(this,aHtml);aHtml.push('<button id="',this._sControlId,'"',!this.isEnabled()?' disabled="disabled"':'');if(this.peAlign>=0){aHtml.push(' style="text-align: ',df.sys.gui.cssTextAlign(this.peAlign),'"');}aHtml.push('>',df.dom.encodeHtml(this.psCaption),'</button>');},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"button");df.WebButton.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onBtnClick,this);df.events.addDomKeyListener(this._eElem,this.onKey,this);},onBtnClick:function onBtnClick(oEvent){var tTimer=null,bDone=false,eElem=this._eElem;if(this.isEnabled()){df.dom.addClass(eElem,df.CssHit);tTimer=setTimeout(function(){if(bDone){df.dom.removeClass(eElem,df.CssHit);}tTimer=null;},df.hitTimeout);this.fire('OnClick',[],function(oEvent){if(!oEvent.bCanceled){if(this.psLoadViewOnClick){this.getWebApp().showView(this.psLoadViewOnClick,false);}}if(!tTimer){df.dom.removeClass(eElem,df.CssHit);}bDone=true;});oEvent.stop();}},applyEnabled:function applyEnabled(bVal){df.WebButton.base.applyEnabled.call(this,bVal);if(this._eControl){this._eControl.disabled=!bVal;}},set_psCaption:function set_psCaption(sVal){if(this._eControl){df.dom.setText(this._eControl,sVal);this.sizeChanged();}},set_pbShowWaitDialog:function set_pbShowWaitDialog(bVal){this.setActionMode("OnClick",bVal?df.cCallModeProgress:df.cCallModeWait,this.psWaitMessage);},set_psWaitMessage:function set_psWaitMessage(sVal){this.setActionMode("OnClick",this.pbShowWaitDialog?df.cCallModeProgress:df.cCallModeWait,sVal);},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.formKeys.submit)){oEvent.stopPropagation();}},set_peAlign:function set_peAlign(eVal){if(this._eControl){this._eControl.style.textAlign=df.sys.gui.cssTextAlign(eVal);}}});df.WebLabel=function WebLabel(sName,oParent){df.WebLabel.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tInt,"peAlign",0);this.prop(df.tBool,"pbShowBorder",false);this.prop(df.tInt,"peWordBreak",df.wbPreWrap);this.pbShowLabel=false;this._bFocusAble=false;this._sControlClass="WebLabel";};df.defineClass("df.WebLabel","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebLabel.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebLabel_content ',df.classWordBreak(this.peWordBreak),'">&nbsp;</div>');},closeHtml:function closeHtml(aHtml){df.WebLabel.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebLabel_content");df.WebLabel.base.afterRender.call(this);this.set_peAlign(this.peAlign);this.set_psCaption(this.psCaption);this.set_pbShowBorder(this.pbShowBorder);},set_psCaption:function set_psCaption(sVal){if(this._eControl){df.dom.setText(this._eControl,sVal);if(sVal!==this.psCaption){this.sizeChanged();}}},set_peWordBreak:function set_peWordBreak(iVal){if(this._eControl){df._eControl.className="WebLabel_content "+df.classWordBreak(iVal);}},set_pbShowBorder:function set_pbShowBorder(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebLabel_border",bVal);if(this.pbShowBorder!==bVal){this.sizeChanged();}}},set_peAlign:function set_peAlign(iVal){if(this._eControl){this._eControl.style.textAlign=iVal===df.ciAlignLeft?"left":iVal===df.ciAlignCenter?"center":iVal===df.ciAlignRight?"right":"";}}});df.WebForm=function WebForm(sName,oParent){df.WebForm.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbPromptButton",false);this.prop(df.tBool,"pbPassword",false);this.prop(df.tString,"psPlaceHolder","");this.prop(df.tBool,"pbAutoTab",false);this.prop(df.tString,"psInputMode","");this.event("OnPrompt",df.cCallModeWait);this._eWrap=null;this._ePrompt=null;this._bAutoTabOnUp=false;this._sControlClass="WebForm";};df.defineClass("df.WebForm","df.WebBaseForm",{openHtml:function openHtml(aHtml){df.WebForm.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><span class="WebFrm_Prompt"></span><div class="WebFrm_PromptSpacer">','<input type="',this.pbPassword?'password':'text','"',' name="',this._sName,'"',' value="" id="',this._sControlId,'"');if(this.psInputMode){aHtml.push(' inputmode="',this.psInputMode,'"');}aHtml.push(this.peLabelPosition!=df.ciLabelFloat?' placeholder="'+df.dom.encodeAttr(this.psPlaceHolder)+'"':'',' autocomplete="',df.dom.encodeAttr(this.psAutoComplete),'"',!this.isEnabled()?' disabled="disabled" tabindex="-1"':'','>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div></div>');df.WebForm.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebFrm_Wrapper input");this._ePrompt=df.dom.query(this._eElem,"div.WebFrm_Wrapper span.WebFrm_Prompt");this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");df.WebForm.base.afterRender.call(this);df.dom.on("click",this._ePrompt,this.onPromptClick,this);this.set_pbPromptButton(this.pbPromptButton);},set_pbPassword:function set_pbPassword(bVal){if(this._eControl){if(df.sys.isIE&&df.sys.iVersion<9){var eNew=this._eControl.cloneNode(false);eNew.type=bVal?'password':'text';this._eControl.parentNode.replaceChild(eNew,this._eControl);this._eControl=eNew;}else{this._eControl.type=bVal?'password':'text';}}},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eWrap){this._eWrap.style.background=sVal||'';}},set_pbPromptButton:function set_pbPromptButton(bVal){if(this._eWrap&&this._ePrompt){df.dom.toggleClass(this._eWrap,"WebFrm_HasPrompt",bVal);}},set_psPlaceHolder:function set_psPlaceHolder(sVal){if(this._eControl&&this.peLabelPosition!=df.ciLabelFloat){this._eControl.placeholder=sVal;}},set_psInputMode:function set_psInputMode(sVal){if(this._eControl){this._eControl.inputMode=sVal;}},onPromptClick:function onPromptClick(oEvent){if(this.isEnabled()){this.objFocus();if(this.firePrompt()){oEvent.stopPropagation();}else{this.focus();}}},getVertHeightDiff:function getVertHeightDiff(){var iResult=df.WebForm.base.getVertHeightDiff.call(this);iResult+=df.sys.gui.getVertBoxDiff(this._eWrap);return iResult;},onKey:function onKey(oEvent){df.WebForm.base.onKey.call(this,oEvent);if(oEvent.matchKey(df.settings.formKeys.prompt)){if(this.firePrompt()){oEvent.stop();}}},firePrompt:function firePrompt(){if(this.pbPromptButton){return this.fire("OnPrompt");}},focus:function focus(bOptSelect){if(this._bFocusAble&&this.isEnabled()&&this._eControl&&this._eControl.focus){try{this._eControl.focus();if(bOptSelect){this._eControl.select();}}catch(oErr){}this.objFocus();return true;}return false;},onFocus:function onFocus(oEvent){var iCarPos,iNewCarPos,iRight,iSelection,bSelectAll;iCarPos=df.dom.getCaretPosition(this._eControl);iRight=this._eControl.value.length-iCarPos;iSelection=df.dom.getSelectionLength(this._eControl);bSelectAll=iSelection>=this._eControl.value.length;df.WebForm.base.onFocus.call(this,oEvent);iNewCarPos=df.dom.getCaretPosition(this._eControl);if(iCarPos!==iNewCarPos){if(this.peDataType===df.ciTypeBCD){iCarPos=this._eControl.value.length-iRight;}df.dom.setCaretPosition(this._eControl,iCarPos);}if(bSelectAll){this._eControl.select();}},autoTab:function autoTab(){var iMax=this.maxLength();if(this._eControl.value.length==iMax){var oSel=df.dom.getSelection(this._eControl);if(oSel.length==0&&oSel.start==iMax){this.focusNext(true);return true;}}return false;},onKeyPressAutoTab:function onKeyPressAutoTab(oEv){this._bAutoTabOnUp=!this.autoTab();},onKeyUpAutoTab:function onKeyUpAutoTab(oEv){if(this._bAutoTabOnUp){this.autoTab();this._bAutoTabOnUp=false;}},maxLength:function maxLength(){if(this.peDataType===df.ciTypeBCD){return this.piMaxLength+(this.piPrecision?this.decSep().length:0);}else if(this.peDataType===df.ciTypeDate){return df.sys.data.dateToString(new Date(2020,10,10,10,10,10,10),this.dateFormat(),this.dateSep(),this.timeSep()).length;}else if(this.peDataType===df.ciTypeDateTime){return df.sys.data.dateToString(new Date(2020,10,10,10,10,10,10),this.dateTimeFormat(),this.dateSep(),this.timeSep()).length;}else if(this.peDataType===df.ciTypeTime){return df.sys.data.dateToString(new Date(2020,10,10,10,10,10,10),this.timeFormat(),this.dateSep(),this.timeSep()).length;}else{return this.psMask?this.psMask.length:this.piMaxLength;}},initMask:function initMask(){if(this._eControl){df.dom.off("keypress",this._eControl,this.onKeyPressAutoTab);df.dom.off("keyup",this._eControl,this.onKeyUpAutoTab);}df.WebForm.base.initMask.call(this);if(this._eControl&&this.pbAutoTab){df.dom.on("keypress",this._eControl,this.onKeyPressAutoTab,this);df.dom.on("keyup",this._eControl,this.onKeyUpAutoTab,this);}},set_pbAutoTab:function set_pbAutoTab(bVal){if(this._eControl){this.pbAutoTab=bVal;this.initMask();}}});df.WebDateForm=function WebDateForm(sName,oParent){df.WebDateForm.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbShowWeekNr",true);this.prop(df.tBool,"pbShowToday",true);this.prop(df.tInt,"piStartWeekAt",1);this.prop(df.tBool,"pbAutoShow",false);this.prop(df.tBool,"pbHtml5NativeOnMobile",true);this.pbPromptButton=true;this._ePickerWrp=null;this._eFocus=null;this._bPickerVisible=false;this._bSkipAutoShow=false;this._bShowWait=false;this._iWidth=0;this._iHeight=0;this._tOnChange=null;this._sControlClass="WebForm WebDateForm";this._eParentRef=null;};df.defineClass("df.WebDateForm","df.WebForm",{afterRender:function afterRender(){df.WebDateForm.base.afterRender.call(this);if(this.pbHtml5NativeOnMobile&&df.sys.isMobile&&df.sys.supportHtml5Input("date")){this._ePrompt.innerHTML='<div class="WebDF_HiddenDate"><input type="date"></div>';this._eHtml5HiddenDate=df.dom.query(this._ePrompt,"input");df.dom.on("change",this._eHtml5HiddenDate,this.html5OnChange,this);df.dom.on("input",this._eHtml5HiddenDate,this.html5OnChange,this);}},destroy:function destroy(){if(this._oFloatingPanel){this._oFloatingPanel.destroy();this._oFloatingPanel=null;this._oPicker=null;}df.WebDateForm.base.destroy.call(this);},set_pbShowWeekNr:function set_pbShowWeekNr(bVal){if(this._oPicker){this._oPicker.set("pbShowWeekNr",bVal);}},set_pbShowToday:function set_pbShowToday(bVal){if(this._oPicker){this._oPicker.set("pbShowToday",bVal);}},set_piStartWeekAt:function set_piStartWeekAt(iVal){if(this._oPicker){this._oPicker.set("piStartWeekAt",iVal);}},setControlValue:function setControlValue(sVal){df.WebDateForm.base.setControlValue.call(this,sVal);if(this._eHtml5HiddenDate){this._eHtml5HiddenDate.value=this._tValue&&df.sys.data.dateToString(this._tValue,"yyyy/mm/dd","-")||"";}},html5OnChange:function html5OnChange(oEvent){var that=this;this._tValue=df.sys.data.stringToDate(this._eHtml5HiddenDate.value,"yyyy-mm-dd","-");this.refreshDisplay(this._tValue);if(this._tOnChange){clearTimeout(this._tOnChange);}this._tOnChange=setTimeout(function(){that.fireChange();that._tOnChange=null;},150);},initPicker:function initPicker(){var oPnl,oPicker;oPnl=this._oFloatingPanel=new df.WebFloatingPanel(null,this);oPnl.psFloatByControl=this.getLongName();oPnl.piColumnCount=1;oPnl.pbHideOnBlur=true;oPnl.pbFocusOnShow=true;oPnl.pbHideOnEscape=true;oPnl.pbNaturalWidth=true;oPnl.psCSSClass="NoWitespace Shadow WebDateForm_FlPnl";oPnl.OnHide.addListener(this.onPanelClose,this);oPnl.create();oPicker=this._oPicker=new df.WebDatePicker(null,this);oPicker.pbShowLabel=false;oPicker.psValue=this.getServerVal();oPicker.piColumnSpan=0;oPicker.pbShowWeekNr=this.pbShowWeekNr;oPicker.pbShowToday=this.pbShowToday;oPicker.piStartWeekAt=this.piStartWeekAt;oPicker.psMask=this.getWebApp().psDateFormat;oPicker.psCSSClass="WebDatePicker_Form NoWitespace";oPicker.OnRealtimeChange.addListener(this.onPickerChange,this);oPicker.OnEnter.addListener(this.onPickerEnter,this);oPicker.create();oPnl.addChild(oPicker);},renderPicker:function renderPicker(){var ePnl,oPnl=this._oFloatingPanel;ePnl=oPnl.render();if(ePnl){this._eElem.parentNode.insertBefore(ePnl,this._eElem);}oPnl.afterRender();oPnl.resizeHorizontal();oPnl.resizeVertical();},showPicker:function showPicker(){if(!this._oFloatingPanel){this.initPicker();}if(!this._oFloatingPanel._eElem){this.renderPicker();}this._oPicker._bBuddyActive=true;this._oPicker.set("psValue",this.getServerVal());this._oFloatingPanel.show();this._bPickerVisible=true;},hideDatePicker:function hideDatePicker(bOptNoFocus){this._bPickerVisible=false;if(this._oFloatingPanel){this._oPicker._bBuddyActive=false;this._oFloatingPanel.hide();}},firePrompt:function firePrompt(){var that=this;if(this.isEnabled()&&!this.pbReadOnly){if(this._eHtml5HiddenDate){this.updateTypeVal();if(this._tValue){this._eHtml5HiddenDate.value=df.sys.data.dateToString(this._tValue,"yyyy/mm/dd","-");}else{this._eHtml5HiddenDate.value="";}return true;}this.showPicker();return true;}},onPickerChange:function onPickerChange(oEvent){this._tValue=oEvent.dValue;this.refreshDisplay(oEvent.dValue);},onPickerEnter:function onPickerEnter(oEvent){if(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime){this._tValue=oEvent.dValue;this.refreshDisplay(this._tValue);}this.hideDatePicker();this.focus();this.fireChange();},onPanelClose:function onPanelClose(oEvent){var sReason=oEvent.aParams[0];this.fireChange();if(sReason!=="auto_blur"){this._bSkipAutoShow=true;this.focus();}},onFocus:function onFocus(oEvent){df.WebDateForm.base.onFocus.call(this,oEvent);if(this.pbAutoShow&&this.isEnabled()&&!this.pbReadOnly&&!this._bSkipAutoShow){this.showPicker();}this._bSkipAutoShow=false;}});df.tQueuedSyncProp={sO:df.tString,sP:df.tString,bA:df.tBool,sV:df.tString,tVT:{}};df.tSyncPropsWrapper={bReset:df.tBool,aSyncProps:[{sO:df.tString,aP:[{sN:df.tString,sV:df.tString}]}]};df.tAdvSyncPropsWrapper={bReset:df.tBool,aAdvSyncProps:[{sO:df.tString,sP:df.tString,tV:{}}]};df.WebDynamicObjectContainerBase=df.mixin("df.WebBaseContainer_mixin","df.WebBaseControl");df.WebDynamicObjectContainer=function WebDynamicObjectContainer(sName,oParent){df.WebDynamicObjectContainer.base.constructor.call(this,sName,oParent);this.prop(df.tAdv,"ptSyncPropsWrapper",null);this.prop(df.tAdv,"ptAdvSyncPropsWrapper",null);this.addSync("ptSyncPropsWrapper");this.addSync("ptAdvSyncPropsWrapper");this._aSyncPropQueue=[];this._bReset=false;this._aSyncPropCache=[];this._aAdvSyncPropCache=[];};df.defineClass("df.WebDynamicObjectContainer","df.WebDynamicObjectContainerBase",{getRef:function getRef(){df.WebDynamicObjectContainer.base.getRef.call(this);this._eControl=df.dom.query(this._eElem,"div.WebCon_Inner > div");},getMinHeight:function getMinHeight(){var iHeight=0;this.resize();iHeight=this.getRequiredHeight();if(this._eControl){iHeight+=df.sys.gui.getVertBoxDiff(this._eControl);iHeight+=df.sys.gui.getVertBoxDiff(this._eInner);iHeight+=df.sys.gui.getVertBoxDiff(this._eControlWrp);}if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}return iHeight;},setHeight:function setHeight(iHeight,bSense){if(this._eControl){if(iHeight>0){iHeight-=this.getVertHeightDiff();iHeight=iHeight<0?0:iHeight;this._eContainer.style.height=iHeight+"px";}else{this._eContainer.style.height="";}}},wrpOpenHtml:function wrpOpenHtml(aHtml){aHtml.push('<div class="WebContainer">');},wrpCloseHtml:function wrpCloseHtml(aHtml){aHtml.push('</div>');},loadQueuedSyncProps:function loadQueuedSyncProps(){var aQueuedSyncProps=this._tActionData,tQueuedSyncProp;for(var i=0;i<aQueuedSyncProps.length;i++){tQueuedSyncProp=aQueuedSyncProps[i];if(tQueuedSyncProp.bA){tQueuedSyncProp.tV=this.deserializeVT(sVal.c[4]);}this._aSyncPropQueue.push(tQueuedSyncProp);}},loadDynamicObjects:function loadDynamicObjects(){var oObj,tDef,aObjects=this._tActionData;for(var i=0;i<aObjects.length;i++){tDef=aObjects[i];oObj=this.initDynamicObject(tDef,this,false);oObj._oOwner=this;}if(this._eElem){this.renderChildren();this.afterRender();this.position();this.getWebApp().resize();}this.emptyPropCache();},insertDynamicObject:function insertDynamicObject(sParent,sInsertAfter){var tDef=this._tActionData,oObj,oParent,oInsertAfter,iIndex;oParent=this.getWebApp().findObj(sParent)||this;oInsertAfter=oParent[sInsertAfter]||null;oObj=this.initDynamicObject(tDef,oParent,true);if(this._eElem){iIndex=oInsertAfter!==null?oParent._aChildren.indexOf(oInsertAfter)+1:0;oParent.insertChild(oObj,iIndex);oParent.renderChild(oObj);this.getWebApp().resize();}},insertDynamicObjectAtIndex:function insertDynamicObjectAtIndex(sParent,iIndex){var tDef=this._tActionData,oObj,oParent;oParent=this.getWebApp().findObj(sParent)||this;oObj=this.initDynamicObject(tDef,oParent,true);if(this._eElem){oParent.insertChild(oObj,iIndex);oParent.renderChild(oObj);this.getWebApp().resize();}},prependDynamicObject:function prependDynamicObject(sParent){var tDef=this._tActionData,oObj,oParent;oParent=this.getWebApp().findObj(sParent)||this;oObj=this.initDynamicObject(tDef,oParent,true);if(this._eElem){oParent.insertChild(oObj,0);oParent.renderChild(oObj);this.getWebApp().resize();}},appendDynamicObject:function appendDynamicObject(sParent){var tDef=this._tActionData,oObj,oParent,iIndex;oParent=this.getWebApp().findObj(sParent)||this;oObj=this.initDynamicObject(tDef,oParent,true);if(this._eElem){iIndex=oParent._aUIObjects.length;oParent.insertChild(oObj,iIndex);oParent.renderChild(oObj);this.getWebApp().resize();}},moveDynamicObject:function moveDynamicObject(sDynamicObjectId,sInsertAfter){var oObj,eObj,oOldParent,oInsertAfter,oNewParent,iResizeCount,webApp=this.getWebApp(),iIndex;oObj=webApp.findObj(sDynamicObjectId);oInsertAfter=webApp.findObj(sInsertAfter);oNewParent=oInsertAfter._oParent;oOldParent=oObj._oParent;eObj=oObj._eElem;oObj._oParent=oNewParent;oOldParent.removeChild(oObj);iIndex=oInsertAfter!==null?oNewParent._aChildren.indexOf(oInsertAfter)+1:0;oNewParent.insertChild(oObj,iIndex,oInsertAfter);oNewParent.renderChild(oObj,eObj);iResizeCount=oObj.getObjectLevel();for(var i=0;i<iResizeCount;i++){webApp.resize();}},moveDynamicObjectToIndex:function moveDynamicObjectToIndex(sDynamicObjectId,sParentId,iIndex){var oObj,eObj,oOldParent,oNewParent,iResizeCount,webApp=this.getWebApp();oObj=webApp.findObj(sDynamicObjectId);oNewParent=webApp.findObj(sParentId);oOldParent=oObj._oParent;eObj=oObj._eElem;oObj._oParent=oNewParent;oOldParent.removeChild(oObj);oNewParent.insertChild(oObj,iIndex);oNewParent.renderChild(oObj,eObj);iResizeCount=oObj.getObjectLevel();for(var i=0;i<iResizeCount;i++){webApp.resize();}},destroyDynamicObject:function destroyDynamicObject(sDynamicObjectId){var oObj,oParent,iResizeCount;oObj=this.getWebApp().findObj(sDynamicObjectId);oParent=oObj._oParent;oParent.removeChild(oObj);oParent.unrenderChild(oObj);oObj.destroy();iResizeCount=oParent.getObjectLevel();for(var i=0;i<iResizeCount;i++){this.getWebApp().resize();}},initDynamicObject:function initDynamicObject(tDef,oParent,bInsert){var i,sP,oObj,FConstructor,webApp=this.getWebApp();if(!oParent[tDef.sName]){FConstructor=webApp.getConstructor(tDef.sType,tDef);if(typeof FConstructor==="function"){oParent[tDef.sName]=oObj=new FConstructor(tDef.sName,oParent);}else{throw new df.Error(999,"Could not find class '{{0}}'",this,[tDef.sType]);}}else{throw new df.Error(999,"Naming conflict with child object '{{0}}'",this,[tDef.sName]);}for(i=0;i<tDef.aProps.length;i++){sP=tDef.aProps[i].sN;if(sP.charAt(0)!=="_"){if(!oObj[sP]||_typeof(oObj[sP])!=="object"&&typeof oObj[sP]!=="function"){oObj._set(sP,tDef.aProps[i].sV,false,false);}else{throw new df.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[sP,tDef.sName]);}}else{throw new df.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[tDef.aProps[i].sV,tDef.sName]);}}if(tDef.aAdvP){for(i=0;i<tDef.aAdvP.length;i++){sP=tDef.aAdvP[i].sN;if(sP.charAt(0)!=="_"){if(!oObj[sP]||_typeof(oObj[sP])!=="object"&&typeof oObj[sP]!=="function"){if(!oObj._oTypes[sP]){oObj._oTypes[sP]=df.tAdv;}oObj._set(sP,tDef.aAdvP[i].tV,false,false);}else{throw new df.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[sP,tDef.sName]);}}else{throw new df.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[tDef.aAdvP[i].sV,tDef.sName]);}}}this.applyQueuedSyncProps(oObj);oObj._oOwner=this;if(!bInsert){webApp.newWebObject(oObj,oParent);}for(i=0;i<tDef.aObjs.length;i++){this.initDynamicObject.call(this,tDef.aObjs[i],oObj,false);}oObj.create(tDef);return oObj;},resetContainer:function resetContainer(){for(var i=0;i<this._aChildren.length;i++){this._aChildren[i].destroy();}this._aChildren=[];this._aFloats=[];this._aUIObjects=[];this._aPanels=[];this._aSyncPropQueue=[];this._bReset=false;this.getWebApp().resize();},applyQueuedSyncProps:function applyQueuedSyncProps(oObj){var vPropValue,aQueue,tQueuedSyncProp;aQueue=this._aSyncPropQueue.filter(function(e){return e.sO===oObj.getLongName();});this._aSyncPropQueue=this._aSyncPropQueue.filter(function(e){return e.sO!==oObj._sName;});for(var i=0;i<aQueue.length;i++){tQueuedSyncProp=aQueue[i];if(tQueuedSyncProp.bA){vPropValue=tQueuedSyncProp.tVT;}else{vPropValue=tQueuedSyncProp.sV;}oObj.addSync(tQueuedSyncProp.sP);oObj.set(tQueuedSyncProp.sP,vPropValue);}},emptyPropCache:function emptyPropCache(){this.handleSyncProps(this._aSyncPropCache);this.handleAdvSyncProps(this._aAdvSyncPropCache);this._aSyncPropCache=[];this._aAdvSyncPropCache=[];},getSynced:function getSynced(aObjs,aAdvProps){var sProp,aProps=[],val,sObj=this.getLongName();for(sProp in this._oSynced){if(this._oSynced.hasOwnProperty(sProp)){val=this.get(sProp);if(this._oTypes[sProp]){val=this.toServerType(val,this._oTypes[sProp]);}if(val===undefined){val=null;}if(this._oTypes[sProp]===df.tAdv){aAdvProps.push({sO:sObj,sP:sProp,tV:val});}else{aProps.push({sN:sProp,sV:val});}}}if(aProps.length>0){aObjs.push({sO:sObj,aP:aProps});}},handleSyncProps:function handleSyncProps(aProps){var i,oWO,tObj,x,webApp=this.getWebApp();for(i=0;i<aProps.length;i++){tObj=aProps[i];oWO=webApp.findObj(tObj.sO);if(oWO){for(x=0;x<tObj.aP.length;x++){oWO._set(tObj.aP[x].sN,tObj.aP[x].sV,true,true);}}else{}}},handleAdvSyncProps:function handleAdvSyncProps(aAdvSyncP){var i,tP,oWO,webApp=this.getWebApp();for(i=0;i<aAdvSyncP.length;i++){tP=aAdvSyncP[i];oWO=webApp.findObj(tP.sO);if(oWO){oWO._set(tP.sP,tP.tV,true,true);}else{}}},set_ptSyncPropsWrapper:function set_ptSyncPropsWrapper(sVal){var tSyncPropsWrapper;tSyncPropsWrapper=df.sys.vt.deserialize(sVal,df.tSyncPropsWrapper);if(!tSyncPropsWrapper.bReset){this.handleSyncProps(tSyncPropsWrapper.aSyncProps);}else{this._bReset=true;this._aSyncPropCache=this._aSyncPropCache.concat(tSyncPropsWrapper.aSyncProps);}},get_ptSyncPropsWrapper:function get_ptSyncPropsWrapper(){var aPropList=[],aAdvPropList=[],tSyncPropsWrapper;for(var i=0;i<this._aChildren.length;i++){this._aChildren[i].getSynced(aPropList,aAdvPropList);}for(var iObj=0;iObj<aPropList.length;iObj++){aPropList[iObj].aP.sort(function(a,b){return a.sN>b.sN?1:b.sN>a.sN?-1:0;});}tSyncPropsWrapper={bReset:this._bReset,aSyncProps:aPropList};return df.sys.vt.serialize(tSyncPropsWrapper,df.tSyncPropsWrapper);},set_ptAdvSyncPropsWrapper:function set_ptAdvSyncPropsWrapper(sVal){var tAdvSyncPropsWrapper;tAdvSyncPropsWrapper=df.sys.vt.deserialize(sVal,df.tAdvSyncPropsWrapper);for(var i=0;i<sVal.c[1].c.length;i++){tAdvSyncPropsWrapper.aAdvSyncProps[i].tV=sVal.c[1].c[i].c[2];}if(!tAdvSyncPropsWrapper.bReset){this.handleAdvSyncProps(tAdvSyncPropsWrapper.aAdvSyncProps);}else{this._bReset=true;this._aAdvSyncPropCache=this._aAdvSyncPropCache.concat(tAdvSyncPropsWrapper.aAdvSyncProps);}},get_ptAdvSyncPropsWrapper:function get_ptAdvSyncPropsWrapper(){var aPropList=[],aAdvPropList=[],tAdvSyncPropsWrapper;for(var i=0;i<this._aChildren.length;i++){this._aChildren[i].getSynced(aPropList,aAdvPropList);}for(var iObj=0;iObj<aAdvPropList.length;iObj++){aAdvPropList[iObj].aP.sort(function(a,b){return a.sN>b.sN?1:b.sN>a.sN?-1:0;});}tAdvSyncPropsWrapper={bReset:this._bReset,aAdvSyncProps:aAdvPropList};return df.sys.vt.serialize(tAdvSyncPropsWrapper,df.tAdvSyncPropsWrapper);},getLongNamePrnt:function getLongNamePrnt(){return this.getLongName()+"$";},onFocus:function onFocus(oEV){},onBlur:function onBlur(oEV){},serializeAdvSyncProps:function serializeAdvSyncProps(tStruct){function composeAdvSyncProp(oObj){return{v:"",c:[{v:oObj.sO.toString(),c:[]},{v:oObj.sP.toString(),c:[]},this.serializeVT(oObj.tV)]};}function composeAdvSyncPropsArray(aArray){var tVT={v:"",c:[]},i;for(i=0;i<aArray.length;i++){tVT.c.push(composeAdvSyncProp(aArray[i]));}return tVT;}function composeAdvSyncPropsObject(oObj){return{v:"",c:[{v:oObj.sO.toString(),c:[]},composeAdvSyncPropsArray(oObj.aP)]};}function composeAdvSyncPropsObjectArray(aArray){var tVT={v:"",c:[]},i;for(i=0;i<aArray.length;i++){tVT.c.push(composeAdvSyncPropsObject(aArray[i]));}return tVT;}try{return composeAdvSyncPropsObjectArray(tStruct);}catch(oErr){throw new df.Error(999,"Unable to serialize AdvSyncProps array, invalid data format!\n\r\n\rMSG: {{0}}",this,[oErr.message]);}}});df.WebCheckbox=function WebCheckbox(sName,oParent){df.WebCheckbox.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psChecked","1");this.prop(df.tString,"psUnchecked","0");this.prop(df.tString,"psCaption","");this.pbServerOnChange=false;this.psClientOnChange="";this._eCaption=null;this._sControlClass="WebCheckbox";};df.defineClass("df.WebCheckbox","df.WebBaseDEO",{openHtml:function openHtml(aHtml){df.WebCheckbox.base.openHtml.call(this,aHtml);aHtml.push('<input type="checkbox" id="',this._sControlId,'"',!this.isEnabled()?' disabled="disabled" tabindex="-1"':'','><span class="WebCB_Fake"></span><label class="WebCheckbox_Caption" for="',this._sControlId,'"></label><div style="clear: both"></div>');},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"input");this._eCaption=df.dom.query(this._eElem,"label.WebCheckbox_Caption");this._eFakeBox=df.dom.query(this._eElem,".WebCB_Fake");this.set_psCaption(this.psCaption);df.WebCheckbox.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onClick,this);df.dom.on("click",this._eFakeBox,this.onFakeClick,this);},getControlValue:function getControlValue(){if(this._eControl){if(this._eControl.checked){return this.psChecked;}return this.psUnchecked;}return this.psValue;},setControlValue:function setControlValue(sVal){if(this._eControl){this._eControl.checked=sVal===this.psChecked;}},set_psValue:function set_psValue(sVal){df.WebCheckbox.base.set_psValue.call(this,sVal);this._sPrevChangeVal=this.get_psValue();},set_psCaption:function set_psCaption(sVal){if(this._eCaption){df.dom.setText(this._eCaption,sVal);if(this.psCaption!==sVal){this.sizeChanged();}}},set_psTextColor:function set_psTextColor(sVal){if(this._eCaption){this._eCaption.style.color=sVal||'';}},set_psToolTip:function set_psToolTip(sVal){df.WebCheckbox.base.set_psToolTip.call(this,sVal);if(this._eFakeBox){this._eFakeBox.title=sVal;}if(this._eCaption){this._eCaption.title=sVal;}},tick:function tick(){if(this._eControl&&this.isEnabled()){this._eControl.checked=!this._eControl.checked;this.fireChange();}},onClick:function onClick(oEvent){this.fireChange();},onFakeClick:function onFakeClick(oEvent){if(this.isEnabled()){this.tick();this.focus();this.fireChange();}}});df.WebEdit=function WebEdit(sName,oParent){df.WebEdit.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbStopOnSubmit",true);this.prop(df.tString,"psPlaceHolder","");this._eWrap=null;this._ePrompt=null;this._sControlClass="WebEdit";};df.defineClass("df.WebEdit","df.WebBaseForm",{openHtml:function openHtml(aHtml){df.WebEdit.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><textarea name="',this._sName,'"',' autocomplete="',df.dom.encodeAttr(this.psAutoComplete),'"',this.peLabelPosition!=df.ciLabelFloat?' placeholder="'+df.dom.encodeAttr(this.psPlaceHolder)+'" ':'',!this.isEnabled()?' disabled="disabled" tabindex="-1"':'','></textarea></div>');},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebFrm_Wrapper textarea");this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");df.WebEdit.base.afterRender.call(this);df.events.addDomKeyListener(this._eElem,this.onKey,this);},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eWrap){this._eWrap.style.background=sVal||'';}},set_psPlaceHolder:function set_psPlaceHolder(sVal){if(this._eControl&&this.peLabelPosition!=df.ciLabelFloat){this._eControl.placeholder=sVal;}},get_pbChanged:function get_pbChanged(){var sComp=this._sOrigValue;if(this.pbChanged){return true;}if(this._eElem){this.updateTypeVal();sComp=sComp.replace(/\r\n|\r/g,'\n');}return sComp!==this.getServerVal();},getVertHeightDiff:function getVertHeightDiff(){var iResult=df.WebEdit.base.getVertHeightDiff.call(this);iResult+=df.sys.gui.getVertBoxDiff(this._eWrap);if(df.sys.isChrome){iResult++;iResult++;}return iResult;},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.formKeys.submit)&&this.pbStopOnSubmit){oEvent.stopPropagation();}else{df.WebEdit.base.onKey.apply(this,arguments);}}});df.tWebComboItem={sValue:df.tString,sDescription:df.tString};df.WebCombo=function WebCombo(sName,oParent){df.WebCombo.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peSortItems",df.csUnsorted);this._bFilled=false;this._sControlClass="WebCombo";this._aValues=null;this._bDeferedSet=false;};df.defineClass("df.WebCombo","df.WebBaseDEO",{openHtml:function openHtml(aHtml){df.WebCombo.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><select name="',this._sName,'" id="',this._sControlId,'"',!this.isEnabled()?' disabled="disabled" tabindex="-1"':'','></select></div>');},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebFrm_Wrapper > select");this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");df.WebCombo.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onClick,this);this.updateList(this.psValue);},deserializeVT:df.sys.vt.generateDeserializer([df.tWebComboItem]),fill:function fill(){var tVT=this._tActionData;this._aValues=this.deserializeVT(tVT);this.sortList();this.updateList(this._sPrevChangeVal);},sortList:function sortList(){var fCompare;if(this.peSortItems===df.csValue){fCompare=df.sys.data.compareFunction(this.peDataType);this._aValues.sort(function(a,b){return fCompare(a.sValue,b.sValue);});}else if(this.peSortItems===df.csDescription){this._aValues.sort(function(a,b){return df.sys.data.compareText(a.sDescription,b.sDescription);});}},updateList:function updateList(sValue){var eOpt,i,aValues=this._aValues;if(this._eControl&&aValues){while(this._eControl.options.length>0){this._eControl.remove(0);}for(i=0;i<aValues.length;i++){eOpt=new Option(aValues[i].sDescription,aValues[i].sValue);this._eControl.options[this._eControl.options.length]=eOpt;if(aValues[i].sValue===sValue){eOpt.selected=true;}}this._bFilled=true;}},getControlValue:function getControlValue(){if(this._eControl&&this._bFilled){return this._eControl.value;}return this.psValue;},setControlValue:function setControlValue(sVal){if(this._eControl&&this._bFilled){this._eControl.value=sVal;this._bDeferedSet=this._eControl.value!==sVal;}else{this._bDeferedSet=true;}},fireChange:function fireChange(){this._bDeferedSet=false;df.WebCombo.base.fireChange.call(this);},set_pbCapslock:function set_pbCapslock(bVal){},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eWrap){this._eWrap.style.background=sVal||'';}},onClick:function onClick(oEvent){this.fireChange();},onKey:function onKey(oEvent){var that=this;df.WebCombo.base.onKey.call(this,oEvent);setTimeout(function(){that.fireChange();},10);}});df.WebBaseSelectionForm=function WebBaseSelectionForm(sName,oParent){df.WebBaseSelectionForm.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbCaseSensitive",false);this.prop(df.tBool,"pbFullText",false);this.prop(df.tInt,"piPageSize",15);this.prop(df.tInt,"piStartAtChar",2);this.prop(df.tInt,"piPopupWidth",0);this.prop(df.tString,"psShowMoreText","Show more...");this.prop(df.tString,"psCreateNewItemText","Create new item");this.prop(df.tBool,"pbSourceIsValidationTable",false);this.prop(df.tInt,"piMinimumItemLength",2);this.prop(df.tBool,"pbAllowCreate",false);this.prop(df.tInt,"piTypeTimeout",20);this.prop(df.tBool,"pbAllData",false);this.prop(df.tBool,"pbSuggestions",false);this.prop(df.tBool,"pbPaged",false);this._eSuggestions=null;this._bForceDisplay=false;this._tRepos=null;this._aSuggestRows=[];this._aShownSuggestions=[];this._oSelectedSuggestion=null;this._iMaxCells=1;this._bFirstFetch=true;this._TotalOfControlRows=0;this._ShowNextHandle=false;this._iPage=0;this._iAdditionalItems=0;this._oPrevItem=null;};df.defineClass("df.WebBaseSelectionForm","df.WebForm",{afterRender:function afterRender(){this._eSuggestions=df.dom.create('<div class="WebBaseSelectionForm WebSuggestions'+(this.psCSSClass.length>0?" "+this.psCSSClass:'')+' WebSug_Hidden"><div class="WebSug_Content"></div></div>');this._eSugContent=df.dom.query(this._eSuggestions,"div.WebSug_Content");this._eSugSuggestions=df.dom.create('<div class="WebSug_Suggestions"></div>');this._eSugControls=df.dom.create('<div class="WebSug_Controls"></div>');this._eSugContent.appendChild(this._eSugSuggestions);this._eSugContent.appendChild(this._eSugControls);this._hInputBox=df.dom.query(this._eElem,".WebFrm_PromptSpacer");this._eControl=this._hInputField=df.dom.query(this._hInputBox,"input");df.WebBaseSelectionForm.base.afterRender.call(this);df.dom.addClass(this._eElem,"WebSelectionForm");document.body.appendChild(this._eSuggestions);df.dom.on("keyup",this._eControl,this.onSuggestKey,this);df.dom.on("click",this._eSuggestions,this.onSuggestClick,this);df.dom.on("click",this._hInputBox,this.inputBoxOnClick,this);df.dom.on("resize",window,this.onWindowResize,this);this.set_pbReadOnly(this.pbReadOnly);this.set_pbEnabled(this.isEnabled());},getSearchValue:function getSearchValue(){if(this.pbReadOnly)return"";return this.pbCapslock?this.getServerVal().toUpperCase():this.getServerVal();},set_pbEnabled:function set_pbEnabled(bVal){df.WebBaseSelectionForm.base.set_pbEnabled.call(this,bVal);if(this._hInputField&&!(this.pbReadOnly&&this.isEnabled())){this._hInputField.contentEditable=bVal;this._hInputField.tabIndex=bVal?0:-1;}},set_pbReadOnly:function set_pbReadOnly(bVal){this.pbReadOnly=bVal;if(this._hInputField&&!(!this.pbReadOnly&&!this.isEnabled())){this._hInputField.contentEditable=!this.pbReadOnly;this._hInputField.tabIndex=!this.pbReadOnly?0:-1;}},encode:function encode(sValue){var htmlEscapes={'<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','/':'&#x2F;'};Object.keys(htmlEscapes).forEach(function(sEscape){sValue=sValue.replaceAll(sEscape,htmlEscapes[sEscape]);});return sValue;},decode:function decode(sValue){var htmlEscapes={'&lt;':'<','&gt;':'>','&quot;':'"','&#x27;':"'",'&#x2F;':'/'};Object.keys(htmlEscapes).forEach(function(sEscape){sValue=sValue.replaceAll(sEscape,htmlEscapes[sEscape]);});return sValue;},inputBoxOnClick:function inputBoxOnClick(oEvent){if(window.getSelection().type!="Range"&&this.isEnabled()){this._hInputField.focus();oEvent.stop();}},suggestSelect:function suggestSelect(){var sValue=this.getSearchValue().trim();if(this._oSelectedSuggestion&&this._oSelectedSuggestion.control){switch(this._oSelectedSuggestion.sRowId){case"more":this.handleMoreButton();this.suggestMove(-1);return;case"create":if(this.isEnabled()&&this.pbAllowCreate&&sValue.length>=this.piMinimumItemLength){this.serverAction("CreateNewByValue",[sValue],null,null);}else{return;}break;}}else if(this.isEnabled()&&this.pbAllowCreate==1&&sValue.length>=this.piMinimumItemLength){this.serverAction("CreateNewByValue",[sValue],null,null);}this._hInputField.value="";this.suggestHide();},handleMoreButton:function handleMoreButton(){if(this._bLastItemOnServer)return;if(!this._bMoreRequested){this._bMoreRequested=true;if(this.pbPaged)this._iPage++;this.suggestLoad();}},onSuggestClick:function onSuggestClick(oEvent){var oElem=oEvent.getTarget();while(oElem.tagName!=="TR"&&oElem.parentNode&&oElem!==this._eSugContent){oElem=oElem.parentNode;}if(oElem.hasAttribute("data-dfrowid")){var oRow=this._aShownSuggestions[parseInt(oElem.getAttribute("data-dfrowid"))];if(oRow){this.suggestHightlight(oRow);this.suggestSelect();this.focus();}}},suggestUpdate:function suggestUpdate(){this.updateTypeVal();var sVal=this.getSearchValue().trim();if(sVal!==this._sSuggestPrevVal||this._bForceDisplay){this._sSuggestPrevVal=sVal;if(sVal.length>=this.piStartAtChar||this._bForceDisplay){if(this._bSuggestVisible){if(this._sSuggestBaseVal){if(sVal.substr(0,this._sSuggestBaseVal.length)==this._sSuggestBaseVal){this.suggestRefine(sVal);return;}}}this.suggestDisplay();this.suggestLoad();}else if(this._bSuggestVisible){this.suggestHide();}}},clientFilter:function clientFilter(aList,callbackOnLoop){var aFiltered=[];var sCurVal=this.getSearchValue();var oRegEx=new RegExp(df.sys.data.escapeRegExp(sCurVal),this.pbCaseSensitive||this.pbCapslock?'':'i');for(var i=0;i<aList.length;i++){if(aList[i].control){aFiltered.push(aList[i]);continue;}for(var x=0;x<aList[i].aValues.length;x++){if(this.pbFullText){if(oRegEx.test(aList[i].aValues[x])){aFiltered.push(aList[i]);if(callbackOnLoop)callbackOnLoop(aList[i]);break;}}else{if(this.pbCaseSensitive||this.pbCapslock){if(aList[i].aValues[x].indexOf(sCurVal)==0){aFiltered.push(aList[i]);if(callbackOnLoop)callbackOnLoop(aList[i]);break;}}else{if(aList[i].aValues[x].toLowerCase().indexOf(sCurVal.toLowerCase())==0){aFiltered.push(aList[i]);if(callbackOnLoop)callbackOnLoop(aList[i]);break;}}}}}return this.extraFilterOnHandle?this.extraFilterOnHandle(aFiltered):aFiltered;},suggestHandle:function suggestHandle(sVal,bLast){var that=this;this._bFirstFetch=false;this._bMoreRequested=false;this._bLastItemOnServer=bLast==1;var aList,sCurVal,bRefine;aList=this._tActionData;this.updateTypeVal();if(this._hInputField)sCurVal=this.getSearchValue();if(sCurVal!==sVal){if(sCurVal.substr(0,sVal)==sVal)bRefine=true;else return;}this._iMaxCells=0;for(var i=0;i<aList.length;i++){if(aList[i].aValues.length>this._iMaxCells)this._iMaxCells++;}this._sSuggestBaseVal=sVal;if(this._iPage>0&&this.pbPaged){this._aSuggestRows=this._aSuggestRows.concat(aList);}else{this._aSuggestRows=aList;}this._oPrevItem=this._aSuggestRows[this._aSuggestRows.length-1];var bFound;var aSelectables=this.clientFilter(this._aSuggestRows,function(tRow){bFound=bFound||that._oSelectedSuggestion&&tRow.aValues[0]==that._oSelectedSuggestion.aValues[0];});if(!bFound)this._oSelectedSuggestion=this._aShownSuggestions.length>0?this._aShownSuggestions[0]:null;this._TotalOfControlRows=this.AddControlSuggestions(aSelectables);var iIndex=-1;if(this._oSelectedSuggestion)iIndex=this.findIndexByValue(this._oSelectedSuggestion.aValues[0],aSelectables);if(iIndex<0){this._oSelectedSuggestion=aSelectables.length>0?aSelectables[0]:null;}else{this._oSelectedSuggestion=aSelectables[iIndex];}if(bRefine)this.suggestRefine(sCurVal);else this.suggestRender(sVal);if(this._ShowNextHandle){this._ShowNextHandle=false;this.showSuggestions();}},AddControlSuggestions:function AddControlSuggestions(aList){var iAdded=aList.length;var sValue=this.getSearchValue().trim();if(!this._bLastItemOnServer&&this.pbPaged&&aList.length>0&&!this.pbAllData)aList.push({control:true,sRowId:"more",aValues:["("+this.psShowMoreText+")"],sCssClassName:"Sugg_ControlSuggestion"});var bShow=true;if(this._aShownSuggestions)bShow=!(this._aShownSuggestions.length>0&&this._aShownSuggestions[0].aValues[0]==sValue);if(bShow&&this.pbAllowCreate&&sValue.length>0)aList.push({control:true,sRowId:"create",aValues:["("+this.psCreateNewItemText+(sValue.length>0?" \""+df.dom.encodeAttr(this.encode(sValue))+"\"":"")+")"],sCssClassName:"Sugg_ControlSuggestion"});return aList.length-iAdded;},suggestRender:function suggestRender(sSearch){if(!this._eSuggestions)return;var sLowerSearch,iLen,sVal,oRegEx;if(this.pbFullText){oRegEx=new RegExp(df.sys.data.escapeRegExp(sSearch),this.pbCaseSensitive||this.pbCapslock?'g':'gi');}else{sLowerSearch=sSearch.toLowerCase();iLen=sSearch.length;}var that=this;function renderSuggestion(iIndex,oSuggestion,aHtml){function makeBold(sMatch){return'<b>'+sMatch+'</b>';}var x=0;aHtml.push('<tr data-dfrowid="',iIndex,'" class="WebSug_Suggestion ',oSuggestion.sCssClassName,that._oSelectedSuggestion&&oSuggestion.aValues[0]==that._oSelectedSuggestion.aValues[0]?' WebSug_Selected':'','">');for(x=0;x<oSuggestion.aValues.length;x++){sVal=that.encode(oSuggestion.aValues[x]);aHtml.push('<td>');if(oSuggestion.control){aHtml.push(sVal);}else{if(!that.pbSourceIsValidationTable||x==0){if(that.pbFullText){aHtml.push(sVal.replace(oRegEx,makeBold));}else{if(sVal.length>0&&sVal.substr(0,iLen).toLowerCase()==sLowerSearch){aHtml.push('<b>',sVal.substr(0,iLen),'</b>',sVal.substr(iLen));}else{aHtml.push(sVal);}}}else{aHtml.push(sVal);}}aHtml.push('</td>');}while(x++<that._iMaxCells){aHtml.push('<td></td>');}aHtml.push('</tr>');}var aControls=[];this._aShownSuggestions=this.clientFilter(this._aSuggestRows);this._TotalOfControlRows=this.AddControlSuggestions(this._aShownSuggestions);var aSuggestionsTable=[];aSuggestionsTable.push('<table>');var iMaxLength=this.pbSuggestions?this._aShownSuggestions.length<this.piPageSize?this._aShownSuggestions.length:this.piPageSize:this._aShownSuggestions.length;for(var i=0;i<iMaxLength;i++){if(this._aShownSuggestions[i].control){aControls.push({iIndex:i,oObj:this._aShownSuggestions[i]});continue;}renderSuggestion(i,this._aShownSuggestions[i],aSuggestionsTable);}aSuggestionsTable.push('</table>');var aControlsTable=[];aControlsTable.push('<table>');for(var _i2=0;_i2<this._TotalOfControlRows;_i2++){renderSuggestion(aControls[_i2].iIndex,aControls[_i2].oObj,aControlsTable);}aControlsTable.push('</table>');this._eSugSuggestions.innerHTML=aSuggestionsTable.join("");this._eSugControls.innerHTML=aControlsTable.join("");this.suggestPosition();},suggestRefine:function suggestRefine(sFilter){var that=this,bFound=false;this._aShownSuggestions=this.clientFilter(this._aSuggestRows,function(tRow){bFound=bFound||that._oSelectedSuggestion&&tRow.aValues[0]==that._oSelectedSuggestion.aValues[0];});if(!bFound)this._oSelectedSuggestion=this._aShownSuggestions.length>0?this._aShownSuggestions[0]:null;this.suggestRender(sFilter);if(this._bSuggestVisible)this.suggestDisplay();this.afterSuggestRefine();},afterSuggestRefine:function afterSuggestRefine(sFilter){if(this._aShownSuggestions.length-this._TotalOfControlRows<this.piPageSize&&!this._bLastItemOnServer&&this.pbPaged){this.handleMoreButton();}},suggestMove:function suggestMove(iDir){var i,aList=this._aShownSuggestions=this.clientFilter(this._aSuggestRows);this._TotalOfControlRows=this.AddControlSuggestions(aList);if(this._oSelectedSuggestion){i=this.findIndexByValue(this._oSelectedSuggestion.aValues[0],aList)+iDir;if(i>=aList.length)i=0;else if(i<0)i=aList.length-1;this.suggestHightlight(aList[i]);}else this.suggestHightlight(aList.length>0?aList[0]:null);},suggestHightlight:function suggestHightlight(oSelectedSuggestion){var eElem,iTop,iBottom,bFound;this._oSelectedSuggestion=oSelectedSuggestion;this._aShownSuggestions=this.clientFilter(this._aSuggestRows);this._TotalOfControlRows=this.AddControlSuggestions(this._aShownSuggestions);for(var i=0;i<this._aShownSuggestions.length;i++){bFound=this._oSelectedSuggestion&&this._aShownSuggestions[i].aValues[0]==this._oSelectedSuggestion.aValues[0];if(bFound)break;}if(!bFound)this._oSelectedSuggestion=this._aShownSuggestions.length>0?this._aShownSuggestions[0]:null;this.updateTypeVal();this.suggestRender(this.getSearchValue());eElem=df.dom.query(this._eSugSuggestions,"tr.WebSug_Selected");if(eElem){iTop=df.sys.gui.getAbsoluteOffset(eElem).top;iBottom=iTop+eElem.offsetHeight;if(iTop-this._eSugSuggestions.scrollTop<0){this._eSugSuggestions.scrollTop=iTop;}else if(iBottom>this._eSugSuggestions.clientHeight+this._eSugSuggestions.scrollTop){this._eSugSuggestions.scrollTop=iBottom-this._eSugSuggestions.clientHeight;}}},findSuggestionByValue:function findSuggestionByValue(sValue){var iIndex=this.findIndexByValue(sValue,this._aSuggestRows);return iIndex!=-1?this._aSuggestRows[iIndex]:null;},findIndexByValue:function findIndexByValue(sValue,aList){for(var i=0;i<aList.length;i++){if(aList[i].aValues[0]==sValue)return i;}return-1;},onSuggestKey:function onSuggestKey(oEvent){var oKeys=df.settings.suggestionKeys,iKey=oEvent.getKeyCode();if(oEvent.matchKey(oKeys.forceDisplay)){this._bForceDisplay=true;if(!this._bSuggestVisible){this.suggestDisplay();}oEvent.stop();}if(this._bSuggestVisible||this.getSearchValue().length>0){this.suggestUpdate();}else{if(!oEvent.isSpecialKey()&&(iKey<112||iKey>127)){this.suggestUpdate();}}this._bForceDisplay=false;},suggestLoad:function suggestLoad(overrideDoLoad){var that=this;if(overrideDoLoad){this._overrideDoLoad=overrideDoLoad;}df.dom.addClass(this._eSuggestions,"WebSug_Loading");if(this._eElem)df.dom.addClass(this._eElem,"WebSug_Loading");if(!this._tSuggestUpdate){this._tSuggestUpdate=setTimeout(function(){that._tSuggestUpdate=null;that.updateTypeVal();that.suggestDoLoad(that.getSearchValue());if(that._bSuggestVisible)that.suggestDisplay();},this.piTypeTimeout);}},suggestDoLoad:function suggestDoLoad(sVal){if(!this.pbAllData||this._aSuggestRows.length===0||this._overrideDoLoad){this._overrideDoLoad=false;if(!this._bSuggestLoading&&this.isEnabled()){this._bSuggestLoading=true;this.serverAction("FindSuggestions",[sVal,this._iPage,this._iAdditionalItems],this._oPrevItem,function(){this._bSuggestLoading=false;if(this._sSuggestNextLoad){this.suggestDoLoad(this._sSuggestNextLoad);this._sSuggestNextLoad=null;}else{if(this._eSuggestions)df.dom.removeClass(this._eSuggestions,"WebSug_Loading");if(this._eElem)df.dom.removeClass(this._eElem,"WebSug_Loading");if(this._bSuggestVisible)this.suggestDisplay();}},this);}else this._sSuggestNextLoad=sVal;}else this.suggestHightlight(this._oSelectedSuggestion);},suggestDisplay:function suggestDisplay(){var hSuggestionsBody=df.dom.query(this._eSugSuggestions,"tbody");var hControlsBody=df.dom.query(this._eSugControls,"tbody");if(hSuggestionsBody){if(hSuggestionsBody.childNodes.length==0&&hControlsBody.childNodes.length==0){this.suggestHide();return;}}else if(!this._bFirstFetch){var bReturn=true;if(hControlsBody){if(hControlsBody.childNodes.length>0)bReturn=false;}if(bReturn){this.suggestHide();this._ShowNextHandle=true;return;}}if(this.isEnabled()){df.dom.addClass(this._eSuggestions,"WebSug_Visible");df.dom.removeClass(this._eSuggestions,"WebSug_Hidden");var iHeight=0;if(hSuggestionsBody){var iMax=hSuggestionsBody.childNodes.length>this.piPageSize?this.piPageSize:hSuggestionsBody.childNodes.length;if(iMax>0){var oBounds=df.sys.gui.getBoundRect(hSuggestionsBody.childNodes[0]);iHeight=oBounds.height*iMax;}else{var _bReturn=true;if(hControlsBody){if(hControlsBody.childNodes.length>0)_bReturn=false;}if(_bReturn){this.suggestHide();return;}}}this._eSugSuggestions.style.height=iHeight+"px";this.suggestPosition();this.suggestHightlight(this._oSelectedSuggestion);this._bSuggestVisible=true;}},suggestPosition:function suggestPosition(){var oRect,eSugg,eTarget,iOffsetTop,iOffsetLeft;eSugg=this._eSuggestions;eTarget=this._eWrap;if(eSugg&&eTarget){if(df.sys.gui.isOnScreen(eTarget)){eSugg.style.display="";oRect=df.sys.gui.getBoundRect(eTarget);iOffsetTop=oRect.bottom;iOffsetLeft=oRect.left;eSugg.style.top=iOffsetTop+"px";eSugg.style.left=iOffsetLeft+"px";eSugg.style.width=(this.piPopupWidth>0?this.piPopupWidth:oRect.width)+"px";if(oRect.bottom+this._eSugSuggestions.clientHeight>window.innerHeight)eSugg.style.top=oRect.top-this._eSuggestions.clientHeight+"px";}else eSugg.style.display="none";}},suggestHide:function suggestHide(){if(this._eSuggestions){df.dom.addClass(this._eSuggestions,"WebSug_Hidden");df.dom.removeClass(this._eSuggestions,"WebSug_Visible");if(this._tSuggestDisplay){clearTimeout(this._tSuggestDisplay);this._tSuggestDisplay=null;}if(this._tSuggestUpdate){clearTimeout(this._tSuggestUpdate);this._tSuggestUpdate=null;}this._oSelectedSuggestion=null;}this.updateTypeVal();this._sSuggestPrevVal=this.getSearchValue();this._bSuggestVisible=false;this._bForceDisplay=false;},showSuggestions:function showSuggestions(){this._bForceDisplay=true;this.suggestDisplay();this.suggestUpdate();this.focus();},onKey:function onKey(oEvent){if(!this.isEnabled()){oEvent.stop();return;}var oKeys=df.settings.suggestionKeys;if(!oEvent.bCanceled)df.WebBaseSelectionForm.base.onKey.call(this,oEvent);if(!oEvent.bCanceled){if(oEvent.matchKey(oKeys.escape)&&this._bSuggestVisible){this.suggestHide();}else if(oEvent.matchKey(oKeys.select)){this.suggestSelect();oEvent.stop();}else if(oEvent.matchKey(oKeys.moveUp)){if(!this._bSuggestVisible)this.showSuggestions();this.suggestMove(-1);oEvent.stop();}else if(oEvent.matchKey(oKeys.moveDown)){if(!this._bSuggestVisible)this.showSuggestions();this.suggestMove(1);oEvent.stop();}else{this._iPage=0;this._bLastItemOnServer=false;if(oEvent.matchKey(oKeys.backSpace)&&this.getSearchValue().length<=1){this.suggestLoad();}}if(oEvent.matchKey(oKeys.forceDisplay)){oEvent.stop();}}},onWindowResize:function onWindowResize(oEvent){var that=this;if(!this._tRepos){setTimeout(function(){if(that._bSuggestVisible)that.suggestPosition();that._tRepos=null;},40);}if(this._bSuggestVisible)this.suggestPosition();},onBlur:function onBlur(oEvent){var that=this;df.WebBaseSelectionForm.base.onBlur.call(this,oEvent);if(this._tSugBlurTimeout){clearTimeout(this._tSugBlurTimeout);this._tSugBlurTimeout=null;}this._tSugBlurTimeout=setTimeout(function(){if(!that._bHasFocus){that.suggestHide();}if(that.afterBlur)that.afterBlur();},500);},onPromptClick:function onPromptClick(oEvent){if(this.isEnabled()){this.objFocus();if(this.firePrompt()){oEvent.stopPropagation();}else{this.focus();if(!this._bSuggestVisible)this.showSuggestions();else this.suggestHide();}}}});df.WebSuggestionForm=function WebSuggestionForm(sName,oParent){df.WebSuggestionForm.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psPopupCSSClass","");this.prop(df.tInt,"peSuggestionMode",df.smFind);this.prop(df.tBool,"pbCaseSensitive",false);this.prop(df.tBool,"pbAllowForce",true);this.prop(df.tBool,"pbFullText",false);this.prop(df.tBool,"pbHighlight",true);this.prop(df.tBool,"pbShowResults",true);this.prop(df.tInt,"piMaxResults",15);this.prop(df.tInt,"piStartAtChar",2);this.prop(df.tInt,"piSuggestionWidth",0);this.prop(df.tBool,"pbClientRefinement",true);this.prop(df.tInt,"piPopupTimeout",50);this.prop(df.tInt,"piTypeTimeout",20);this.event("OnHideSuggestions",df.cCallModeDefault);this._eSuggestions=null;this._bForceDisplay=false;this._tRepos=null;this._aScrollListeners=null;this._sSelectedId=null;};df.defineClass("df.WebSuggestionForm","df.WebForm",{openHtml:function openHtml(aHtml){df.WebSuggestionForm.base.openHtml.call(this,aHtml);},afterRender:function afterRender(){df.WebSuggestionForm.base.afterRender.call(this);df.dom.on("keyup",this._eControl,this.onSuggestKey,this);},initDOM:function initDOM(){var eViewPort;this._eSuggestions=df.dom.create('<div class="WebSuggestions WebSug_Hidden '+this.psPopupCSSClass+'"><div class="WebSug_Content"></div><div>');this._eSugContent=df.dom.query(this._eSuggestions,"div.WebSug_Content");eViewPort=document.body;eViewPort.appendChild(this._eSuggestions);df.dom.on("click",this._eSuggestions,this.onSuggestClick,this);},suggestUpdate:function suggestUpdate(){var that=this,sVal;this.updateTypeVal();sVal=this.getServerVal();if(sVal!==this._sSuggestPrevVal||this._bForceDisplay){this._sSuggestPrevVal=sVal;if(sVal.length>=this.piStartAtChar||this._bForceDisplay){if(this._bSuggestVisible){if(this.pbClientRefinement&&this._sSuggestBaseVal){if(sVal.substr(0,this._sSuggestBaseVal.length)===this._sSuggestBaseVal){this.suggestRefine(sVal);return;}}}else{if(!this._tSuggestDisplay){this._tSuggestDisplay=setTimeout(function(){that._tSuggestDisplay=null;that.suggestDisplay();},this.piPopupTimeout);}}this.suggestLoad();}else if(this._bSuggestVisible){this.suggestHide();}}},suggestLoad:function suggestLoad(){var that=this;if(this.pbShowResults){if(!this._eSuggestions){this.initDOM();}df.dom.addClass(this._eSuggestions,"WebSug_Loading");}if(this._eElem){df.dom.addClass(this._eElem,"WebSug_Loading");}if(!this._tSuggestUpdate){this._tSuggestUpdate=setTimeout(function(){that._tSuggestUpdate=null;that.updateTypeVal();that.suggestDoLoad(that.getServerVal());},this.piTypeTimeout);}},suggestDoLoad:function suggestDoLoad(sVal){if(!this._bSuggestLoading){this._bSuggestLoading=true;this.serverAction("FindSuggestions",[sVal],null,function(){this._bSuggestLoading=false;if(this._sSuggestNextLoad){this.suggestDoLoad(this._sSuggestNextLoad);this._sSuggestNextLoad=null;}else{if(this._eSuggestions){df.dom.removeClass(this._eSuggestions,"WebSug_Loading");}if(this._eElem){df.dom.removeClass(this._eElem,"WebSug_Loading");}}},this);}else{this._sSuggestNextLoad=sVal;}},suggestHandle:function suggestHandle(sVal){var aList,i,sCurVal,bFound=false,bRefine;aList=this._tActionData;this.updateTypeVal();sCurVal=this.getServerVal();if(sCurVal!==sVal){if(this.pbClientRefinement&&sCurVal.substr(0,sVal)===sVal){bRefine=true;}else{return;}}this._sSuggestBaseVal=sVal;this._aSuggestBase=this._aSuggestRows=aList;for(i=0;i<aList.length;i++){if(aList[i].sRowId===this._sSelectedId){bFound=true;}}if(!bFound){this._sSelectedId=aList.length>0?aList[0].sRowId:null;}if(bRefine){this.suggestRefine(sCurVal);}else{this.suggestRender(sVal);}},suggestDisplay:function suggestDisplay(){if(this.isEnabled()){if(this.pbShowResults){if(!this._eSuggestions){this.initDOM();}if(!this._aSuggestRows){this._eSugContent.innerHTML="";}this.suggestPosition();df.dom.addClass(this._eSuggestions,"WebSug_Visible");df.dom.removeClass(this._eSuggestions,"WebSug_Hidden");this.suggestPosition();df.dom.on("resize",window,this.onWindowResize,this);this._aScrollListeners=df.sys.gui.addScrollListeners(this._eWrap,this.onWindowResize,this);}this._bSuggestVisible=true;}},suggestPosition:function suggestPosition(){var oRect,eSugg,eTarget,iOffsetTop,iOffsetLeft;eSugg=this._eSuggestions;eTarget=this._eWrap;if(eSugg&&eTarget){if(df.sys.gui.isOnScreen(eTarget)){eSugg.style.display="";oRect=df.sys.gui.getBoundRect(eTarget);iOffsetTop=oRect.bottom;iOffsetLeft=oRect.left;eSugg.style.top=iOffsetTop+"px";eSugg.style.left=iOffsetLeft+"px";eSugg.style.width=(this.piSuggestionWidth>0?this.piSuggestionWidth:oRect.width)+"px";if(oRect.bottom+this._eSugContent.clientHeight>window.innerHeight){this._eSuggestions.style.bottom="0px";}else{this._eSuggestions.style.bottom="";}}else{eSugg.style.display="none";}}},suggestHide:function suggestHide(){if(this._eSuggestions){df.dom.addClass(this._eSuggestions,"WebSug_Hidden");df.dom.removeClass(this._eSuggestions,"WebSug_Visible");if(this._tSuggestDisplay){clearTimeout(this._tSuggestDisplay);this._tSuggestDisplay=null;}if(this._tSuggestUpdate){clearTimeout(this._tSuggestUpdate);this._tSuggestUpdate=null;}this.updateTypeVal();this._sSuggestPrevVal=this.getServerVal();df.dom.off("resize",window,this.onWindowResize,this);if(this._aScrollListeners){df.sys.gui.removeScrollListeners(this._aScrollListeners);}this._aSuggestRows=null;this._sSelectedId=null;}this.fire("OnHideSuggestions",[]);this._bSuggestVisible=false;this._bForceDisplay=false;},suggestRender:function suggestRender(sSearch){var aHtml=[],aList=this._aSuggestRows,i,x,sLowerSearch,iLen,sVal,oRegEx;function makeBold(sMatch){return'<b>'+sMatch+'</b>';}if(this._eSuggestions){if(this.pbHighlight){if(this.pbFullText){oRegEx=new RegExp(df.sys.data.escapeRegExp(sSearch),this.pbCaseSensitive?'g':'gi');}else{sLowerSearch=sSearch.toLowerCase();iLen=sSearch.length;}}aHtml.push('<table>');for(i=0;i<aList.length;i++){aHtml.push('<tr data-suggestnr="',i,'" class="WebSug_Suggestion ',aList[i].sRowId===this._sSelectedId?'WebSug_Selected':'','">');for(x=0;x<aList[i].aValues.length;x++){sVal=aList[i].aValues[x];aHtml.push('<td>');if(this.pbHighlight&&(this.peSuggestionMode!==df.smValidationTable||x===0)){if(this.pbFullText){aHtml.push(sVal.replace(oRegEx,makeBold));}else{if(sVal.substr(0,iLen).toLowerCase()===sLowerSearch){aHtml.push('<b>',sVal.substr(0,iLen),'</b>',sVal.substr(iLen));}else{aHtml.push(sVal);}}}else{aHtml.push(sVal);}aHtml.push('</td>');}aHtml.push('</tr>');}aHtml.push('</table>');this._eSugContent.innerHTML=aHtml.join("");this.suggestPosition();}},suggestRefine:function suggestRefine(sSearch){var i,x,aList=[],aBase=this._aSuggestBase,sLowVal,iLen,bServer=true,bFound=false,oRegEx;if(this.pbFullText){oRegEx=new RegExp(df.sys.data.escapeRegExp(sSearch),this.pbCaseSensitive?'':'i');for(i=0;i<aBase.length;i++){for(x=0;x<(this.peSuggestionMode!==df.smValidationTable?aBase[i].aValues.length:1);x++){if(oRegEx.test(aBase[i].aValues[x])){aList.push(aBase[i]);bFound=bFound||aBase[i].sRowId===this._sSelectedId;break;}}}this._aSuggestRows=aList;this.suggestRender(sSearch);if(aBase.length>=this.piMaxResults&&aList.length<this.piMaxResults){this.suggestLoad();}}else{sLowVal=sSearch.toLowerCase();iLen=sSearch.length;for(i=0;i<aBase.length;i++){if(!this.pbCaseSensitive&&aBase[i].aValues[0].substr(0,iLen).toLowerCase()===sLowVal||this.pbCaseSensitive&&aBase[i].aValues[0].substr(0,iLen)===sSearch){aList.push(aBase[i]);bFound=bFound||aBase[i].sRowId===this._sSelectedId;}else if(aList.length>0){bServer=this.peDataType===df.ciTypeBCD;}}this._aSuggestRows=aList;if(!bFound){this._sSelectedId=aList.length>0?aList[0].sRowId:null;}this.suggestRender(sSearch);if(aBase.length>=this.piMaxResults&&bServer&&sSearch!==this._sSuggestBaseVal){this.suggestLoad();}}},suggestSelect:function suggestSelect(){var i,aList=this._aSuggestRows,tRow=null;if(this._sSelectedId){for(i=0;i<aList.length;i++){if(aList[i].sRowId===this._sSelectedId){tRow=aList[i];break;}}if(tRow){this.updateTypeVal();this.serverAction("SelectSuggestion",[this.getServerVal()],[tRow],function(oEvent){this.suggestHide();});}}},suggestMove:function suggestMove(iDir){var i,aList=this._aSuggestRows;if(this._sSelectedId){for(i=0;i<aList.length;i++){if(aList[i].sRowId===this._sSelectedId){break;}}i=i+iDir;i=i>=0?i<aList.length?i:aList.length-1:0;this.suggestHightlight(aList[i].sRowId);}else{this.suggestHightlight(aList.length>0?aList[0].sRowId:null);}},suggestHightlight:function suggestHightlight(sId){var eElem,iTop,iBottom;this._sSelectedId=sId;this.updateTypeVal();this.suggestRender(this.getServerVal());eElem=df.dom.query(this._eSugContent,"tr.WebSug_Selected");if(eElem){iTop=df.sys.gui.getAbsoluteOffset(eElem).top;iBottom=iTop+eElem.offsetHeight;if(iTop-this._eSuggestions.scrollTop<0){this._eSuggestions.scrollTop=iTop;}else if(iBottom>this._eSuggestions.clientHeight+this._eSuggestions.scrollTop){this._eSuggestions.scrollTop=iBottom-this._eSuggestions.clientHeight;}}},onSuggestClick:function onSuggestClick(oEvent){var iRow,eElem=oEvent.getTarget();while(eElem.tagName!=="TR"&&eElem.parentNode&&eElem!==this._eSugContent){eElem=eElem.parentNode;}if(eElem.hasAttribute("data-suggestnr")){iRow=parseInt(eElem.getAttribute("data-suggestnr"),10);if(this._aSuggestRows[iRow]){this.suggestHightlight(this._aSuggestRows[iRow].sRowId);this.suggestSelect();this.focus();}}},showSuggestions:function showSuggestions(){this._bForceDisplay=true;if(!this._bSuggestVisible){this.suggestDisplay();}this.suggestUpdate();this.focus();},onKey:function onKey(oEvent){var oKeys=df.settings.suggestionKeys;df.WebSuggestionForm.base.onKey.call(this,oEvent);if(!oEvent.bCanceled){if(this._bSuggestVisible&&this.pbShowResults){if(oEvent.matchKey(oKeys.escape)){this.suggestHide();}else if(oEvent.matchKey(oKeys.select)){this.suggestSelect();oEvent.stop();}else if(oEvent.matchKey(oKeys.moveUp)){this.suggestMove(-1);oEvent.stop();}else if(oEvent.matchKey(oKeys.moveDown)){this.suggestMove(1);oEvent.stop();}}if(oEvent.matchKey(oKeys.forceDisplay)&&this.pbAllowForce){oEvent.stop();}}},onSuggestKey:function onSuggestKey(oEvent){var oKeys=df.settings.suggestionKeys,iKey=oEvent.getKeyCode();if(oEvent.matchKey(oKeys.forceDisplay)&&this.pbAllowForce){this._bForceDisplay=true;if(!this._bSuggestVisible){this.suggestDisplay();}oEvent.stop();}if(this._bSuggestVisible){this.suggestUpdate();}else{if(!oEvent.isSpecialKey()&&(iKey<112||iKey>127)){this.suggestUpdate();}}this._bForceDisplay=false;},onWindowResize:function onWindowResize(oEvent){var that=this;if(!this._tRepos){setTimeout(function(){that.suggestPosition();that._tRepos=null;},40);}this.suggestPosition();},onBlur:function onBlur(oEvent){var that=this;df.WebSuggestionForm.base.onBlur.call(this,oEvent);if(this._tSugBlurTimeout){clearTimeout(this._tSugBlurTimeout);this._tSugBlurTimeout=null;}this._tSugBlurTimeout=setTimeout(function(){if(!that._bHasFocus){that.suggestHide();}},500);},set_psPopupCSSClass:function set_psPopupCSSClass(sVal){if(this._eSuggestions){this._eSuggestions.className="WebSuggestions "+(this._bSuggestVisible?"WebSug_Visible":"WebSug_Hidden")+sVal;}}});df.WebSelectionForm=function WebSelectionForm(sName,oParent){df.WebSelectionForm.base.constructor.call(this,sName,oParent);this.event("OnSelect",df.cCallModeDefault,"privateOnSelect");};df.defineClass("df.WebSelectionForm","df.WebBaseSelectionForm",{openHtml:function openHtml(aHtml){df.WebSelectionForm.base.openHtml.call(this,aHtml);},afterRender:function afterRender(){df.WebSelectionForm.base.afterRender.call(this);},suggestSelect:function suggestSelect(){if(this._oSelectedSuggestion&&!this._oSelectedSuggestion.control){var tRow=this.findSuggestionByValue(this._oSelectedSuggestion.aValues[0]);if(tRow){this.set_psValue(tRow.aValues[0]);this.fireEx({sEvent:"OnSelect",tActionData:[tRow],oEnv:this});this.suggestHide();return;}}df.WebTagsForm.base.suggestSelect.call(this);}});df.WebTagsForm=function WebTagsForm(sName,oParent){df.WebTagsForm.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piTagTruncateAt",60);this.prop(df.tBool,"pbTagOnSpace",false);this.prop(df.tBool,"pbAllowTagSelection",true);this.prop(df.tString,"psSeparator",",");this.event("OnTagClick",df.cCallModeDefault,"privateOnTagClick");this.event("OnAddTag",df.cCallModeDefault,"privateOnAddTag");this.event("OnRemoveTag",df.cCallModeDefault,"privateOnRemoveTag");this._aSelectedSuggestions=[];this._sSelectedTag=null;this._oSelectedTag=null;this._aTagCssClass={};};df.defineClass("df.WebTagsForm","df.WebBaseSelectionForm",{openHtml:function openHtml(aHtml){df.WebForm.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><div class="WebFrm_PromptSpacer">','<span class="WebDynFrm WebTgf_Placeholder">',this.peLabelPosition!=df.ciLabelFloat?df.dom.encodeAttr(this.encode(this.psPlaceHolder)):'','</span>','<span class="WebDynFrm WebTgfInput" name="',this._sName,'" id="',this._sControlId,'" role="textbox" tabindex="0"',' contenteditable="true"></span>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div><span class="WebFrm_Prompt"></span></div>');df.WebForm.base.closeHtml.call(this,aHtml);},setPlaceHolderVisibility:function setPlaceHolderVisibility(bVisible){this.setVisibility(this._hPlaceHolder,bVisible);},setInputVisibility:function setInputVisibility(bVisible){this.setVisibility(this._hInputField,bVisible);},setVisibility:function setVisibility(hElem,bVisible){hElem.style.display=!bVisible?"none":"";},getVisibility:function getVisibility(hElem){return hElem.style.display!="none";},focusInputField:function focusInputField(){if(this.pbReadOnly||!this.isEnabled()){return;}if(this._aSelectedSuggestions.length===0||this.getVisibility(this._hPlaceHolder)){this.setPlaceHolderVisibility(false);}var that=this;if(!this._tFocus){this._tFocus=setTimeout(function(){if(!that._tFocus)return;that._hInputField.focus();that._tFocus=null;},1);}},blurInputField:function blurInputField(){this._tFocus=null;if(this._hInputField.value.length===0&&this._aSelectedSuggestions.length===0||this.getVisibility(this._hPlaceHolder)){this.setPlaceHolderVisibility(true);}},afterRender:function afterRender(){this._eSuggestions=df.dom.create('<div class="WebBaseSelectionForm WebSuggestions'+(this.psCSSClass.length>0?" "+this.psCSSClass:'')+' WebSug_Hidden"><div class="WebSug_Content"></div></div>');this._eSugContent=df.dom.query(this._eSuggestions,"div.WebSug_Content");this._eSugSuggestions=df.dom.create('<div class="WebSug_Suggestions"></div>');this._eSugControls=df.dom.create('<div class="WebSug_Controls"></div>');this._eSugContent.appendChild(this._eSugSuggestions);this._eSugContent.appendChild(this._eSugControls);this._hInputBox=df.dom.query(this._eElem,".WebFrm_PromptSpacer");this._hPlaceHolder=df.dom.query(this._eElem,".WebTgf_Placeholder");var that=this;this._eControl=this._hInputField=df.dom.query(this._hInputBox,".WebTgfInput");Object.defineProperty(this._hInputField,"value",{get:function get(){return that._hInputField.innerText;},set:function set(val){that._hInputField.innerText=val;}});Object.defineProperty(this._hInputField,"keypress",{get:function get(){return that._hInputField.keydown;},set:function set(val){that._hInputField.keydown=val;}});this._hInputField.select=function(){that._hInputField.focus();};df.dom.on("focusin",this._hInputBox,this.focusInputField,this);df.dom.on("click",this._hInputBox,this.focusInputField,this);df.dom.on("blur",this._hInputField,this.blurInputField,this);this.blurInputField();this._ePrompt=df.dom.query(this._eElem,"div.WebFrm_Wrapper span.WebFrm_Prompt");this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");df.WebForm.base.afterRender.call(this);df.dom.on("click",this._ePrompt,this.onPromptClick,this);this.set_pbPromptButton(this.pbPromptButton);df.dom.addClass(this._eElem,"WebSelectionForm");document.body.appendChild(this._eSuggestions);df.dom.on("keyup",this._eControl,this.onSuggestKey,this);df.dom.on("click",this._eSuggestions,this.onSuggestClick,this);df.dom.on("click",this._hInputBox,this.inputBoxOnClick,this);df.dom.on("resize",window,this.onWindowResize,this);df.dom.addClass(this._eElem,"WebTagsForm");if(this.aSelectionCache)this.setCachedTags();df.dom.on("click",this._hInputBox,this.removeTagSelection,this);this.set_pbReadOnly(this.pbReadOnly);this.set_pbEnabled(this.isEnabled());this.validateAsSeparator(this.psSeparator);this.dragDropInit();},set_pbEnabled:function set_pbEnabled(bVal){var bChanged=bVal!==this.isEnabled();df.WebTagsForm.base.set_pbEnabled.call(this,bVal);if(bChanged)this.setControlValue(this.getControlValue());},validateAsSeparator:function validateAsSeparator(sVal){if(sVal.length!==1){throw new df.Error(871,"Invalid psSeparator; requires length of just one character.");}return true;},set_psSeparator:function set_psSeparator(sVal){if(sVal!==this.psSeparator&&this.validateAsSeparator(sVal)){this.psSeparator=sVal;}},set_pbReadOnly:function set_pbReadOnly(bVal){var bChanged=bVal!==this.pbReadOnly;df.WebTagsForm.base.set_pbReadOnly.call(this,bVal);if(bChanged)this.setControlValue(this.getControlValue());},removeTagSelection:function removeTagSelection(){if(this._sSelectedTag||this._oSelectedTag){df.dom.removeClass(this._oSelectedTag,"WebTgf_Focus");this._sSelectedTag=null;this._oSelectedTag=null;}},setTagSelection:function setTagSelection(tRow){this.removeTagSelection();this._sSelectedTag=tRow;this._oSelectedTag=df.dom.query(this._hInputBox,".WebTgf_Tag[data-dfrowid='"+this._sSelectedTag.aValues[0].replaceAll("'","\\'")+"']");df.dom.addClass(this._oSelectedTag,"WebTgf_Focus");},getSearchValue:function getSearchValue(){var sValue=this._hInputField.value;return this.pbCapslock?sValue.toUpperCase():sValue;},getControlValue:function getControlValue(){var aData=[];var sEscapedSeperator="\\"+this.psSeparator;for(var i=0;i<this._aSelectedSuggestions.length;i++){if(!this._aSelectedSuggestions[i].control){aData.push(this._aSelectedSuggestions[i].aValues[0].replaceAll(this.psSeparator,sEscapedSeperator));}}return aData.join(this.psSeparator);},setControlValue:function setControlValue(sVal){this.aSelectionCache=[];var iIndex=-1,iLastIndex=-1,iBegin=0;while((iIndex=sVal.indexOf(this.psSeparator,iLastIndex+1))>=0){var bEven=true;var j=iIndex;while(--j>=0&&sVal.charAt(j)==='\\'){bEven=!bEven;}if(bEven){var _sValue=sVal.substr(iBegin,iIndex-iBegin);_sValue=_sValue.replaceAll("\\"+this.psSeparator,this.psSeparator).trim();if(_sValue.length>0){this.aSelectionCache.push(_sValue);iBegin=iIndex+1;}}iLastIndex=iIndex;}var sValue=sVal.substr(iBegin,sVal.length-iBegin);sValue=sValue.replaceAll("\\"+this.psSeparator,this.psSeparator).trim();if(sValue.length>0)this.aSelectionCache.push(sValue);if(this._hInputBox)this.setCachedTags();},suggestHandle:function suggestHandle(sVal,bLast){df.WebTagsForm.base.suggestHandle.call(this,sVal,bLast);if(this._aSuggestRows.length-this._aSelectedSuggestions.length<this.piPageSize&&!this._bLastItemOnServer&&this.pbPaged){this.handleMoreButton();}},AddControlSuggestions:function AddControlSuggestions(aList){var iAdded=aList.length;var sValue=this.getSearchValue().trim();if(!this._bLastItemOnServer&&this.pbPaged&&aList.length>0&&!this.pbAllData)aList.push({control:true,sRowId:"more",aValues:["("+this.psShowMoreText+")"],sCssClassName:"Sugg_ControlSuggestion"});var bShow=true;if(this._aShownSuggestions)bShow=!(this._aShownSuggestions.length>0&&this._aShownSuggestions[0].aValues[0]==sValue);if(bShow)bShow=this.getSelectedSuggestionId(sValue)<0;if(bShow&&this.pbAllowCreate&&sValue.length>0)aList.push({control:true,sRowId:"create",aValues:["("+this.psCreateNewItemText+(sValue.length>0?" '"+sValue+"'":"")+")"],sCssClassName:"Sugg_ControlSuggestion"});return aList.length-iAdded;},afterSuggestRefine:function afterSuggestRefine(sFilter){if(this._aShownSuggestions.length-this._TotalOfControlRows-this._aSelectedSuggestions.length<this.piPageSize&&!this._bLastItemOnServer&&this.pbPaged){this.handleMoreButton();}},setCachedTags:function setCachedTags(){this.clearTags();for(var i=0;i<this.aSelectionCache.length;i++){this.addTag({sRowId:i.toString(),aValues:[this.aSelectionCache[i]],sCssClassName:""});}this.setPlaceHolderVisibility(this._hInputField.value.length===0&&this.aSelectionCache.length==0);this.updateTypeVal();},truncate:function truncate(sValue,iMaximumLength,bUseBoundary){if(sValue.length<=iMaximumLength)return sValue;if(iMaximumLength==0)return sValue;var subString=sValue.substr(0,iMaximumLength);return(bUseBoundary&&subString.lastIndexOf(" ")!=-1?subString.substr(0,subString.lastIndexOf(" ")):subString)+"&hellip;";},setTagCssClass:function setTagCssClass(sTag,sCssClass){this._aTagCssClass[sTag]=" "+sCssClass.trim();this.updateTypeVal();this.refreshDisplay(this._tValue);},suggestSelect:function suggestSelect(){if(this._oSelectedSuggestion&&!this._oSelectedSuggestion.control){var tRow=this.findSuggestionByValue(this._oSelectedSuggestion.aValues[0]);if(tRow){this.fireEx({sEvent:"OnAddTag",tActionData:tRow,oEnv:this});this.addTag(tRow);this.updateTypeVal();this.focusInputField();this._hInputField.value="";this.suggestHide();return;}}df.WebTagsForm.base.suggestSelect.call(this);this.focusInputField();},extraFilterOnHandle:function extraFilterOnHandle(aList){this._aSelectedSuggestions.forEach(function(tRow){for(var i=0;i<aList.length;i++){if(aList[i].aValues[0]==tRow.aValues[0])aList.splice(i--,1);}});return aList;},addTag:function addTag(tRow){this._aSelectedSuggestions.push(tRow);var bHasFocus=false;if(this._sSelectedTag&&this.isEnabled())if(this._sSelectedTag.aValues[0]==tRow.aValues[0])bHasFocus=true;var tag_elem=df.dom.create('<div class="WebTgf_Tag'+(bHasFocus?" WebTgf_Focus":"")+(this._aTagCssClass[tRow.aValues[0]]?this._aTagCssClass[tRow.aValues[0]]:"")+'" data-dfrowid="'+df.dom.encodeAttr(tRow.aValues[0])+'"'+(this.pbDragDropEnabled&&this.isSupportedDragAction(df.dragActions.WebTagsForm.ciDragTag)?' draggable="true"':'')+'> \
                <span class="WebTgf_Text">'+this.encode(this.truncate(tRow.aValues[0],this.piTagTruncateAt,false))+'</span>'+(this.isEnabled()&&!this.pbReadOnly?'<span class="WebTgf_CloseTag">x</span> ':'')+'</div>');var oTag=this._hInputBox.insertBefore(tag_elem,this._hInputField);if(bHasFocus)this._oSelectedTag=tag_elem;df.dom.on("mouseup",oTag,function(oEvent){if(window.getSelection().type=="Range")return;var target=oEvent.getTarget();while(!target.classList.contains("WebTgf_Tag")&&!target.classList.contains("WebTgf_CloseTag")){target=target.parentNode;}if(!this.isEnabled())return;if(target.classList.contains("WebTgf_CloseTag")){target=target.parentNode;this.removeTag(target.getAttribute("data-dfrowid"));this.blurInputField();if(this._sSelectedTag){if(this._sSelectedTag)df.dom.removeClass(this._oSelectedTag,"WebTgf_Focus");this._sSelectedTag=null;this._oSelectedTag=null;}}else if(target.classList.contains("WebTgf_Tag")){var iIndex=this.getSelectedSuggestionId(target.getAttribute("data-dfrowid"));if(this._sSelectedTag)df.dom.removeClass(this._oSelectedTag,"WebTgf_Focus");if(this.pbAllowTagSelection){this._sSelectedTag=this._aSelectedSuggestions[iIndex];this._oSelectedTag=target;this.focus();}}},this);df.dom.on("mousedown",oTag,function(oEvent){if(window.getSelection().type=="Range")return;var target=oEvent.getTarget();while(!target.classList.contains("WebTgf_Tag")&&!target.classList.contains("WebTgf_CloseTag")){target=target.parentNode;}if(!this.isEnabled())return;if(target.classList.contains("WebTgf_Tag")){var iIndex=this.getSelectedSuggestionId(target.getAttribute("data-dfrowid"));if(iIndex<0)throw new df.Error(999,"Could not refind the clicked tag.");this.fireEx({sEvent:"OnTagClick",tActionData:this._aSelectedSuggestions[iIndex],oEnv:this});}},this);if(this.pbSuggestions)this._iAdditionalItems++;this.sizeChanged();},clearTags:function clearTags(){var that=this;this._aSelectedSuggestions=[];if(this._hInputBox){this._hInputBox.querySelectorAll(".WebTgf_Tag").forEach(function(oTag){that._hInputBox.removeChild(oTag);});}this._iAdditionalItems=0;},removeTag:function removeTag(sValue){var oRow=df.dom.query(this._hInputBox,".WebTgf_Tag[data-dfrowid='"+sValue.replaceAll("'","\\'")+"']");if(oRow){var iIndex=this.getSelectedSuggestionId(sValue);var tRow=this._aSelectedSuggestions[iIndex];this._aSelectedSuggestions.splice(iIndex,1);oRow.parentNode.removeChild(oRow);this.updateTypeVal();this.fireEx({sEvent:"OnRemoveTag",tActionData:tRow,oEnv:this});this.sizeChanged();}if(this._bSuggestVisible)this.suggestHide();if(this.pbSuggestions)this._iAdditionalItems--;this.suggestLoad();},getSelectedSuggestionId:function getSelectedSuggestionId(sValue){for(var i=0;i<this._aSelectedSuggestions.length;i++){if(this._aSelectedSuggestions[i].aValues[0]==sValue){return i;}}return-1;},onKey:function onKey(oEvent){if(!this.isEnabled()||this.pbReadOnly){oEvent.stop();return;}function setCaretPosition(el,pos){var range=document.createRange();var sel=window.getSelection();if(el.childNodes.length==0)return;range.setStart(el.childNodes[0],pos);range.collapse(true);sel.removeAllRanges();sel.addRange(range);}function getCaretPosition(editableDiv){var caretPos=0,sel,range;if(window.getSelection){sel=window.getSelection();if(sel.rangeCount){range=sel.getRangeAt(0);if(range.commonAncestorContainer.parentNode==editableDiv){caretPos=range.endOffset;}}}else if(document.selection&&document.selection.createRange){range=document.selection.createRange();if(range.parentElement()==editableDiv){var tempEl=document.createElement("span");editableDiv.insertBefore(tempEl,editableDiv.firstChild);var tempRange=range.duplicate();tempRange.moveToElementText(tempEl);tempRange.setEndPoint("EndToEnd",range);caretPos=tempRange.text.length;}}return caretPos;}if(oEvent.e.ctrlKey){switch(oEvent.e.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:oEvent.stop();return false;}}if(['<','>',"'",'/'].indexOf(oEvent.e.key)>-1){oEvent.stop();this._hInputField.value+=oEvent.e.key;setCaretPosition(this._hInputField,this._hInputField.value.length);return;}var oKeys=df.settings.suggestionKeys;switch(oEvent.e.key){case"Enter":if(!this._bSuggestVisible){oEvent.stop();return;}if(oEvent.e.shiftKey)this._oSelectedSuggestion=null;this.suggestSelect();oEvent.stop();break;case" ":case"Spacebar":if(!this.pbTagOnSpace||oEvent.e.ctrlKey)break;this.suggestSelect();oEvent.stop();break;}df.WebTagsForm.base.onKey.call(this,oEvent);if(!oEvent.bCanceled){if((oEvent.e.key=="Backspace"||oEvent.e.key=="Delete")&&(this.getSearchValue().length==0||this._sSelectedTag)&&this.pbAllowTagSelection){if(this._sSelectedTag){this.removeTag(this._sSelectedTag.aValues[0]);this.removeTagSelection();}else if(this._aSelectedSuggestions.length>0){this.setTagSelection(this._aSelectedSuggestions[this._aSelectedSuggestions.length-1]);}oEvent.stop();}else if((oEvent.e.key=="ArrowLeft"||oEvent.e.key=="Left")&&this.pbAllowTagSelection){if(this._aSelectedSuggestions.length<=0)return false;if(this._sSelectedTag){var i=this.getSelectedSuggestionId(this._sSelectedTag.aValues[0]);this.removeTagSelection();if(i>0)i--;else{this.removeTagSelection();this._hInputField.focus();setCaretPosition(this._hInputField,this.getSearchValue().length);oEvent.stop();return;}this.setTagSelection(this._aSelectedSuggestions[i]);oEvent.stop();}else if(getCaretPosition(this._hInputField)==0){this.setTagSelection(this._aSelectedSuggestions[this._aSelectedSuggestions.length-1]);oEvent.stop();}}else if((oEvent.e.key=="ArrowRight"||oEvent.e.key=="Right")&&this.pbAllowTagSelection){if(this._aSelectedSuggestions.length<=0)return;if(this._sSelectedTag){var _i3=this.getSelectedSuggestionId(this._sSelectedTag.aValues[0]);this.removeTagSelection();if(_i3>=this._aSelectedSuggestions.length-1){this.removeTagSelection();this._hInputField.focus();setCaretPosition(this._hInputField,0);oEvent.stop();return;}else _i3++;this.setTagSelection(this._aSelectedSuggestions[_i3]);oEvent.stop();}else if(getCaretPosition(this._hInputField)==this.getSearchValue().length){this.setTagSelection(this._aSelectedSuggestions[0]);oEvent.stop();}}else{this.removeTagSelection();}if(oEvent.matchKey(oKeys.forceDisplay)){oEvent.stop();}}},createTag:function createTag(){var tRow=this._tActionData;if(tRow.aValues[0]==-1){tRow.aValues[0]=this._aSelectedSuggestions.length.toString();}if(this.getSelectedSuggestionId(tRow.aValues[0])!=-1)throw new df.Error(871,"Id already in use.");this.addTag(tRow);this.updateTypeVal();this.suggestDoLoad(this.getSearchValue());this.suggestHide();},afterBlur:function afterBlur(){if(this._sSelectedTag){var that=this;if(!this._tUnselectTag){this._tUnselectTag=setTimeout(function(){that._tUnselectTag=null;if(!that._bHasFocus){df.dom.removeClass(that._oSelectedTag,"WebTgf_Focus");that._sSelectedTag=null;that._oSelectedTag=null;}},500);}}},determineSelectorForWebUIContext:function determineSelectorForWebUIContext(eContext){switch(eContext){case df.WebUIContext.WebUIContextTagsFormTag:return".WebTgf_Tag[data-dfrowid]";}return null;},retrieveValueFromWebUIContext:function retrieveValueFromWebUIContext(eElem,eContext){switch(eContext){case df.WebUIContext.WebUIContextTagsFormTag:{if(!eElem.hasAttribute('data-dfrowid'))break;return eElem.getAttribute('data-dfrowid');}}return null;},getDragData:function getDragData(oEv,eDraggedElem){try{var sTagText=eDraggedElem.getAttribute("data-dfrowid");return[{data:sTagText},df.dragActions.WebTagsForm.ciDragTag];}catch(err){console.error("Attempt to perform unsupported drag action");return[null,null];}},getDropData:function getDropData(oDropZone,oPosition){if(oDropZone&&oDropZone._eDropElem){var eTextElem=df.dom.query(oDropZone._eDropElem,'.WebTgf_Text');var sTagText='';if(eTextElem){sTagText=eTextElem.innerText;}var dropData={data:sTagText,action:df.dropActions.WebTagsForm.ciDropOnInput};return dropData;}return null;},initDraggableElements:function initDraggableElements(){},initDropZones:function initDropZones(){this._aDropZones=[];df.WebList.base.initDropZones.call(this);if(this.isSupportedDropAction(df.dropActions.WebTagsForm.ciDropOnInput)){var eZone=df.dom.query(this._eElem,'.WebFrm_Wrapper');this.addDropZone(eZone);}},determineDropCandidate:function determineDropCandidate(oEv,aHelpers){var _this4=this;if(aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this4,df.dropActions.WebControl.ciDropOnControl);})){return[this._eElem,df.dropActions.WebControl.ciDropOnControl];}if(!aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this4,df.dropActions.WebTagsForm.ciDropOnInput);})){return[null,null];}var eElem=document.elementFromPoint(oEv.e.clientX,oEv.e.clientY);var eTag=eElem===null||eElem===void 0?void 0:eElem.closest('.WebTgf_Tag');if(!eTag){var aElems=df.dom.query(this._eElem,'.WebTgf_Tag',true);eTag=aElems.length>0&&aElems[aElems.length-1]||null;}if(eTag){if(eTag.hasAttribute('data-dfdropplaceholder')){var _eTag$previousElement,_eTag$nextElementSibl;if((_eTag$previousElement=eTag.previousElementSibling)!==null&&_eTag$previousElement!==void 0&&_eTag$previousElement.hasAttribute("data-dfrowid")){eTag=eTag.previousElementSibling;}else if((_eTag$nextElementSibl=eTag.nextElementSibling)!==null&&_eTag$nextElementSibl!==void 0&&_eTag$nextElementSibl.hasAttribute("data-dfrowid")){eTag=eTag.nextElementSibling;}}if(eTag){return[eTag,df.dropActions.WebTagsForm.ciDropOnInput];}}return[null,null];},determineDropPosition:function determineDropPosition(oEv,eElem){var oRect=df.sys.gui.getBoundRect(eElem);var iMid=oRect.right-oRect.width/2;if(oEv.e.clientX>=iMid){return df.dropPositions.ciDropAfter;}else{return df.dropPositions.ciDropBefore;}},interactWithDropElem:function interactWithDropElem(dropZone,eElem){if(dropZone._eDropAction==df.dropActions.WebControl.ciDropOnControl){dropZone.highlightElement();}else{var eTempElem=document.createElement('div');eTempElem.innerHTML='<span class="WebTgf_Text">DROP</span><span class="WebTgf_CloseTag">x</span> ';df.dom.addClass(eTempElem,'WebTgf_Tag WebTgf_DropPlaceHolder');eTempElem.setAttribute('data-dfrowid','empty_placeholder');dropZone.insertElement(eTempElem,eElem);}},doEmptyInteraction:function doEmptyInteraction(dropZone){if(this.isSupportedDropAction(df.dropActions.WebTagsForm.ciDropOnInput)){var eTempElem=document.createElement('div');eTempElem.innerHTML='<span class="WebTgf_Text">DROP</span><span class="WebTgf_CloseTag">x</span> ';df.dom.addClass(eTempElem,'WebTgf_Tag WebTgf_DropPlaceHolder');var eTargetElem=df.dom.query(this._eElem,'.WebFrm_PromptSpacer');dropZone.insertElement(eTempElem,eTargetElem);return df.dropActions.WebTagsForm.ciDropOnInput;}else if(this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)){dropZone.highlightElement();return df.dropActions.WebControl.ciDropOnControl;}return null;},hasData:function hasData(){return this.get('psValue')!='';}});df.cHideColumnCSS=' style="visibility:hidden"';df.WebList=function WebList(sName,oParent){df.WebList.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCurrentRowId","");this.prop(df.tInt,"piCurrentRowIndex",-1);this.prop(df.tInt,"piRowCount",0);this.prop(df.tBool,"pbShowHeader",true);this.prop(df.tBool,"pbShowFooter",false);this.prop(df.tBool,"pbShowSelected",true);this.prop(df.tBool,"pbDataAware",true);this.prop(df.tInt,"peDbGridType",df.gtAutomatic);this.prop(df.tBool,"pbOfflineEditing",false);this.prop(df.tBool,"pbAutoSearch",true);this.prop(df.tBool,"pbColumnSortable",true);this.prop(df.tBool,"pbReverseOrdering",true);this.prop(df.tInt,"piSortColumn",0);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tInt,"piHeight",0);this.prop(df.tBool,"pbColumnsResizable",true);this.prop(df.tBool,"pbAutoColumnSizing",true);this.prop(df.tBool,"pbAllowColumnReordering",true);this.prop(df.tBool,"pbAllowColumnHiding",true);this.prop(df.tBool,"pbStoreColumnLayout",true);this.prop(df.tString,"psPlaceHolder","");this.prop(df.tString,"psKeyBuddy","");this.prop(df.tBool,"pbScroll",true);this.event("OnRowClick",df.cCallModeWait);this._aColumns=[];this._aSwipeBtns=[];this._oRowRenderer=null;this._oModel=null;this._oHeader=null;this._oBody=null;this._oFooter=null;this._oTouchHandler=null;this._iColCount=0;this._tRedraw=null;this._bLozingFocus=false;this._bScrollQueued=false;this._onSettingChange=new df.events.JSHandler();this._onResize=new df.events.JSHandler();this._onModulesCreated=new df.events.JSHandler();this.addSync("piCurrentRowIndex");this.addSync("psCurrentRowId");this.addSync("piRowCount");this.setActionMode("HandleProcessDataSet",df.cCallModeWait);this.setActionMode("ChangeCurrentRow",df.cCallModeWait);this.event("OnColumnLayoutChanged",df.cCallModeWait);this._sControlClass="WebList";};df.defineClass("df.WebList","df.WebBaseControl",{addChild:function addChild(oChild){if(oChild._bIsColumn){oChild._iColIndex=this._iColCount++;oChild._iCol=this._aColumns.length;this._aColumns.push(oChild);}if(oChild._bIsSwipeButton){oChild._iColIndex=this._iColCount++;this._aSwipeBtns.push(oChild);}df.WebList.base.addChild.call(this,oChild);},create:function create(){this.recordColumnMapperDefaults();this.loadLayout(true,false);this.rebuildColumnMapper(false);this._oModel=this.createModel();this._oController=this.createController();this._oRowRenderer=this.createRowModel();this._oHeader=this.createHeaderView();this._oBody=this.createView();this._oFooter=this.createFooterView();this._oTouchHandler=this.createTouchHandler();this._oPlaceHolder=this.createPlaceHolder();this._oRowRenderer.init();this._onModulesCreated.fire(this);},destroy:function destroy(){var _this$_oHeader;(_this$_oHeader=this._oHeader)===null||_this$_oHeader===void 0?void 0:_this$_oHeader.destoryHeaderMenu();df.WebList.base.destroy.call(this,arguments);},getStorageName:function getStorageName(sPostFix){if(sPostFix&&sPostFix.length>0){return window.location.host+"."+window.location.pathname+"."+this.getLongName()+"@"+sPostFix;}return window.location.host+"."+window.location.pathname+"."+this.getLongName();},serializeLayout:function serializeLayout(){var aLayout=[];for(var i=0;i<this._aColumns.length;i++){var oColLayout={};oColLayout.sObjName=this._aColumns[i].getLongName();oColLayout.bFixed=this._aColumns[i].pbFixedWidth;oColLayout.iWidth=this._aColumns[i].piWidth;oColLayout.iPosition=this._aColumns[i].piPosition;oColLayout.bHidden=this._aColumns[i].pbHidden;aLayout.push(oColLayout);}return aLayout;},loadLayout:function loadLayout(bLoadIntoMapper,bRedraw){if(typeof bRedraw!="boolean")bRedraw=true;var aLayout=null;if(this.pbStoreColumnLayout&&!df.pbDebugging){try{var sLayout=localStorage.getItem(this.getStorageName("layout"));if(sLayout)aLayout=JSON.parse(sLayout);}catch(ex){}if(aLayout&&bLoadIntoMapper){this.restoreColumnMapper(bRedraw,aLayout);}}return aLayout;},saveLayout:function saveLayout(aLayout){if(this.pbStoreColumnLayout&&!df.pbDebugging){try{localStorage.setItem(this.getStorageName("layout"),JSON.stringify(aLayout));}catch(ex){}}},triggerLayoutChange:function triggerLayoutChange(hSender){var aLayout=this.serializeLayout();this.saveLayout(aLayout);this.fireEx({sEvent:"OnColumnLayoutChanged",tActionData:aLayout,sAltServerName:"privateOnColumnLayoutChanged"});},recordColumnMapperDefaults:function recordColumnMapperDefaults(){this._defaultLayout=this.serializeLayout();},restoreColumnMapperDefaults:function restoreColumnMapperDefaults(){this.restoreColumnMapper(true,this._defaultLayout);},restoreColumnMapper:function restoreColumnMapper(bRedraw,aLayout){if(typeof bRedraw!="boolean")bRedraw=true;if(Array.isArray(this._tActionData)&&!Array.isArray(aLayout))aLayout=this._tActionData;if(!Array.isArray(aLayout))return;var lookupSet=[];for(var i=0;i<this._aColumns.length;i++){lookupSet[this._aColumns[i].getLongName()]=this._aColumns[i];}try{for(var _i4=0;_i4<aLayout.length;_i4++){var oColumnRef=lookupSet[aLayout[_i4].sObjName];if(oColumnRef){oColumnRef.pbFixedWidth=aLayout[_i4].bFixed;oColumnRef.piWidth=aLayout[_i4].iWidth;oColumnRef.piPosition=aLayout[_i4].iPosition;oColumnRef.pbHidden=aLayout[_i4].bHidden;}}aLayout=this.serializeLayout();this.saveLayout(aLayout);this.rebuildColumnMapper(false);if(bRedraw)this.redraw();}catch(ex){}},rebuildColumnMapper:function rebuildColumnMapper(bRedraw){if(typeof bRedraw!="boolean")bRedraw=true;this._aColumnMapper=[];var aIndifferent=[];for(var i=0;i<this._aColumns.length;i++){if(this._aColumns[i].piPosition!==-1){this._aColumnMapper.push(this._aColumns[i]);}else{aIndifferent.push(this._aColumns[i]);}}this._aColumnMapper.sort(function(a,b){var x=a.piPosition,y=b.piPosition;return x<y?-1:x>y?1:0;});var iIndex=0;if(this._aColumnMapper.length>0){do{if(this._aColumnMapper[iIndex].piPosition!==iIndex){if(aIndifferent.length>0){this._aColumnMapper.splice(iIndex,0,aIndifferent[0]);aIndifferent.splice(0,1);}this._aColumnMapper[iIndex].piPosition=iIndex;}}while(++iIndex<this._aColumnMapper.length);}this._aColumnMapper=this._aColumnMapper.concat(aIndifferent);if(aIndifferent.length>0){do{this._aColumnMapper[iIndex].piPosition=iIndex;}while(++iIndex<this._aColumnMapper.length);}if(bRedraw)this.redraw();},createView:function createView(){if(this.pbScroll){return new df.WebListScrollingView(this,this._oModel,this._oController);}else{return new df.WebListView(this,this._oModel,this._oController);}},createController:function createController(){return new df.WebListController(this,this._oModel);},createModel:function createModel(){if(this.peDbGridType===df.gtAllData||this.peDbGridType===df.gtManual||!this.pbDataAware||!this.pbScroll){return new df.WebListModel(this);}else{return new df.WebListPagedModel(this);}},createRowModel:function createRowModel(){return new df.WebListRowModel(this,this._oModel);},createHeaderView:function createHeaderView(){return new df.WebListHeaderView(this,this._oModel,this._oController);},createFooterView:function createFooterView(){return new df.WebListFooterView(this,this._oModel,this._oController);},createPlaceHolder:function createPlaceHolder(){return new df.WebListPlaceHolderView(this,this._oModel);},createTouchHandler:function createTouchHandler(){return new df.WebListTouchHandler(this,this._oBody,this._oModel,this._oController);},openHtml:function openHtml(aHtml){df.WebList.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebList_Focus" tabindex="',this.isEnabled()?'0':'-1','">');this._oHeader.genHtml(aHtml);this._oBody.genHtml(aHtml);this._oFooter.genHtml(aHtml);this._oPlaceHolder.genHtml(aHtml);},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebList.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){var oObj;this._eControl=this._eFocus=df.dom.query(this._eElem,'div.WebList_Focus');if(this._oHeader){this._oHeader.afterRender(this._eElem);}this._oBody.afterRender(this._eElem);if(this._oFooter){this._oFooter.afterRender(this._eElem);}this._oPlaceHolder.afterRender(this._eElem);this._oTouchHandler.afterRender(this._eElem);df.WebList.base.afterRender.call(this);this.updateEnabled();df.dom.on("keydown",this._eFocus,this.onKeyDown,this);df.dom.on("keypress",this._eFocus,this.onKeyPress,this);df.dom.on("click",this._eElem,this.onListClick,this);this._bRenderChildren=true;if(this.psKeyBuddy){oObj=this.getWebApp().findObj(this.psKeyBuddy);if(oObj){if(oObj instanceof df.WebBaseControl){this._eKeyBuddy=oObj._eControl;}if(!this._eKeyBuddy){this._eKeyBuddy=oObj._eElem;}df.events.addDomListener("keydown",this._eKeyBuddy,this.onKeyDown,this);}}this.dragDropInit();},afterRenderChildren:function afterRenderChildren(){},setHeight:function setHeight(iHeight,bSense){if(this._eControl){if(iHeight>0){iHeight-=this.getVertHeightDiff();iHeight=iHeight<0?0:iHeight;this._oBody.setHeight(iHeight);}else{this._oBody.setHeight(0);}}},getVertHeightDiff:function getVertHeightDiff(){var iResult=df.WebList.base.getVertHeightDiff.call(this);if(this._oHeader){iResult+=this._oHeader.offsetHeight();}if(this._oFooter){iResult+=this._oFooter.offsetHeight();}return iResult;},resize:function resize(){this._onResize.fire(this);df.WebList.base.resize.call(this);},onKeyPress:function onKeyPress(oEv){if(!this.isEnabled()){return;}return this._oController.keyPress(oEv);},onKeyDown:function onKeyDown(oEv){if(!this.isEnabled()){return;}return this._oController.keyDown(oEv);},applyEnabled:function applyEnabled(bVal){if(this._eFocus){this._eFocus.tabIndex=bVal?0:-1;}df.WebList.base.applyEnabled.call(this,bVal);},gridRefresh:function gridRefresh(bFirst,bLast){var aRows=this.deserializeRows(this._tActionData);this.cancelServerAction("ChangeCurrentRow");this.cancelServerAction("OnRowClick");this._oController.handleData(aRows,"page","",df.toBool(bFirst),df.toBool(bLast));},handleDataPage:function handleDataPage(sType,sStartRowId,bFirst,bLast){var aRows=this.deserializeRows(this._tActionData);this._oController.handleData(aRows,sType,sStartRowId,df.toBool(bFirst),df.toBool(bLast));},handleRowChange:function handleRowChange(bVal){this._oController.handleRowChange(bVal);},updateRow:function updateRow(sRowId){var aRows=this.deserializeRows(this._tActionData);if(aRows.length>0){this._oController.updateRow(sRowId,aRows[0]);}},dataSetAppendRow:function dataSetAppendRow(){var aRows=this.deserializeRows(this._tActionData);if(aRows.length>0){this._oController.appendRow(aRows[0]);}},dataSetInsertRowBefore:function dataSetInsertRowBefore(sBeforeRowID){var aRows=this.deserializeRows(this._tActionData);if(aRows.length>0){this._oController.insertBefore(sBeforeRowID,aRows[0]);}},dataSetInsertRowAfter:function dataSetInsertRowAfter(sAfterRowID){var aRows=this.deserializeRows(this._tActionData);if(aRows.length>0){this._oController.insertAfter(sAfterRowID,aRows[0]);}},dataSetRemoveRow:function dataSetRemoveRow(sRowId){this._oController.removeRow(sRowId);},dataSetUpdateRow:function dataSetUpdateRow(sRowID){var aRows=this.deserializeRows(this._tActionData);if(aRows.length>0){this._oController.updateRow(aRows[0].sRowId,aRows[0]);}},removeRow:function removeRow(sRowId){this._oController.removeRow(sRowId);},processDataSet:function processDataSet(eOperation){this._oController.processDataSet(eOperation);},moveToFirstRow:function moveToFirstRow(){this._oController.moveToFirstRow();},moveToLastRow:function moveToLastRow(){this._oController.moveToLastRow();},moveDownRow:function moveDownRow(){this._oController.moveDownRow();},moveUpRow:function moveUpRow(){this._oController.moveUpRow();},movePageDown:function movePageDown(){this._oController.movePageDown();},movePageUp:function movePageUp(){this._oController.movePageUp();},moveToRow:function moveToRow(iRowIndex){this._oController.moveToRow(iRowIndex);},moveToRowByID:function moveToRowByID(sRowId){this._oController.moveToRowByID(sRowId);},scrollToCol:function scrollToCol(iCol){if(this.pbScroll&&this._oBody){this._oBody.scrollToCol(iCol);}},search:function search(sSearch){this._oController.search(sSearch);},showSearch:function showSearch(sSearch){this._oController.showSearch(sSearch);},set_psCurrentRowId:function set_psCurrentRowId(sVal){if(this._oController){this._oController.setCurrentRowId(sVal);}},set_pbAllowColumnReordering:function set_pbAllowColumnReordering(bVal){if(this.pbAllowColumnReordering!==bVal){this._oHeader.changeColumnReorderingState(this.pbAllowColumnReordering=bVal);}},set_pbAllowColumnHiding:function set_pbAllowColumnHiding(bVal){if(this.pbAllowColumnHiding!==bVal){this.pbAllowColumnHiding=bVal;this._oHeader.recreateHeaderMenu();}},get_psCurrentRowId:function get_psCurrentRowId(){return this.currentRowId();},get_piRowCount:function get_piRowCount(){return this._oModel&&this._oModel.aData.length||0;},get_piCurrentRowIndex:function get_piCurrentRowIndex(){return this._oModel&&this._oModel.iCurrentRow;},set_piSortColumn:function set_piSortColumn(iVal){this.propertyUpdate("piSortColumn",iVal);},set_pbReverseOrdering:function set_pbReverseOrdering(bVal){this.propertyUpdate("pbReverseOrdering",bVal);},set_psPlaceHolder:function set_psPlaceHolder(bVal){this.propertyUpdate("psPlaceHolder",bVal);},set_pbShowHeader:function set_pbShowHeader(bVal){this.propertyUpdate("pbShowHeader",bVal);},set_pbShowFooter:function set_pbShowFooter(bVal){this.propertyUpdate("pbShowFooter",bVal);},set_pbShowSelected:function set_pbShowSelected(bVal){this.propertyUpdate("pbShowSelected",bVal);},set_pbColumnsResizable:function set_pbColumnsResizable(bVal){this.propertyUpdate("pbColumnsResizable",bVal);},set_pbAutoColumnSizing:function set_pbAutoColumnSizing(bVal){this.propertyUpdate("pbAutoColumnSizing",bVal);this.redraw();},propertyUpdate:function propertyUpdate(sProp,val){var prev;if(this[sProp]!==val){prev=this[sProp];this[sProp]=val;this._onSettingChange.fire(this,{sType:"prop",sProp:sProp,newval:val,prevval:prev});}},updateCurrentCell:function updateCurrentCell(oCol,sVal){this._oController.updateCell(oCol,sVal);},redraw:function redraw(){var that=this;if(this._tRedraw){clearTimeout(this._tRedraw);}this._tRedraw=setTimeout(function(){that._onSettingChange.fire(that,{sType:"prepare-redraw"});that._onSettingChange.fire(that,{sType:"redraw"});that._tRedraw=null;},10);},insertChild:function insertChild(oChild,iIndex){if(oChild._bIsColumn){oChild._iColIndex=this._iColCount++;oChild._iCol=this._aColumns.length;this._aColumns.splice(iIndex,0,oChild);}if(oChild._bIsSwipeButton){oChild._iColIndex=this._iColCount++;this._aSwipeBtns.splice(iIndex,0,oChild);}df.WebList.base.insertChild.call(this,oChild,iIndex);},renderChild:function renderChild(oChild,eOptChild){this.redraw();df.WebList.base.renderChild.call(this,oChild,eOptChild);},removeChild:function removeChild(oChild){var iIndex=this._aChildren.indexOf(oChild);if(oChild._bIsColumn){oChild._iColIndex=this._iColCount--;oChild._iCol=this._aColumns.length;this._aColumns.splice(iIndex,1);}if(oChild._bIsSwipeButton){oChild._iColIndex=this._iColCount--;this._aSwipeBtns.splice(iIndex,1);}df.WebList.base.removeChild.call(this,oChild);},unrenderChild:function unrenderChild(oChild){this.redraw();df.WebList.base.unrenderChild.call(this,oChild);},getColCell:function getColCell(oCol){return this._oBody.colCell(oCol);},getColHead:function getColHead(oCol){return this._oHeader.colCell(oCol);},getCell:function getCell(iRow,iCol){var sRowId=this._oModel.rowIdByRowIndex(iRow);return this._oBody.cell(sRowId,iCol);},currentRowId:function currentRowId(){return this._oModel&&this._oModel.sCurrentRowId||"";},focus:function focus(){if(this._bFocusAble&&this.isEnabled()&&this._eFocus){this._eFocus.focus();this.objFocus();return true;}return false;},onListClick:function onListClick(oEv){this.focus();},onFocus:function onFocus(oEvent){if(!this._bHasFocus){df.WebList.base.onFocus.call(this,oEvent);}this._bLozingFocus=false;},onBlur:function onBlur(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){df.WebList.base.onBlur.call(that,oEvent);that._bLozingFocus=false;}},20);},hasFocus:function hasFocus(){if(this._bHasFocus){if(this._bLozingFocus){var oFocusObj=this.getWebApp()._oCurrentObj;while(oFocusObj!=this&&oFocusObj._oParent){oFocusObj=oFocusObj._oParent;}return oFocusObj==this;}else{return true;}}return false;},determineSelectorForWebUIContext:function determineSelectorForWebUIContext(eContext){switch(eContext){case df.WebUIContext.WebUIContextListRow:return"table[data-dfrowid]";}return null;},retrieveValueFromWebUIContext:function retrieveValueFromWebUIContext(eElem,eContext){switch(eContext){case df.WebUIContext.WebUIContextListRow:{if(!eElem.hasAttribute('data-dfrowid'))break;return eElem.getAttribute('data-dfrowid');}}return null;},getDragData:function getDragData(oEv,eDraggedElem){try{var itemId=eDraggedElem.getAttribute("data-dfrowid")||-1;var item;if(itemId&&itemId!="empty"&&itemId!=-1&&(itemId!=''||itemId>=0)){item=_objectSpread({},this._oModel.aData[this._oModel.rowIndexByRowId(itemId)]);Object.keys(item).forEach(function(key){key.indexOf("_")==0&&delete item[key];});return[{data:item},df.dragActions.WebList.ciDragRow];}return[null,null];}catch(err){console.error("Attempt to perform unsupported drag action");return[null,null];}},getDropData:function getDropData(oDropZone,oPosition){var itemId=oDropZone._eDropElem&&oDropZone._eDropElem.getAttribute("data-dfrowid")||-1;var item;if(itemId&&itemId!=-1&&(itemId!=''||itemId>=0)){item=_objectSpread({},this._oModel.aData[this._oModel.rowIndexByRowId(itemId)]);Object.keys(item).forEach(function(key){key.indexOf("_")==0&&delete item[key];});}var dropData={data:item,action:df.dropActions.WebList.ciDropOnRow};return dropData;},initDropZones:function initDropZones(){this._aDropZones=[];df.WebList.base.initDropZones.call(this);if(this.isSupportedDropAction(df.dropActions.WebList.ciDropOnRow)){var eZone=df.dom.query(this._eElem,'.WebList_BodyWrp');this.addDropZone(eZone);}},determineDropCandidate:function determineDropCandidate(oEv,aHelpers){var _this5=this;if(aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this5,df.dropActions.WebControl.ciDropOnControl);})){return[this._eElem,df.dropActions.WebControl.ciDropOnControl];}if(!aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this5,df.dropActions.WebList.ciDropOnRow);})){return[null,null];}var eElem=document.elementFromPoint(oEv.e.clientX,oEv.e.clientY);var eRow=eElem===null||eElem===void 0?void 0:eElem.closest('table[data-dfrowid]');if(eRow){var sRowId=eRow.getAttribute('data-dfrowid');if(sRowId=='empty_placeholder'){return[eRow.previousElementSibling||eRow.nextElementSibling||eRow,df.dropActions.WebList.ciDropOnRow];}else if(sRowId=='empty'){while(eRow){var _sRowId=eRow.getAttribute('data-dfrowid');if(_sRowId!='empty'&&_sRowId!='empty_placeholder'){return[eRow,df.dropActions.WebList.ciDropOnRow];}eRow=eRow.previousElementSibling;}}else{return[eRow,df.dropActions.WebList.ciDropOnRow];}}return[null,null];},determineDropPosition:function determineDropPosition(oEv,eElem){var oRect=df.sys.gui.getBoundRect(eElem);var iMid=oRect.bottom-oRect.height/2;if(oEv.e.clientY>=iMid){return df.dropPositions.ciDropAfter;}else{return df.dropPositions.ciDropBefore;}},onControlDragOver:function onControlDragOver(oEv,oDropZone,eDropElem){var _this6=this;if(!this._bScrollQueued){var dY=10;var dT=100;var oRect=df.sys.gui.getBoundRect(oDropZone._eZone);var iBottomSection=oRect.bottom-50;if(oEv.e.clientY<=oRect.bottom&&oEv.e.clientY>iBottomSection){var iDiffFromBottom=oRect.bottom-oEv.e.y;if(iDiffFromBottom<iBottomSection*0.5){dT=20;}this._bScrollQueued=true;setTimeout(function(){_this6.dragScroll(dY);},dT);}var iTopSection=oRect.top+50;if(oEv.e.clientY>=oRect.top&&oEv.e.clientY<iTopSection){dY=-dY;var iDiffFromTop=oEv.e.y-oRect.top;if(iDiffFromTop<iTopSection*0.5){dT=20;}this._bScrollQueued=true;setTimeout(function(){_this6.dragScroll(dY);},dT);}}},dragScroll:function dragScroll(dY){this._oBody.scroll(dY,false);this._bScrollQueued=false;},interactWithDropElem:function interactWithDropElem(dropZone,eElem){if(dropZone._eDropAction==df.dropActions.WebControl.ciDropOnControl){dropZone.highlightElement();}else{var eTempElem=document.createElement('table');df.dom.addClass(eTempElem,'WebList_Row WebList_DropPlaceHolder');eTempElem.setAttribute('data-dfrowid','empty_placeholder');var iHeight=this.getPlaceholderRowHeight();if(iHeight&&iHeight>0){eTempElem.style.height=String(iHeight)+"px";}dropZone.insertElement(eTempElem,eElem);}},doEmptyInteraction:function doEmptyInteraction(dropZone){if(this.isSupportedDropAction(df.dropActions.WebList.ciDropOnRow)){var eTempElem=document.createElement('table');df.dom.addClass(eTempElem,'WebList_Row WebList_DropPlaceHolder');var iHeight=this.getPlaceholderRowHeight();if(iHeight&&iHeight>0){eTempElem.style.height=String(iHeight)+"px";}var eTargetElem=df.dom.query(this._eElem,'.WebList_Body table');dropZone.insertElement(eTempElem,eTargetElem,df.dropPositions.ciDropBefore);return df.dropActions.WebList.ciDropOnRow;}else if(this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)){dropZone.highlightElement();return df.dropActions.WebControl.ciDropOnControl;}return null;},hasData:function hasData(){return this._oModel.aData&&this._oModel.aData.length>0;},getPlaceholderRowHeight:function getPlaceholderRowHeight(){var iAvgHeight=this._oBody.iAvgRowHeight;var iFirstRowHeight=df.dom.clientHeight(df.dom.query(this._eElem,'.WebList_Body table'));var iHeight=(iAvgHeight>0?iAvgHeight:iFirstRowHeight)||0;return iHeight;},deserializeRows:function deserializeRows(aRows){return aRows;},serializeRows:function serializeRows(aRows){return aRows;}});df.WebListView=function WebListView(oList,oModel,oController){this.oL=oList;this.oM=oModel;this.oC=oController;this.oR=oList._oRowRenderer;this.bPreventSubmit=false;this.bCancelClick=false;this.bScroll=false;this.onRowsRendered=new df.events.JSHandler();oModel.onDataUpdate.on(this.onDataUpdate,this);oModel.onRowChange.on(this.onRowChange,this);oList._onSettingChange.on(this.onSettingChange,this);oController.onCellClick.on(this.onCellClick,this);oController.onAfterCellClick.on(this.onAfterCellClick,this);};df.defineClass("df.WebListView",{genHtml:function genHtml(aHtml){aHtml.push('<div class="WebList_BodyWrp">');aHtml.push('<div class="WebList_Body',this.oL.pbShowSelected?' WebList_ShowSelected':'','">');this.tableHtml(aHtml);aHtml.push('</div></div>');},afterRender:function afterRender(eList){this.eBody=df.dom.query(eList,"div.WebList_Body");this.eBodyWrp=df.dom.query(eList,"div.WebList_BodyWrp");df.dom.addClass(this.oL._eControl,this.bScroll?'WebList_Scrolling':'WebList_NoScrolling');df.events.addDomListener("click",this.eBody,this.onTableClick,this);df.events.addDomListener("dblclick",this.eBody,this.onTableDblClick,this);this.onRowsRendered.fire(this);},rowHtml:function rowHtml(tRow,aHtml,bZebra){this.oR.rowHtml(tRow,aHtml,bZebra);},tableHtml:function tableHtml(aHtml){var oM=this.oM,oR=this.oR,bZebra=false,i;for(i=0;i<oM.aData.length;i++){this.rowHtml(oM.aData[i],aHtml,bZebra);bZebra=!bZebra;}},refreshDisplay:function refreshDisplay(){var aHtml=[];if(this.eBody){this.tableHtml(aHtml);this.eBody.innerHTML=aHtml.join("");this.onRowsRendered.fire(this);this.oL.sizeChanged(false);}},refreshRow:function refreshRow(sRowId,sNewRowId){var oM=this.oM,iRow,eRow,eNewRow,aHtml=[];iRow=oM.rowIndexByRowId(sNewRowId);eRow=this.eBody&&df.dom.query(this.eBody,"table[data-dfrowid='"+sRowId+"']")||null;if(iRow>=0&&eRow){this.rowHtml(oM.aData[iRow],aHtml,eRow.className.indexOf("WebList_RowOdd")>=0);eNewRow=df.dom.create(aHtml.join(""));eRow.parentNode.replaceChild(eNewRow,eRow);}},refreshCell:function refreshCell(sRowId,oCol){var oM=this.oM,eCell,iRow;eCell=this.cell(sRowId,oCol._iCol);iRow=oM.rowIndexByRowId(sRowId);if(eCell&&iRow>=0){eCell.innerHTML=this.oR.cellHtml(oCol,this.oM.aData[iRow],this.oM.aData[iRow].aCells[oCol._iColIndex]);}},onDataUpdate:function onDataUpdate(oEv){if(oEv.sType==="row"){this.refreshRow(oEv.sUpdateRowId,oEv.sNewRowId);}if(oEv.sType==="cell"){this.refreshCell(oEv.sUpdateRowId,oEv.oCol);}else{this.refreshDisplay();}},onRowChange:function onRowChange(oEv){var eRow,ePrevRow;if(this.eBody){if(oEv.sPrevRowId){ePrevRow=this.row(oEv.sPrevRowId);if(ePrevRow){df.dom.removeClass(ePrevRow,"WebList_Selected");}}eRow=this.row(oEv.sGotoRowId);if(eRow){df.dom.addClass(eRow,"WebList_Selected");}}},onSettingChange:function onSettingChange(oEv){var oL=this.oL;if(oEv.sType==="redraw"){this.refreshDisplay();}else if(oEv.sType==="prop"){switch(oEv.sProp){case"pbShowSelected":if(this.eBody){df.dom.toggleClass(this.eBody,"WebList_ShowSelected",oL.pbShowSelected);}break;}}},row:function row(sRowId){return this.eBody&&df.dom.query(this.eBody,'table.WebList_Row[data-dfrowid="'+sRowId+'"]')||null;},currentRowElem:function currentRowElem(){return this.row(this.oM.sCurrentRowId);},determineCell:function determineCell(eElem){var oRes={iCol:-1,sRowId:null,eSwipeBtn:null};while(eElem&&eElem.parentNode&&eElem!==this.eBody&&!oRes.sRowId){if(eElem.tagName==="TD"&&eElem.hasAttribute("data-dfcol")){oRes.iCol=parseInt(eElem.getAttribute("data-dfcol"),10);}else if(eElem.tagName==="TD"&&eElem.hasAttribute("data-dfswbtn")){oRes.eSwipeBtn=eElem;}else if(eElem.tagName==="TABLE"&&eElem.hasAttribute("data-dfisrow")){oRes.sRowId=eElem.getAttribute("data-dfrowid");}eElem=eElem.parentNode;}return oRes;},onTableClick:function onTableClick(oEv){var oCDtl,that=this;if(!this.oL.isEnabled()||this.bCancelClick){return;}oCDtl=this.determineCell(oEv.getTarget());if(oCDtl.eSwipeBtn){this.oL._oTouchHandler.swipeBtnClick(oEv,oCDtl.eSwipeBtn);}else if(oCDtl.sRowId!==null){if(this.oC.cellClick(oEv,oCDtl.sRowId,oCDtl.iCol)){this._bPreventSubmit=true;setTimeout(function(){that.bPreventSubmit=false;},250);oEv.stop();}}},onTableDblClick:function onTableDblClick(oEv){var oCDtl;if(!this.oL.isEnabled()){return;}oCDtl=this.determineCell(oEv.getTarget());if(oCDtl.sRowId!==null){if(this.oC.cellDblClick(oEv,oCDtl.sRowId,oCDtl.iCol)){oEv.stop();return;}}if(!this.bPreventSubmit){this.oL.fireSubmit();}},onCellClick:function onCellClick(oEv){var that=this;this.bHitDone=false;this.eHitElem=this.row(oEv.sRowId);df.dom.addClass(this.eHitElem,df.CssHit);this.tHitTimer=setTimeout(function(){if(that.bHitDone){df.dom.removeClass(that.eHitElem,df.CssHit);}that.tHitTimer=null;},df.hitTimeout);},onAfterCellClick:function onAfterCellClick(oEv){if(!this.tHitTimer){df.dom.removeClass(this.eHitElem,df.CssHit);}this.bHitDone=true;},setHeight:function setHeight(iHeight){},cell:function cell(sRowId,iCol){return this.eBody&&df.dom.query(this.eBody,"table[data-dfrowid='"+sRowId+"'] td[data-dfcol='"+iCol+"']")||null;},colCell:function colCell(oCol){return this.cell(this.oM.sCurrentRowId,oCol._iCol);},colCellByIndex:function colCellByIndex(iCol){return this.cell(this.oM.sCurrentRowId,iCol);},scrollbarWidth:function scrollbarWidth(){return 0;},getViewSize:function getViewSize(){return 10;},fullwidth:function fullwidth(){return this.eBody&&this.eBody.clientWidth||0;},setExtraRowHeight:function setExtraRowHeight(sRowId,iExtra){},getExtraRowHeight:function getExtraRowHeight(sRowId){return 0;}});df.WebListTouchHandler=function WebListTouchHandler(oList,oView,oModel,oController){this.oL=oList;this.oV=oView;this.oM=oModel;this.oC=oController;this.iAutoScrollIncr=1;this.iSwipeStartOffset=0;this.iSwipeOffset=0;this.eSwipeRow=null;this.eSwipeRowStart=null;this.eSwipeLeftBtns=null;this.eSwipeRightBtns=null;};df.defineClass("df.WebListTouchHandler",{afterRender:function afterRender(eList){var oV=this.oV;if(window.PointerEvent){df.dom.on("pointerdown",oV.eBody,this.onPointerDown,this);}else{df.dom.on("touchstart",oV.eBody,this.onTouchStart,this);}if(oV.bScroll&&oV.eBodyWrp.addEventListener&&this.oL.pbAutoColumnSizing){oV.eBodyWrp.addEventListener("touchmove",function(e){e.preventDefault();},{passive:false});}},onTouchStart:function onTouchStart(oEv){if(oEv.e.targetTouches.length===1){this.touchScroll(false,oEv);}},onPointerDown:function onPointerDown(oEv){if(oEv.e.pointerType==="pen"||oEv.e.pointerType==="touch"){this.touchScroll(true,oEv);}},touchScroll:function touchScroll(bPointer,oEv){var that=this,oV=this.oV,iY,iPrevY,iStartY,iVelocity=0,iAmplitude=0,iTimestamp=Date.now(),iFrame,tTracker,iTarget,iTimeConstant=325,iMaxPX,iBounce,iBounceTime=0,iStartOffset,iAuto,iStartX,iX,iPrevX,bSwipable,bScrollable=!!oV.bScroll,bSwipe=false,bSwipeFixed=false;oV.iAutoScroll=iAuto=this.iAutoScrollIncr++;bSwipable=this.swipeStart(oEv.getTarget());iStartX=iPrevX=iX=bPointer?oEv.e.clientX:oEv.e.targetTouches[0].pageX;iStartY=iFrame=iPrevY=iY=bPointer?oEv.e.clientY:oEv.e.targetTouches[0].pageY;if(bScrollable){iStartOffset=oV.iScrollOffsetPx;iMaxPX=oV.getMaxPX();iBounce=oV.iTableHeight*0.1;}function touchMove(oEv){var iOffset,iDiff;iY=bPointer?oEv.e.clientY:oEv.e.targetTouches[0].pageY;iX=bPointer?oEv.e.clientX:oEv.e.targetTouches[0].pageX;if(bSwipeFixed&&bSwipe||!bSwipeFixed&&Math.abs(iStartX-iX)>Math.abs(iStartY-iY)){bSwipe=true;this.swipeRow(oEv.getTarget(),iStartX-iX);}else{if(bSwipe){this.swipeRowCancel();}if(bScrollable){iOffset=oV.iScrollOffsetPx+(iPrevY-iY);if(iOffset<0){iDiff=iStartOffset+(iStartY-iY);iOffset=iDiff*0.3;}else if(iOffset>iMaxPX){iDiff=iStartOffset+(iStartY-iY)-iMaxPX;iOffset=iMaxPX+iDiff*0.3;}oV.scrollTo(iOffset,false,false,true);oEv.stop();}}iPrevY=iY;iPrevX=iX;if(bSwipable||bScrollable){oEv.e.preventDefault();}}function autoScroll(){var iElapsed,iDelta,iOffset,iDone;if(oV.iAutoScroll===iAuto&&iAmplitude){iElapsed=Date.now()-iTimestamp;if(oV.iScrollOffsetPx<0||oV.iScrollOffsetPx>iMaxPX){if(!iBounceTime){iDone=Math.abs(-iAmplitude*Math.exp(-iElapsed/iTimeConstant)/iAmplitude);iBounceTime=iDone*100;iAmplitude=Math.max(-iAmplitude/2000,1)*(oV.iScrollOffsetPx>iMaxPX?iBounce:-iBounce)*iDone;iTarget=oV.iScrollOffsetPx+iAmplitude;iTimestamp=Date.now();iElapsed=Date.now()-iTimestamp;}iDelta=-iAmplitude*Math.exp(-iElapsed/iBounceTime);}else{iDelta=-iAmplitude*Math.exp(-iElapsed/iTimeConstant);}iOffset=iTarget+iDelta;if(iDelta>0.5||iDelta<-0.5){oV.scrollTo(iOffset,false,false,true);df.dom.animFrame(autoScroll,this);}else{oV.scrollTo(iTarget,false,false,true);if(iTarget<0){aniScroll.call(that,-oV.iScrollOffsetPx,iOffset/-iBounce*80);}else if(iTarget>iMaxPX){aniScroll.call(that,iMaxPX-oV.iScrollOffsetPx,(iOffset-iMaxPX)/iBounce*80);}}}}function touchEnd(oEv){if(bPointer){df.dom.off("pointerup",document,touchEnd);df.dom.off("pointercancel",document,touchEnd);df.dom.off("pointermove",document,touchMove);}else{df.dom.off("touchend",document,touchEnd);df.dom.off("touchcancel",document,touchEnd);df.dom.off("touchmove",document,touchMove);}clearInterval(tTracker);if(bSwipe){this.swipeRowEnd();}if(bScrollable){if(oV.iScrollOffsetPx<0){aniScroll.call(this,-oV.iScrollOffsetPx,oV.iScrollOffsetPx/-iBounce*80);}else if(oV.iScrollOffsetPx>iMaxPX){aniScroll.call(this,iMaxPX-oV.iScrollOffsetPx,(oV.iScrollOffsetPx-iMaxPX)/iBounce*80);}else if(!bSwipe){if(iVelocity>10||iVelocity<-10){iAmplitude=1.9*iVelocity;iTarget=Math.round(oV.iScrollOffsetPx+iAmplitude);if(iTarget>0&&iTarget<iMaxPX){iTarget=oV.snapToRow(iTarget);}iTimestamp=Date.now();df.dom.animFrame(autoScroll,this);}}}if(Math.abs(iPrevY-iStartY)>15||Math.abs(iPrevX-iStartX)>15){if(bPointer){oV.bCancelClick=true;setTimeout(function(){oV.bCancelClick=false;},200);}}}function aniScroll(iDelta,iLengthMS){var oV=this.oV,iFrom,tStart,tEnd;function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;}function animate(){var tCur,iStep;if(oV.iAutoScroll===iAuto){tCur=Math.min(Date.now(),tEnd);iStep=easeInOutSine(tCur-tStart,iFrom,iDelta,tEnd-tStart);oV.scrollTo(iStep,false,false,true);if(tCur<tEnd&&(iStep>0.5||iStep<0.5)){df.dom.animFrame(animate,this);}}}if(iDelta!==0){iFrom=oV.iScrollOffsetPx;tStart=Date.now();tEnd=tStart+iLengthMS;animate();}};function track(){var iNow,iElapsed,iDelta,v;iNow=Date.now();iElapsed=iNow-iTimestamp;iTimestamp=iNow;iDelta=iFrame-iY;iFrame=iY;v=500*iDelta/(1+iElapsed);iVelocity=0.8*v+0.2*iVelocity;}if(bPointer){df.dom.on("pointerup",document,touchEnd,this);df.dom.on("pointercancel",document,touchEnd,this);df.dom.on("pointermove",document,touchMove,this);}else{df.dom.on("touchend",document,touchEnd,this);df.dom.on("touchcancel",document,touchEnd,this);df.dom.on("touchmove",document,touchMove,this);}tTracker=setInterval(track,50);setTimeout(function(){bSwipeFixed=true;},300);},showSwipeLeft:function showSwipeLeft(){var eElem=this.oV.currentRowElem(),iOffset;if(eElem){if(this.swipeStart(eElem)){if(this.eSwipeRow&&!this.eSwipeRowStart&&this.iSwipeOffset<0){this.swipeRowClose(this.eSwipeRow);return true;}if(this.eSwipeRowStart){if(this.eSwipeRow&&this.eSwipeRow!==this.eSwipeRowStart){this.swipeRowClose(this.eSwipeRow);}this.eSwipeRow=this.eSwipeRowStart;this.eSwipeRowStart=null;}if(!this.eSwipeLeftBtns&&!this.eSwipeRightBtns){this.initSwipeRow();}if(this.eSwipeLeftBtns){if(this.iSwipeStartOffset<0){iOffset=0;}else{iOffset=this.eSwipeLeftBtns.offsetWidth;}this.swipeAniOffset(this.eSwipeRow,iOffset);return true;}}}return false;},showSwipeRight:function showSwipeRight(){var eElem=this.oV.currentRowElem(),iOffset;if(eElem){if(this.swipeStart(eElem)){if(this.eSwipeRow&&!this.eSwipeRowStart&&this.iSwipeOffset>0){this.swipeRowClose(this.eSwipeRow);return true;}if(this.eSwipeRowStart){if(this.eSwipeRow&&this.eSwipeRow!==this.eSwipeRowStart){this.swipeRowClose(this.eSwipeRow);}this.eSwipeRow=this.eSwipeRowStart;this.eSwipeRowStart=null;}if(!this.eSwipeLeftBtns&&!this.eSwipeRightBtns){this.initSwipeRow();}if(this.eSwipeRightBtns){if(this.iSwipeStartOffset>0){iOffset=0;}else{iOffset=-this.eSwipeRightBtns.offsetWidth;}this.swipeAniOffset(this.eSwipeRow,iOffset);return true;}}}return false;},swipeStart:function swipeStart(eElem){var oL=this.oL,oV=this.oV,oM=this.oM,bFound=false,iRow,tRow,iBtn,oBtn,tCell;while(eElem&&eElem!==oV.eBody){if(eElem.tagName==="TABLE"&&eElem.hasAttribute("data-dfisrow")){bFound=true;break;}eElem=eElem.parentNode;}if(bFound){this.iSwipeStartOffset=0;if(this.eSwipeRow){if(this.eSwipeRow===eElem){this.iSwipeStartOffset=this.iSwipeOffset;return true;}}iRow=oM.rowIndexByRowId(eElem.getAttribute("data-dfrowid"));tRow=oM.aData[iRow];for(iBtn=0;iBtn<oL._aSwipeBtns.length;iBtn++){oBtn=oL._aSwipeBtns[iBtn];tCell=tRow.aCells[oBtn._iColIndex];if(oBtn.isVisible(tCell)){this.eSwipeRowStart=eElem;return true;}}this.eSwipeRowStart=null;}return false;},initSwipeRow:function initSwipeRow(){var iRow,tRow,eRow,aLeftHtml,aRightHtml,tCell,oBtn,eLeft,eRight,aHtml,oM=this.oM,iBtn,oL=this.oL,bRight=false,bLeft=false;eRow=this.eSwipeRow;if(eRow){iRow=oM.rowIndexByRowId(eRow.getAttribute("data-dfrowid"));tRow=oM.aData[iRow];aLeftHtml=['<table data-dfrowid="',tRow?tRow.sRowId:"empty",'" class="WebList_SwipeBtns WebList_SwipeBtnsLeft"><tr>'];aRightHtml=['<table data-dfrowid="',tRow?tRow.sRowId:"empty",'" class="WebList_SwipeBtns WebList_SwipeBtnsRight"><tr>'];for(iBtn=0;iBtn<oL._aSwipeBtns.length;iBtn++){oBtn=oL._aSwipeBtns[iBtn];tCell=tRow.aCells[oBtn._iColIndex];if(oBtn.isVisible(tCell)){if(oBtn.pbPositionLeft){aHtml=aLeftHtml;bLeft=true;}else{aHtml=aRightHtml;bRight=true;}aHtml.push('<td data-dfswbtn="',iBtn,'" class="WebList_SwipeBtn ',oBtn.psCSSClass,' ',tCell.sCssClassName,'" style="');if(oBtn.piWidth>0){aHtml.push('width: ',oBtn.piWidth,'px; ');}aHtml.push('height: ',eRow.offsetHeight,'px">',oBtn.btnHtml(tCell),'</td>');}}aLeftHtml.push('</tr></table>');aRightHtml.push('</tr></table>');if(bLeft){this.eSwipeLeftBtns=eLeft=df.dom.create(aLeftHtml.join(''));eRow.parentNode.insertBefore(eLeft,eRow);}if(bRight){this.eSwipeRightBtns=eRight=df.dom.create(aRightHtml.join(''));eRow.parentNode.insertBefore(eRight,eRow);}}},swipeRow:function swipeRow(eElem,iDiffX){var iOffset,iMin=0,iMax=0;if(this.eSwipeRowStart){if(this.eSwipeRow){this.swipeRowClose(this.eSwipeRow);}this.eSwipeRow=this.eSwipeRowStart;this.eSwipeRowStart=null;}if(this.eSwipeRow){if(!this.eSwipeLeftBtns&&!this.eSwipeRightBtns){this.initSwipeRow();}if(this.eSwipeLeftBtns){iMax=this.eSwipeLeftBtns.offsetWidth;}if(this.eSwipeRightBtns){iMin-=this.eSwipeRightBtns.offsetWidth;}this.iSwipeOffset=iOffset=Math.max(Math.min(this.iSwipeStartOffset-iDiffX,iMax),iMin);df.dom.translateX(this.eSwipeRow,iOffset,false);}},swipeRowCancel:function swipeRowCancel(){if(this.eSwipeRow){this.swipeRowClose(this.eSwipeRow);this.eSwipeRow=null;}},swipeRowClose:function swipeRowClose(eRow){var eLeft=this.eSwipeLeftBtns,eRight=this.eSwipeRightBtns;this.swipeAniOffset(eRow,0,function finish(){if(eLeft){if(eLeft.parentNode){eLeft.parentNode.removeChild(eLeft);}}if(eRight){if(eRight.parentNode){eRight.parentNode.removeChild(eRight);}}});this.eSwipeLeftBtns=null;this.eSwipeRightBtns=null;},swipeRowEnd:function swipeRowEnd(){var iOffset=this.iSwipeOffset;if(this.eSwipeRow){if(this.iSwipeOffset>this.iSwipeStartOffset){if(this.iSwipeOffset>0){iOffset=this.eSwipeLeftBtns.offsetWidth;}else{iOffset=0;}}else{if(this.iSwipeOffset<0){iOffset=0-this.eSwipeRightBtns.offsetWidth;}else{iOffset=0;}}if(iOffset===0){this.swipeRowClose(this.eSwipeRow);this.eSwipeRow=null;}else{this.swipeAniOffset(this.eSwipeRow,iOffset);}}},swipeAniOffset:function swipeAniOffset(eRow,iOffset,fFinish){df.dom.transition(eRow,"all 200ms",fFinish,this);df.dom.translateX(eRow,iOffset);this.iSwipeOffset=iOffset;},swipeBtnClick:function swipeBtnClick(oEv,eElem){var oL=this.oL,oM=this.oM,eBtn=eElem,sRowId=null,iRow,eRow=this.eSwipeRow;while(eElem&&eElem!==this.oV.eBody){if(eElem.tagName==="TABLE"&&eElem.hasAttribute("data-dfrowid")){sRowId=eElem.getAttribute("data-dfrowid");break;}eElem=eElem.parentNode;}if(sRowId){iRow=oM.rowIndexByRowId(sRowId);if(iRow>=0){this.oC.selectRow("row",iRow);df.dom.addClass(eBtn,"WebCon_Active");oL._aSwipeBtns[eBtn.getAttribute("data-dfswbtn")].btnClick(oEv,oM.aData[iRow].sRowId,function(oEv){df.dom.removeClass(eBtn,"WebCon_Active");this.swipeRowClose(eRow);oL.focus();},this);}}}});df.WebListScrollingView=function WebListScrollingView(oList,oModel,oController){df.WebListScrollingView.base.constructor.call(this,oList,oModel,oController);this.bScroll=true;this.bZebraTop=false;this.bZebraBottom=false;this.iTableOffset=0;this.iScrollOffsetPx=0;this.iRowDispOffset=0;this.iViewOffset=0;this.iRowsDispOffset=0;this.iRowDispLast=0;this.iPrefViewOffset=8;this.iMaxViewOffsetDiff=this.iPrefViewOffset/2;this.iLastScrollbarSet=0;this.bScrollbarDirty=false;this.iAvgRowHeight=0;this.iTableHeight=0;this.bNoRender=false;this.iAutoScroll=0;this.oInitialFullEvent=null;this.bFirstFill=true;this.aRowHeightProcess=[];this.onHorizontalScroll=new df.events.JSHandler();this.onVerticalScroll=new df.events.JSHandler();this.bDelUpdDim=false;this.bDelUpdDimForced=false;oList._onResize.on(this.onResize,this);};df.defineClass("df.WebListScrollingView","df.WebListView",{genHtml:function genHtml(aHtml){aHtml.push('<div class="WebList_BodyWrp">');aHtml.push('<div class="WebList_Scroll" tabindex="-1"><div class="WebList_Stretcher" style="width: 1px;"></div></div>');aHtml.push('<div class="WebList_Body',this.oL.pbShowSelected?' WebList_ShowSelected':'','">');aHtml.push('<div class="WebList_TableWrp',this.oL.pbAutoColumnSizing?" WebList_AutoSize":" WebList_HorizScroll",'">');aHtml.push('<div class="WebList_Table">');aHtml.push('</div></div></div>');aHtml.push('<div style="clear: both"></div>');aHtml.push('</div>');},afterRender:function afterRender(eList){this.eTableWrp=df.dom.query(eList,"div.WebList_TableWrp");this.eTable=df.dom.query(eList,"div.WebList_Table");this.eScrollbar=df.dom.query(eList,"div.WebList_Scroll");this.eScrollStretch=df.dom.query(eList,"div.WebList_Scroll > div.WebList_Stretcher");df.WebListScrollingView.base.afterRender.call(this,eList);df.events.addDomMouseWheelListener(this.eBody,this.onMouseWheelScroll,this);df.dom.on("scroll",this.eScrollbar,this.onScrollbarScroll,this);df.dom.on("scroll",this.eTableWrp,this.onHorizbarScroll,this);df.events.addDomCaptureListener("load",this.eTableWrp,this.onContentLoaded,this);},afterFirstFill:function afterFirstFill(){df.dom.animFrame(function(){if(this.oL.piSortColumn>0){this.scrollToCol(this.oL.piSortColumn);}},this);},onDataUpdate:function onDataUpdate(oEv){var eRow,iOffsetTop;this.iMaxPX=null;if(oEv.sType==="full"){if(!this.eBody){this.oInitialFullEvent=oEv;return;}this.updateScrollbarSize();this.bNoRender=true;eRow=this.row(this.oM.sCurrentRowId);if(eRow){iOffsetTop=eRow.offsetTop-this.iTableOffset;}else{this.centerCurrentRow();}this.bNoRender=false;this.updatePosition(true);if(this.determineDimensions()){this.updateScrollbarSize();if(eRow){this.smartRepositionCurrentRow(iOffsetTop);}else{this.centerCurrentRow();}}if(this.iTableHeight<=0){df.dom.animFrame(function(){if(this.iTableHeight>0){this.centerCurrentRow();}},this);}if(this.bFirstFill){this.bFirstFill=false;this.afterFirstFill();}}if(oEv.sType==="next"){this.updateScrollbarSize();}if(oEv.sType==="prev"){this.iScrollOffsetPx+=oEv.iOffsetChange*(this.iAvgRowHeight||20);this.iRowDispOffset+=oEv.iOffsetChange;this.iRowsDispOffset+=oEv.iOffsetChange;this.iRowDispLast+=oEv.iOffsetChange;this.bNoRender=true;this.updateScrollbarSize();this.eScrollbar.scrollTop=this.eScrollbar.scrollTop+oEv.iOffsetChange*(this.iAvgRowHeight||20);this.bNoRender=false;this.updatePosition();}if(oEv.sType==="row"){this.refreshRow(oEv.sUpdateRowId,oEv.sNewRowId);}if(oEv.sType==="cell"){this.refreshCell(oEv.sUpdateRowId,oEv.oCol);}if(oEv.sType==="newrow"){this.bNoRender=true;this.updateScrollbarSize();this.scrollToCurrentRow();this.bNoRender=false;this.updatePosition(true);}if(oEv.sType==="remrow"){this.bNoRender=true;this.updateScrollbarSize();this.scrollToCurrentRow();this.bNoRender=false;this.updatePosition(true);}},onRowChange:function onRowChange(oEv){if(this.eBody){this.scrollToCurrentRow();df.WebListScrollingView.base.onRowChange.call(this,oEv);}},onSettingChange:function onSettingChange(oEv){if(oEv.sType==="redraw"){this.updatePosition(true);}else if(oEv.sType==="prop"&&oEv.sProp==="pbAutoColumnSizing"){df.dom.toggleClass(this.eTableWrp,"WebList_AutoSize",this.oL.pbAutoColumnSizing);df.dom.toggleClass(this.eTableWrp,"WebList_HorizScroll",!this.oL.pbAutoColumnSizing);}else{df.WebListScrollingView.base.onSettingChange.call(this,oEv);}},scroll:function scroll(iDelta,bSnap,bFromScrollbar){var iOffset;iOffset=this.iScrollOffsetPx;iOffset+=iDelta;this.scrollTo(iOffset,bSnap,bFromScrollbar);},scrollTo:function scrollTo(iOffset,bSnap,bFromScrollbar,bNoBoundaries){if(iOffset!==this.iScrollOffsetPx){this.iScrollOffsetPx=iOffset;this.updatePosition(false,bSnap,!!bNoBoundaries);if(!bFromScrollbar){this.updateScrollbarPos(this.iScrollOffsetPx);}this.onVerticalScroll.fire(this,{iScrollOffsetPx:this.iScrollOffsetPx});this.updateCache();}},updatePosition:function updatePosition(bForceRedraw,bSnap,bNoBoundaries){var oM=this.oM,iViewOffsetPx,iScrollOffsetPx,iRowViewLast=null,iRowDispLast,iRowDispOffset,iRowScrollOffset=null,iEmptyRows=0,i,iTotalPx=0,iViewEndOffsetPx,iRowPx,iMaxPX,iInitScrollOffsetPx,iViewRowOffsetPx;if(!this.eBody||this.bNoRender){return;}bSnap=!!bSnap;bNoBoundaries=!!bNoBoundaries;bForceRedraw=!!bForceRedraw;iMaxPX=this.getMaxPX();iInitScrollOffsetPx=iScrollOffsetPx=this.iScrollOffsetPx;iViewEndOffsetPx=Math.max(iScrollOffsetPx,0)+this.iTableHeight;for(i=0;i<oM.aData.length;i++){iRowPx=this.rowHeightPx(i);if(bSnap&&iRowScrollOffset===null&&iTotalPx+iRowPx>iScrollOffsetPx&&iRowPx<this.iAvgRowHeight*1.5){if(iScrollOffsetPx-iTotalPx<iRowPx/2){iScrollOffsetPx=iTotalPx;}else{iScrollOffsetPx=iTotalPx+iRowPx;}}iTotalPx+=iRowPx;if(iRowScrollOffset===null&&iTotalPx>=iScrollOffsetPx){if(bNoBoundaries){this.iScrollOffsetPx=iScrollOffsetPx;}else{this.iScrollOffsetPx=iScrollOffsetPx=Math.max(0,Math.min(iScrollOffsetPx,iMaxPX));}iViewEndOffsetPx=Math.max(iScrollOffsetPx,0)+this.iTableHeight;iRowScrollOffset=i;iViewRowOffsetPx=iTotalPx-iRowPx;}if(iTotalPx>=iViewEndOffsetPx){iRowViewLast=i;break;}}if(iMaxPX-iInitScrollOffsetPx<this.iAvgRowHeight*0.5){iScrollOffsetPx=iMaxPX;}if(iRowScrollOffset===null){if(bNoBoundaries){this.iScrollOffsetPx=iScrollOffsetPx;}else{this.iScrollOffsetPx=iScrollOffsetPx=Math.max(0,Math.min(iScrollOffsetPx,iMaxPX));}iViewEndOffsetPx=Math.max(iScrollOffsetPx,0)+this.iTableHeight;iRowScrollOffset=0;iViewRowOffsetPx=0;}if(iRowViewLast===null){iRowViewLast=Math.max(0,oM.aData.length-1);}if(iTotalPx<this.iTableHeight){iEmptyRows=(this.iTableHeight-iTotalPx)/(this.iAvgRowHeight||20)+this.iPrefViewOffset;}iRowDispOffset=Math.max(iRowScrollOffset-this.iPrefViewOffset,0);iRowDispLast=Math.min(iRowViewLast+this.iPrefViewOffset,oM.aData.length-1);this.iCalcRowDispLast=iRowDispLast;if(bForceRedraw||iRowScrollOffset<this.iRowDispOffset||iRowViewLast>this.iRowDispLast||this.iCalcEmptyRows!==iEmptyRows){this.iCalcEmptyRows=iEmptyRows;this.refreshDisplay(iRowDispOffset,iRowDispLast);}else{this.adjustDisplay(iRowDispOffset);}iViewOffsetPx=iScrollOffsetPx-(iViewRowOffsetPx-this.combinedRowHeightPx(this.iRowDispOffset,iRowScrollOffset));this.updateScrollOfset(iViewOffsetPx);},refreshDisplay:function refreshDisplay(iRowDispOffset){var aHtml=[];this.iRowDispOffset=iRowDispOffset;this.tableHtml(aHtml);if(df.sys.isIE){while(this.eTable.lastChild){this.eTable.removeChild(this.eTable.lastChild);}}this.eTable.innerHTML=aHtml.join('');this.onRowsRendered.fire(this);this.delayUpdateDimensions(true);},rowHtml:function rowHtml(tRow,aHtml,bZebra){df.WebListScrollingView.base.rowHtml.call(this,tRow,aHtml,bZebra);if(tRow){if(!tRow._iRowHeight){this.aRowHeightProcess.push(tRow.sRowId);}}},tableHtml:function tableHtml(aHtml){var oM=this.oM,i,bZebra=!this.bZebraTop;for(i=this.iRowDispOffset;i<=this.iCalcRowDispLast&&i<oM.aData.length;i++){this.rowHtml(oM.aData[i],aHtml,bZebra);this.iRowDispLast=i;bZebra=!bZebra;}for(i=0;i<this.iCalcEmptyRows;i++){this.rowHtml(null,aHtml,bZebra);bZebra=!bZebra;}this.bZebraBottom=bZebra;},adjustDisplay:function adjustDisplay(iRowDispOffset,iRowDispLast){var oM=this.oM,iAllowedDiff=this.iMaxViewOffsetDiff,bAdd=false;if(this.iRowDispOffset>iRowDispOffset){if(this.iRowDispOffset>iRowDispOffset+iAllowedDiff){while(this.iRowDispOffset>iRowDispOffset){this.iRowDispOffset--;this.insertRow(oM.aData[this.iRowDispOffset],true);bAdd=true;}}if(this.iRowDispLast>iRowDispLast+iAllowedDiff){while(this.iRowDispLast>iRowDispLast){this.removeBottomRow();}}}else{if(this.iRowDispLast<iRowDispLast-iAllowedDiff){while(this.iRowDispLast<iRowDispLast){this.iRowDispLast++;this.insertRow(oM.aData[this.iRowDispLast],false);bAdd=true;}}if(this.iRowDispOffset<iRowDispOffset-iAllowedDiff){while(this.iRowDispOffset<iRowDispOffset){this.removeTopRow();}}}if(bAdd){this.onRowsRendered.fire(this);}},removeTopRow:function removeTopRow(){this.iRowDispOffset++;this.bZebraTop=!this.bZebraTop;while(this.eTable.firstChild.className.indexOf("WebList_Row")<0){this.eTable.removeChild(this.eTable.firstChild);}this.eTable.removeChild(this.eTable.firstChild);},removeBottomRow:function removeBottomRow(){this.iRowDispLast--;while(this.eTable.lastChild.className.indexOf("WebList_Row")<0){this.eTable.removeChild(this.eTable.lastChild);}this.eTable.removeChild(this.eTable.lastChild);this.bZebraBottom=!this.bZebraBottom;},updateScrollOfset:function updateScrollOfset(iOffset){if(this.eTable){this.iTableOffset=iOffset;df.dom.translateY(this.eTable,-iOffset,true);if(this.eTableWrp.scrollTop>0){this.eTableWrp.scrollTop=0;}}},insertRow:function insertRow(tRow,bTop){var eRow,bZebra,aHtml=[];if(bTop){bZebra=this.bZebraTop;this.bZebraTop=!this.bZebraTop;}else{bZebra=this.bZebraBottom;this.bZebraBottom=!this.bZebraBottom;}this.rowHtml(tRow,aHtml,bZebra);eRow=df.dom.create(aHtml.join(''));if(bTop&&this.eTable.firstChild){this.eTable.insertBefore(eRow,this.eTable.firstChild);}else{this.eTable.appendChild(eRow);}},updateRowHeight:function updateRowHeight(sRowId){var oM=this.oM,eRow,iHeight,iMarginTop,iMarginBottom,oStyle,iRow,rect;iRow=oM.rowIndexByRowId(sRowId);if(iRow>=0){eRow=this.row(sRowId);}if(eRow){rect=eRow.getBoundingClientRect();iHeight=rect.height;oStyle=df.sys.gui.getCurrentStyle(eRow);iMarginTop=parseFloat(oStyle.marginTop);iMarginBottom=parseFloat(oStyle.marginBottom);if(eRow===eRow.parentNode.lastChild&&this.iRowDispLast===oM.aData.length-1&&(oM.bLast||!oM.bPaged)){iHeight+=iMarginTop+iMarginBottom;}else{iHeight+=Math.max(iMarginTop,iMarginBottom);}oM.aData[iRow]._iRowHeight=iHeight;}},updateAvgRowHeight:function updateAvgRowHeight(){var iSum=0,iCount=0;this.oM.aData.forEach(function(tRow){if(tRow._iRowHeight){iCount++;iSum+=tRow._iRowHeight;}});if(iCount){this.iAvgRowHeight=iSum/iCount;}},processRowHeights:function processRowHeights(){var sRowId,bChange=false;while(sRowId=this.aRowHeightProcess.pop()){bChange=true;this.updateRowHeight(sRowId);}if(bChange){this.iMaxPX=null;this.updateAvgRowHeight();}return bChange;},rowHeightPx:function rowHeightPx(iRow){var iHeightPx,tRow=this.oM.aData[iRow];if(tRow._iRowHeight){iHeightPx=tRow._iRowHeight;}else{iHeightPx=this.iAvgRowHeight||20;}if(tRow._iRowHeightExtra){iHeightPx+=tRow._iRowHeightExtra;}return iHeightPx;},combinedRowHeightPx:function combinedRowHeightPx(iStart,iTo){var oM=this.oM,i,iHeightPx=0;for(i=iStart;i<oM.aData.length&&i<iTo;i++){iHeightPx+=this.rowHeightPx(i);}return iHeightPx;},snapToRow:function snapToRow(iOffsetPx){var oM=this.oM,iRowPx,iTotalPx=0,i;for(i=0;i<oM.aData.length;i++){iRowPx=this.rowHeightPx(i);if(iTotalPx+iRowPx>iOffsetPx){if(iOffsetPx-iTotalPx<iRowPx/2){return iTotalPx;}else{return iTotalPx+iRowPx;}}iTotalPx+=iRowPx;}return iTotalPx;},getMaxPX:function getMaxPX(){if(this.iMaxPX){return this.iMaxPX;}return this.iMaxPX=Math.max(this.combinedRowHeightPx(0,this.oM.aData.length)-this.iTableHeight,0);},updateScrollbarSize:function updateScrollbarSize(){var iHeight=this.combinedRowHeightPx(0,this.oM.aData.length);if(this.eScrollStretch&&this.eScrollStretch.clientHeight!==iHeight){this.eScrollStretch.style.height=iHeight+"px";}},updateScrollbarPos:function updateScrollbarPos(iOffset){var bDirty,that=this;if(this.eScrollbar){this.eScrollbar.scrollTop=this.iLastScrollbarSet=iOffset;this.bScrollbarDirty=bDirty=Math.abs(this.eScrollbar.scrollTop-this.iLastScrollbarSet)>5;if(bDirty){setTimeout(function(){if(that.bScrollbarDirty&&that.eScrollbar.scrollTop!==that.iLastScrollbarSet){that.eScrollbar.scrollTop=that.iLastScrollbarSet;}that.bScrollbarDirty=false;},300);}}},onScrollbarScroll:function onScrollbarScroll(oEv){var iOffset=this.eScrollbar.scrollTop;if(Math.abs(iOffset-this.iLastScrollbarSet)>2&&!this.bScrollbarDirty){this.iAutoScroll=0;this.iLastScrollbarSet=iOffset;this.scrollTo(iOffset,true,true);}},onMouseWheelScroll:function onMouseWheelScroll(oEv){var iDelta=oEv.getMouseWheelDelta();this.iAutoScroll=0;if(iDelta>0){this.scroll(-((this.iAvgRowHeight||20)*2),true);}else if(iDelta<0){this.scroll((this.iAvgRowHeight||20)*2,true);}oEv.stop();},updateCache:function updateCache(){this.oC.triggerCacheUpdate(this.iRowDispOffset,this.iRowDispLast);},centerCurrentRow:function centerCurrentRow(){var oM=this.oM,iOffsetPx,iRow;iRow=oM.iCurrentRow;if(iRow>=0&&this.iTableHeight>0){iOffsetPx=this.combinedRowHeightPx(0,iRow);iOffsetPx=iOffsetPx-this.iTableHeight/2+this.rowHeightPx(iRow)/2;this.scrollTo(iOffsetPx,true,false);}},smartRepositionCurrentRow:function smartRepositionCurrentRow(iOffsetTop){var iRow,iOffsetPx;iRow=this.oM.iCurrentRow;if(iRow>=0){iOffsetPx=this.combinedRowHeightPx(0,iRow);iOffsetPx-=iOffsetTop;if(iOffsetPx>0){this.scrollTo(iOffsetPx,true,false);}this.scrollToCurrentRow();}},scrollToCurrentRow:function scrollToCurrentRow(){var oM=this.oM,iOffsetPx,iRow,iRowPx;iRow=oM.iCurrentRow;if(iRow>=0){iOffsetPx=this.combinedRowHeightPx(0,iRow);iRowPx=this.rowHeightPx(iRow);if(iOffsetPx<this.iScrollOffsetPx){this.scrollTo(iOffsetPx,true,false);}else if(iOffsetPx+iRowPx>this.iScrollOffsetPx+this.iTableHeight){iOffsetPx=iOffsetPx+iRowPx-this.iTableHeight;this.scrollTo(iOffsetPx,false,false);}}},scrollToCol:function scrollToCol(iCol){var oL=this.oL,eCell;if(!oL.pbAutoColumnSizing){eCell=this.colCellByIndex(iCol);if(!eCell){eCell=this.eBody&&df.dom.query(this.eBody,"td[data-dfcol='"+iCol+"']")||null;}if(eCell){if(eCell.offsetLeft<this.eTableWrp.scrollLeft){oL._oBody.scrollToHoriz(eCell.offsetLeft);}else if(eCell.offsetLeft+eCell.offsetWidth>this.eTableWrp.clientWidth+this.eTableWrp.scrollLeft){oL._oBody.scrollToHoriz(Math.min(eCell.offsetLeft,eCell.offsetLeft+eCell.offsetWidth-this.eTableWrp.clientWidth));}}}},scrollToHoriz:function scrollToHoriz(iScrollX){this.eTableWrp.scrollLeft=iScrollX;},setHeight:function setHeight(iHeight){iHeight-=df.sys.gui.getVertBoxDiff(this.eBody);iHeight-=df.sys.gui.getVertBoxDiff(this.eBodyWrp);iHeight=Math.max(iHeight,0);this.eBody.style.height=iHeight+"px";this.eScrollbar.style.height=(df.dom.clientHeight(this.eTableWrp)||iHeight||0)+"px";},determineDimensions:function determineDimensions(){var bChanged=false;if(this.eBody){this.iPrevTableHeight=this.iTableHeight;this.iTableHeight=this.eTableWrp.clientHeight||this.iTableHeight;bChanged=bChanged||this.iPrevTableHeight!==this.iTableHeight;bChanged=bChanged||this.processRowHeights();}return bChanged;},updateDimensions:function updateDimensions(bForceRedraw){if(this.determineDimensions()){if(bForceRedraw){this.oM.aData.forEach(function(tRow){tRow._iRowHeight=null;});}this.updateScrollbarSize();this.updatePosition(bForceRedraw);}},delayUpdateDimensions:function delayUpdateDimensions(bForceRedraw){this.bDelUpdDimForced=this.bDelUpdDimForced||!!bForceRedraw;if(!this.bDelUpdDim){df.dom.animFrame(function(){this.updateDimensions(this.bDelUpdDimForced);this.bDelUpdDim=false;this.bDelUpdDimForced=false;},this);this.bDelUpdDim=true;}},onResize:function onResize(oEv){if(this.oInitialFullEvent){this.determineDimensions();this.onDataUpdate(this.oInitialFullEvent);this.oInitialFullEvent=null;}else{this.updateDimensions(true);}},onContentLoaded:function onContentLoaded(oEv){var sRowId,eElem=oEv.getTarget();while(eElem&&eElem!==this.eTableWrp){if(eElem.hasAttribute("data-dfrowid")){sRowId=eElem.getAttribute("data-dfrowid");if(this.aRowHeightProcess.indexOf(sRowId)<=0){this.aRowHeightProcess.push(sRowId);this.delayUpdateDimensions(false);}return;}eElem=eElem.parentNode;}},scrollbarWidth:function scrollbarWidth(){return this.eBody&&this.eBody.clientWidth-this.eTableWrp.clientWidth||0;},getViewSize:function getViewSize(){if(this.iTableHeight&&this.iAvgRowHeight){return this.iTableHeight/this.iAvgRowHeight;}return 10;},setExtraRowHeight:function setExtraRowHeight(sRowId,iExtra){var oM=this.oM,iRow;iRow=oM.rowIndexByRowId(sRowId);if(iRow>=0){oM.aData[iRow]._iRowHeightExtra=iExtra;this.iMaxPX=null;this.updateScrollbarSize();}},getExtraRowHeight:function getExtraRowHeight(sRowId){var oM=this.oM,iRow;iRow=oM.rowIndexByRowId(sRowId);if(iRow>=0){return oM.aData[iRow]._iRowHeightExtra||0;}},onHorizbarScroll:function onHorizbarScroll(oEv){this.onHorizontalScroll.fire(this,{nScrollX:this.eTableWrp.scrollLeft});}});df.WebListRowModel=function WebListRowModel(oList,oModel){this.oL=oList;this.oM=oModel;this.iColMin=20;this.iRound=df.sys.isIE&&df.sys.iVersion<=8?1:100;this.sTableWidth="100%";oList._onSettingChange.on(this.onSettingChange,this);};df.defineClass("df.WebListRowModel",{init:function init(){this.prepareLayout();},onSettingChange:function onSettingChange(oEv){if(oEv.sType==="prepare-redraw"){this.prepareLayout();}},rowHtml:function rowHtml(tRow,aHtml,bZebra){var oL=this.oL,sTooltip,i,oCol;if(tRow&&tRow.aCells.length<oL._aColumns.length+oL._aSwipeBtns.length){throw new df.Error(999,"List data is not containing enough columns ({{0}} / {{1}}).",this,[tRow.aCells.length,oL._aColumns.length+oL._aSwipeBtns.length]);}aHtml.push('<table data-dfisrow="true" data-dfrowid="',tRow?tRow.sRowId:"empty",this.oL.pbDragDropEnabled&&this.oL.isSupportedDragAction(df.dragActions.WebList.ciDragRow)?'" draggable="true"':'" ','" class="',this.rowClass(tRow,bZebra),'" style="width:',this.sTableWidth,'">');this.resizeRowHtml(aHtml);for(i=0;i<this.oL._aColumnMapper.length;i++){if(!this.oL._aColumnMapper[i].pbRender||this.oL._aColumnMapper[i].pbHidden)continue;oCol=this.oL._aColumnMapper[i];if(oCol.pbNewLine){aHtml.push('</tr><tr>');}sTooltip=tRow&&(tRow.aCells[oCol._iColIndex].sTooltip||oCol.pbValueAsTooltip&&oCol.tooltipValue(tRow.aCells[oCol._iColIndex]))||"";var sClassSpecifier=tRow&&tRow.fCellClass?tRow.fCellClass(oCol,tRow&&tRow.aCells[oCol._iColIndex]||null):this.cellClass(oCol,tRow&&tRow.aCells[oCol._iColIndex]||null);aHtml.push('<td data-dfcol="',oCol._iCol,'" class="',sClassSpecifier,'" title="',df.dom.encodeAttr(sTooltip),'"');if(oCol.piListRowSpan>1){aHtml.push(' rowspan="',oCol.piListRowSpan,'"');}if(oCol.piListColSpan>1){aHtml.push(' colspan="',oCol.piListColSpan,'"');}if(!oCol.pbVisible){aHtml.push(df.cHideColumnCSS);}aHtml.push('>',tRow?this.cellHtml(oCol,tRow,tRow.aCells[oCol._iColIndex]):'&nbsp;','</td>');}aHtml.push('</tr></table>');},cellClass:function cellClass(oCol,tCell){var aClasses=[];aClasses.push(oCol._sCellClass);aClasses.push(oCol.isEnabled()?df.CssEnabled:df.CssDisabled);if(oCol.pbEditable&&this.oL._sControlClass==="WebGrid"){aClasses.push("WebEditable");}aClasses.push(oCol.peAlign===df.ciAlignLeft?"WebList_AlignLeft":oCol.peAlign===df.ciAlignCenter?"WebList_AlignCenter":oCol.peAlign===df.ciAlignRight?"WebList_AlignRight":"");if(oCol.peDataType===df.ciTypeBCD){aClasses.push("dfData_BCD");}else if(oCol.peDataType===df.ciTypeDate){aClasses.push("dfData_Date");}else{aClasses.push("dfData_Text");}if(oCol.psCSSClass){aClasses.push(oCol.psCSSClass);}if(tCell&&tCell.sCssClassName){aClasses.push(tCell.sCssClassName);}return aClasses.join(" ");},rowClass:function rowClass(tRow,bZebra){var aClasses=["WebList_Row"];if((tRow&&tRow.sRowId)===this.oM.sCurrentRowId){aClasses.push("WebList_Selected");}aClasses.push(bZebra?' WebList_RowOdd':' WebList_RowEven');if(!tRow){aClasses.push("WebList_RowEmpty");}if(tRow&&tRow.sCssClassName){aClasses.push(tRow.sCssClassName);}return aClasses.join(" ");},cellHtml:function cellHtml(oCol,tRow,tCell){var bFocus,sHtml;tCell=tCell||{sValue:"",sTooltip:"",sCssClassName:"",aOptions:[]};bFocus=oCol._bHasFocus;oCol._bHasFocus=false;sHtml=tRow&&tRow.fCellHtml?tRow.fCellHtml.call(oCol,tCell):oCol.cellHtml(tCell);oCol._bHasFocus=bFocus;return sHtml;},resizeRowHtml:function resizeRowHtml(aHtml){var i,aCols=this.aColWidths,bAllFixed=!this.oL.pbAutoColumnSizing;aHtml.push('<colgroup>');for(i=0;i<aCols.length;i++){if(bAllFixed||aCols[i].bFixed){aHtml.push('<col data-dfcol="',aCols[i].oCol._iCol,'" style="width: ',aCols[i].iPixels,'px"></col>');}else{aHtml.push('<col data-dfcol="',aCols[i].oCol._iCol,'" style="width: ',aCols[i].iPercent,'%"></col>');}}aHtml.push('</colgroup>');},prepareLayout:function prepareLayout(){var oL=this.oL,aTable=[],iCol,i,iCols=0,iRow=0,iCell=0,aColWidths=[],iTotalPx=0,iFixed=0,iRatio=0,oCol,x,y;for(i=0;i<this.oL._aColumnMapper.length;i++){if(!this.oL._aColumnMapper[i].pbRender||this.oL._aColumnMapper[i].pbHidden)continue;oCol=this.oL._aColumnMapper[i];oCol.piListColSpan=Math.max(oCol.piListColSpan,1);oCol.piListRowSpan=Math.max(oCol.piListRowSpan,1);if(oCol.pbNewLine&&aTable.length>0){if(aTable[iRow].length>iCols){iCols=aTable[iRow].length;}iRow++;iCell=0;}while(aTable[iRow]&&aTable[iRow][iCell]){iCell++;}for(x=0;x<oCol.piListRowSpan;x++){if(!aTable[iRow+x]){aTable[iRow+x]=[];}for(y=0;y<oCol.piListColSpan;y++){aTable[iRow+x][iCell+y]=oCol;}}iCell+=oCol.piListColSpan;}if(aTable[iRow]&&aTable[iRow].length>iCols){iCols=aTable[iRow].length;}for(iCol=0;iCol<iCols;iCol++){aColWidths[iCol]={bDef:false,bGues:false,bFixed:false,iWidth:0,oCol:null};for(iRow=0;iRow<aTable.length;iRow++){oCol=aTable[iRow][iCol];if(oCol){if(oCol.piListColSpan===1){aColWidths[iCol].bDef=true;aColWidths[iCol].bFixed=oCol.pbFixedWidth;aColWidths[iCol].iWidth=oCol.piWidth;aColWidths[iCol].oCol=oCol;break;}else if(!aColWidths[iCol].bGues){aColWidths[iCol].bGues=true;aColWidths[iCol].bFixed=oCol.pbFixedWidth;aColWidths[iCol].iWidth=oCol.piWidth/oCol.piListColSpan;aColWidths[iCol].oCol=oCol;}}}if(aColWidths[iCol].bFixed){iFixed+=aColWidths[iCol].iWidth;}else{iRatio+=aColWidths[iCol].iWidth;}}for(iCol=0;iCol<aColWidths.length;iCol++){iTotalPx+=aColWidths[iCol].iWidth;aColWidths[iCol].iPixels=aColWidths[iCol].iWidth;if(!aColWidths[iCol].bFixed){aColWidths[iCol].iPercent=Math.floor(aColWidths[iCol].iWidth*(100/iRatio)*this.iRound)/this.iRound;}}this.aColWidths=aColWidths;if(this.oL.pbAutoColumnSizing){this.sTableWidth="100%";}else{this.sTableWidth=iTotalPx+"px";}},recalcColumnSizes:function recalcColumnSizes(iVCol,iDiff,bOverrideResizable){var i,iTotal=0,iColDiff,iColls=0,iLast,iRatio,iPixels,iChanged;if(this.oL.pbAutoColumnSizing){iRatio=this.calcPixelRatio();for(i=iVCol+1;i<this.aColWidths.length;i++){if(this.aColWidths[i].bFixed){iTotal+=this.aColWidths[i].iPixels;}else{iTotal+=this.aColWidths[i].iPercent*iRatio;}if(this.aColWidths[i].oCol.pbResizable||bOverrideResizable){iColls++;}}if(this.aColWidths[iVCol].bFixed){this.aColWidths[iVCol].iPixels=this.aColWidths[iVCol].iPixels+iDiff;}else{this.aColWidths[iVCol].iPercent=(this.aColWidths[iVCol].iPercent*iRatio+iDiff)/iRatio;}while(Math.round(iDiff||0)!==0&&iDiff!==iLast){iColDiff=iDiff/iColls;iLast=iDiff;for(i=iVCol+1;i<this.aColWidths.length;i++){if(this.aColWidths[i].oCol.pbResizable||bOverrideResizable){iPixels=this.aColWidths[i].bFixed?this.aColWidths[i].iPixels:this.aColWidths[i].iPercent*iRatio;iChanged=iPixels-iColDiff;if(iChanged<this.iColMin){iChanged=this.iColMin;}if(this.aColWidths[i].bFixed){this.aColWidths[i].iPixels=iChanged;}else{this.aColWidths[i].iPercent=iChanged/iRatio;}iDiff-=iPixels-iChanged;}}}for(i=0;i<this.aColWidths.length;i++){if(this.aColWidths[i].bFixed){this.aColWidths[i].oCol.piWidth=this.aColWidths[i].iPixels;}else{this.aColWidths[i].oCol.piWidth=this.aColWidths[i].iPercent*10;}this.aColWidths[i].oCol.addSync("piWidth");}}else{this.aColWidths[iVCol].oCol.piWidth=this.aColWidths[iVCol].iPixels=this.aColWidths[iVCol].iPixels+iDiff;this.aColWidths[iVCol].oCol.addSync("piWidth");}this.oL.redraw();},calcPixelRatio:function calcPixelRatio(){var i,iFullWidth;iFullWidth=this.oL._oBody.fullwidth();for(i=0;i<this.aColWidths.length;i++){if(this.aColWidths[i].bFixed){iFullWidth-=this.aColWidths[i].iPixels;}}return iFullWidth/100;},findVColNr:function findVColNr(oCol){var oL=this.oL,iVCol=0,i,oCur;for(i=0;i<oL._aColumnMapper.length;i++){oCur=oL._aColumnMapper[i];if(oCur.pbRender){if(oCur.pbNewLine){iVCol=0;}if(oCur===oCol){return iVCol;}iVCol+=oCur.piListColSpan;}}return-1;}});df.WebListPlaceHolderView=function WebListPlaceHolderView(oList,oModel){this.oL=oList;this.oM=oModel;this.eElem=null;oModel.onDataUpdate.on(this.onDataUpdate,this);oList._onSettingChange.on(this.onSettingChange,this);};df.defineClass("df.WebListPlaceHolderView",{genHtml:function genHtml(aHtml){var oL=this.oL;aHtml.push('<div class="WebList_PlaceHolder"',oL.psPlaceHolder&&this.oM.aData.length===0?'':' style="display: none"','>',df.dom.encodeHtml(oL.psPlaceHolder),'</div>');},afterRender:function afterRender(eList){this.eElem=df.dom.query(eList,"div.WebList_PlaceHolder");},onDataUpdate:function onDataUpdate(oEv){if(this.oL.psPlaceHolder&&this.eElem){this.eElem.style.display=this.oM.aData.length===0?'':'none';}},onSettingChange:function onSettingChange(oEv){var oL=this.oL;if(this.eElem&&oEv.sType==="prop"&&oEv.sProp==="psPlaceHolder"){if(!oL.psPlaceHolder){this.eElem.style.display="none";}else{df.dom.setText(this.eElem,oL.psPlaceHolder);}}}});df.WebListModel=function WebListModel(oList){this.oL=oList;this.bPaged=false;this.sCurrentRowId=oList.psCurrentRowId;this.iCurrentRow=-1;this.aData=[];this.onDataUpdate=new df.events.JSHandler();this.onBeforeDataUpdate=new df.events.JSHandler();this.onBeforeRowChange=new df.events.JSHandler();this.onRowChange=new df.events.JSHandler();this.onAfterRowChange=new df.events.JSHandler();oList._onSettingChange.on(this.onSettingChange,this);};df.defineClass("df.WebListModel",{handleData:function handleData(aRows){this.onBeforeDataUpdate.fire(this);this.aData=aRows;this.sortData();this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);if(this.iCurrentRow<0&&this.aData.length>0){this.iCurrentRow=0;this.sCurrentRowId=this.aData[0].sRowId;}this.onDataUpdate.fire(this,{sType:"full"});},sortData:function sortData(){var oL=this.oL;if(oL.piSortColumn>=0){var iCol,bRev,aCompare,i;iCol=oL._aColumns[oL.piSortColumn]._iColIndex;bRev=oL.pbReverseOrdering;aCompare=[];for(i=0;i<oL._aColumns.length;i++){aCompare[i]=df.sys.data.compareFunction(oL._aColumns[i].peDataType);}this.aData.sort(function(oItem1,oItem2){var i,x;if(oItem1.aCells[iCol].sValue!==oItem2.aCells[iCol].sValue){x=aCompare[iCol](oItem1.aCells[iCol].sValue,oItem2.aCells[iCol].sValue);return bRev?-x:x;}for(i=0;i<oItem1.aCells.length;i++){if(oItem1.aCells[i].sValue!==oItem2.aCells[i].sValue){x=aCompare[i](oItem1.aCells[i].sValue,oItem2.aCells[i].sValue);return bRev?-x:x;}}return 0;});return true;}return false;},rowIndexByRowId:function rowIndexByRowId(sRowId){var i;for(i=0;i<this.aData.length;i++){if(this.aData[i].sRowId===sRowId){return i;}}return-1;},rowIdByRowIndex:function rowIdByRowIndex(iRowIndex){return this.aData[iRowIndex]?this.aData[iRowIndex].sRowId:null;},setCurrentRowId:function setCurrentRowId(sRowId){if(this.sCurrentRowId!==sRowId){var oOptions={sPrevRowId:this.sCurrentRowId,iPrevRowIndex:this.iCurrentRow,sGotoRowId:sRowId,iGotoRowIndex:this.rowIndexByRowId(sRowId)};this.sCurrentRowId=oOptions.sGotoRowId;this.iCurrentRow=oOptions.iGotoRowIndex;this.onRowChange.fire(this,oOptions);}},updateRow:function updateRow(sRowId,tRow){var iRow=this.rowIndexByRowId(sRowId);if(iRow>=0){this.onBeforeDataUpdate.fire(this);this.aData[iRow]=tRow;if(this.sCurrentRowId===sRowId||this.sCurrentRowId===tRow.sRowId){this.sCurrentRowId=tRow.sRowId;this.iCurrentRow=iRow;}this.onDataUpdate.fire(this,{sType:"row",sUpdateRowId:sRowId,sNewRowId:tRow.sRowId});}},removeRow:function removeRow(sRowId){var iRow=this.rowIndexByRowId(sRowId);if(iRow>=0){if(this.iCurrentRow>iRow){this.iCurrentRow--;}this.aData.splice(iRow,1);this.onDataUpdate.fire(this,{sType:"remrow",sRowId:sRowId,iRowIndex:iRow});}},appendRow:function appendRow(tRow){this.aData.push(tRow);if(this.sortData()){this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);}this.onDataUpdate.fire(this,{sType:"newrow",sRowId:tRow.sRowId});},insertBefore:function insertBefore(sBeforeRowId,tRow){var iBefore=this.rowIndexByRowId(sBeforeRowId);if(iBefore<0){iBefore=this.aData.length;}if(iBefore<=this.iCurrentRow){this.iCurrentRow++;}this.aData.splice(iBefore,0,tRow);if(this.sortData()){this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);}this.onDataUpdate.fire(this,{sType:"newrow",sRowId:tRow.sRowId});},insertAfter:function insertAfter(sAfterRowId,tRow){var iAfter=this.rowIndexByRowId(sAfterRowId);if(iAfter<0||iAfter+1==this.aData.length){this.appendRow(tRow);}else{this.insertBefore(this.aData[iAfter+1].sRowId,tRow);}},updateCell:function updateCell(oCol,sVal){if(this.iCurrentRow>=0){this.onBeforeDataUpdate.fire(this);this.aData[this.iCurrentRow].aCells[oCol._iColIndex].sValue=sVal;this.onDataUpdate.fire(this,{sType:"cell",sUpdateRowId:this.sCurrentRowId,oCol:oCol});}},updateSorting:function updateSorting(){var oL=this.oL;if(!this.bPaged&&oL.piSortColumn>=0){this.handleData(this.aData,"page","",true,true);}},onSettingChange:function onSettingChange(oEv){if(oEv.sType==="prop"){switch(oEv.sProp){case"piSortColumn":case"pbReverseOrdering":this.updateSorting();break;}}if(oEv.sType==="sorting"){this.updateSorting();}}});df.WebListPagedModel=function WebListPagedModel(oList){df.WebListPagedModel.base.constructor.call(this,oList);this.bFirst=false;this.bLast=false;this.bPaged=true;this.iPrefCacheOffset=25;};df.defineClass("df.WebListPagedModel","df.WebListModel",{handleData:function handleData(aRows,sType,sStartRowId,bFirst,bLast){var oOptions={sType:"",iOffsetChange:0,sUpdateRowId:""};this.onBeforeDataUpdate.fire(this);if(sType==="page"){this.aData=aRows;this.bLast=bLast;this.bFirst=bFirst;this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);if(this.iCurrentRow<0&&bLast&&bFirst){if(this.aData.length>0){this.iCurrentRow=0;this.sCurrentRowId=this.aData[0].sRowId;}}oOptions.sType="full";}if(sType==="first"){this.aData=aRows;this.bLast=bLast;this.bFirst=bFirst;this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);oOptions.sType="full";}if(sType==="last"){aRows.reverse();this.aData=aRows;this.bLast=bLast;this.bFirst=bFirst;this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);oOptions.sType="full";}if(sType==="next"){this.aData=this.aData.concat(aRows);this.bLast=bLast;oOptions.sType="next";}if(sType==="prev"){aRows.reverse();this.aData=aRows.concat(this.aData);this.bFirst=bFirst;oOptions.iOffsetChange=aRows.length;oOptions.sType="prev";this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);}this.onDataUpdate.fire(this,oOptions);},updateSorting:function updateSorting(){},sortData:function sortData(){}});df.WebListHeaderView=function WebListHeaderView(oList,oModel,oController){this.oL=oList;this.oC=oController;this.oR=oList._oRowRenderer;this._oHeaderMenu=null;this._oHeaderMenuColumnList=null;this._oHeaderMenuRestore=null;this._bHeaderMenuPreviousState=true;this._oColumnNewLineCache=[];oList._onResize.on(this.onResize,this);oList._onSettingChange.on(this.onSettingChange,this);oList._onModulesCreated.on(this.onModulesCreated,this);};df.defineClass("df.WebListHeaderView",{onModulesCreated:function onModulesCreated(oEv){var oV=this.oL._oBody;if(oV instanceof df.WebListScrollingView){oV.onHorizontalScroll.on(this.onHorizontalScroll,this);}},genHtml:function genHtml(aHtml){var oL=this.oL;aHtml.push('<div class="WebList_Head"',oL.pbShowHeader?'':' style="display:none"','>');aHtml.push('<div class="WebList_HeadWrp',oL.pbColumnsResizable?' WebList_ColResizable':'',oL.pbAutoColumnSizing?" WebList_AutoSize":" WebList_HorizScroll",'">');this.headerHtml(aHtml);aHtml.push('</div>');aHtml.push('</div>');},afterRender:function afterRender(eList){this.eHead=df.dom.query(eList,"div.WebList_Head");this.eHeadWrp=df.dom.query(eList,"div.WebList_HeadWrp");df.dom.on("click",this.eHead,this.onHeadClick,this);df.dom.on("mousedown",this.eHead,this.onHeadMouseDown,this);df.dom.on("dblclick",this.eHead,this.onHeadDblClick,this);this.changeColumnReorderingState(this.oL.pbAllowColumnReordering);},recreateHeaderMenu:function recreateHeaderMenu(){this.destoryHeaderMenu();this.createHeaderMenu();},destoryHeaderMenu:function destoryHeaderMenu(){if(this._oHeaderMenuColumnList!==null){this._oHeaderMenuColumnList.destroy();this._oHeaderMenuColumnList=null;}if(this._oHeaderMenuRestore!==null){this._oHeaderMenuRestore.destroy();this._oHeaderMenuRestore=null;}if(this._oHeaderMenu!==null){this._oHeaderMenu.destroy();this._oHeaderMenu=null;}},createHeaderMenu:function createHeaderMenu(){if(df.sys.isMobile||df.sys.isIE&&df.sys.iVersion<11)return;if(!this.oL.pbAllowColumnReordering&&!this.oL.pbAllowColumnHiding)return;var oWebApp=this.oL.getWebApp();this._oHeaderMenu=new df.WebContextMenu("ShowHideMenu",this.oL);this._oHeaderMenu.set_psControlName(this.oL.getLongName());this._oHeaderMenu.set_psContextCSSSelector(".WebList_Head");if(this.oL.pbAllowColumnHiding){this._oHeaderMenuColumnList=this._oHeaderMenu.createMenuItem(oWebApp.getTrans("weblist_HeaderMenuSelectorMenuName"));this._oHeaderMenu.addChild(this._oHeaderMenuColumnList);}this._oHeaderMenuRestore=this._oHeaderMenu.createMenuItem(oWebApp.getTrans("weblist_HeaderMenuRestoreMenuName"));this._oHeaderMenuRestore.OnClick.on(function(){this.oL.restoreColumnMapperDefaults(true);this.oL.triggerLayoutChange(this._oHeaderMenuRestore);},this);this._oHeaderMenu.addChild(this._oHeaderMenuRestore);this._oHeaderMenu.create();this._oHeaderMenu.render();this._oHeaderMenu.afterRender();this.rebuildHeaderMenu();document.body.appendChild(this._oHeaderMenu._eElem);},onHeadMouseDownWithDraggingProxy:function onHeadMouseDownWithDraggingProxy(oEv){this.onHeadMouseDown(oEv,true);},changeColumnReorderingState:function changeColumnReorderingState(bVal){if(bVal&&!df.sys.isMobile){df.dom.on("dragstart",this.eHead,this.onHeadMouseDownWithDraggingProxy,this);}else{df.dom.off("dragstart",this.eHead,this.onHeadMouseDownWithDraggingProxy,this);}this.recreateHeaderMenu();},rebuildHeaderMenu:function rebuildHeaderMenu(){var oL=this.oL;var that=this;if(!this._oHeaderMenuColumnList)return;this._oHeaderMenuColumnList._aChildren=[];for(var i=0;i<this.oL._aColumns.length;i++){if(!this.oL._aColumns[i].pbRender||this.oL._aColumns[i].psCaption.length===0)continue;var oItem=this._oHeaderMenu.createCheckedMenuItem(this.oL._aColumns[i].psCaption,this.oL._aColumns[i].pbHidden==false);oItem._oColumnRef=this.oL._aColumns[i];oItem.OnClick.on(function(oEv){var aFilteredVisible=that.oL._aColumns.filter(function(oCol){return oCol.pbRender&&!oCol.pbHidden&&oCol.psCaption.length!==0;});if(aFilteredVisible.length<=1){this.set_pbChecked(true);this._oColumnRef.set_pbHidden(false);}else{this.set_pbChecked(!this._oColumnRef.pbHidden);this._oColumnRef.set_pbHidden(!this._oColumnRef.pbHidden);}oL.triggerLayoutChange(this._oColumnRef);oEv.stop();},oItem);this._oHeaderMenuColumnList.addChild(oItem);}this._oHeaderMenu.refreshMenu();},headerHtml:function headerHtml(aHtml){var oL=this.oL,oR=this.oR,sCssClass,oCol,oLast=null;aHtml.push('<table style="width:',oR.sTableWidth,'">');oR.resizeRowHtml(aHtml);aHtml.push('<tr>');oLast=this.oL._aColumnMapper[this.oL._aColumnMapper.length-1];for(var i=0;i<this.oL._aColumnMapper.length;i++){if(!this.oL._aColumnMapper[i].pbRender||this.oL._aColumnMapper[i].pbHidden)continue;oCol=this.oL._aColumnMapper[i];if(oCol.pbNewLine){aHtml.push('</tr><tr>');}sCssClass="WebList_ColHead";if(oCol._iCol===oL.piSortColumn){sCssClass+=!oL.pbReverseOrdering?" WebList_SortedReverse":" WebList_Sorted";}if(oL.pbColumnSortable&&oCol.pbSortable){sCssClass+=" WebList_Sortable";}sCssClass+=" "+this.oR.cellClass(oCol,null);aHtml.push('<th ',this.oL.pbAllowColumnReordering?'draggable="true"':'',' class="',sCssClass,'" data-dfcol="',oCol._iCol,'"');if(oCol.piListRowSpan>1){aHtml.push(' rowspan="',oCol.piListRowSpan,'"');}if(oCol.piListColSpan>1){aHtml.push(' colspan="',oCol.piListColSpan,'"');}if(oCol.psToolTip){aHtml.push(' title="',df.dom.encodeHtml(oCol.psToolTip),'"');}if(!oCol.pbVisible){aHtml.push(df.cHideColumnCSS);}aHtml.push('><div>');aHtml.push('<div class="WebList_ColCap">',oCol.psCaption&&oCol.pbShowCaption?oCol.psCaption:'&nbsp;','</div>');if(oCol.pbResizable&&(!oL.pbAutoColumnSizing||oCol!==oLast)){aHtml.push('<div class="WebList_ColSep" data-dfcol="',oCol._iCol,'"></div>');}aHtml.push('</div></th>');}aHtml.push('</tr></table>');},updateHeader:function updateHeader(){var aHtml=[];if(this.oL.pbAllowColumnHiding)this.rebuildHeaderMenu();if(this.eHeadWrp){this.headerHtml(aHtml);this.eHeadWrp.innerHTML=aHtml.join("");}},offsetHeight:function offsetHeight(){if(this.eHead){return this.eHead.offsetHeight;}},onHeadClick:function onHeadClick(oEv){var eElem=oEv.getTarget(),iCol;if(!this.oL.isEnabled()){return;}while(eElem.parentNode&&eElem!==this._eHead){if(eElem.tagName==="TH"&&eElem.hasAttribute("data-dfcol")){iCol=parseInt(eElem.getAttribute("data-dfcol"),10);if(this.oC.headClick(oEv,iCol)){oEv.stop();}return;}eElem=eElem.parentNode;}},onHeadDblClick:function onHeadDblClick(oEv){var eElem=oEv.getTarget(),iCol;if(!this.oL.isEnabled()){return;}while(eElem.parentNode&&eElem!==this._eHead){if(eElem.tagName==="TH"&&eElem.hasAttribute("data-dfcol")){iCol=parseInt(eElem.getAttribute("data-dfcol"),10);if(this.oC.headDblClick(oEv,iCol)){oEv.stop();}return;}eElem=eElem.parentNode;}},onHeadMouseDown:function onHeadMouseDown(oEv,bDragging){var eTarget=oEv.getTarget();if(!this.oL.isEnabled()){oEv.stop();return false;}if(oEv.e.button!==0)return;if(this._oHeaderMenu&&this._oHeaderMenu.isVisible()){this._oHeaderMenu.hideMenu();return;}if(eTarget.className==='WebList_ColSep'&&this.oL.pbColumnsResizable){if(this._oHeaderMenu){this._bHeaderMenuPreviousState=this._oHeaderMenu.isEnabled();this._oHeaderMenu.disable();}this.resizeColumn(oEv,parseInt(eTarget.getAttribute('data-dfcol'),10));oEv.stop();return false;}else if((eTarget.classList.contains('WebList_ColHead')||eTarget.className==='WebList_ColCap')&&this.oL.pbAllowColumnReordering&&bDragging){if(this._oHeaderMenu){this._bHeaderMenuPreviousState=this._oHeaderMenu.isEnabled();this._oHeaderMenu.disable();}while(!eTarget.classList.contains('WebList_ColHead')){eTarget=eTarget.parentNode;}var iColumn=parseInt(eTarget.getAttribute('data-dfcol'),10);var that=this;this._oColumnNewLineCache=[];for(var i=0;i<this.oL._aColumnMapper.length;i++){if(this.oL._aColumnMapper[i].pbNewLine){this._oColumnNewLineCache.push(i);this.oL._aColumnMapper[i].pbNewLine=false;}}if(this._oColumnNewLineCache.length>0)this.oL.redraw();setTimeout(function(){var eColumnHead=df.dom.query(that.eHead,'.WebList_ColHead[data-dfcol="'+iColumn+'"');that.moveColumn(eColumnHead,oEv,iColumn);},this._oColumnNewLineCache.length>0?75:0);oEv.stop();return false;}return true;},moveColumn:function moveColumn(eColumnHeader,oEv,iOriginalDbIndex){var eColumnGhost=this.oL._eElem.cloneNode(true);var aLayoutToMapperIndex=[];for(var i=0;i<this.oL._aColumnMapper.length;i++){if(this.oL._aColumnMapper[i].pbRender&&!this.oL._aColumnMapper[i].pbHidden){aLayoutToMapperIndex.push(i);}}var iOriginalIndexInLayout=Array.prototype.indexOf.call(eColumnHeader.parentNode.children,eColumnHeader);var iOriginalIndexInMapper=aLayoutToMapperIndex[iOriginalIndexInLayout];var iNewIndexInMapper=iOriginalIndexInMapper;for(var _i5=0;_i5<eColumnHeader.childNodes.length;_i5++){eColumnHeader.removeChild(eColumnHeader.childNodes[_i5]);}eColumnHeader.classList.add("WebList_Moving");var aColumnHeadedRows=df.dom.query(this.oL._oBody.eBody,'td[data-dfcol="'+iOriginalDbIndex+'"',true);for(var _i6=0;_i6<aColumnHeadedRows.length;_i6++){aColumnHeadedRows[_i6].innerHTML="";aColumnHeadedRows[_i6].classList.add("WebList_Moving");}var oColumnHead_Rect=eColumnHeader.getBoundingClientRect();var iColumnGhost_MouseCorrection_X=oColumnHead_Rect.width/2;var iColumnGhost_MouseCorrection_Y=oColumnHead_Rect.height/2;var aGhostColumnCells=df.dom.query(eColumnGhost,"[data-dfcol]",true);for(var _i7=0;_i7<aGhostColumnCells.length;_i7++){if(aGhostColumnCells[_i7].getAttribute("data-dfcol")!=iOriginalDbIndex){aGhostColumnCells[_i7].parentNode.removeChild(aGhostColumnCells[_i7]);}else{aGhostColumnCells[_i7].style.width="100%";}}var eVerticalScrollBar=df.dom.query(eColumnGhost,".WebList_Scroll");if(eVerticalScrollBar)eVerticalScrollBar.parentNode.removeChild(eVerticalScrollBar);var aHorizontalScrollBars=df.dom.query(eColumnGhost,".WebList_HorizScroll",true);for(var _i8=0;_i8<aHorizontalScrollBars.length;_i8++){df.dom.removeClass(aHorizontalScrollBars[_i8],"WebList_HorizScroll");}if(this.oL.pbShowLabel){var eGhostListLabel=df.dom.query(eColumnGhost,"div > label",false);if(eGhostListLabel)eGhostListLabel.parentNode.removeChild(eGhostListLabel);}eColumnGhost.style.position="absolute";eColumnGhost.style.left=oEv.e.clientX-iColumnGhost_MouseCorrection_X+"px";eColumnGhost.style.top=oEv.e.clientY-iColumnGhost_MouseCorrection_Y+"px";eColumnGhost.style.width=oColumnHead_Rect.width+"px";eColumnGhost.style["pointer-events"]="none";document.body.appendChild(eColumnGhost);var sBodyOverflowCache=document.body.style.overflow;document.body.style.overflow="hidden";var aColumnElements=df.dom.query(this.oL._eElem,'[data-dfcol="'+iOriginalDbIndex+'"',true);function updateColumnShadowPosition(iNewIndexOfColumn){function moveElementToIndex(eElem,iIndex){var eParent=eElem.parentNode;eParent.removeChild(eElem);if(iIndex>=eParent.childNodes.length){eParent.appendChild(eElem);}else{eParent.insertBefore(eElem,eParent.childNodes[iIndex]);}}moveElementToIndex(eColumnHeader,iNewIndexOfColumn);for(var _i9=0;_i9<aColumnElements.length;_i9++){moveElementToIndex(aColumnElements[_i9],iNewIndexOfColumn);}}var dtLastHorizontalScroll=Date.now();var eHorizontalSrollbar=this.oL._oBody.eTableWrp;var iHorizontalScrollDeltaPx=20;function onMove(oEv){eColumnGhost.style.left=oEv.e.clientX-iColumnGhost_MouseCorrection_X+"px";eColumnGhost.style.top=oEv.e.clientY-iColumnGhost_MouseCorrection_Y+"px";if(this.oL._oBody.eTableWrp){var oScrollBarRect=eHorizontalSrollbar.getBoundingClientRect();if(Date.now()-dtLastHorizontalScroll>100){if(oEv.e.clientX<oScrollBarRect.left+iHorizontalScrollDeltaPx+iHorizontalScrollDeltaPx){eHorizontalSrollbar.scrollLeft-=iHorizontalScrollDeltaPx;dtLastHorizontalScroll=Date.now();}else if(oEv.e.clientX>oScrollBarRect.right-iHorizontalScrollDeltaPx-iHorizontalScrollDeltaPx){eHorizontalSrollbar.scrollLeft+=iHorizontalScrollDeltaPx;dtLastHorizontalScroll=Date.now();}}}var eTarget=oEv.getTarget();while(eTarget.hasAttribute&&!eTarget.hasAttribute('data-dfcol')&&eTarget!=this.oL._eElem){eTarget=eTarget.parentNode;}var eWebObject=eTarget;if(eTarget.hasAttribute&&eTarget.hasAttribute('data-dfcol')){while(eWebObject.hasAttribute&&!eWebObject.hasAttribute('data-dfobj')&&eTarget!=this.oL._eElem){eWebObject=eWebObject.parentNode;}}if(!eTarget.hasAttribute||!eTarget.hasAttribute('data-dfcol')||eWebObject!==this.oL._eElem){updateColumnShadowPosition(iOriginalIndexInLayout);return;}if(eTarget.classList.contains("WebList_Moving"))return;var oRect=eTarget.getBoundingClientRect();var iLeftBarrier=oRect.left+(oRect.right-oRect.left)/3;var iRightBarrier=oRect.right-(oRect.right-oRect.left)/3;if(oEv.e.x>iLeftBarrier&&oEv.e.x<iRightBarrier)return;var iNewIndexInLayout=Array.prototype.indexOf.call(eTarget.parentNode.children,eTarget);if(oEv.e.x<=iLeftBarrier){if(iNewIndexInLayout>iOriginalIndexInLayout&&iNewIndexInLayout>0){iNewIndexInLayout--;}}else if(oEv.e.x>iRightBarrier){if(iNewIndexInLayout<iOriginalIndexInLayout&&iNewIndexInLayout<eTarget.parentNode.children.length-1){iNewIndexInLayout++;}}iNewIndexInMapper=aLayoutToMapperIndex[iNewIndexInLayout];updateColumnShadowPosition(iNewIndexInLayout);}function onStopMove(oEv){if(this._oHeaderMenu)this._oHeaderMenu.enable(this._bHeaderMenuPreviousState);if(oEv.e.button!==0)return;document.body.style.overflow=sBodyOverflowCache;df.dom.off("mouseup",window,onStopMove);df.dom.off("mousemove",window,onMove);document.body.removeChild(eColumnGhost);for(var _i10=0;_i10<this._oColumnNewLineCache.length;_i10++){this.oL._aColumnMapper[this._oColumnNewLineCache[_i10]].pbNewLine=true;}var eTarget=oEv.getTarget();while(eTarget.hasAttribute&&!eTarget.hasAttribute('data-dfcol')&&eTarget!=this.oL._eElem){eTarget=eTarget.parentNode;}var eWebObject=eTarget;if(eTarget.hasAttribute&&eTarget.hasAttribute('data-dfcol')){while(eWebObject.hasAttribute&&!eWebObject.hasAttribute('data-dfobj')&&eTarget!=this.oL._eElem){eWebObject=eWebObject.parentNode;}}if(!eTarget.hasAttribute||!eTarget.hasAttribute('data-dfcol')||eWebObject!==this.oL._eElem){this.oL.redraw();return;}var oOrgCol=this.oL._aColumnMapper[iOriginalIndexInMapper];this.oL._aColumnMapper.splice(iOriginalIndexInMapper,1);this.oL._aColumnMapper.splice(iNewIndexInMapper,0,oOrgCol);var iIndex=iNewIndexInMapper<iOriginalIndexInMapper?iNewIndexInMapper:iOriginalIndexInMapper;for(;iIndex<this.oL._aColumnMapper.length;iIndex++){this.oL._aColumnMapper[iIndex].piPosition=iIndex;}this.oL.redraw();this.oL.triggerLayoutChange(this.oL._aChildren[iOriginalDbIndex]);}df.dom.on("mouseup",window,onStopMove,this);df.dom.on("mousemove",window,onMove,this);},resizeColumn:function resizeColumn(oEv,iCol){var oL=this.oL,oR=this.oR,eMask,eGhost,iLeft=0,iRatio,iPX=0,iStartX,iDiff=0,iMin,iMax=0,i,iVCol,oRect;eMask=df.gui.dragMask();eMask.style.cursor="e-resize";iRatio=oR.calcPixelRatio();var eColumn=oEv.getTarget().parentNode;while(eColumn.hasAttribute&&!eColumn.hasAttribute('data-dfcol')&&eColumn!=this.oL._eElem){eColumn=eColumn.parentNode;}iVCol=Array.prototype.indexOf.call(eColumn.parentNode.children,eColumn);oRect=oEv.getTarget().getBoundingClientRect();if(oL.pbAutoColumnSizing){for(i=iVCol+1;i<oR.aColWidths.length;i++){if(oR.aColWidths[i].oCol.pbResizable){if(oR.aColWidths[i].bFixed){iPX=oR.aColWidths[i].iPixels;}else{iPX=oR.aColWidths[i].iPercent*iRatio;}iMax+=iPX-oR.iColMin;}}}else{iMax=screen.width-oRect.left;}iStartX=oEv.getMouseX();if(oR.aColWidths[iVCol].bFixed||!oL.pbAutoColumnSizing){iMin=-oR.aColWidths[iVCol].iPixels+oR.iColMin;}else{iMin=-(oR.aColWidths[iVCol].iPercent*iRatio)+oR.iColMin;}iLeft=oRect.left;eGhost=df.dom.create('<div class="WebList_ColResizer"></div>');this.eHead.appendChild(eGhost);eGhost.style.left=iLeft+"px";eGhost.style.top=oRect.top+"px";eGhost.style.height=oL._eElem.clientHeight+"px";function onResize(oEv){var iNewX=oEv.getMouseX(),iNewLeft;iDiff=iNewX-iStartX;if(iDiff<iMin){iDiff=iMin;}if(iDiff>iMax){iDiff=iMax;}iNewLeft=iLeft+iDiff;eGhost.style.left=iNewLeft+"px";}function onStopResize(oEv){if(this._oHeaderMenu)this._oHeaderMenu.enable(this._bHeaderMenuPreviousState);if(oEv.e.button!==0)return;df.dom.off("mouseup",eMask,onStopResize);df.dom.off("mouseup",window,onStopResize);df.dom.off("mousemove",eMask,onResize);eGhost.parentNode.removeChild(eGhost);eMask.parentNode.removeChild(eMask);this.oR.recalcColumnSizes(iVCol,iDiff,false);this.oL.triggerLayoutChange(this.oL._aChildren[iCol]);}df.dom.on("mouseup",eMask,onStopResize,this);df.dom.on("mouseup",window,onStopResize,this);df.dom.on("mousemove",eMask,onResize,this);},colCell:function colCell(oCol){return this.colCellByIndex(oCol._iCol);},colCellByIndex:function colCellByIndex(iCol){return df.dom.query(this.eHeadWrp,"th.WebList_ColHead[data-dfcol='"+iCol+"']");},onSettingChange:function onSettingChange(oEv){var oL=this.oL;if(oEv.sType==="redraw"){this.updateHeader();}else if(oEv.sType==="sorting"){this.updateHeader();}else if(oEv.sType==="prop"){switch(oEv.sProp){case"piSortColumn":case"pbReverseOrdering":this.updateHeader();break;case"pbShowHeader":if(this.eHead){this.eHead.style.display=oL.pbShowHeader?"":"none";oL.sizeChanged();}break;case"pbColumnsResizable":if(this.eHead){df.dom.toggleClass(this.eHeadWrp,"WebList_ColResizable",oL.pbColumnsResizable);}break;case"pbAutoColumnSizing":df.dom.toggleClass(this.eHeadWrp,"WebList_AutoSize",this.oL.pbAutoColumnSizing);df.dom.toggleClass(this.eHeadWrp,"WebList_HorizScroll",!this.oL.pbAutoColumnSizing);}}},onResize:function onResize(oEv){if(this.eHead&&this.oL._oBody){this.eHead.style.paddingRight=this.oL._oBody.scrollbarWidth()+"px";}},onHorizontalScroll:function onHorizontalScroll(oEv){if(this.eHeadWrp){this.eHeadWrp.scrollLeft=oEv.nScrollX;}}});df.WebListFooterView=function WebListFooterView(oList,oModel,oController){this.oL=oList;this.oC=oController;this.oR=oList._oRowRenderer;this.oM=oModel;oList._onResize.on(this.onResize,this);oList._onSettingChange.on(this.onSettingChange,this);oList._onModulesCreated.on(this.onModulesCreated,this);};df.defineClass("df.WebListFooterView",{onModulesCreated:function onModulesCreated(oEv){var oV=this.oL._oBody;if(oV instanceof df.WebListScrollingView){oV.onHorizontalScroll.on(this.onHorizontalScroll,this);}},genHtml:function genHtml(aHtml){var oL=this.oL;aHtml.push('<div class="WebList_Footer WebList_Body"',oL.pbShowFooter?'':' style="display:none"','>');aHtml.push('<div class="WebList_FooterWrp WebList_BodyWrp',oL.pbColumnsResizable?' WebList_ColResizable':'',oL.pbAutoColumnSizing?" WebList_AutoSize":" WebList_HorizScroll",'">');this.footerHtml(aHtml);aHtml.push('</div>');aHtml.push('</div>');},afterRender:function afterRender(eList){this.eFooter=df.dom.query(eList,"div.WebList_Footer");this.eFooterWrp=df.dom.query(eList,"div.WebList_FooterWrp");},footerHtml:function footerHtml(aHtml){var oFooterRow={aCells:[],sCssClassName:"",sRowId:"_WebList_Footer",fCellClass:function fCellClass(oCol,tCell){var aClasses=[];aClasses.push(oCol._sCellClass);aClasses.push(df.CssDisabled);aClasses.push(oCol.peFooterAlign===df.ciAlignLeft?"WebList_AlignLeft":oCol.peFooterAlign===df.ciAlignCenter?"WebList_AlignCenter":oCol.peFooterAlign===df.ciAlignRight?"WebList_AlignRight":"");if(oCol.peFooterDataType===df.ciTypeBCD){aClasses.push("dfData_BCD");}else if(oCol.peFooterDataType===df.ciTypeDate){aClasses.push("dfData_Date");}else{aClasses.push("dfData_Text");}if(oCol.psCSSClass){aClasses.push(oCol.psCSSClass);}if(tCell&&tCell.sCssClassName){aClasses.push(tCell.sCssClassName);}return aClasses.join(" ");},fCellHtml:function fCellHtml(tCell){var sVal=tCell.sValue;if(sVal.length===0)return'&nbsp;';sVal=df.sys.data.serverToType(sVal,this.peFooterDataType);sVal=df.sys.data.typeToDisplay(sVal,this.peFooterDataType,this.getWebApp(),this._bHasFocus,this.psFooterMask,this.piFooterPrecision);if(!this.pbAllowHtml){sVal=df.dom.encodeHtml(sVal);}return sVal!==''?sVal:'&nbsp;';}};var aMergedColumns=this.oL._aColumns.concat(this.oL._aSwipeBtns);aMergedColumns.sort(function(a,b){var x=a._iColIndex,y=b._iColIndex;return x<y?-1:x>y?1:0;});for(var i=0;i<aMergedColumns.length;i++){oFooterRow.aCells.push({sValue:aMergedColumns[i].psFooterValue||"",sTooltip:"",sCssClassName:"",aOptions:[]});}this.oR.rowHtml(oFooterRow,aHtml,true);},updateFooter:function updateFooter(){var aHtml=[];if(this.eFooterWrp){this.footerHtml(aHtml);this.eFooterWrp.innerHTML=aHtml.join("");}},offsetHeight:function offsetHeight(){if(this.eFooter){return this.eFooter.offsetHeight;}},onSettingChange:function onSettingChange(oEv){var oL=this.oL;if(oEv.sType==="redraw"){this.updateFooter();}else if(oEv.sType==="sorting"){this.updateFooter();}else if(oEv.sType==="prop"){switch(oEv.sProp){case"piSortColumn":case"pbReverseOrdering":this.updateFooter();break;case"pbShowFooter":if(this.eFooter){this.eFooter.style.display=oL.pbShowFooter?"":"none";oL.sizeChanged();}break;case"pbColumnsResizable":if(this.eFooter){df.dom.toggleClass(this.eFooterWrp,"WebList_ColResizable",oL.pbColumnsResizable);}break;case"pbAutoColumnSizing":df.dom.toggleClass(this.eFooterWrp,"WebList_AutoSize",this.oL.pbAutoColumnSizing);df.dom.toggleClass(this.eFooterWrp,"WebList_HorizScroll",!this.oL.pbAutoColumnSizing);}}},onResize:function onResize(oEv){if(this.eFooter&&this.oL._oBody){this.eFooter.style.paddingRight=this.oL._oBody.scrollbarWidth()+"px";}},onHorizontalScroll:function onHorizontalScroll(oEv){if(this.eFooterWrp){this.eFooterWrp.scrollLeft=oEv.nScrollX;}}});df.WebListController=function WebListController(oList,oModel){this.oL=oList;this.oM=oModel;this.iRowChangeCount=0;this.onCellClick=new df.events.JSHandler();this.onCellDblClick=new df.events.JSHandler();this.onAfterCellClick=new df.events.JSHandler();};df.defineClass("df.WebListController",{cellClick:function cellClick(oEv,sRowId,iCol){var oL=this.oL,oM=this.oM,iColIndex,sColVal="",iRow;oL._bHasFocus=true;iRow=oM.rowIndexByRowId(sRowId);if(iRow>=0){if(iCol>=0){iColIndex=oL._aColumns[iCol]._iColIndex;sColVal=oM.aData[iRow].aCells[iColIndex].sValue;}if(iCol>=0){if(oL._aColumns[iCol].cellClickBefore(oEv,sRowId,sColVal)){return false;}}this.selectRow("row",iRow);if(iCol>=0){if(oL._aColumns[iCol].cellClickAfter(oEv,sRowId,sColVal)){oL.focus();return false;}}if(this.fireRowClick(sRowId,iCol)){return true;}}return false;},fireRowClick:function fireRowClick(sRowId,iCol){var bHandled;this.onCellClick.fire(this,{sRowId:sRowId,iCol:iCol});bHandled=this.oL.fire("OnRowClick",[sRowId],function(oEv){this.onAfterCellClick.fire(this,{sRowId:sRowId,iCol:iCol});},this);return bHandled;},cellDblClick:function cellDblClick(oEv,sRowId,iCol){return!this.onCellDblClick.fire(this,{sRowId:sRowId,iCol:iCol});},headClick:function headClick(oEv,iCol){var oL=this.oL,bRes=false,oCol=oL._aColumns[iCol];if(oCol){if(oCol.fire("OnHeaderClick")){bRes=true;}else{if(oL.pbColumnSortable){if(oCol.pbSortable){if(oL.piSortColumn===iCol){this.changeSorting(iCol,!oL.pbReverseOrdering);}else{this.changeSorting(iCol,false);}bRes=true;}}}}oL.focus();return bRes;},headDblClick:function headDblClick(oEv,iCol){return false;},changeSorting:function changeSorting(iCol,bReverse){var oL=this.oL,iPrevCol=oL.piSortColumn,bPrevReverse=oL.pbReverseOrdering;oL.addSync('piSortColumn');oL.addSync('pbReverseOrdering');oL.piSortColumn=iCol;oL.pbReverseOrdering=bReverse;oL._onSettingChange.fire(this,{sType:"sorting"});if(this.oM.bPaged){oL.serverAction("ChangeSorting",[iCol,bReverse,iPrevCol,bPrevReverse]);}},keyPress:function keyPress(oEv){var oL=this.oL,sChar,iChar;if(!oL.isEnabled()){return;}if(oL.pbAutoSearch&&oL.piSortColumn>=0&&!this.bNoSearch&&oL.hasFocus()){iChar=oEv.getCharCode();if(iChar>32&&!oEv.isSpecialKey()){sChar=String.fromCharCode(oEv.getCharCode());if(oL._aColumns[oL.piSortColumn].peDataType===df.ciTypeBCD){if("0123456789,.-".indexOf(sChar)<0){sChar="";}}else if(oL._aColumns[oL.piSortColumn].peDataType===df.ciTypeDate){if("0123456789-".indexOf(sChar)<0){sChar="";}}this.showSearch(sChar);oEv.stop();return false;}}return true;},search:function search(sSearch){var oM=this.oM,oL=this.oL,fComp,aData=oM.aData,iCol,iLow=0,iHigh=aData.length-1,iMid,iRes,iRow=null,bRev;bRev=oL.pbReverseOrdering;iCol=oL._aColumns[oL.piSortColumn]._iColIndex;if(iCol<0){return;}if(!this.oM.bPaged){if(oL._aColumns[iCol].peDataType===df.ciTypeText){fComp=function fComp(sVal1,sVal2){sVal1=sVal1.substr(0,sVal2.length).toLowerCase();return sVal1.localeCompare(sVal2);};sSearch=sSearch.toLowerCase();}else{fComp=df.sys.data.compareFunction(oL._aColumns[iCol].peDataType);}while(iLow<iHigh){iMid=Math.floor((iLow+iHigh)/2);iRes=fComp(aData[iMid].aCells[iCol].sValue,sSearch);iRes=bRev?-iRes:iRes;if(iRes<0){iLow=iMid+1;}else if(iRes>0){iHigh=iMid-1;}else{iRow=iMid;break;}}if(iRes===0){if(iRow>0){iRes=fComp(aData[iRow-1].aCells[iCol].sValue,sSearch);iRes=bRev?-iRes:iRes;while(iRes===0&&iRow>0){iRow--;if(iRow>0){iRes=fComp(aData[iRow-1].aCells[iCol].sValue,sSearch);}}}}else{if(iMid<iLow){iRow=iLow;}else if(iMid>iLow){iRow=iHigh;}else{iRow=iMid;}}this.moveToRow(iRow);}else{oL.serverAction("OnSearch",[sSearch]);}},showSearch:function showSearch(sOptSearch){var oL=this.oL,oDialog,oContentPnl,oForm,oButtonPnl,oOKBtn,oCancelBtn,iWindowWidth=df.dom.windowWidth(),iCol=oL.piSortColumn;if(iCol<0){return;}oDialog=new df.WebModalDialog(null,oL);oDialog.psCaption=oL.getWebApp().getTrans("search")+": "+oL._aColumns[iCol].psCaption;oDialog.pbShowClose=true;oDialog.pbDDHotKeys=false;oDialog.pbResizable=false;oDialog.piMinWidth=iWindowWidth>390?370:iWindowWidth-20;oDialog.psCSSClass="WebMsgBox";oContentPnl=new df.WebPanel(null,oDialog);oContentPnl.peRegion=df.ciRegionCenter;oDialog.addChild(oContentPnl);oForm=new df.WebForm(null,oDialog);oForm.psLabel="";oForm.pbShowLabel=false;oForm.psValue=sOptSearch||"";oForm.peDataType=oL._aColumns[iCol].peDataType;oForm.psMask=oL._aColumns[iCol].psMask;oForm.piPrecision=oL._aColumns[iCol].piPrecision;oForm.piMaxLength=oL._aColumns[iCol].piMaxLength;oForm.pbCapslock=oL._aColumns[iCol].pbCapslock;oForm.peAlign=df.ciAlignLeft;oContentPnl.addChild(oForm);oButtonPnl=new df.WebPanel(null,oDialog);oButtonPnl.peRegion=df.ciRegionBottom;oButtonPnl.piColumnCount=3;oButtonPnl.psCSSClass="WebMsgBoxOneBtn";oDialog.addChild(oButtonPnl);oOKBtn=new df.WebButton(null,oDialog);oOKBtn.psCaption=oL.getWebApp().getTrans("ok");oOKBtn.piColumnIndex=1;oOKBtn.pbShowLabel=false;oOKBtn.OnClick.addListener(function(oEv){oDialog.fire('OnSubmit');},this);oButtonPnl.addChild(oOKBtn);oCancelBtn=new df.WebButton(null,oDialog);oCancelBtn.psCaption=oL.getWebApp().getTrans("cancel");oCancelBtn.piColumnIndex=2;oCancelBtn.pbShowLabel=false;oCancelBtn.OnClick.addListener(function(oEv){oDialog.hide();},this);oButtonPnl.addChild(oCancelBtn);oDialog.OnSubmit.addListener(function(oEv){var sVal=oForm.get("psValue");oDialog.hide();oL.objFocus();this.search(sVal);if(oL._eFocus){oL._eFocus.focus();}},this);oDialog.show();if(oForm.peDataType===df.ciTypeDate||oForm.peDataType===df.ciTypeDateTime||oForm.peDataType===df.ciTypeTime){oForm.focus();if(sOptSearch){oForm.setControlValue(sOptSearch);}}if(!df.sys.isMobile){df.dom.setCaretPosition(oForm._eControl,oForm._eControl.value.length);}},keyDown:function keyDown(oEv){var oL=this.oL,that=this;if(!oL._bHasFocus){return;}if(oEv.matchKey(df.settings.listKeys.scrollUp)){this.moveUpRow();}else if(oEv.matchKey(df.settings.listKeys.scrollDown)){this.moveDownRow();}else if(oEv.matchKey(df.settings.listKeys.scrollPageUp)){this.movePageUp();}else if(oEv.matchKey(df.settings.listKeys.scrollPageDown)){this.movePageDown();}else if(oEv.matchKey(df.settings.listKeys.scrollTop)){this.moveToFirstRow();}else if(oEv.matchKey(df.settings.listKeys.scrollBottom)){this.moveToLastRow();}else if(oEv.matchKey(df.settings.listKeys.leftSwipeBtns)&&oL._oTouchHandler&&oL._oTouchHandler.showSwipeLeft()){}else if(oEv.matchKey(df.settings.listKeys.rightSwipeBtns)&&oL._oTouchHandler&&oL._oTouchHandler.showSwipeRight()){}else if(oEv.matchKey(df.settings.formKeys.submit)){if(this.oM.sCurrentRowId){if(this.fireRowClick(this.oM.sCurrentRowId,null)){oEv.stop();return false;}}return true;}else{return true;}this.bNoSearch=true;setTimeout(function(){that.bNoSearch=false;},50);oEv.stop();return false;},handleData:function handleData(aRows,sType,sStartRowId,bFirst,bLast){this.oM.handleData(aRows,sType,sStartRowId,bFirst,bLast);if(!this.pbDataAware){this.updateColumnsFromCache(sType==="page");}},setCurrentRowId:function setCurrentRowId(sRowId){this.oM.setCurrentRowId(sRowId);},updateRow:function updateRow(sRowId,tRow){this.oM.updateRow(sRowId,tRow);},updateCell:function updateCell(oCol,sVal){this.oM.updateCell(oCol,sVal);},removeRow:function removeRow(sRowId){var oM=this.oM,bRowChange=false,iPrevRow;if(oM.sCurrentRowId===sRowId){bRowChange=true;iPrevRow=oM.iCurrentRow;oM.sCurrentRowId="";oM.iCurrentRow=-1;}oM.removeRow(sRowId);if(bRowChange){if(iPrevRow<oM.aData.length){this.selectRow("row",iPrevRow);}else if(iPrevRow>0){this.selectRow("row",iPrevRow-1);}else{this.appendNewRow();}}},appendRow:function appendRow(tRow){this.oM.appendRow(tRow);},insertBefore:function insertBefore(sBeforeRowId,tRow){this.oM.insertBefore(sBeforeRowId,tRow);},insertAfter:function insertAfter(sAfterRowId,tRow){this.oM.insertAfter(sAfterRowId,tRow);},selectRow:function selectRow(sGotoRow,iRow,fOptHandler,tOptSelectRowData){var oL=this.oL,oM=this.oM,sPrevRowId=oM.sCurrentRowId,bContinue=true,sTargetRowId="",tSelectRowData=tOptSelectRowData||null,iRowChange,oOptions;oL.cancelServerAction("ChangeCurrentRow");if(sGotoRow==="row"){sTargetRowId=oM.rowIdByRowIndex(iRow);bContinue=sTargetRowId!==null&&sTargetRowId!==sPrevRowId;if(!oL.pbDataAware){tSelectRowData=oM.aData[iRow];}}oOptions={sPrevRowId:oM.sCurrentRowId,iPrevRowIndex:oM.iCurrentRow,sGotoRow:sTargetRowId,iGotoRowIndex:iRow};this.iRowChangeCount++;iRowChange=this.iRowChangeCount;function handleRowChange(bResult){var bOverridden=iRowChange!==this.iRowChangeCount;oOptions.bSuccess=df.toBool(bResult);oM.onAfterRowChange.fire(oM,oOptions);if(oL.pbOfflineEditing||df.toBool(bResult)){if(fOptHandler){fOptHandler.call(this,true,bOverridden);}}else{fOptHandler.call(this,false,bOverridden);}}if(bContinue){oM.onBeforeRowChange.fire(oM,oOptions);if(!oL.pbOfflineEditing){this.handleRowChange=handleRowChange;oL.serverAction("ChangeCurrentRow",[sGotoRow,sTargetRowId],tSelectRowData&&oL.serializeRows([tSelectRowData])||null);}else{if(sGotoRow==="row"){this.setCurrentRowId(sTargetRowId);this.updateColumnsFromCache(true);}handleRowChange.call(this);}}else{if(fOptHandler){fOptHandler.call(this,false);}}},handleRowChange:function handleRowChange(bResult){},updateColumnsFromCache:function updateColumnsFromCache(bResetChange){var oL=this.oL,oM=this.oM,iRow,iCol;if(!oL.pbDataAware){iRow=oM.rowIndexByRowId(oM.sCurrentRowId);if(iRow>=0){for(iCol=0;iCol<oL._aColumns.length;iCol++){oL._aColumns[iCol].set('psValue',oM.aData[iRow].aCells[oL._aColumns[iCol]._iColIndex].sValue);if(bResetChange){oL._aColumns[iCol].set('pbChanged',false);}}}}},triggerCacheUpdate:function triggerCacheUpdate(iTopRow,iLastRow){var oM=this.oM;if(oM.bPaged){if(!oM.bLast){if(oM.aData.length-iLastRow<oM.iPrefCacheOffset){this.loadCachePage("next");}}if(!oM.bFirst){if(iTopRow<oM.iPrefCacheOffset){this.loadCachePage("prev");}}}},loadCachePage:function loadCachePage(sType,fOptHandler,oOptEnv){var oL=this.oL,oM=this.oM,sStartRowId="";if(this.bLoading){return;}this.bLoading=true;if(sType==="next"){if(oM.aData.length){sStartRowId=oM.aData[oM.aData.length-1].sRowId;}}else if(sType==="prev"){if(oM.aData.length){sStartRowId=oM.aData[0].sRowId;}}else{this._bNoRender=true;}oL.serverAction("LoadDataPage",[sType,sStartRowId],null,function(oEv){this.bLoading=false;if(!oEv.bError){if(fOptHandler){fOptHandler.call(oOptEnv||this);}}},this);},processDataSet:function processDataSet(eOperation){var oM=this.oM,oL=this.oL;oL.serverAction("HandleProcessDataSet",[eOperation,oM.iCurrentRow],oL.serializeRows(oM.aData));},moveToFirstRow:function moveToFirstRow(){var oM=this.oM,oL=this.oL,fSelect;fSelect=function fSelect(){if(oM.aData.length>0){this.selectRow("row",0);}else{this.appendNewRow();}};if(!oM.bPaged){fSelect.call(this);}else{if(oL.pbOfflineEditing||oM.iCurrentRow===0&&oM.sCurrentRowId===""){this.loadCachePage("first",function(){fSelect.call(this);});}else{this.selectRow("first",-1);}}},moveToLastRow:function moveToLastRow(){var oM=this.oM,oL=this.oL,fSelect;fSelect=function fSelect(){if(oM.aData.length>0){this.selectRow("row",oM.aData.length-1);}else{this.appendNewRow();}};if(!oM.bPaged){fSelect.call(this);}else{if(oL.pbOfflineEditing||oM.iCurrentRow===0&&oM.sCurrentRowId===""){this.loadCachePage("last",function(){fSelect.call(this);});}else{this.selectRow("last",-1);}}},moveDownRow:function moveDownRow(){var oM=this.oM;if(oM.iCurrentRow>=0&&oM.iCurrentRow<oM.aData.length-1){this.selectRow("row",oM.iCurrentRow+1);return true;}return false;},moveUpRow:function moveUpRow(){var oM=this.oM;if(oM.iCurrentRow>0){this.selectRow("row",oM.iCurrentRow-1);}},movePageDown:function movePageDown(){var oM=this.oM,iRow;iRow=Math.round(oM.iCurrentRow+this.oL._oBody.getViewSize()-1);if(iRow>=oM.aData.length){iRow=oM.aData.length-1;}this.selectRow("row",iRow);},movePageUp:function movePageUp(){var oM=this.oM,iRow;iRow=Math.round(oM.iCurrentRow-this.oL._oBody.getViewSize()+1);if(iRow<0){iRow=0;}this.selectRow("row",iRow);},moveToRow:function moveToRow(iRowIndex){iRowIndex=parseInt(iRowIndex,10);if(iRowIndex>=0&&iRowIndex<this.oM.aData.length){this.selectRow("row",iRowIndex);}},moveToRowByID:function moveToRowByID(sRowId){var iRowIndex=this.oM.rowIndexByRowId(sRowId);if(iRowIndex>=0){this.moveToRow(iRowIndex);}},appendNewRow:function appendNewRow(){}});df.WebListSwipeButton=function WebListSwipeButton(sName,oParent){df.WebListSwipeButton.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tInt,"piWidth",50);this.prop(df.tBool,"pbPositionLeft",false);this.prop(df.tBool,"pbDynamic",false);this.prop(df.tBool,"pbAllowHtml",false);this.event("OnClick",df.cCallModeWait);this._iColIndex=0;this._bIsSwipeButton=true;};df.defineClass("df.WebListSwipeButton","df.WebBaseUIObject",{isVisible:function isVisible(tCell){return this.pbRender&&this.pbVisible&&(!this.pbDynamic||df.toBool(tCell.aOptions[0]));},btnHtml:function btnHtml(tCell){var sV="";if(this.pbDynamic){sV=tCell.sValue;}else{sV=this.psCaption;}if(!this.pbAllowHtml){sV=df.dom.encodeHtml(sV);}return sV;},btnClick:function btnClick(oEv,sRowId,fHandler,oEnv){this.fire("OnClick",[sRowId],fHandler,oEnv);return true;}});df.wleManual=0;df.wleOpenOnRowChange=1;df.wleOpenOnRowClick=2;df.wleOpenOnRowClickCloseOnChange=3;df.wleOpenOnRowDoubleClick=4;df.wleOpenOnRowDoubleClickCloseOnChange=5;df.WebListExpandPanel=function WebListExpandPanel(sName,oPrnt){df.WebListExpandPanel.base.constructor.call(this,sName,oPrnt);this.prop(df.tInt,"peMode",df.wleOpenOnRowClickCloseOnChange);this.prop(df.tBool,"pbShowLoading",false);this.prop(df.tString,"psExpandedRow","");this.prop(df.tBool,"pbFocusOnShow",true);this.event("OnExpand",df.cCallModeDefault);this.event("OnCollapse",df.cCallModeDefault);this._sExpandedRow=null;this._bExpanding=false;this.OnAfterExpand=new df.events.JSHandler();this._sControlClass="WebListExpPnl";this._bWrapDiv=true;this.addSync("psExpandedRow");if(oPrnt instanceof df.WebList){this._oL=oPrnt;this._oL._onModulesCreated.addListener(this.onModulesCreated,this);}else{throw new df.Error(999,"WebListExpandPanel object '{{0}}' should be placed inside a WebList object.",this,[this.getLongName()]);}};df.defineClass("df.WebListExpandPanel","df.WebBaseContainer",{onModulesCreated:function onModulesCreated(oEv){this._oL._oBody.onRowsRendered.addListener(this.onRowsRendered,this);this._oL._oController.onCellClick.addListener(this.onCellClick,this);this._oL._oController.onCellDblClick.addListener(this.onCellDblClick,this);this._oL._oModel.onRowChange.addListener(this.onRowChange,this);},onCellClick:function onCellClick(oEv){if(this.peMode==df.wleOpenOnRowClick||this.peMode==df.wleOpenOnRowClickCloseOnChange){if(this._sExpandedRow==oEv.sRowId){this.collapse();}else{this.expand(oEv.sRowId);}}},onCellDblClick:function onCellDblClick(oEv){if(this.peMode==df.wleOpenOnRowDoubleClick||this.peMode==df.wleOpenOnRowDoubleClickCloseOnChange){if(this._sExpandedRow==oEv.sRowId){this.collapse();}else{this.expand(oEv.sRowId);}}},onRowChange:function onRowChange(oEv){if(this.peMode==df.wleOpenOnRowChange){if(this._sExpandedRow!==oEv.sGotoRowId){this.expand(oEv.sGotoRowId);}}else if(this.peMode==df.wleOpenOnRowClickCloseOnChange||this.peMode==df.wleOpenOnRowDoubleClickCloseOnChange){if(this._sExpandedRow!==oEv.sGotoRowId){this.collapse();}}},afterRender:function afterRender(){df.WebListExpandPanel.base.afterRender.call(this);df.dom.on("focusin",this._eElem,this.onFocus,this);df.dom.on("click",this._eElem,this.onClick,this);df.dom.on("keydown keypress",this._eElem,function(oEv){oEv.stopPropagation();},this);},onFocus:function onFocus(oEv){oEv.stop();},onClick:function onClick(oEv){oEv.stop();},collapse:function collapse(){var oV=this._oL._oBody,eGhost;function colTransEnd(oEv){if(eGhost.parentNode){eGhost.parentNode.removeChild(eGhost);}df.dom.off("transitionend",eGhost,colTransEnd);}if(this._sExpandedRow){this.fire("OnCollapse");if(this._eElem.parentNode){eGhost=this._eElem.cloneNode(true);df.dom.query(eGhost,"input",true).forEach(function(eEl){eEl.name=eEl.name+"_1";});eGhost.style.height=this._eElem.scrollHeight+"px";this._eElem.parentNode.insertBefore(eGhost,this._eElem);this._eElem.parentNode.removeChild(this._eElem);df.dom.animFrame(function(){df.dom.animFrame(function(){df.dom.on("transitionend",eGhost,colTransEnd,this);df.dom.addClass(eGhost,"WebLEP_Hidden");df.dom.removeClass(eGhost,"WebLEP_Visible");eGhost.style.height="0px";},this);},this);}df.dom.addClass(this._eElem,"WebLEP_Hidden");df.dom.removeClass(this._eElem,"WebLEP_Visible");oV.setExtraRowHeight(this._sExpandedRow,0);this._sExpandedRow=null;this.afterHide();}},expand:function expand(sRowId){var oV=this._oL._oBody,eRow,ePnl;if(this._sExpandedRow){this.collapse();}function expTransEnd(oEv){ePnl.style.height=null;this._bExpanding=false;df.dom.off("transitionend",ePnl,expTransEnd);this.afterShow();}eRow=oV.row(sRowId);if(eRow){if(!this._eElem){this.render();df.dom.addClass(this._eElem,"WebLEP_Hidden");this._eElem.style.display="none";df.dom.insertAfter(this._eElem,eRow);this.afterRender();}else{this._eElem.style.display="none";df.dom.insertAfter(this._eElem,eRow);}ePnl=this._eElem;if(this.pbShowLoading){df.dom.addClass(ePnl,"WebCon_Loading");}this.fire("OnExpand",[sRowId],function(oEv){df.dom.removeClass(ePnl,"WebCon_Loading");},this);this.resizeHorizontal();this.resizeVertical();this._sExpandedRow=sRowId;if(this.pbFocusOnShow){this.focus();}df.dom.animFrame(function(){df.dom.on("transitionend",ePnl,expTransEnd,this);ePnl.style.height="0px";ePnl.style.display="";df.dom.animFrame(function(){var iHeightTo;if(this.piHeight>0){iHeightTo=this.piHeight+this.getHeightDiff(false,true,false,false);}else{iHeightTo=ePnl.scrollHeight;}ePnl.style.height=iHeightTo+"px";df.dom.addClass(ePnl,"WebLEP_Visible");df.dom.removeClass(ePnl,"WebLEP_Hidden");this._bExpanding=true;oV.setExtraRowHeight(sRowId,iHeightTo);},this);},this);}},onRowsRendered:function onRowsRendered(oEv){if(this._sExpandedRow&&this._eElem){if(!this._eElem.parentNode){var oV=this._oL._oBody,eRow;eRow=oV.row(this._sExpandedRow);if(eRow){df.dom.insertAfter(this._eElem,eRow);}}}},get_psExpandedRow:function get_psExpandedRow(){return this._sExpandedRow||"";},resize:function resize(){this.resizeHorizontal();this.resizeVertical();},setInnerHeight:function setInnerHeight(iHeight){df.WebListExpandPanel.base.setInnerHeight.call(this,iHeight);}});df.WebGrid=function WebGrid(sName,oParent){df.WebGrid.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbAllowInsertRow",true);this.prop(df.tBool,"pbAllowAppendRow",true);this.prop(df.tInt,"piCurrentColumn",0);this.pbAutoSearch=false;this.addSync("piCurrentColumn");this._bRenderChildren=true;this._sControlClass="WebGrid";};df.defineClass("df.WebGrid","df.WebList",{createView:function createView(){if(this.pbScroll){return new df.WebGridScrollingView(this,this._oModel,this._oController);}else{return new df.WebGridView(this,this._oModel,this._oController);}},createController:function createController(){return new df.WebGridController(this,this._oModel);},createModel:function createModel(){if(this.peDbGridType===df.gtAllData||this.peDbGridType===df.gtManual||!this.pbDataAware||!this.pbScroll){return new df.WebGridModel(this);}else{return new df.WebGridPagedModel(this);}},renderChildren:function renderChildren(){var i,oM=this._oModel,oVisCol=null,oSelCol=null;for(i=0;i<this._aColumns.length;i++){this._aColumns[i].pbShowLabel=false;this._aColumns[i].render();this._aColumns[i].afterRender();if(oVisCol==null&&this._aColumns[i].pbRender){oVisCol=this._aColumns[i];}if(oSelCol==null&&this._aColumns[i].pbRender&&this._aColumns[i].isEnabled()){oSelCol=this._aColumns[i];}}if(oM.iCurrentColumn<0){if(oSelCol){oM.iCurrentColumn=oSelCol._iCol;}else if(oVisCol){oM.iCurrentColumn=oVisCol._iCol;}else{oM.iCurrentColumn=0;}}},applyEnabled:function applyEnabled(bVal){df.WebList.base.applyEnabled.call(this,bVal);},prevCol:function prevCol(){this._oController.prevCol();},nextCol:function nextCol(){this._oController.nextCol();},selectCol:function selectCol(iCol){this._oController.selectCol(iCol);},insertNewRow:function insertNewRow(){return this._oController.insertNewRow();},appendNewRow:function appendNewRow(){return this._oController.appendNewRow();},clearRow:function clearRow(sRowId){return this._oController.clearRow(sRowId);},get_piCurrentColumn:function get_piCurrentColumn(){return this._oModel.iCurrentColumn;},set_piCurrentColumn:function set_piCurrentColumn(iVal){this._oController.selectCol(iVal);},attachFocusEvents:function attachFocusEvents(){this._eFocus.tabIndex=-1;df.WebGrid.base.attachFocusEvents.call(this);},focus:function focus(){if(this._bFocusAble&&this.isEnabled()&&this._eFocus){if(!this._oBody.focus()){this._eFocus.focus();this.objFocus();}return true;}return false;}});df.WebGridView_mixin=function WebGridView_mixin(oList,oModel,oController){this.getBase("df.WebGridView_mixin").constructor.call(this,oList,oModel,oController);this.eEditCell=null;this.oEditCol=null;this.sEditRowId=null;this.bCellEdit=false;this.bStopFocus=false;oModel.onColChange.on(this.onColChange,this);oModel.onBeforeRowChange.on(this.onBeforeRowChange,this);oModel.onAfterRowChange.on(this.onAfterRowChange,this);};df.defineClass("df.WebGridView_mixin",{afterRender:function afterRender(eList){this.getBase("df.WebGridView_mixin").afterRender.call(this,eList);this.editCell();},refreshDisplay:function refreshDisplay(iRowDispOffset){if(this.eBody){this.unEditCell(false);this.getBase("df.WebGridView_mixin").refreshDisplay.call(this,iRowDispOffset);this.editCell();}},refreshRow:function refreshRow(sRowId,sNewRowId){var bIsRow=sRowId===this.sEditRowId;if(this.eBody){if(bIsRow){this.unEditCell(false);bIsRow=true;}this.getBase("df.WebGridView_mixin").refreshRow.call(this,sRowId,sNewRowId);if(bIsRow){this.editCell();}}},refreshCell:function refreshCell(sRowId,oCol){if(this.oEditCol!==oCol||this.sEditRowId!==sRowId){this.getBase("df.WebGridView_mixin").refreshCell.call(this,sRowId,oCol);}},insertRow:function insertRow(tRow,bTop){this.getBase("df.WebGridView_mixin").insertRow.call(this,tRow,bTop);if(tRow&&tRow.sRowId===this.oM.sCurrentRowId){this.editCell();}},removeTopRow:function removeTopRow(){if(this.eEditCell&&this.oM.iCurrentRow===this.iRowDispOffset){this.unEditCell(false);this.oL._eFocus.focus();}this.getBase("df.WebGridView_mixin").removeTopRow.call(this);},removeBottomRow:function removeBottomRow(){if(this.eEditCell&&this.iRowDispLast===this.oM.iCurrentRow){this.unEditCell(false);this.oL._eFocus.focus();}this.getBase("df.WebGridView_mixin").removeBottomRow.call(this);},editCell:function editCell(){var oL=this.oL,oM=this.oM,eElem,eCell,oCol,bEdit,eFocus,iCol=oM.iCurrentColumn,iRow=oM.iCurrentRow;if((!this.bScroll||iRow>=this.iRowDispOffset&&iRow<=this.iRowDispLast)&&iCol>=0){oCol=oL._aColumns[iCol];if(!oCol||!oCol.pbEditable){return;}this.bCellEdit=bEdit=oCol._bCellEdit;eElem=oCol._eElem;oCol._bIgnoreOnChange=true;eCell=this.cell(oM.sCurrentRowId,iCol);if(eCell){if(eCell!==this.eEditCell){if(bEdit){eCell.innerHTML="";eCell.appendChild(eElem);}df.dom.addClass(eCell,"WebGrid_EditCell");}oCol.cellEdit();if(oL.hasFocus()){if(oCol.isEnabled()){if(bEdit){oCol.focus(true);if(df.sys.isIE||df.sys.isEdge&&df.sys.iVersion<13){setTimeout(function(){if(df.sys.isEdge){oCol.focus(true);}else if(oCol instanceof df.WebColumn){oCol._eControl.select();}},10);}}else{eFocus=df.dom.getFirstFocusChild(eCell);if(eFocus){eFocus.focus();}else{oL._eFocus.focus();}}}else{oL._eFocus.focus();}}this.eEditCell=eCell;this.oEditCol=oCol;this.sEditRowId=oM.sCurrentRowId;}oCol._bIgnoreOnChange=false;}},unEditCell:function unEditCell(bUpdate){var oR=this.oR,oM=this.oM,oCol,bEdit,iRow;if(this.oEditCol){oCol=this.oEditCol;bEdit=oCol._bCellEdit;iRow=oM.rowIndexByRowId(this.sEditRowId);if(bUpdate&&bEdit&&iRow>=0){if(oCol.get('pbChanged')){oM.aData[iRow].aCells[oCol._iColIndex].sValue=oCol.get_psValue();}}if(oCol._eControl&&oCol._eControl.blur){oCol._eControl.blur();}if(bEdit){if(oCol._eElem.parentNode){oCol._eElem.parentNode.removeChild(oCol._eElem);}}if(iRow>=0){this.eEditCell.innerHTML=oR.cellHtml(oCol,oM.aData[iRow],oM.aData[iRow].aCells[oCol._iColIndex]);}df.dom.removeClass(this.eEditCell,"WebGrid_EditCell");this.eEditCell=null;this.oEditCol=null;this.iEditRowId=null;}},focus:function focus(){var eFocus,oM=this.oM;if(!this.bStopFocus&&(!this.bScroll||oM.iCurrentRow>=this.iRowDispOffset&&oM.iCurrentRow<=this.iRowDispLast)){if(this.oEditCol){if(this.oEditCol._bCellEdit){if(this.oEditCol.focus(true)){return true;}}else{eFocus=df.dom.getFirstFocusChild(this.eEditCell);if(eFocus){eFocus.focus();return true;}}}}return false;},onColChange:function onColChange(oEv){if(!oEv.bRowChange){this.unEditCell(true);this.editCell();}},onRowChange:function onRowChange(oEv){this.unEditCell(!this.oL.pbDataAware);this.getBase("df.WebGridView_mixin").onRowChange.call(this,oEv);this.editCell();},onBeforeRowChange:function onBeforeRowChange(oEv){this.bStopFocus=true;},onAfterRowChange:function onAfterRowChange(oEv){this.bStopFocus=false;if(this.oL.hasFocus()){this.focus();}}});df.WebGridView=df.mixin("df.WebGridView_mixin","df.WebListView");df.WebGridScrollingView=df.mixin("df.WebGridView_mixin","df.WebListScrollingView");df.WebGridModel_mixin=function WebGridModel_mixin(oList){this.getBase("df.WebGridModel_mixin").constructor.call(this,oList);this.iCurrentColumn=oList.piCurrentColumn;this.onColChange=new df.events.JSHandler();};df.defineClass("df.WebGridModel_mixin",{appendRow:function appendRow(tRow){if(this.aData.length>0&&this.aData[this.aData.length-1].sRowId===""){this.aData.splice(this.aData.length-1,0,tRow);this.iCurrentRow++;}else{this.aData.push(tRow);}if(this.sortData()){this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId);}this.onDataUpdate.fire(this,{sType:"newrow",sRowId:tRow.sRowId});}});df.WebGridModel=df.mixin("df.WebGridModel_mixin","df.WebListModel");df.WebGridPagedModel=df.mixin("df.WebGridModel_mixin","df.WebListPagedModel");df.WebGridController=function WebGridController(oList,oModel){df.WebGridController.base.constructor.call(this,oList,oModel);this.iChangeToCol=null;this.bNewRow=false;this.tNewRow=null;this.iNewCount=0;};df.defineClass("df.WebGridController","df.WebListController",{selectRow:function selectRow(sGotoRow,iRow,fOptHandler,tOptSelectRowData){var oL=this.oL,oV=this.oL._oBody||{};if(!oL.pbDataAware){this.updateCacheFromColumns();}if(oV.oEditCol&&oV.oEditCol.validate){if(oV.oEditCol.get("pbChanged")&&!oV.oEditCol.validate()){return false;}}df.WebGridController.base.selectRow.call(this,sGotoRow,iRow,function(bSuccess,bOverridden){var oM=this.oM,iNewRow,iPrevCol;if(this.iChangeToCol!==null&&this.iChangeToCol!==oM.iCurrentColumn){iPrevCol=oM.iCurrentColumn;oM.iCurrentColumn=this.iChangeToCol;oM.onColChange.fire(this,{bRowChange:bSuccess,iGotoCol:this.iChangeToCol,iPrevCol:iPrevCol});}this.iChangeToCol=null;if(bSuccess&&oM.aData[iRow]){this.tOrigRow=df.sys.json.parse(df.sys.json.stringify(oM.aData[iRow]));}if(bSuccess&&this.bNewRow){iNewRow=oM.rowIndexByRowId("");if(iNewRow>=0){if(oM.iCurrentRow==iNewRow){oM.iCurrentRow--;}oM.aData.splice(iNewRow,1);oM.onDataUpdate.fire(this,{sType:"remrow",sRowId:"",iRowIndex:iNewRow});}this.bNewRow=false;}if(fOptHandler){fOptHandler.call(this,bSuccess,bOverridden);}},tOptSelectRowData);},processDataSet:function processDataSet(eOperation){this.updateCacheFromColumns();df.WebGridController.base.processDataSet.call(this,eOperation);},updateCacheFromColumns:function updateCacheFromColumns(){var oM=this.oM,oL=this.oL,iCol,oCol,iRow=oM.iCurrentRow,tUpdateRow=null,bChanged=false,sVal;if(!oL.pbDataAware){if(iRow>=0){for(iCol=0;iCol<oL._aColumns.length;iCol++){oCol=oL._aColumns[iCol];if(oCol.get('pbChanged')){if(!tUpdateRow){tUpdateRow=JSON.parse(JSON.stringify(oM.aData[iRow]));}sVal=oCol.get('psValue');bChanged=bChanged||tUpdateRow.aCells[oCol._iColIndex].sValue!==sVal;tUpdateRow.aCells[oCol._iColIndex].sValue=sVal;}}if(tUpdateRow&&(bChanged||tUpdateRow.sRowId==="")){if(tUpdateRow.sRowId===""){tUpdateRow.sRowId="new_"+this.iNewCount++;}oM.updateRow(oM.sCurrentRowId,tUpdateRow);}}}},updateRow:function updateRow(sRowId,tRow){if(this.bNewRow&&sRowId===""&&tRow.sRowId===""){tRow.sRowId="new_"+this.iNewCount++;}df.WebGridController.base.updateRow.call(this,sRowId,tRow);},updateCell:function updateCell(oCol,sVal){if(this.tNewRow&&this.oM.sCurrentRowId===""){this.tNewRow.aCells[oCol._iColIndex].sValue=sVal;}else{df.WebGridController.base.updateCell.call(this,oCol,sVal);}},handleData:function handleData(aRows,sType,sStartRowId,bFirst,bLast){df.WebGridController.base.handleData.apply(this,arguments);if(this.oM.aData.length===0){this.appendNewRow();}},createNewRow:function createNewRow(){var oL=this.oL,tNewRow,i;tNewRow={sRowId:"",sCssClassName:"",aCells:[]};for(i=0;i<oL._aColumns.length;i++){tNewRow.aCells[oL._aColumns[i]._iColIndex]={sValue:oL._aColumns[i].peDataType===df.ciTypeBCD?"0":"",sTooltip:"",sCssClassName:"",aOptions:[]};}return tNewRow;},appendNewRow:function appendNewRow(){var oL=this.oL,oM=this.oM,tNewRow;if(oL.pbAllowAppendRow){this.tNewRow=tNewRow=this.createNewRow();this.selectRow("new",-1,function(bSuccess,bOverridden){if(bSuccess){this.bNewRow=true;oM.aData.push(tNewRow);if(oM.sCurrentRowId!==tNewRow.sRowId){this.setCurrentRowId(tNewRow.sRowId);}else{oM.iCurrentRow=oM.rowIndexByRowId(tNewRow.sRowId);}oM.onDataUpdate.fire(this,{sType:"newrow",sRowId:tNewRow.sRowId,iRowIndex:oM.aData.length-1});if(oL.pbOfflineEditing){this.updateColumnsFromCache(true);}}this.tNewRow=null;},!oL.pbDataAware?tNewRow:null);return true;}return false;},insertNewRow:function insertNewRow(){var oL=this.oL,oM=this.oM,tNewRow,iRow=oM.iCurrentRow;if(oL.pbAllowInsertRow){this.tNewRow=tNewRow=this.createNewRow();this.selectRow("new",-1,function(bSuccess,bOverridden){if(bSuccess){this.bNewRow=true;oM.aData.splice(iRow,0,tNewRow);if(oM.sCurrentRowId!==tNewRow.sRowId){this.setCurrentRowId(tNewRow.sRowId);}else{oM.iCurrentRow=oM.rowIndexByRowId(tNewRow.sRowId);}oM.onDataUpdate.fire(this,{sType:"newrow",sRowId:tNewRow.sRowId,iRowIndex:oM.iCurrentRow});if(oL.pbOfflineEditing){this.updateColumnsFromCache(true);}this.tNewRow=null;}},!oL.pbDataAware?tNewRow:null);return true;}return this.appendNewRow();},clearRow:function clearRow(sRowId){var oM=this.oM,oL=this.oL,iRow,iCol,oCol;if(sRowId===oM.sCurrentRowId){iRow=oM.iCurrentRow;if(iRow>=0){for(iCol=0;iCol<oL._aColumns.length;iCol++){oCol=oL._aColumns[iCol];if(oCol.get('pbChanged')){oCol.set('psValue',this.tOrigRow&&this.tOrigRow.aCells[oCol._iColIndex].sValue||"");oCol.set('pbChanged',false);}}}}},setCurrentRowId:function setCurrentRowId(sRowId){var oM=this.oM,iPrevCol;if(sRowId!==oM.sCurrentRowId&&this.iChangeToCol!==null&&this.iChangeToCol!==oM.iCurrentColumn){iPrevCol=oM.iCurrentColumn;oM.iCurrentColumn=this.iChangeToCol;oM.onColChange.fire(this,{bRowChange:true,iGotoCol:this.iChangeToCol,iPrevCol:iPrevCol});this.iChangeToCol=null;}df.WebGridController.base.setCurrentRowId.call(this,sRowId);},cellClick:function cellClick(oEv,sRowId,iCol){var oM=this.oM,oL=this.oL;if(iCol>=0&&iCol!==oM.iCurrentColumn&&oL._aColumns[iCol].pbEditable){this.iChangeToCol=iCol;}if(sRowId==="empty"){this.appendNewRow();}df.WebGridController.base.cellClick.call(this,oEv,sRowId,iCol);},prevCol:function prevCol(){var oM=this.oM,oL=this.oL,iPrevCol,iCol,bPrevRow=false;iCol=oM.iCurrentColumn;for(var i=0;i<oL._aColumnMapper.length;i++){if(oL._aColumnMapper[i]._iCol===iCol){iCol=i;break;}}do{iCol--;if(iCol<0){if(bPrevRow){break;}bPrevRow=true;iCol=oL._aColumnMapper.length-1;}}while(!oL._aColumnMapper[iCol].isEnabled()||!oL._aColumnMapper[iCol].pbEditable||!oL._aColumnMapper[iCol].pbRender||oL._aColumnMapper[iCol].pbHidden||!oL._aColumnMapper[iCol].pbVisible);iCol=oL._aColumnMapper[iCol]._iCol;if(bPrevRow){if(oM.iCurrentRow>0){this.iChangeToCol=iCol;this.selectRow("row",oM.iCurrentRow-1);return true;}}else if(iCol!==oM.iCurrentColumn){iPrevCol=oM.iCurrentColumn;oM.iCurrentColumn=iCol;oM.onColChange.fire(this,{bRowChange:bPrevRow,iGotoCol:iCol,iPrevCol:iPrevCol});return true;}return false;},nextCol:function nextCol(){var oL=this.oL,oM=this.oM,iCol,bNextRow,iPrevCol;iCol=oM.iCurrentColumn;for(var i=0;i<oL._aColumnMapper.length;i++){if(oL._aColumnMapper[i]._iCol===iCol){iCol=i;break;}}if(!oL._aColumnMapper[iCol].isEnabled()||oL._aColumnMapper[iCol].validate&&oL._aColumnMapper[iCol].validate()){do{iCol++;if(iCol>=oL._aColumnMapper.length){if(bNextRow){break;}bNextRow=true;iCol=0;}}while(!oL._aColumnMapper[iCol].isEnabled()||!oL._aColumnMapper[iCol].pbEditable||!oL._aColumnMapper[iCol].pbRender||oL._aColumnMapper[iCol].pbHidden||!oL._aColumnMapper[iCol].pbVisible);iCol=oL._aColumnMapper[iCol]._iCol;if(bNextRow){this.iChangeToCol=iCol;if(oM.iCurrentRow<oM.aData.length-1){this.selectRow("row",oM.iCurrentRow+1);return true;}else{return this.appendNewRow();}}else if(iCol!==oM.iCurrentColumn){iPrevCol=oM.iCurrentColumn;oM.iCurrentColumn=iCol;oM.onColChange.fire(this,{bRowChange:false,iGotoCol:iCol,iPrevCol:iPrevCol});return true;}}return true;},selectCol:function selectCol(iCol){var oM=this.oM,oL=this.oL,iPrevCol;if(iCol>=0&&iCol<oL._aColumns.length&&oL._aColumns[iCol].pbRender){iPrevCol=oM.iCurrentColumn;oM.iCurrentColumn=iCol;oM.onColChange.fire(this,{bRowChange:false,iGotoCol:iCol,iPrevCol:iPrevCol});}},keyDown:function keyDown(oEv){if(oEv.matchKey(df.settings.gridKeys.prevCol)){if(this.prevCol()){oEv.stop();return false;}}else if(oEv.matchKey(df.settings.gridKeys.nextCol)){if(this.nextCol()){oEv.stop();return false;}}else if(oEv.matchKey(df.settings.gridKeys.newRow)){if(this.insertNewRow()){oEv.stop();return false;}}else{return df.WebGridController.base.keyDown.call(this,oEv);}return true;},moveDownRow:function moveDownRow(){if(!df.WebGridController.base.moveDownRow.call(this)){if(!this.oM.bPaged||this.oM.bLast){return this.appendNewRow();}return false;}return true;}});df.WebColumn_mixin=function WebColumn_mixin(sName,oParent){this.getBase("df.WebColumn_mixin").constructor.call(this,sName,oParent);if(!(oParent&&oParent instanceof df.WebList)){throw new df.Error(999,"WebColumn object '{{0}}' should be placed inside a WebList object. Consider wrapping your column with a list or grid object.",this,[this.getLongName()]);}this.prop(df.tBool,"pbSortable",false);this.prop(df.tBool,"pbValueAsTooltip",true);this.prop(df.tBool,"pbAllowHtml",false);this.prop(df.tInt,"piWidth",0);this.prop(df.tString,"psCaption","");this.prop(df.tBool,"pbNewLine",false);this.prop(df.tInt,"piListColSpan",1);this.prop(df.tInt,"piListRowSpan",1);this.prop(df.tBool,"pbFixedWidth",false);this.prop(df.tBool,"pbResizable",true);this.prop(df.tBool,"pbHidden",false);this.prop(df.tBool,"pbShowCaption",true);this.prop(df.tInt,"piPosition",-1);this.prop(df.tInt,"peFooterDataType",df.ciTypeText);this.prop(df.tInt,"peFooterAlign",-1);this.prop(df.tInt,"piFooterPrecision",0);this.prop(df.tString,"psFooterMask","");this.prop(df.tString,"psFooterValue","");this.addSync("pbHidden");this.addSync("piPosition");this.prop(df.tBool,"pbEditable",true);this.event("OnHeaderClick",df.cCallModeDefault);this._sCellClass="WebCol";this._bCellEdit=true;this._iColIndex=0;this._iCol=0;this._bIsColumn=true;};df.defineClass("df.WebColumn_mixin",{set_psFooterValue:function set_psFooterValue(sVal){if(this.psFooterValue!==sVal){this.psFooterValue=sVal;this._oParent._oFooter.updateFooter();}},set_psFooterMask:function set_psFooterMask(sVal){if(this.psFooterMask!==sVal){this.psFooterMask=sVal;this._oParent._oFooter.updateFooter();}},set_piFooterPrecision:function set_piFooterPrecision(iVal){if(this.piFooterPrecision!==iVal){this.piFooterPrecision=iVal;this._oParent._oFooter.updateFooter();}},set_peFooterAlign:function set_peFooterAlign(eVal){if(this.peFooterAlign!==eVal){this.peFooterAlign=eVal;this._oParent._oFooter.updateFooter();}},set_peFooterDataType:function set_peFooterDataType(eVal){if(this.peFooterDataType!==eVal){this.peFooterDataType=eVal;this._oParent._oFooter.updateFooter();}},set_psValue:function set_psValue(sVal){this.getBase("df.WebColumn_mixin").set_psValue.call(this,sVal);if(this._oParent instanceof df.WebGrid){this._oParent.updateCurrentCell(this,sVal);}},set_pbRender:function set_pbRender(bVal,bRedraw){if(typeof bRedraw!="boolean")bRedraw=true;var bCS=this.pbRender!==bVal;this.getBase("df.WebColumn_mixin").set_pbRender.call(this,bVal);if(bCS){this.pbRender=bVal;this._oParent.rebuildColumnMapper(bRedraw);}},set_pbShowCaption:function set_pbShowCaption(bVal){if(this.pbShowCaption!==bVal){this.pbShowCaption=bVal;this._oParent._oHeader.updateHeader();}},set_pbHidden:function set_pbHidden(bVal,bRedraw){if(typeof bRedraw!="boolean")bRedraw=true;if(this.pbHidden!==bVal){this.pbHidden=bVal;this._oParent.rebuildColumnMapper(bRedraw);}},set_piPosition:function set_piPosition(iVal,bRedraw){if(typeof bRedraw!="boolean")bRedraw=true;if(this.piPosition!==iVal){this.piPosition=iVal;this._oParent.rebuildColumnMapper(bRedraw);}},set_pbEditable:function set_pbEditable(bVal){if(this.pbEditable!==bVal){this.pbEditable=bVal;this._oParent.redraw();}},set_pbAllowHtml:function set_pbAllowHtml(bVal){if(this.pbAllowHtml!==bVal){this.pbAllowHtml=bVal;this._oParent.redraw();}},set_piWidth:function set_piWidth(iVal){if(this.piWidth!==iVal){this.piWidth=iVal;this._oParent.redraw();}},set_pbFixedWidth:function set_pbFixedWidth(bVal){if(this.pbFixedWidth!==bVal){this.pbFixedWidth=bVal;this._oParent.redraw();}},set_pbNewLine:function set_pbNewLine(bVal){if(this.pbNewLine!==bVal){this.pbNewLine=bVal;this._oParent.redraw();this._oParent.sizeChanged(true);}},set_psCaption:function set_psCaption(sVal){if(this.psCaption!==sVal){this.psCaption=sVal;this._oParent.redraw();}},set_psCSSClass:function set_psCSSClass(sVal){var bCS=this.psCSSClass!==sVal;this.getBase("df.WebColumn_mixin").set_psCSSClass.call(this,sVal);if(bCS){this.psCSSClass=sVal;this._oParent.redraw();}},set_piListColSpan:function set_piListColSpan(iVal){if(this.piListColSpan!==iVal){this.piListColSpan=iVal;this._oParent.redraw();}},set_piListRowSpan:function set_piListRowSpan(iVal){if(this.piListRowSpan!==iVal){this.piListRowSpan=iVal;this._oParent.redraw();}},set_pbVisible:function set_pbVisible(bVal){if(this.set_pbVisible!==bVal){this.getBase("df.WebColumn_mixin").set_pbVisible.call(this,bVal);this.pbVisible=bVal;this._oParent.redraw();}},applyEnabled:function applyEnabled(bVal){this.getBase("df.WebColumn_mixin").applyEnabled.call(this,bVal);this._oParent.redraw();},onKey:function onKey(oEvent){if(this._oParent.onKeyDown(oEvent)){this.getBase("df.WebColumn_mixin").onKey.call(this,oEvent);}else{oEvent.e.cancelBubble=true;}},cellHtml:function cellHtml(tCell){var tVal,sVal;tVal=df.sys.data.serverToType(tCell.sValue,this.peDataType);sVal=this.typeToDisplay(tVal);if(!this.pbAllowHtml){sVal=df.dom.encodeHtml(sVal);}return sVal!==''?sVal:'&nbsp;';},tooltipValue:function tooltipValue(tCell){var tVal=df.sys.data.serverToType(tCell.sValue,this.peDataType);return this.typeToDisplay(tVal);},cellClickBefore:function cellClickBefore(oEvent,sRowId,sVal){return false;},cellClickAfter:function cellClickAfter(oEvent,sRowId,sVal){return false;},cellEdit:function cellEdit(){},cellUnEdit:function cellUnEdit(){},getTooltipElem:function getTooltipElem(){var eElem=this._oParent.getColCell(this);if(!eElem){eElem=this._oParent.getColHead(this);}return eElem;},getErrorElem:function getErrorElem(){return this.getTooltipElem();},selectAndFocus:function selectAndFocus(){if(this._oParent instanceof df.WebGrid){this._oParent.selectCol(this._iCol);}this.focus();}});df.WebColumnBase=df.mixin("df.WebColumn_mixin","df.WebForm");df.WebColumn=function WebColumn(sName,oParent){df.WebColumn.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peWordBreak",df.wbNone);};df.defineClass("df.WebColumn","df.WebColumnBase",{create:function create(){this._sCellClass="WebCol "+df.classWordBreak(this.peWordBreak);},cellHtml:function cellHtml(tCell){if(this.pbPassword){return tCell.sValue.replace(/./g,"&bull;");}else{return df.WebColumn.base.cellHtml.call(this,tCell);}},tooltipValue:function tooltipValue(tCell){if(this.pbPassword){return tCell.sValue.replace(/./g,"&bull;");}else{return df.WebColumn.base.tooltipValue.call(this,tCell);}},set_peWordBreak:function set_peWordBreak(iVal){if(this.peWordBreak!==iVal){this._sCellClass="WebCol "+df.classWordBreak(iVal);this._oParent.redraw();}}});df.WebColumnComboBase=df.mixin("df.WebColumn_mixin","df.WebCombo");df.WebColumnCombo=function WebColumnCombo(sName,oParent){df.WebColumnCombo.base.constructor.call(this,sName,oParent);this._sCellClass="WebColCombo";};df.defineClass("df.WebColumnCombo","df.WebColumnComboBase",{afterRender:function afterRender(){df.WebColumnCombo.base.afterRender.call(this);},cellHtml:function cellHtml(tCell){var i,sVal=tCell.sValue,tVal;if(this._aValues){for(i=0;i<this._aValues.length;i++){if(this._aValues[i].sValue===sVal){return!this.pbAllowHtml?df.dom.encodeHtml(this._aValues[i].sDescription):this._aValues[i].sDescription;}}}tVal=df.sys.data.serverToType(sVal,this.peDataType);sVal=this.typeToDisplay(tVal);if(!this.pbAllowHtml){sVal=df.dom.encodeHtml(sVal);}return sVal!==''?sVal:'&nbsp;';},onKey:function onKey(oEvent){var that=this;df.WebColumnCombo.base.onKey.apply(this,arguments);if(df.sys.isMoz){if(oEvent.matchKey(df.settings.listKeys.scrollUp)||oEvent.matchKey(df.settings.listKeys.scrollDown)){this._eControl.disabled=true;setTimeout(function(){that._eControl.disabled=!that.isEnabled();},20);}}}});df.WebColumnCheckboxBase=df.mixin("df.WebColumn_mixin","df.WebCheckbox");df.WebColumnCheckbox=function WebColumnCheckbox(sName,oParent){df.WebColumnCheckbox.base.constructor.call(this,sName,oParent);this._sTick=null;this._sCellClass="WebColCheckbox";this._sControlClass="WebCheckbox WebCheckboxColumn";};df.defineClass("df.WebColumnCheckbox","df.WebColumnCheckboxBase",{cellClickBefore:function cellClickBefore(oEvent,sRowId,sVal){var eTarget=oEvent.getTarget();df.WebColumnCheckbox.base.cellClickBefore.call(this,oEvent,sRowId,sVal);if(!df.dom.isParent(eTarget,this._eElem)&&(eTarget.tagName==="INPUT"||eTarget.tagName==="SPAN")){this._sTick=sRowId;}},cellClickAfter:function cellClickAfter(oEv,sRowId,sColVal){df.WebColumnCheckbox.base.cellClickAfter.call(this,oEv,sRowId,sColVal);if(this._sTick){this.getWebApp().waitForCall(function(){this._bIgnoreOnChange=false;if(this._sTick===this._oParent.currentRowId()){this.tick();this._sTick=null;}this._bIgnoreOnChange=true;},this);}},cellHtml:function cellHtml(tCell){var aHtml=[];aHtml.push('<div class="',this.genClass(),'"><div class="WebCon_Inner"><div><input type="checkbox"');if(tCell.sValue===this.psChecked){aHtml.push(' onclick="this.checked = true" checked="checked"');}else{aHtml.push(' onclick="this.checked = false"');}if(!this.isEnabled()){aHtml.push(' disabled="disabled"');}if(!(this._oParent instanceof df.WebGrid)){aHtml.push(' tabindex="-1"');}aHtml.push('><span class="WebCB_Fake"></span></div></div></div>');return aHtml.join('');}});df.WebColumnDateBase=df.mixin("df.WebColumn_mixin","df.WebDateForm");df.WebColumnDate=function WebColumnDate(sName,oParent){df.WebColumnDate.base.constructor.call(this,sName,oParent);this._sCellClass="WebCol";};df.defineClass("df.WebColumnDate","df.WebColumnDateBase",{afterRender:function afterRender(){df.WebColumnDate.base.afterRender.call(this);},onKey:function onKey(oEvent){if(!this._bPickerVisible){df.WebColumnDate.base.onKey.call(this,oEvent);}else if(oEvent.matchKey(df.settings.calendarKeys.close)&&this._bPickerVisible){this.hideDatePicker();oEvent.stop();}}});df.WebColumnButtonBase=df.mixin("df.WebColumn_mixin","df.WebBaseDEO");df.WebColumnButton=function WebColumnButton(sName,oParent){df.WebColumnButton.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psBtnCssClass","");this.prop(df.tBool,"pbDynamic",false);this.event("OnClick",df.cCallModeWait);this._sControlClass="";this._sCellClass="WebColBtn";this._bCellEdit=false;};df.defineClass("df.WebColumnButton","df.WebColumnButtonBase",{openHtml:function openHtml(aHtml){df.WebColumnButton.base.openHtml.call(this,aHtml);aHtml.push('<div>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebColumnButton.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div");df.WebColumnButton.base.afterRender.call(this);},set_psBtnCssClass:function set_psBtnCssClass(sVal){var bCS=this.psBtnCssClass!==sVal;this.psBtnCssClass=sVal;if(bCS){this._oParent.redraw();}},getControlValue:function getControlValue(){return this.psValue;},cellClickAfter:function cellClickAfter(oEvent,sRowId,sVal){var eBtn=oEvent.getTarget();if(eBtn.tagName==="BUTTON"&&eBtn.hasAttribute("data-dfbtnid")&&this.isEnabled()){this.fire("OnClick",[eBtn.getAttribute("data-dfbtnid"),sRowId]);return true;}return false;},cellHtml:function cellHtml(tCell){var i,aButtons,aHtml=[],sAttributes="";if(!this.isEnabled()){sAttributes+=' disabled="disabled"';}if(this.pbDynamic){aButtons=tCell.aOptions;for(i=0;i<aButtons.length;i+=3){if(aButtons[i]){aHtml.push('<button data-dfbtnid="',aButtons[i],'" class="',aButtons[i+1],'"',sAttributes,'>',aButtons[i+2],'</button>');}}}else{aHtml.push('<button data-dfbtnid="DEFAULT"',sAttributes,' class="',this.psBtnCssClass,'">',this.psButtonCaption,'</button>');}return aHtml.join('');},focus:function focus(){var eBtn;if(this._bFocusAble&&this.isEnabled()&&this._eControl&&this._eControl.focus){eBtn=df.dom.query(this._eControl,"button");if(eBtn){eBtn.focus();this.objFocus();return true;}}return false;}});df.WebColumnImageBase=df.mixin("df.WebColumn_mixin","df.WebBaseDEO");df.WebColumnImage=function WebColumnImage(sName,oParent){df.WebColumnImage.base.constructor.call(this,sName,oParent);this.event("OnClick",df.cCallModeWait);this.prop(df.tBool,"pbImageByCSS",false);this.prop(df.tBool,"pbDynamic",false);this.prop(df.tInt,"pePosition",df.cwiFit);this.prop(df.tString,"psImageUrl","");this.prop(df.tString,"psImageCSSClass","");this.prop(df.tInt,"piImageWidth",0);this.prop(df.tInt,"piImageHeight",0);this._sControlClass="";this._sCellClass="WebColImg";this._bCellEdit=false;};df.defineClass("df.WebColumnImage","df.WebColumnImageBase",{openHtml:function openHtml(aHtml){df.WebColumnImage.base.openHtml.call(this,aHtml);aHtml.push('<div>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebColumnImage.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div");df.WebColumnImage.base.afterRender.call(this);},set_psImageUrl:function set_psImageUrl(sVal){this.psImageUrl=sVal;this._oParent.redraw();},getControlValue:function getControlValue(){return this.psValue;},cellClickAfter:function cellClickAfter(oEvent,sRowId,sVal){var eImg=oEvent.getTarget();if(this.isEnabled()&&eImg.hasAttribute("data-dfimg")){if(this.fire("OnClick",[eImg.getAttribute("data-dfimg"),sRowId])){return true;}}return false;},cellHtml:function cellHtml(tCell){var i,aImages,aHtml=[],sStyle="",sTooltip;if(this.piImageWidth>0){sStyle+="width: "+this.piImageWidth+"px;";}if(this.piImageHeight>0){sStyle+="height: "+this.piImageHeight+"px;";}if(this.piImageHeight>0&&this.piImageWidth>0){switch(this.pePosition){case df.cwiActual:break;case df.cwiStretch:sStyle+=" background-size:100% 100%;";break;case df.cwiStretchHoriz:sStyle+=" background-size: 100%; background-position: center center;";break;case df.cwiCenter:sStyle+=" background-position: center center;";break;case df.cwiFit:sStyle+=" background-size:contain; background-position: center center;";break;case df.cwiCover:sStyle+=" background-size:cover; background-position: center center;";break;}}if(this.pbDynamic){aImages=tCell.aOptions;if(aImages.length){for(i=0;i<aImages.length;i+=2){if(aImages[i]){sTooltip=aImages[i+1]||"";if(this.pbImageByCSS){aHtml.push('<span style="',sStyle,'" class="',aImages[i],'" data-dfimg="',aImages[i],'" title="',sTooltip,'"></span>');}else{if(this.piImageWidth===0||this.piImageHeight===0){aHtml.push('<img style="',sStyle,'" src="',aImages[i],'" data-dfimg="',aImages[i],'" title="',sTooltip,'">');}else{aHtml.push('<span style="',sStyle,'background-repeat: no-repeat; background-image: url(\'',aImages[i],'\');" data-dfimg="',aImages[i],'" title="',sTooltip,'"></span>');}}}}}else{aHtml.push('<span style="',sStyle,'" class=""></span>');}}else{if(this.pbImageByCSS){aHtml.push('<span style="',sStyle,'" class="',this.psImageCSSClass,'" data-dfimg="',this.psImageUrl,'"></span>');}else{aHtml.push('<img style="',sStyle,'" src="',this.psImageUrl,'" data-dfimg="',this.psImageUrl,'">');}}return aHtml.join('');}});df.WebColumnSuggestionBase=df.mixin("df.WebColumn_mixin","df.WebSuggestionForm");df.WebColumnSuggestion=function WebColumnSuggestion(sName,oParent){df.WebColumnSuggestion.base.constructor.call(this,sName,oParent);this._sCellClass="WebCol";};df.defineClass("df.WebColumnSuggestion","df.WebColumnSuggestionBase",{onKey:function onKey(oEvent){var oKeys=df.settings.suggestionKeys;if(this._bSuggestVisible){if(oEvent.matchKey(oKeys.moveUp)){this.suggestMove(-1);oEvent.stop();return;}if(oEvent.matchKey(oKeys.moveDown)){this.suggestMove(1);oEvent.stop();return;}}df.WebColumnSuggestion.base.onKey.call(this,oEvent);}});df.WebColumnLinkBase=df.mixin("df.WebColumn_mixin","df.WebBaseDEO");df.WebColumnLink=function WebColumnLink(sName,oParent){df.WebColumnLink.base.constructor.call(this,sName,oParent);this.event("OnClick",df.cCallModeWait);this._sControlClass="WebColLink";this._sCellClass="WebColLink WebWrp_None";this._bCellEdit=false;};df.defineClass("df.WebColumnLink","df.WebColumnLinkBase",{openHtml:function openHtml(aHtml){df.WebColumnLink.base.openHtml.call(this,aHtml);aHtml.push('<a href="javascript:void(0);">');},closeHtml:function closeHtml(aHtml){aHtml.push('</a>');df.WebColumnLink.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"a");df.WebColumnLink.base.afterRender.call(this);},getControlValue:function getControlValue(){return this.psValue;},cellClickAfter:function cellClickAfter(oEvent,sRowId,sVal){if(oEvent.getTarget().tagName==="A"&&this.isEnabled()){this.fire("OnClick",[sRowId,sVal]);return true;}return false;},cellHtml:function cellHtml(tCell){return'<a href="javascript:void(0);">'+df.WebColumnLink.base.cellHtml.call(this,tCell)+'</a>';},onKey:function onKey(oEvent){oEvent.e.cancelBubble=true;if(oEvent.matchKey(df.settings.formKeys.submit)){this.cellClick(oEvent,this._oParent.currentRowId(),this.psValue);}else{df.WebColumnLink.base.onKey.call(this,oEvent);}}});df.WebCommandBar=function WebCommandBar(sName,oParent){df.WebCommandBar.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peRegion",df.ciRegionTop);this._eSizer=null;this._bWrapDiv=true;this._bRenderChildren=true;this._sControlClass="WebCommandBar";};df.defineClass("df.WebCommandBar","df.WebBaseUIObject",{addChild:function addChild(oChild){if(oChild instanceof df.WebMenuBar||oChild instanceof df.WebToolBar){df.WebCommandBar.base.addChild.call(this,oChild);}else{throw new df.Error(5201,"Invalid object structure: WebCommandBar can only contain WebMenuBar or WebToolBar objects.",this);}},openHtml:function openHtml(aHtml){df.WebCommandBar.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebCmd_Sizer">');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebCommandBar.base.closeHtml.call(this,aHtml);},renderChildren:function renderChildren(eContainer){var i,eChild,oChild,eToolWrap;this._eSizer=df.dom.query(this._eElem,"div.WebCmd_Sizer");for(i=0;i<this._aChildren.length;i++){oChild=this._aChildren[i];if(oChild instanceof df.WebBaseUIObject){eChild=oChild.render();if(oChild instanceof df.WebToolBar){if(!eToolWrap){eToolWrap=df.dom.create('<div class="WebCmd_ToolWrap"></div>');this._eSizer.appendChild(eToolWrap);}eToolWrap.appendChild(eChild);}else{eToolWrap=null;this._eSizer.appendChild(eChild);}}}},prepareSize:function prepareSize(){this._bStretch=false;if(this._eSizer){this._iWantedHeight=this._eSizer.scrollHeight;}return this._iWantedHeight;},setOuterHeight:function setOuterHeight(iHeight){if(this._eElem){this._eElem.style.height=iHeight+"px";}}});df.WebMenuBar=function WebMenuBar(sName,oParent){df.WebMenuBar.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbShowOnHover",false);this.prop(df.tBool,"pbFocusable",false);this._bShownByHover=false;this._sSelectedItem=null;this._sExpanded=null;this._tHideTimeout=null;this._bIsMenuListener=true;this._bWrapDiv=true;this._bRenderChildren=false;this._sControlClass="WebMenuBar";};df.defineClass("df.WebMenuBar","df.WebBaseMenu",{openHtml:function openHtml(aHtml){df.WebMenuBar.base.openHtml.call(this,aHtml);aHtml.push('<ul class="WebBarRoot" tabindex="0">');this.genMenuHtml(aHtml);},closeHtml:function closeHtml(aHtml){aHtml.push('</ul>');aHtml.push('<div style="clear: both"></div>');df.WebMenuBar.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"ul");df.WebMenuBar.base.afterRender.apply(this,arguments);df.dom.on("click",this._eControl,this.onMenuClick,this);df.dom.on("mouseover",this._eControl,this.onMouseOver,this);df.dom.on("mouseout",this._eControl,this.onMouseOut,this);df.dom.on("keydown",this._eControl,this.onKeyDown,this);},genMenuHtml:function genMenuHtml(aHtml){var i,aMenu=this.getMenu();for(i=0;i<aMenu.length;i++){this.genItemHtml(aHtml,aMenu[i],i.toString(),true);}},refreshMenu:function refreshMenu(){var aHtml=[];if(this._eControl){this.genMenuHtml(aHtml);this._eControl.innerHTML=aHtml.join('');this.exapndPath(this._sExpanded||"",true);}},onMenuClick:function onMenuClick(oEvent){var eElem,tItem=null;if(!this.isEnabled()){return;}this.notifyReceived();this._bShownByHover=false;eElem=oEvent.getTarget();while(!tItem&&eElem&&eElem!==this._eElem){if(eElem.hasAttribute("data-df-path")){tItem=this.getItemByPath(eElem.getAttribute("data-df-path"));}eElem=eElem.parentNode;}if(tItem){this.selectItem(tItem);if(tItem.bEnabled){if(this.isExpanded(tItem)){this.collapseItem(tItem);}else{this.expandItem(tItem);}if(tItem._oHandler.itemClick(tItem,function(bExec){if(bExec&&!(tItem.hRef instanceof df.WebMenuItemCheckbox)){this.collapseAll();}},this)){this.getWebApp().returnFocus();}}oEvent.stop();}},onMouseOver:function onMouseOver(oEvent){var eElem,tItem=null;if(!this.isEnabled()){return;}this.notifyReceived();eElem=oEvent.getTarget();while(!tItem&&eElem&&eElem!==this._eElem){if(eElem.hasAttribute("data-df-path")){tItem=this.getItemByPath(eElem.getAttribute("data-df-path"));}eElem=eElem.parentNode;}if(tItem){this.selectItem(tItem);if(this._sExpanded||this.pbShowOnHover){if(!this._sExpanded){this._bShownByHover=true;}if(tItem.aChildren.length>0){this.expandItem(tItem);}else{this.collapseSubItems(tItem);}}oEvent.stop();}},onMouseOut:function onMouseOut(oEvent){this.notifyLost(true);oEvent.stop();},selectItem:function selectItem(tItem){var eItem;if(this._sSelectedItem&&this._sSelectedItem!==tItem._sPath&&this._sSelectedItem!==tItem._sPath){eItem=this.getItemElemByPath(this._sSelectedItem);if(eItem){df.dom.removeClass(eItem,"WebItm_Selected");}this._sSelectedItem=null;}if(tItem.bEnabled){eItem=this.getItemElemByPath(tItem._sPath);df.dom.addClass(eItem,"WebItm_Selected");this._sSelectedItem=tItem._sPath;}},isExpanded:function isExpanded(tItem){if(this._sExpanded&&this._sExpanded.substr(0,tItem._sPath.length)===tItem._sPath){return true;}return false;},exapndPath:function exapndPath(sPath,bWithoutTransition){var aPath=sPath.split('.');var sConstructPath="";if(bWithoutTransition)df.dom.addClass(this._eElem,"WebNoTransition");for(var i=0;i<aPath.length;i++){sConstructPath+=i>0?"."+aPath[i]:aPath[i];var tItem=this.getItemByPath(sConstructPath);if(tItem){this.expandItem(tItem);}}if(bWithoutTransition)df.dom.removeClass(this._eElem,"WebNoTransition");},expandItem:function expandItem(tItem){var eItem,eLast,eSub,oRect,iLeft,iViewport;this.collapseSubItems(tItem);if(tItem.aChildren.length>0&&tItem.bEnabled){this._sExpanded=tItem._sPath;eItem=this.getItemElemByPath(this._sExpanded);while(eItem&&eItem!==this._eElem){if(eItem.hasAttribute("data-df-path")){df.dom.addClass(eItem,"WebItm_Expanded");eLast=eItem;}eItem=eItem.parentNode;}if(eLast){eSub=eLast.lastChild;oRect=eLast.getBoundingClientRect();iLeft=oRect.left;iViewport=df.sys.gui.getViewportWidth();if(iLeft+eSub.offsetWidth>iViewport){iLeft=oRect.right-eSub.offsetWidth;if(iLeft<0){iLeft=5;}}eSub.style.top=oRect.bottom+"px";eSub.style.left=iLeft+"px";}}},collapseSubItems:function collapseSubItems(tItem){var eItem,sTarget=tItem._sPath;if(this._sExpanded&&tItem._sPath!==this._sExpanded){eItem=this.getItemElemByPath(this._sExpanded);if(eItem){while(eItem&&eItem!==this._eElem){if(eItem.hasAttribute("data-df-path")){this._sExpanded=eItem.getAttribute("data-df-path");if(this._sExpanded!==sTarget.substr(0,this._sExpanded.length)){df.dom.removeClass(eItem,"WebItm_Expanded");}else{break;}}eItem=eItem.parentNode;}}else{this.collapseAll();}}},collapseItem:function collapseItem(tItem){var sTarget=tItem._sPath;if(sTarget.indexOf(".")>0){sTarget=sTarget.substr(0,sTarget.lastIndexOf("."));this.expandItem(this.getItemByPath(sTarget));}else{this.collapseAll();}},collapseAll:function collapseAll(){var i,aItems=df.dom.query(this._eControl,'li.WebItm_Expanded',true);for(i=0;i<aItems.length;i++){df.dom.removeClass(aItems[i],"WebItm_Expanded");}this._sExpanded=null;},notifyLost:function notifyLost(bMouseOut){var that=this;if(!bMouseOut||this._bShownByHover){if(this._tHideTimeout){clearTimeout(this._tHideTimeout);}this._tHideTimeout=setTimeout(function(){var eItem;that._tHideTimeout=null;that.collapseAll();if(that._sSelectedItem){eItem=that.getItemElemByPath(that._sSelectedItem);if(eItem){df.dom.removeClass(eItem,"WebItm_Selected");}that._sSelectedItem=null;}if(bMouseOut&&that._bShownByHover){that.getWebApp().returnFocus();}},150);}},notifyReceived:function notifyReceived(){if(this._tHideTimeout){clearTimeout(this._tHideTimeout);this._tHideTimeout=null;}},moveParent:function moveParent(){var tItem,sTarget=this._sSelectedItem;if(sTarget){if(sTarget.indexOf(".")>0){sTarget=sTarget.substr(0,sTarget.lastIndexOf("."));tItem=this.getItemByPath(sTarget);if(tItem){this.collapseItem(tItem);this.selectItem(tItem);}}}},moveSibling:function moveSibling(iDelta){var aPath,sTarget,tItem,bFirst=true;if(this._sSelectedItem){aPath=this._sSelectedItem.split(".");while(bFirst||tItem&&!tItem.bEnabled){aPath[aPath.length-1]=parseInt(aPath[aPath.length-1],10)+iDelta;sTarget=aPath.join(".");tItem=this.getItemByPath(sTarget);bFirst=false;}if(tItem){this.expandItem(tItem);this.selectItem(tItem);}}},moveChild:function moveChild(){var aPath,sTarget,tItem,bFirst=true;if(this._sSelectedItem){sTarget=this._sSelectedItem+".0";}else{sTarget="0";}aPath=sTarget.split(".");while(bFirst||tItem&&!tItem.bEnabled){sTarget=aPath.join(".");tItem=this.getItemByPath(sTarget);aPath[aPath.length-1]=parseInt(aPath[aPath.length-1],10)+1;bFirst=false;}if(tItem){this.expandItem(tItem);this.selectItem(tItem);}},onKeyDown:function onKeyDown(oEvent){var bRes=false,tItem,bRoot=this._sSelectedItem&&this._sSelectedItem.indexOf(".")<0;if(oEvent.matchKey(df.settings.menuKeys.moveUp)){if(!bRoot){this.moveSibling(-1);}bRes=true;}else if(oEvent.matchKey(df.settings.menuKeys.moveDown)){if(bRoot){this.moveChild();}else{this.moveSibling(1);}bRes=true;}else if(oEvent.matchKey(df.settings.menuKeys.moveLeft)){if(bRoot){this.moveSibling(-1);}else{this.moveParent();}bRes=true;}else if(oEvent.matchKey(df.settings.menuKeys.moveRight)){if(bRoot){this.moveSibling(1);}else{this.moveChild();}bRes=true;}else if(oEvent.matchKey(df.settings.formKeys.submit)){if(this._sSelectedItem){tItem=this.getItemByPath(this._sSelectedItem);if(tItem){bRes=true;tItem._oHandler.itemClick(tItem,function(bExec){if(bExec){this.collapseAll();this.getWebApp().returnFocus();}},this);}}}if(bRes){oEvent.stop();this._bShownByHover=false;}},onFocus:function onFocus(oEvent){if(!this.isEnabled()){return;}this.notifyReceived();if(this._eElem){df.dom.addClass(this._eElem,"WebCon_Focus");if(!this._sSelectedItem){this.moveChild();}}if(this.pbFocusable){this.objFocus();}this.fire("OnFocus");this._bHasFocus=true;},onBlur:function onBlur(oEvent){this.notifyLost(false);if(this._eElem){df.dom.removeClass(this._eElem,"WebCon_Focus");}this.fire("OnBlur");this._bHasFocus=false;}});df.WebBaseMenuGroup=df.mixin("df.WebMenuProvider_mixin","df.WebObject");df.WebMenuGroup=function WebMenuGroup(sName,oPrnt){df.WebMenuGroup.base.constructor.apply(this,arguments);this._bActive=false;};df.defineClass("df.WebMenuGroup","df.WebBaseMenuGroup",{create:function create(){var oView=this.getView();if(oView){oView.OnShow.addListener(this.showView,this);oView.OnHide.addListener(this.hideView,this);}else{this._bActive=true;df.WebMenuGroup.base.create.apply(this,arguments);}},showView:function showView(oEvent){this._bActive=true;if(this.psGroupName){this.getHub().addProvider(this.psGroupName,this);}},hideView:function hideView(oEvent){this._bActive=false;if(this.psGroupName){this.getHub().remProvider(this.psGroupName,this);}},set_psGroupName:function set_psGroupName(bVal){if(this._bActive){df.WebMenuGroup.base.set_psGroupName.call(this,bVal);}}});df.WebToolBar=function WebToolBar(sName,oParent){df.WebToolBar.base.constructor.apply(this,arguments);this.prop(df.tBool,"pbShowCaption",false);this.prop(df.tInt,"peAlign",df.ciAlignLeft);this.prop(df.tBool,"pbShowIcons",true);this.prop(df.tString,"psSubItemCaption","More..");this._eControl=null;this._bWrapDiv=true;this._sControlClass="WebToolBar";};df.defineClass("df.WebToolBar","df.WebMenuBar",{openHtml:function openHtml(aHtml){df.WebToolBar.base.openHtml.call(this,aHtml);},closeHtml:function closeHtml(aHtml){df.WebToolBar.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"ul");df.WebToolBar.base.afterRender.call(this);this.set_pbShowCaption(this.pbShowCaption);this.set_pbShowIcons(this.pbShowIcons);this.set_peAlign(this.peAlign);},refreshMenu:function refreshMenu(){df.WebToolBar.base.refreshMenu.apply(this,arguments);this.adjustWidth();},genMenuHtml:function genMenuHtml(aHtml){df.WebToolBar.base.genMenuHtml.call(this,aHtml);aHtml.push('<li data-df-item="subitems" class="WebMenuItem WebTlb_SubItems WebTlb_NoFit" style="display: none;"><div><span class="WebItm_Icon">&nbsp;</span><a href="javascript: void(0);">',this.psSubItemCaption,'</a></div><ul></ul></li>');},onMenuClick:function onMenuClick(oEvent){var eElem;df.WebToolBar.base.onMenuClick.call(this,oEvent);if(!oEvent.bCanceled){eElem=oEvent.getTarget();while(eElem&&eElem!==this._eElem){if(eElem.hasAttribute("data-df-item")){this._eControl.focus();if(this._bSubMenuOpened){this.collapseAll();}else{this.expandSub();}oEvent.stop();return;}eElem=eElem.parentNode;}}},expandSub:function expandSub(){var eSubBtn,eSubMen,oRect,iLeft,iViewport;eSubBtn=df.dom.query(this._eControl,"li.WebTlb_NoFit");eSubMen=eSubBtn.lastChild;if(eSubMen){df.dom.addClass(eSubBtn,"WebItm_Expanded");this._bSubMenuOpened=true;oRect=eSubBtn.getBoundingClientRect();iLeft=oRect.left;iViewport=df.sys.gui.getViewportWidth();if(iLeft+eSubMen.offsetWidth>iViewport){iLeft=oRect.right-eSubMen.offsetWidth;if(iLeft<0){iLeft=5;}}eSubMen.style.top=oRect.bottom+"px";eSubMen.style.left=iLeft+"px";}},collapseAll:function collapseAll(){var eSubBtn;if(this._bSubMenuOpened){eSubBtn=df.dom.query(this._eControl,"li.WebTlb_NoFit");df.dom.addClass(eSubBtn,"WebItm_Expanded");this._bSubMenuOpened=false;}df.WebToolBar.base.collapseAll.apply(this,arguments);},adjustWidth:function adjustWidth(){var iSpace,aItems,eItem,i,eSubMen,eSubBtn;if(this._eControl){iSpace=this._eControlWrp.clientWidth;eSubBtn=df.dom.query(this._eControl,"li.WebTlb_NoFit");if(this._eControl.scrollWidth>iSpace){aItems=df.dom.query(this._eElem,"ul.WebBarRoot > li.WebMenuItem",true);if(aItems.length>1){eSubMen=df.dom.query(this._eControl,"li.WebTlb_NoFit > ul");eSubBtn.style.display="";i=aItems.length-2;while(this._eControl.scrollWidth>iSpace&&i>=0){eItem=aItems[i];eSubMen.appendChild(eItem);i--;}}}else{eSubBtn.style.display="none";}}},resize:function resize(){var iSpace=this._eControlWrp.clientWidth;if(this._iLastResizeSpace!==iSpace){this._iLastResizeSpace=iSpace;this.adjustWidth();}},genClass:function genClass(){var sClass=df.WebToolBar.base.genClass.apply(this,arguments);sClass+=this._oParent instanceof df.WebCommandBar?" WebTlb_Command":" WebTlb_Standalone";return sClass;},set_pbShowCaption:function set_pbShowCaption(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebTlb_HideCaption",!bVal);this.refreshMenu();}},set_pbShowIcons:function set_pbShowIcons(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebTlb_HideIcons",!bVal);this.refreshMenu();}},set_peAlign:function set_peAlign(eVal){if(this._eControlWrp){this._eControlWrp.style.textAlign=["left","center","right"][eVal];}}});df.WebActionBar=function WebActionBar(sName,oParent){df.WebActionBar.base.constructor.apply(this,arguments);this._sControlClass+=" WebActionBar";};df.defineClass("df.WebActionBar","df.WebToolBar",{genMenuHtml:function genMenuHtml(aHtml){var i,tItm,aMenu=this.getMenu(),bMenu=false;for(i=0;i<aMenu.length;i++){tItm=aMenu[i];if(!tItm.sCSSClass){tItm.sCSSClass="WebDefaultMenuItem";}if(tItm.eActionDisplay===df.adBoth||tItm.eActionDisplay===df.adActionBar){this.genItemHtml(aHtml,tItm,true);}bMenu=bMenu||tItm.eActionDisplay===df.adBoth||tItm.eActionDisplay===df.adMenu;}aHtml.push('<li data-df-item="subitems" class="WebMenuItem WebTlb_SubItems WebTlb_NoFit"',bMenu?'':' style="display: none;"','><div><span class="WebItm_Icon">&nbsp;</span><a href="javascript: void(0);">',this.psSubItemCaption,'</a></div><ul>');if(bMenu){for(i=0;i<aMenu.length;i++){tItm=aMenu[i];if(tItm.eActionDisplay===df.adBoth||tItm.eActionDisplay===df.adMenu){this.genItemHtml(aHtml,tItm,true);}}}aHtml.push('</ul></li>');},adjustWidth:function adjustWidth(){var iSpace,aItems,eItem,i,eSubMen,eSubBtn,tItem;if(this._eControl){iSpace=this._eControlWrp.clientWidth;if(this._eControl.scrollWidth>iSpace){aItems=df.dom.query(this._eElem,"ul.WebBarRoot > li.WebMenuItem",true);if(aItems.length>1){i=aItems.length-2;while(this._eControl.scrollWidth>iSpace&&i>=0){eItem=aItems[i];if(eItem.hasAttribute("data-df-path")){tItem=this.getItemByPath(eItem.getAttribute("data-df-path"));if(tItem.eActionDisplay===df.adBoth){eItem.parentNode.removeChild(eItem);}}i--;}if(this._eControl.scrollWidth>iSpace){eSubMen=df.dom.query(this._eControl,"li.WebTlb_NoFit > ul");aItems=df.dom.query(this._eElem,"ul.WebBarRoot > li.WebMenuItem",true);i=aItems.length-2;while(this._eControl.scrollWidth>iSpace&&i>=0){eItem=aItems[i];eSubMen.appendChild(eItem);i--;}}eSubBtn=df.dom.query(this._eControl,"li.WebTlb_NoFit");eSubBtn.style.display="";}}}},collapseAll:function collapseAll(){if(this._eMask){df.dom.off("click",this._eMask,this.onMaskTouch);this._eMask.parentNode.removeChild(this._eMask);this._eMask=null;}df.WebActionBar.base.collapseAll.apply(this,arguments);},expandItem:function expandItem(tItem){if(tItem&&tItem.aChildren.length>0){this.showMask();}df.WebActionBar.base.expandItem.apply(this,arguments);},expandSub:function expandSub(){this.showMask();df.WebActionBar.base.expandSub.apply(this,arguments);},showMask:function showMask(){if(df.sys.isMobile){this._eMask=df.dom.create('<div class="WebMenu_Mask">&nbsp;</div>');this._eElem.insertBefore(this._eMask,this._eElem.firstChild);df.dom.on("click",this._eMask,this.onMaskTouch,this);}},onMaskTouch:function onMaskTouch(oEvent){this.collapseAll();oEvent.stop();}});df.WebMenuItem=function WebMenuItem(sName,oParent){df.WebMenuItem.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tString,"psTextColor","");this.prop(df.tBool,"pbBeginGroup",false);this.prop(df.tString,"psGroupCaption","");this.prop(df.tString,"psImage","");this.prop(df.tString,"psToolTip","");this.prop(df.tInt,"peActionDisplay",df.adBoth);this.event("OnClick",df.cCallModeWait);this.prop(df.tString,"psLoadViewOnClick","");this._bShown=true;this._oProv=null;};df.defineClass("df.WebMenuItem","df.WebBaseUIObject",{itemClick:function itemClick(tItem,fReturn,oEnv){return this.fire('OnClick',[],function(oEvent){if(!oEvent.bCanceled){if(this.psLoadViewOnClick){this.getWebApp().showView(this.psLoadViewOnClick);}}fReturn.call(oEnv,oEvent.bClient||oEvent.bServer||this.psLoadViewOnClick);});},set_psCaption:function set_psCaption(sVal){this.psCaption=sVal;this.notifyChange();},set_psToolTip:function set_psToolTip(sVal){this.psToolTip=sVal;this.notifyChange();},set_pbBeginGroup:function set_pbBeginGroup(bVal){this.pbBeginGroup=bVal;this.notifyChange();},set_psImage:function set_psImage(sVal){this.psImage=sVal;this.notifyChange();},set_psHtmlId:function set_psHtmlId(sVal){this.psHtmlId=sVal;this.notifyChange();},set_psCSSClass:function set_psCSSClass(sVal){this.psCSSClass=sVal;this.notifyChange();},set_psTextColor:function set_psTextColor(sVal){this.psTextColor=sVal;this.notifyChange();},set_psBackgroundColor:function set_psBackgroundColor(sVal){this.psBackgroundColor=sVal;this.notifyChange();},set_peActionDisplay:function set_peActionDisplay(eVal){this.peActionDisplay=eVal;this.notifyChange();},set_pbVisible:function set_pbVisible(bVal){if(this.pbVisible!==bVal){this.pbVisible=bVal;this.notifyChange();}},set_pbRender:function set_pbRender(bVal){if(this.pbRender!==bVal){this.pbRender=bVal;if(this.pbRender){this.afterShow();}else{this.afterHide();}this.notifyChange();}},show:function show(){},hide:function hide(){},applyEnabled:function applyEnabled(bVal){this.notifyChange();},notifyChange:function notifyChange(){this.getProv().notifyChange();},getTooltipElem:function getTooltipElem(){var aL,oProv=this.getProv(),oHub,i;if(oProv){if(oProv.psGroupName){oHub=oProv.getHub();aL=oHub.getListeners(oProv.psGroupName);for(i=0;i<aL.length;i++){if(aL[i]._bShown){return aL[i].getItemElemByHandler(this);}}}else{return oProv.getItemElemByHandler(this);}}return null;},getProv:function getProv(){var oWO;if(!this._oProv){oWO=this;while(oWO&&!oWO._bIsMenuProv){oWO=oWO._oParent;}if(oWO&&oWO._bIsMenuProv){this._oProv=oWO;}else{throw new df.Error(999,"Menu item '{{0}}' should be wrapped by a menu object.",this,[this._sName]);}}return this._oProv;}});df.WebMenuItemCheckbox=function WebMenuItemCheckbox(sName,oParent){df.WebMenuItemCheckbox.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbChecked",false);this.addSync("pbChecked");};df.defineClass("df.WebMenuItemCheckbox","df.WebMenuItem",{itemClick:function itemClick(tItem,fReturn,oEnv){if(tItem.hRef){tItem.hRef.set_pbChecked(!tItem.hRef.isChecked());}return df.WebMenuItemCheckbox.base.itemClick.apply(this,arguments);},isChecked:function isChecked(){return this.pbChecked===true;},set_pbChecked:function set_pbChecked(bVal){this.pbChecked=bVal;this.notifyChange();}});df.WebCardContainer=function WebCardContainer(sName,oParent){df.WebCardContainer.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbShowBorder",false);this.prop(df.tBool,"pbShowCaption",false);this.prop(df.tBool,"pbSwipeCards",false);this.prop(df.tString,"psCurrentCard","");this.addSync("psCurrentCard");this.event("OnCardChange",df.cCallModeWait);this._iHeightSet=null;this._aCards=[];this._eHead=null;this._oCurrent=null;this._bRendered=false;this._bCC=true;this._bWrapDiv=true;this._bRenderChildren=true;this._sControlClass="WebCardContainer";this._sCardClass="WebCC";};df.defineClass("df.WebCardContainer","df.WebBaseControl",{openHtml:function openHtml(aHtml){var i;df.WebCardContainer.base.openHtml.call(this,aHtml);this.headHtml(aHtml);aHtml.push('<div class="',this._sCardClass,'_Body">');},headHtml:function headHtml(aHtml){aHtml.push('<div class="',this._sCardClass,'_Head">');for(var i=0;i<this._aCards.length;i++){this._aCards[i].tabButtonHtml(aHtml);}aHtml.push('<div style="clear: both"></div></div>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');aHtml.push('<label class="',this._sCardClass,'_Caption"></label>');df.WebCardContainer.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){var i,aButtons;this._eBody=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Body');this._eHead=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Head');this._eLabel=df.dom.query(this._eElem,'label.'+this._sCardClass+"_Caption");aButtons=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Head > div.WebTab_Btn',true);for(i=0;i<this._aCards.length;i++){if(i<aButtons.length){this._aCards[i].btnRendered(aButtons[i]);}}df.WebCardContainer.base.afterRender.call(this);if(this.pbSwipeCards){this.set_pbSwipeCards(true);}this.showCard(this._oCurrent,true);this._bRendered=true;},set_pbSwipeCards:function set_pbSwipeCards(bVal){if(this._eBody){if(bVal){if(window.PointerEvent){df.dom.on("pointerdown",this._eBody,this.onPointerDown,this);}else{df.dom.on("touchstart",this._eBody,this.onTouchStart,this);}}else{if(window.PointerEvent){df.dom.off("pointerdown",this._eBody,this.onPointerDown,this);}else{df.dom.off("touchstart",this._eBody,this.onTouchStart,this);}}df.dom.toggleClass(this._eBody,"WebCC_Swipable",bVal);}},onTouchStart:function onTouchStart(oEv){if(oEv.e.targetTouches.length===1){this.touchSwipe(false,oEv);}},onPointerDown:function onPointerDown(oEv){if(oEv.e.pointerType==="pen"||oEv.e.pointerType==="touch"){this.touchSwipe(true,oEv);}},touchSwipe:function touchSwipe(bPointer,oEv){var that=this,iY,iPrevY,iStartY,i,iWidth,iDiff,oShowCard=null,iStartX,iX,iPrevX,bSwipe=false,bSwipeFixed=false,iIndex=-1,oPrev=null,oNext=null,oCurrent=this._oCurrent,eCur=null,eNext=null,ePrev=null;for(i=0;i<this._aCards.length;i++){if(this._aCards[i]===oCurrent){iIndex=i;}if(this._aCards[i].isActive()){if(iIndex<0){oPrev=this._aCards[i];}else if(!oNext&&iIndex!==i){oNext=this._aCards[i];break;}}}if(!this.pbSwipeCards||!oCurrent||!oNext&&!oPrev){return;}iStartX=iPrevX=iX=bPointer?oEv.e.clientX:oEv.e.targetTouches[0].pageX;iStartY=iPrevY=iY=bPointer?oEv.e.clientY:oEv.e.targetTouches[0].pageY;function touchMove(oEv){var iBehindOffset;iY=bPointer?oEv.e.clientY:oEv.e.targetTouches[0].pageY;iX=bPointer?oEv.e.clientX:oEv.e.targetTouches[0].pageX;if(bSwipeFixed&&bSwipe||!bSwipeFixed&&Math.abs(iStartX-iX)>Math.abs(iStartY-iY)){bSwipe=true;iDiff=iX-iStartX;if(!eCur){eCur=oCurrent._eElem;df.dom.addClass(eCur,"WebC_Swipe");iWidth=eCur.offsetWidth;}if(iDiff>0){iDiff=Math.min(iWidth,iDiff);if(oPrev){if(!ePrev){if(eNext){df.dom.translateX(eNext,null,false);df.dom.removeClass(eNext,"WebC_SwipeBelow");eNext=null;}if(!oPrev._eElem){oPrev.renderCard(false);}ePrev=oPrev._eElem;df.dom.addClass(ePrev,"WebC_SwipeBelow");}iBehindOffset=-(iWidth*0.3)+iDiff*0.3;df.dom.translateX(ePrev,iBehindOffset,false);df.dom.translateX(eCur,iDiff,false);}else{iDiff=iDiff*0.17;df.dom.translateX(eCur,iDiff,false);}}else{iDiff=Math.max(-iWidth,iDiff);if(oNext){if(!eNext){if(ePrev){df.dom.translateX(ePrev,null,false);df.dom.removeClass(ePrev,"WebC_SwipeBelow");ePrev=null;}if(!oNext._eElem){oNext.renderCard(false);}eNext=oNext._eElem;df.dom.addClass(eNext,"WebC_SwipeBelow");}iBehindOffset=iWidth*0.3+iDiff*0.3;df.dom.translateX(eNext,iBehindOffset,false);df.dom.translateX(eCur,iDiff,false);}else{iDiff=iDiff*0.17;df.dom.translateX(eCur,iDiff,false);}}oEv.stop();}}function finished(){if(oShowCard){this.showCard(oShowCard,false);}if(ePrev){df.dom.translateX(ePrev,null,false);df.dom.removeClass(ePrev,"WebC_SwipeBelow");}if(eNext){df.dom.translateX(eNext,null,false);df.dom.removeClass(eNext,"WebC_SwipeBelow");}if(eCur){df.dom.translateX(eCur,null,false);df.dom.removeClass(eCur,"WebC_Swipe WebC_SwipeLeaving");}}function touchEnd(oEv){if(iDiff>0){if(oPrev&&ePrev){if(iDiff>iWidth*0.4){oShowCard=oPrev;if(iDiff<iWidth){df.dom.transition(ePrev,"all 200ms",finished,this);df.dom.translateX(ePrev,0,false);df.dom.transition(eCur,"all 200ms");df.dom.translateX(eCur,iWidth,false);df.dom.addClass(eCur,"WebC_SwipeLeaving");}else{finished.call(this);}}else{if(iDiff<iWidth){df.dom.transition(ePrev,"all 200ms",finished,this);df.dom.translateX(ePrev,iWidth*0.3,false);df.dom.transition(eCur,"all 200ms");df.dom.translateX(eCur,0,false);}else{finished.call(this);}}}else if(iDiff!==0&&eCur){df.dom.translateX(eCur,0,false);}}else{if(oNext&&eNext){if(-iDiff>iWidth*0.4){oShowCard=oNext;if(-iDiff<iWidth){df.dom.transition(eNext,"all 200ms",finished,this);df.dom.translateX(eNext,0,false);df.dom.transition(eCur,"all 200ms");df.dom.translateX(eCur,-iWidth,false);df.dom.addClass(eCur,"WebC_SwipeLeaving");}else{finished.call(this);}}else{if(-iDiff<iWidth){df.dom.transition(eNext,"all 200ms",finished,this);df.dom.translateX(eNext,-(iWidth*0.3),false);df.dom.transition(eCur,"all 200ms");df.dom.translateX(eCur,0,false);}else{finished.call(this);}}}else if(iDiff!==0&&eCur){df.dom.transition(eCur,"all 100ms",finished,this);df.dom.translateX(eCur,0,false);}}if(bPointer){df.dom.off("pointerup",window,touchEnd);df.dom.off("pointercancel",window,touchEnd);df.dom.off("pointermove",window,touchMove);}else{df.dom.off("touchend",window,touchEnd);df.dom.off("touchcancel",window,touchEnd);df.dom.off("touchmove",window,touchMove);}}if(bPointer){df.dom.on("pointerup",window,touchEnd,this);df.dom.on("pointercancel",window,touchEnd,this);df.dom.on("pointermove",window,touchMove,this);}else{df.dom.on("touchend",window,touchEnd,this);df.dom.on("touchcancel",window,touchEnd,this);df.dom.on("touchmove",window,touchMove,this);}setTimeout(function(){bSwipeFixed=true;},300);},renderChildren:function renderChildren(eRenderTo){var oChild,eChild,i;if(this.psCurrentCard){this._oCurrent=this.getWebApp().findObj(this.psCurrentCard);}for(i=0;i<this._aCards.length&&!this._oCurrent;i++){if(this._aCards[i].isActive()){this._oCurrent=this._aCards[i];}}eRenderTo=this._eControl=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Body');if(this.hasDynamicHeight()){for(i=0;i<this._aChildren.length;i++){oChild=this._aChildren[i];if(oChild instanceof df.WebBaseUIObject){eChild=oChild.render();if(eChild){eRenderTo.appendChild(eChild);}}}}else if(this._oCurrent){eChild=this._oCurrent.render();if(eChild){eRenderTo.appendChild(eChild);}}},afterRenderChildren:function afterRenderChildren(){if(this.hasDynamicHeight()){df.WebCardContainer.base.afterRenderChildren.apply(this,arguments);}else if(this._oCurrent){this._oCurrent.afterRender();}},hasDynamicHeight:function hasDynamicHeight(){return!this.pbFillHeight&&this.piHeight<=0;},addChild:function addChild(oChild){if(oChild instanceof df.WebCard){this._aCards.push(oChild);}else if(oChild instanceof df.WebBaseUIObject){throw new df.Error(999,"WebCardContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebCard.",this,[oChild.getLongName()||'oWebApp']);}df.WebCardContainer.base.addChild.call(this,oChild);},afterShow:function afterShow(){this._bShown=true;if(this._oCurrent){this._oCurrent.afterShow();}},afterHide:function afterHide(){this._bShown=false;if(this._oCurrent){this._oCurrent.afterHide();}},getNaturalHeight:function getNaturalHeight(){var iHeight=0,i,iTab;for(i=0;i<this._aCards.length;i++){if(this._aCards[i].pbRender&&this._aCards[i]._eElem){iTab=this._aCards[i].getRequiredHeight();if(iTab>iHeight){iHeight=iTab;}}}iHeight+=this.getHeightDiff();return iHeight;},sizeHeight:function sizeHeight(iExtHeight){var iHeight=-1;if(this.pbFillHeight){iHeight=iExtHeight;}else{if(this.piHeight>0){iHeight=this.piHeight;}else{iHeight=this.getNaturalHeight();}}if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}this.setHeight(iHeight);if(iHeight>0){return iHeight;}},getVertHeightDiff:function getVertHeightDiff(){var iResult=0;if(this.peLabelPosition===df.ciLabelTop&&this._eLbl){iResult+=this._eLbl.offsetHeight;}iResult+=this.getHeightDiff();return iResult;},resize:function resize(){var i;if(this._eElem&&this._bRendered){for(i=0;i<this._aCards.length;i++){if(this._aCards[i]._eElem){this._aCards[i].resizeHorizontal();this._aCards[i].resizeVertical();}}if(!this.pbFillHeight){this.sizeHeight(-1);}}},getHeightDiff:function getHeightDiff(){var iHeight=0;if(this.pbShowCaption&&this._eHead){iHeight+=df.sys.gui.getVertBoxDiff(this._eHead,1);}if(this._eControl){iHeight+=df.sys.gui.getVertBoxDiff(this._eControl);iHeight+=df.sys.gui.getVertBoxDiff(this._eInner);iHeight+=df.sys.gui.getVertBoxDiff(this._eControlWrp);}return iHeight;},getMinHeight:function getMinHeight(){var iHeight=0;if(this.piHeight>0){return this.piHeight;}if(this.pbFillHeight){return this.piMinHeight;}this.resize();iHeight=this.getNaturalHeight();if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}return iHeight;},renderAllCards:function renderAllCards(){var i,eElem;if(this._eControl){for(i=0;i<this._aCards.length;i++){if(!this._aCards[i]._eElem){eElem=this._aCards[i].render();this._eControl.appendChild(eElem);this._aCards[i].afterRender();}}}},set_piHeight:function set_piHeight(iVal){if(iVal<=0){this.renderAllCards();}df.WebCardContainer.base.set_piHeight.call(this,iVal);},set_pbFillHeight:function set_pbFillHeight(bVal){if(!bVal){this.renderAllCards();}df.WebCardContainer.base.set_pbFillHeight.call(this,bVal);},attachFocusEvents:function attachFocusEvents(){if(this._eHead){if(window.addEventListener){df.events.addDomCaptureListener("focus",this._eHead,this.onFocus,this);df.events.addDomCaptureListener("blur",this._eHead,this.onBlur,this);}else{df.dom.on("focusin",this._eHead,this.onFocus,this);df.dom.on("focusout",this._eHead,this.onBlur,this);}}},focus:function focus(bOptSelect){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i].focus){if(this._aChildren[i].focus(bOptSelect)){return true;}}}return false;},conditionalFocus:function conditionalFocus(bOptSelect){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i].conditionalFocus){if(this._aChildren[i].conditionalFocus(bOptSelect)){return true;}}}return false;},onFocus:function onFocus(oEvent){if(!this._bHasFocus){df.WebCardContainer.base.onFocus.call(this,oEvent);}this._bLozingFocus=false;},onBlur:function onBlur(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){df.WebCardContainer.base.onBlur.call(that,oEvent);that._bLozingFocus=false;}},100);},showCard:function showCard(oDisplay,bOptFirst){var i,oTab;if(this.isEnabled()||bOptFirst){if(oDisplay&&oDisplay.isActive()){if(!bOptFirst&&oDisplay!==this._oCurrent){this.fireCardChange(oDisplay._sName,this._oCurrent&&this._oCurrent._sName||"");}if(this._eElem){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab===oDisplay){oTab._show(!!bOptFirst);if(this._eLabel){df.dom.setText(this._eLabel,oTab.psCaption);}}else{oTab._hide(!!bOptFirst);}}}if(!bOptFirst&&this._oCurrent){this._oCurrent.afterHide();}this._oCurrent=oDisplay;if(!bOptFirst){this._oCurrent.afterShow();}if(this.getWebApp()){this.getWebApp().notifyLayoutChange(this);}}}},fireCardChange:function fireCardChange(sTo,sFrom){this.fire('OnCardChange',[sTo,sFrom]);},hideCard:function hideCard(oHide){var i,oTab,oLast=null,bFound=false;if(oHide===this._oCurrent){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab.isActive()){if(bFound){this.showCard(oTab);return;}oLast=oTab;}if(oTab===oHide){bFound=true;}}this.showCard(oLast);}},nextCard:function nextCard(){var i,bFound=false,oTab;for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(!bFound){bFound=oTab===this._oCurrent;}else{if(oTab.isActive()){this.showCard(oTab);return;}}}},previousCard:function previousCard(){var i,bFound=false,oTab;for(i=this._aCards.length-1;i>=0;i--){oTab=this._aCards[i];if(!bFound){bFound=oTab===this._oCurrent;}else{if(oTab.isActive()){this.showCard(oTab);return;}}}},get_psCurrentCard:function get_psCurrentCard(){return this._oCurrent&&this._oCurrent.getLongName()||"";},genClass:function genClass(){var sClass=df.WebCardContainer.base.genClass.call(this);if(this.pbShowCaption){sClass+=" WebCC_HasCaption";}if(this.pbShowBorder){sClass+=" WebCC_HasBorder";}return sClass;},set_pbShowBorder:function set_pbShowBorder(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebCC_HasBorder",bVal);this.sizeChanged();}},set_pbShowCaption:function set_pbShowCaption(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebCC_HasCaption",bVal);this.sizeChanged();}},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eLabel){this._eLabel.style.background=sVal||'';}if(this._eControl){this._eControl.style.background=sVal||'';}}});df.WebCard=function WebCard(sName,oParent){df.WebCard.base.constructor.call(this,sName,oParent);if(!(oParent&&oParent instanceof df.WebCardContainer)){throw new df.Error(999,"WebCard object '{{0}}' should be placed inside a WebCardContainer object. Consider wrapping your card with a card container.",this,[this.getLongName()]);}this.prop(df.tString,"psCaption","");this.prop(df.tString,"psBtnCSSClass","");this.event("OnShow",df.cCallModeDefault);this.event("OnHide",df.cCallModeDefault);this._eBtn=null;this._eLbl=null;this._bCurrent=false;this._bCC=true;this._sControlClass="WebCard";this._bWrapDiv=true;};df.defineClass("df.WebCard","df.WebBaseContainer",{tabButtonHtml:function tabButtonHtml(aHtml){aHtml.push('<div class="WebTab_Btn ',this.isEnabled()?df.CssEnabled:df.CssDisabled,' ',this.psBtnCSSClass,'" style="',!this.pbRender||!this.pbVisible?'display: none;':'','" ',!this.isEnabled()?'tabindex="-1"':'tabindex="0"','><span><label>',df.dom.encodeHtml(this.psCaption),'</label></span></div>');},afterRender:function afterRender(){df.WebCard.base.afterRender.call(this);this._eElem.style.display='';},btnRendered:function btnRendered(eBtn){this._eBtn=eBtn;this._eLbl=df.dom.query(this._eBtn,'span > label');df.dom.on("click",this._eBtn,this.onBtnClick,this);df.dom.on("click",this._eLbl,this.onBtnClick,this);df.events.addDomKeyListener(this._eBtn,this.onBtnKey,this);},attachFocusEvents:function attachFocusEvents(){if(window.addEventListener){df.events.addDomCaptureListener("focus",this._eBtn,this.onBtnFocus,this);df.events.addDomCaptureListener("blur",this._eBtn,this.onBtnBlur,this);}else{df.dom.on("focusin",this._eBtn,this.onBtnFocus,this);df.dom.on("focusout",this._eBtn,this.onBtnBlur,this);}},prepareSize:function prepareSize(){var iResult=df.WebCard.base.prepareSize.call(this);this._bStretch=true;return iResult;},onBtnClick:function onBtnClick(oEvent){if(this.isEnabled()){this.show();oEvent.stop();}},onBtnKey:function onBtnKey(oEvent){if(this.isEnabled()){if(oEvent.matchKey(df.settings.tabKeys.enter)){this.show();oEvent.stop();}}},onBtnFocus:function onBtnFocus(oEvent){df.dom.addClass(this._eBtn,"WebTab_Focus");},onBtnBlur:function onBtnBlur(oEvent){df.dom.removeClass(this._eBtn,"WebTab_Focus");},_hide:function _hide(bFirst){if(this._eElem){this._eElem.style.visibility="hidden";df.dom.removeClass(this._eBtn,"WebTab_Current");}if(!bFirst&&this._bCurrent){this.fire('OnHide');}this._bCurrent=false;},_show:function _show(bFirst){if(!this._eElem){this.renderCard(true);}else{if(this._eElem.parentNode.firstChild&&this._eElem!==this._eElem.parentNode.firstChild){this._eElem.parentNode.insertBefore(this._eElem,this._eElem.parentNode.firstChild);}}this._eElem.style.visibility="inherit";df.dom.addClass(this._eBtn,"WebTab_Current");if(!bFirst&&!this._bCurrent){this.fire('OnShow');}this._bCurrent=true;},renderCard:function renderCard(bFirstElem){var eElem=this.render();if(bFirstElem&&this._oParent._eControl.firstChild){this._oParent._eControl.insertBefore(eElem,this._oParent._eControl.firstChild);}else{this._oParent._eControl.appendChild(eElem);}this.afterRender();this.resizeHorizontal();this.resizeVertical();},show:function show(){if(this.isActive()){this._oParent.showCard(this);}},applyEnabled:function applyEnabled(bVal){df.WebCard.base.applyEnabled.call(this,bVal);if(this._eBtn){df.dom.toggleClass(this._eBtn,df.CssDisabled,!bVal);df.dom.toggleClass(this._eBtn,df.CssEnabled,bVal);this._eLbl.tabIndex=bVal?0:-1;}},set_psCaption:function set_psCaption(sVal){if(this._eLbl){if(this._oParent._oCurrent===this&&this._oParent._eLabel){df.dom.setText(this._oParent._eLabel,sVal);}df.dom.setText(this._eLbl,sVal);}},set_pbVisible:function set_pbVisible(bVal){if(this._eBtn){this._eBtn.style.display=bVal&&this.pbRender?'':'none';this.pbVisible=bVal;this.getWebApp().waitForCall(function(){if(!bVal){if(this._bCurrent){this._oParent.hideCard(this);}}else{if(!this._oParent._oCurrent){this._oParent.showCard(this);}}this.getWebApp().forceResize();},this);}},set_pbRender:function set_pbRender(bVal){if(this._eBtn){this._eBtn.style.display=bVal&&this.pbVisible?'':'none';if(this.pbRender!==bVal){this.pbRender=bVal;this.getWebApp().waitForCall(function(){if(!bVal){if(this._bCurrent){this._oParent.hideCard(this);}}else{if(!this._oParent._oCurrent){this._oParent.showCard(this);}}this.getWebApp().forceResize();},this);}}},set_psTextColor:function set_psTextColor(sVal){if(this._eLbl){this._eLbl.style.color=sVal||'';}df.WebCard.base.set_psTextColor.call(this,sVal);},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eBtn){this._eBtn.style.background=sVal||'';}df.WebCard.base.set_psBackgroundColor.call(this,sVal);},set_psBtnCSSClass:function set_psBtnCSSClass(sVal){if(this._eBtn&&this.psBtnCSSClass!==sVal){df.dom.removeClass(this._eBtn,this.psBtnCSSClass);df.dom.addClass(this._eBtn,sVal);}}});df.WebTabContainer=function WebTabContainer(sName,oParent){df.WebTabContainer.base.constructor.call(this,sName,oParent);this._sControlClass="WebTabContainer";this._sCardClass="WebTbc";this._bCC=false;};df.defineClass("df.WebTabContainer","df.WebCardContainer",{openHtml:function openHtml(aHtml){this.pbShowCaption=false;this.pbShowBorder=false;df.WebTabContainer.base.openHtml.call(this,aHtml);},addChild:function addChild(oChild){if(oChild instanceof df.WebBaseUIObject&&!(oChild instanceof df.WebCard)){throw new df.Error(999,"WebTabContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebTabPage.",this,[oChild.getLongName()||'oWebApp']);}df.WebTabContainer.base.addChild.call(this,oChild);},set_pbShowCaption:function set_pbShowCaption(bVal){},set_pbShowBorder:function set_pbShowBorder(bVal){},getHeightDiff:function getHeightDiff(){var iHeight=0;if(this._eHead){iHeight+=df.dom.clientHeight(this._eHead);iHeight+=df.sys.gui.getVertBoxDiff(this._eHead,1);}if(this.pbShowCaption&&this._eLabelSpacer){iHeight+=df.dom.clientHeight(this._eLabelSpacer);iHeight+=df.sys.gui.getVertBoxDiff(this._eHead,1);}if(this._eControl){iHeight+=df.sys.gui.getVertBoxDiff(this._eControl);iHeight+=df.sys.gui.getVertBoxDiff(this._eInner);iHeight+=df.sys.gui.getVertBoxDiff(this._eControlWrp);}return iHeight;},focus:function focus(){var i,oTab;if(this._bFocusAble&&this.isEnabled()&&this._eElem){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab.isActive()&&oTab._eBtn){try{oTab._eBtn.focus();}catch(oErr){}this.objFocus();return true;}}}return false;}});df.WebTabPage=function WebTabPage(sName,oParent){if(!(oParent&&oParent instanceof df.WebTabContainer)){this._sName=sName;this._oParent=oParent;throw new df.Error(999,"WebTabPage object '{{0}}' should be placed inside a WebTabContainer object. Consider wrapping your tab page with a tab container.",this,[this.getLongName()]);}df.WebTabPage.base.constructor.call(this,sName,oParent);this._sControlClass="WebTabPage";this._bCC=true;};df.defineClass("df.WebTabPage","df.WebCard",{});df.WebDatePicker=function WebDatePicker(sName,oParent){df.WebDatePicker.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbShowWeekNr",true);this.prop(df.tBool,"pbShowToday",true);this.prop(df.tInt,"piStartWeekAt",1);this.event("OnDateClick",df.cCallModeWait);this.OnRealtimeChange=new df.events.JSHandler();this.OnEnter=new df.events.JSHandler();this._eBuddy=null;this._bBuddyActive=true;this._eElem=null;this._eFocus=null;this._eBody=null;this._eDispMonth=null;this._eDispYear=null;this._dSelected=new Date();this._iWeekSelected=df.sys.data.dateToWeek(this._dSelected);this._iDisplayYear=this._dSelected.getFullYear();this._iDisplayMonth=this._dSelected.getMonth();this._iLastDisplayYear=this._iDisplayYear;this._iLastDisplayMonth=this._iDisplayMonth;this._aMonthNames=df.lang.monthsLong;this._aMonthNamesShort=df.lang.monthsShort;this._aDaysShort=df.lang.daysShort;this._aDaysLong=df.lang.daysLong;this._sControlClass="WebDatePicker";this.peDataType=df.ciTypeDate;};df.defineClass("df.WebDatePicker","df.WebBaseDEO",{create:function create(){var oWA=this.getWebApp();if(!this.psMask){if(oWA){this.psMask=oWA.psDateFormat;}}},openHtml:function openHtml(aHtml){df.WebDatePicker.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebDatePicker_FocusHolder" ',!this.isEnabled()?'tabindex="-1"':'tabindex="0"','>');aHtml.push('<div class="WebDP">','<div class="WebDP_Wrp">','<div class="WebDP_Head">','<div class="WebDP_BtnPrev"><span></span></div>','<div class="WebDP_BtnNext"><span></span></div>','<div class="WebDP_BtnYear"><span></span><div class="WebDP_YearMnu"></div></div>','<div class="WebDP_BtnMonth"><span></span><div class="WebDP_MonthMnu"></div></div>','<div style="clear: both;"></div>','</div>','<div class="WebDP_Body">');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');aHtml.push('<div class="WebDP_Footer"',!this.pbShowToday?' style="display: none"':'','>','<div class="WebDP_BtnToday">',this.getWebApp().getTrans("todayIs"),' <span></span></div>','</div>');aHtml.push('</div>','</div>');df.WebDatePicker.base.closeHtml.call(this,aHtml);aHtml.push('</div>');},afterRender:function afterRender(){this._eFocus=df.dom.query(this._eElem,"div.WebDatePicker_FocusHolder");this._eBody=df.dom.query(this._eElem,"div.WebDP_Body");this._eFooter=df.dom.query(this._eElem,"div.WebDP_Footer");this._eDispMonth=df.dom.query(this._eElem,"div.WebDP_BtnMonth > span");this._eDispYear=df.dom.query(this._eElem,"div.WebDP_BtnYear > span");this._eDispToday=df.dom.query(this._eElem,"div.WebDP_BtnToday > span");df.WebDatePicker.base.afterRender.call(this);df.dom.on("click",this._eElem,this.onWrapClick,this);df.dom.on("click",this._eBody,this.onBodyClick,this);df.dom.on("click",df.dom.query(this._eElem,"div.WebDP_BtnNext"),this.onNextClick,this);df.dom.on("click",df.dom.query(this._eElem,"div.WebDP_BtnPrev"),this.onPrevClick,this);df.dom.on("click",df.dom.query(this._eElem,"div.WebDP_BtnMonth"),this.onMonthClick,this);df.dom.on("click",df.dom.query(this._eElem,"div.WebDP_BtnYear"),this.onYearClick,this);df.dom.on("click",df.dom.query(this._eElem,"div.WebDP_BtnToday"),this.onTodayClick,this);if(this._eBuddy){this._eFocus=this._eBuddy;}df.events.addDomKeyListener(this._eFocus,this.onKey,this);df.dom.on("focus",this._eFocus,this.onFocus,this);df.dom.on("blur",this._eFocus,this.onBlur,this);this.update();},set_pbShowWeekNr:function set_pbShowWeekNr(bVal){this.pbShowWeekNr=bVal;this.displayCalendar();},set_pbShowToday:function set_pbShowToday(bVal){if(this._eFooter){this._eFooter.style.display=bVal?"":"none";}},set_piStartWeekAt:function set_piStartWeekAt(iVal){this.piStartWeekAt=iVal;this.update();},update:function update(){if(this._eElem){df.dom.setText(this._eDispMonth,this._aMonthNames[this._iDisplayMonth]);df.dom.setText(this._eDispYear,this._iDisplayYear);df.dom.setText(this._eDispToday,df.sys.data.applyDateMask(new Date(),this.psMask,this.getWebApp().psDateSeparator));this.displayCalendar();}},displayCalendar:function displayCalendar(){var iDay,iDayPointer,aHtml=[],sCSS,dToday,dEnd,dDate,iRows,iYear,iMonth,eNew,eOld;if(!this._eBody){return;}aHtml.push('<div><table>');iYear=this._iDisplayYear;iMonth=this._iDisplayMonth;dToday=new Date();dDate=new Date(iYear,iMonth,1,1,1,1);dEnd=new Date(iYear,iMonth+1,1,1,1,1);aHtml.push('<tr class="WebDP_BodyHead">');if(this.pbShowWeekNr){aHtml.push('<th class="WebDP_WeekNr">',this.getWebApp().getTrans("wk"),'</th>');}for(iDay=0;iDay<7;iDay++){sCSS="";iDayPointer=iDay+this.piStartWeekAt>6?iDay+this.piStartWeekAt-7:iDay+this.piStartWeekAt;if(iDayPointer===0||iDayPointer===6){sCSS="WebDP_Weekend";}aHtml.push('<th class="',sCSS,'">',this.getDay(iDay,true),'</th>');}aHtml.push('</tr>');iDayPointer=dDate.getDay()-this.piStartWeekAt;if(iDayPointer<0){iDayPointer=7+iDayPointer;}dDate.setDate(dDate.getDate()-iDayPointer);iDayPointer=0;iRows=0;aHtml.push('<tr>');while(dDate<dEnd||iDayPointer<7&&iDayPointer!==0||iRows<6){if(iDayPointer===0||iDayPointer>6){if(iRows>0){aHtml.push('</tr><tr>');}iRows++;if(this.pbShowWeekNr){aHtml.push('<td class="WebDP_WeekNr">',df.sys.data.dateToWeek(dDate),'</td>');}iDayPointer=0;}sCSS="WebDP_Day";if(dDate.getMonth()!==iMonth){sCSS+=(sCSS!==""?" ":"")+"WebDP_Overflow";}if(dDate.getDay()===0||dDate.getDay()===6){sCSS+=(sCSS!==""?" ":"")+"WebDP_Weekend";}if(dDate.getDate()===this._dSelected.getDate()&&dDate.getMonth()===this._dSelected.getMonth()&&dDate.getFullYear()===this._dSelected.getFullYear()){sCSS+=(sCSS!==""?" ":"")+"WebDP_Selected"+(this.bHasFocus?" focussed":"");}if(dDate.getDate()===dToday.getDate()&&dDate.getMonth()===dToday.getMonth()&&dDate.getFullYear()===dToday.getFullYear()){sCSS+=(sCSS!==""?" ":"")+"WebDP_Today";}aHtml.push('<td class="',sCSS,'" data-date="',dDate.getDate(),'" data-month="',dDate.getMonth(),'" data-year="',dDate.getFullYear(),'">',dDate.getDate(),'</td>');dDate.setDate(dDate.getDate()+1);iDayPointer++;}aHtml.push('</table></div>');if(this._iLastDisplayYear===this._iDisplayYear&&this._iLastDisplayMonth===this._iDisplayMonth){this._eBody.innerHTML=aHtml.join('');}else{eOld=df.dom.query(this._eBody,".WebDP_Old");if(eOld){this._eBody.removeChild(eOld);}eNew=df.dom.create(aHtml.join(''));eOld=this._eBody.firstChild;if(eOld){eOld.firstChild.style.width=eOld.firstChild.clientWidth+"px";eOld.firstChild.style.height=eOld.firstChild.clientHeight+"px";df.dom.addClass(eOld,"WebDP_Old");}this._eBody.appendChild(eNew);if(eOld){df.dom.addClass(eOld,this._iLastDisplayYear<this._iDisplayYear||this._iLastDisplayYear===this._iDisplayYear&&this._iLastDisplayMonth<this._iDisplayMonth?"WebDP_HideNext":"WebDP_HidePrev");}}this._iLastDisplayYear=this._iDisplayYear;this._iLastDisplayMonth=this._iDisplayMonth;},setSelectedDate:function setSelectedDate(dSelected,bOptNoAni,bOptNoDisplayNow){if(!dSelected){dSelected=new Date();this.fireRTChange();}this._dSelected=dSelected;this._iWeekSelected=df.sys.data.dateToWeek(this._dSelected);if(!bOptNoDisplayNow){this._iDisplayYear=this._dSelected.getFullYear();this._iDisplayMonth=this._dSelected.getMonth();if(bOptNoAni){this._iLastDisplayYear=this._iDisplayYear;this._iLastDisplayMonth=this._iDisplayMonth;}}this.update();},getSelectedDate:function getSelectedDate(){return new Date(this._dSelected.valueOf());},getDay:function getDay(iDay,bShort){iDay+=this.piStartWeekAt;if(iDay>6){iDay=iDay-7;}return bShort?this._aDaysShort[iDay]:this._aDaysLong[iDay];},onMonthClick:function onMonthClick(oEvent){var eMenu,tMenuTimeout,aHtml=[],i,sCSS,hide,that=this;eMenu=df.dom.query(this._eElem,"div.WebDP_MonthMnu");function onClick(oEvent){var eLI=oEvent.getTarget();if(eLI.getAttribute('data-month')){this._iDisplayMonth=parseInt(eLI.getAttribute('data-month'),10);hide();this.update();this.focus();oEvent.stop();}}function onOver(oEvent){clearTimeout(tMenuTimeout);}function onOut(oEvent){clearTimeout(tMenuTimeout);tMenuTimeout=setTimeout(hide,1200);}hide=function hide(){df.dom.off("click",eMenu,onClick);df.dom.off("mouseover",eMenu,onOver);df.dom.off("mouseout",eMenu,onOut);eMenu.style.display="none";clearTimeout(tMenuTimeout);that._fMonthHide=null;};if(this._fMonthHide){this._fMonthHide();}else{if(this.isEnabled()){this._fMonthHide=hide;df.dom.on("click",eMenu,onClick,this);df.dom.on("mouseover",eMenu,onOver,this);df.dom.on("mouseout",eMenu,onOut,this);aHtml.push('<ul>');for(i=0;i<12;i++){sCSS=i===this._iDisplayMonth?"WebDP_Current":"";aHtml.push('<li data-month="',i,'" class="',sCSS,'">',this._aMonthNames[i],'</li>');}aHtml.push('</ul');eMenu.innerHTML=aHtml.join('');eMenu.style.display="inline";tMenuTimeout=setTimeout(hide,2400);this.focus();oEvent.stop();}}},onYearClick:function onYearClick(oEvent){var eMenu,eUp,eDown,tMenuTimeout,tScrollTimeout,aHtml=[],i,sCSS,hide,that=this;eMenu=df.dom.query(this._eElem,"div.WebDP_YearMnu");function onClick(oEvent){var eLI=oEvent.getTarget();if(eLI.getAttribute('data-year')){this._iDisplayYear=parseInt(eLI.getAttribute('data-year'),10);hide();this.update();this.focus();}oEvent.stop();}function onOver(oEvent){clearTimeout(tMenuTimeout);}function onOut(oEvent){tMenuTimeout=setTimeout(hide,1200);}function scrollUp(){var iYear,eNew;iYear=eUp.nextSibling.getAttribute("data-year");iYear--;eDown.parentNode.removeChild(eDown.previousSibling);eNew=document.createElement("li");df.dom.setText(eNew,iYear);eNew.setAttribute("data-year",iYear);eUp.parentNode.insertBefore(eNew,eUp.nextSibling);}function scrollDown(){var iYear,eNew;iYear=eDown.previousSibling.getAttribute("data-year");iYear++;eUp.parentNode.removeChild(eUp.nextSibling);eNew=document.createElement("li");df.dom.setText(eNew,iYear);eNew.setAttribute("data-year",iYear);eDown.parentNode.insertBefore(eNew,eDown);}function onScroll(oEvent){var fFunc,eScroll;eScroll=oEvent.getTarget();fFunc=eScroll===eUp?scrollUp:scrollDown;function doScroll(){fFunc();tScrollTimeout=setTimeout(doScroll,35);}fFunc();tScrollTimeout=setTimeout(doScroll,300);df.dom.addClass(eScroll,eScroll===eUp?"WebDP_UpDown":"WebDP_DownDown");oEvent.stop();}function onScrollStop(oEvent){clearTimeout(tScrollTimeout);df.dom.removeClass(eUp,"WebDP_UpDown");df.dom.removeClass(eDown,"WebDP_DownDown");oEvent.stop();}hide=function hide(){eMenu.style.display="none";df.dom.off("click",eMenu,onClick);df.dom.off("mouseover",eMenu,onOver);df.dom.off("mouseout",eMenu,onOut);df.dom.off("mousedown",eUp,onScroll);df.dom.off("mouseout",eUp,onScrollStop);df.dom.off("mouseup",eUp,onScrollStop);df.dom.off("mousedown",eDown,onScroll);df.dom.off("mouseout",eDown,onScrollStop);df.dom.off("mouseup",eDown,onScrollStop);clearTimeout(tMenuTimeout);that._fYearHide=null;};if(this._fYearHide){this._fYearHide();}else{if(this.isEnabled()){this._fYearHide=hide;aHtml.push('<ul>');aHtml.push('<li class="WebDP_Up"></li>');for(i=this._iDisplayYear-4;i<this._iDisplayYear+4;i++){sCSS=i===this._iDisplayYear?"WebDP_Current":"";aHtml.push('<li data-year="',i,'" class="',sCSS,'">',i,'</li>');}aHtml.push('<li class="WebDP_Down"></li>');aHtml.push('</ul');eMenu.innerHTML=aHtml.join('');eMenu.style.display="inline";eUp=df.dom.query(eMenu,'li.WebDP_Up');eDown=df.dom.query(eMenu,'li.WebDP_Down');df.dom.on("click",eMenu,onClick,this);df.dom.on("mouseover",eMenu,onOver,this);df.dom.on("mouseout",eMenu,onOut,this);df.dom.on("mousedown",eUp,onScroll,this);df.dom.on("mouseout",eUp,onScrollStop,this);df.dom.on("mouseup",eUp,onScrollStop,this);df.dom.on("mousedown",eDown,onScroll,this);df.dom.on("mouseout",eDown,onScrollStop,this);df.dom.on("mouseup",eDown,onScrollStop,this);tMenuTimeout=setTimeout(hide,2400);this.focus();oEvent.stop();}}},onNextClick:function onNextClick(oEvent){if(this.isEnabled()){this._iDisplayMonth++;if(this._iDisplayMonth>=12){this._iDisplayYear++;this._iDisplayMonth=0;}this.update();this.focus();oEvent.stop();}},onPrevClick:function onPrevClick(oEvent){if(this.isEnabled()){this._iDisplayMonth--;if(this._iDisplayMonth<0){this._iDisplayYear--;this._iDisplayMonth=11;}this.update();this.focus();oEvent.stop();}},onBodyClick:function onBodyClick(oEvent){var eCell=oEvent.getTarget(),dDate;if(this.isEnabled()){if(eCell.getAttribute("data-date")){dDate=new Date(parseInt(eCell.getAttribute("data-year"),10),parseInt(eCell.getAttribute("data-month"),10),parseInt(eCell.getAttribute("data-date"),10),1,1,1);this.focus();this.setSelectedDate(dDate,false,false);this.fireRTChange();this.fireEnter();this.fireDateClick();oEvent.stop();}}},onWrapClick:function onWrapClick(oEvent){if(this.isEnabled()){this.focus();oEvent.stop();}},onTodayClick:function onTodayClick(oEvent){if(this.isEnabled()){this._dSelected=new Date();this._iDisplayYear=this._dSelected.getFullYear();this._iDisplayMonth=this._dSelected.getMonth();this.focus();this.update();this.fireRTChange();this.fireEnter();this.fireDateClick();}},onKey:function onKey(oEvent){var dDate=this._dSelected;if(!this._bBuddyActive){return;}if(this.isEnabled()){if(oEvent.matchKey(df.settings.calendarKeys.dayUp)){dDate.setDate(dDate.getDate()-7);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.dayDown)){dDate.setDate(dDate.getDate()+7);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.dayLeft)){dDate.setDate(dDate.getDate()-1);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.dayRight)){dDate.setDate(dDate.getDate()+1);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.monthUp)){dDate.setMonth(dDate.getMonth()+1);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.monthDown)){dDate.setMonth(dDate.getMonth()-1);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.yearUp)){dDate.setFullYear(dDate.getFullYear()+1);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.yearDown)){dDate.setFullYear(dDate.getFullYear()-1);this.setSelectedDate(dDate);this.fireRTChange();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.enter)){this.fireDateClick();if(!this.fireEnter()){oEvent.stop();}}}},fireRTChange:function fireRTChange(){this.OnRealtimeChange.fire(this,{dValue:this.getSelectedDate()});},fireEnter:function fireEnter(){return this.OnEnter.fire(this,{dValue:this.getSelectedDate()});},fireDateClick:function fireDateClick(){this.fire("OnDateClick",[this.get('psValue')]);},refreshDisplay:function refreshDisplay(tVal){if(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime){this.setSelectedDate(tVal,true,false);}},updateTypeVal:function updateTypeVal(){if(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime){this._tValue=this.getSelectedDate();}},applyEnabled:function applyEnabled(bVal){df.WebDatePicker.base.applyEnabled.call(this,bVal);if(this._eFocus){this._eFocus.tabIndex=bVal?0:-1;}},focus:function focus(){if(this._bFocusAble&&this.isEnabled()&&this._eFocus){this._eFocus.focus();this._bLozingFocus=false;this.objFocus();return true;}return false;},onFocus:function onFocus(oEvent){if(!this._bBuddyActive){return;}if(this._bFocusAble&&this.isEnabled()&&this._eFocus){this.objFocus();if(this._eElem){df.dom.addClass(this._eElem,"WebCon_Focus");}this._bHasFocus=true;this._bLozingFocus=false;}},onBlur:function onBlur(oEvent){var that=this;if(!this._bBuddyActive){return;}this._bLozingFocus=true;this.fireChange();setTimeout(function(){if(that._bLozingFocus){that.updateTypeVal();that.fireAutoFind();if(that._eElem){df.dom.removeClass(that._eElem,"WebCon_Focus");}that._bLozingFocus=false;}},100);}});df.tWebTreeItem={sId:df.tString,sParentId:df.tString,sName:df.tString,sAltText:df.tString,sValue:df.tString,sCSSClass:df.tString,sIcon:df.tString,bFolder:df.tBool,bLoadChildren:df.tBool,bExpanded:df.tBool};df.WebTreeView=function WebTreeView(sName,oParent){df.WebTreeView.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbShowIcons",true);this.prop(df.tBool,"pbAllowHtml",false);this.prop(df.tString,"psSelectedId","");this.prop(df.tString,"psSelectedValue","");this.event("OnSelect",df.cCallModeWait);this.event("OnExpand",df.cCallModeDefault);this.event("OnCollapse",df.cCallModeDefault);this._aRootItems=[];this._aItems=[];this._iAutoNum=1000;this._tSelectedNode=null;this._bRedraw=false;this._eRootTable=null;this._eCurHoveredElem=null;this._fHoverTimeOut=null;this._sControlClass="WebTreeView";};df.defineClass("df.WebTreeView","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebTreeView.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebTree_Body" style="height: 10px;" ',!this.isEnabled()?'tabindex="-1"':'tabindex="0"','>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebTreeView.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){var that=this;this._eControl=df.dom.query(this._eElem,'div.WebTree_Body');this._eFocus=this._eControl;df.WebTreeView.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onBodyClick,this);df.dom.on("dblclick",this._eControl,this.onBodyDblClick,this);df.events.addDomKeyListener(this._eElem,this.onKey,this);this.redraw();setTimeout(function(){if(that._tSelectedNode){that.scrollToElement(that._tSelectedNode._eElem);}},50);setTimeout(function(){that.dragDropCleanup();that.dragDropInit();},50);},applyEnabled:function applyEnabled(bVal){df.WebTreeView.base.applyEnabled.call(this,bVal);if(this._eFocus){this._eFocus.tabIndex=bVal?0:-1;}},get_psSelectedId:function get_psSelectedId(){if(this._tSelectedNode){return this._tSelectedNode.sId;}return"";},get_psSelectedValue:function get_psSelectedValue(){if(this._tSelectedNode){return this._tSelectedNode.sValue;}return"";},set_pbShowIcons:function set_pbShowIcons(bVal){this.pbShowIcons=bVal;this.redraw();},select:function select(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode){this.doSelect(tNode,false);}},expand:function expand(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode&&tNode.bFolder){this.expandNode(tNode);}},collapse:function collapse(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode){this.collapseNode(tNode);}},collapseAll:function collapseAll(){var i;for(i=0;i<this._aItems.length;i++){if(this._aItems[i].bExpanded){this.collapseNode(this._aItems[i]);}}},refresh:function refresh(sParentId){var i,tNode,aNodes=this.deserializeVT(this._tActionData),sSelectedId;sSelectedId=this._tSelectedNode&&(this._tSelectedNode.sId||"");if(!sSelectedId&&this.psSelectedId){sSelectedId=this.psSelectedId;this.psSelectedId="";}if(sParentId){tNode=this.getNodeById(sParentId);if(tNode){while(tNode._aChildren.length>0){this.doRemove(tNode._aChildren[0],true);}}}else{this.clear();this.displayLoading();}for(i=0;i<aNodes.length;i++){tNode=this.initNode(aNodes[i]);if(!tNode.sParentId){tNode.sParentId=sParentId||"";}this.insert(tNode);}if(sSelectedId){tNode=this.getNodeById(sSelectedId);if(tNode){this._tSelectedNode=tNode;}}else{this._tSelectedNode=null;}this.redraw();this.hideLoading();},updateNode:function updateNode(){var tNewNode,tOrigNode,aNodes=this.deserializeVT(this._tActionData);if(aNodes.length>0){tNewNode=this.initNode(aNodes[0]);tOrigNode=this.getNodeById(tNewNode.sId);if(tOrigNode){tOrigNode.sName=tNewNode.sName;tOrigNode.sAltText=tNewNode.sAltText;tOrigNode.sValue=tNewNode.sValue;tOrigNode.sCSSClass=tNewNode.sCSSClass;tOrigNode.sIcon=tNewNode.sIcon;tOrigNode.bFolder=tNewNode.bFolder;tOrigNode.bLoadChildren=tNewNode.bLoadChildren;this.redraw();}}},insertNode:function insertNode(){var tNewNode,aNodes=this.deserializeVT(this._tActionData);if(aNodes.length>0){tNewNode=this.initNode(aNodes[0]);this.insert(tNewNode);this.redraw();}},removeNode:function removeNode(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode){this.doRemove(tNode);this.redraw();}},deserializeVT:df.sys.vt.generateDeserializer([df.tWebTreeItem]),loadSubNodes:function loadSubNodes(tParentNode){var sParentId="",sParentValue="",iParentLevel=0;if(tParentNode){tParentNode._bIsLoading=true;this.displayLoading(tParentNode);sParentId=tParentNode.sId;sParentValue=tParentNode.sValue;iParentLevel=this.getLevel(tParentNode);}else{this.clear();this.displayLoading();}this.serverAction("LoadSubNodes",[sParentId,sParentValue,iParentLevel],null,function(oEvent){if(tParentNode){tParentNode._bIsLoading=false;this.updateNodeCSS(tParentNode);}if(!oEvent.bError){if(tParentNode){tParentNode._bIsLoaded=true;this.expandNode(tParentNode);}else{this.redraw();}}this.hideLoading(tParentNode);},this);},addSubItems:function addSubItems(sParentId){var i,tNode,aNodes=this.deserializeVT(this._tActionData);for(i=0;i<aNodes.length;i++){tNode=this.initNode(aNodes[i]);if(!tNode.sParentId){tNode.sParentId=sParentId||"";}this.insert(tNode);}},initNode:function initNode(tNode){tNode._aChildren=[];tNode._tParent=null;tNode._eElem=null;tNode._eSubMenuRow=null;tNode._eSubMenuTable=null;tNode._bIsLoading=false;tNode._bIsLoaded=tNode.bExpanded;if(!tNode.sId){this._iAutoNum++;tNode.sId=this._iAutoNum.toString();}return tNode;},insert:function insert(tNode){var tParent;if(this.getNodeById(tNode.sId)){throw new df.Error(5151,"Node IDs must be unique (ID: '{{0}}')",this,[tNode.sId]);}if(tNode.sParentId){tParent=this.getNodeById(tNode.sParentId);}if(tParent){tNode._tParent=tParent;tParent._aChildren.push(tNode);}else{this._aRootItems.push(tNode);}this._aItems.push(tNode);},clear:function clear(){var i;if(this._eRootTable){this._eControl.removeChild(this._eRootTable);for(i=0;i<this._aItems.length;i++){if(this._aItems[i]._eElem){this._aItems[i]._eElem.tNode=null;}this._aItems[i]._eElem=null;this._aItems[i]._eSubMenuRow=null;this._aItems[i]._eSubMenuTable=null;}}this._tSelectedNode=null;this._aItems=[];this._aRootItems=[];if(this._eControl){this._eRootTable=this.constructTable();this._eControl.appendChild(this._eRootTable);}},redraw:function redraw(){var i;if(this._eControl){this._bRedraw=true;if(this._eRootTable){this._eControl.removeChild(this._eRootTable);for(i=0;i<this._aItems.length;i++){this._aItems[i]._eElem=null;this._aItems[i]._eSubMenuRow=null;this._aItems[i]._eSubMenuTable=null;}}this._eRootTable=this.constructTable();this.constructMenu(this._aRootItems,this._eRootTable);this._eControl.appendChild(this._eRootTable);this._bRedraw=false;}},constructTable:function constructTable(){var eTable=document.createElement("table");return eTable;},constructNode:function constructNode(tNode,eTable,iPos,bIsStart,bIsLast){var bDoSub,eRow,eCell,sName;bDoSub=tNode._aChildren.length>0||tNode.bLoadChildren;eRow=eTable.insertRow(iPos);eRow.setAttribute("data-dftree-id",tNode.sId);if(this.pbDragDropEnabled){if(tNode.bFolder){if(this.isSupportedDragAction(df.dragActions.WebTreeView.ciDragFolder)){eRow.setAttribute('draggable',true);}}else{if(this.isSupportedDragAction(df.dragActions.WebTreeView.ciDragItem)){eRow.setAttribute('draggable',true);}}}tNode._eElem=eRow;eCell=eRow.insertCell(0);eCell.innerHTML="<div>&nbsp;</div>";eCell=eRow.insertCell(eRow.cells.length);sName=this.pbAllowHtml?tNode.sName:df.dom.encodeHtml(tNode.sName);eCell.innerHTML='<span class="WebTree_Text" title="'+df.dom.encodeAttr(tNode.sAltText)+'">'+sName+'</span>';this.updateNodeCSS(tNode);if(bDoSub){if(tNode.bExpanded){iPos++;this.constructSubmenu(tNode,eTable,iPos,bIsLast);}}return iPos;},constructMenu:function constructMenu(aNodes,eTable){var iNode,iPos=0;for(iNode=0;iNode<aNodes.length;iNode++){iPos=this.constructNode(aNodes[iNode],eTable,iPos,iNode===0&&eTable===this.eRootTable,iNode===aNodes.length-1);iPos++;}},constructSubmenu:function constructSubmenu(tNode,eTable,iPos,bIsLast){var eRow,eCell,eNewTable;eRow=eTable.insertRow(iPos);eRow.className="WebTree_SubRow"+(!this._bRedraw?" WebTree_HiddenSubRow":"");eCell=eRow.insertCell(0);eCell.className=bIsLast?"WebTree_ConLast":"WebTree_Con";eCell=eRow.insertCell(1);eCell.innerHTML="<table></table>";eNewTable=df.dom.query(eCell,"table");tNode._eSubMenuRow=eRow;tNode._eSubMenuTable=eNewTable;this.constructMenu(tNode._aChildren,eNewTable,false);if(!this._bRedraw){setTimeout(function(){if(tNode._eSubMenuRow){df.dom.removeClass(tNode._eSubMenuRow,"WebTree_HiddenSubRow");}},20);}},updateNodeCSS:function updateNodeCSS(tNode){var bFirst,bLast,bRoot,bSub,eCell;if(tNode._eElem){tNode._eElem.className=(tNode.bExpanded?"WebTree_Expanded":"WebTree_Collapsed")+(tNode===this._tSelectedNode?" WebTree_Selected":"")+" "+tNode.sCSSClass;bFirst=this.isFirst(tNode);bLast=this.isLast(tNode);bRoot=this.isRoot(tNode);bSub=this.hasChildren(tNode);tNode._eElem.cells[0].className="WebTree_Item WebTree_"+(bFirst&&bRoot||bLast?(bFirst&&bRoot?"Start":"")+(bLast?"End":""):"Entry")+(bSub?"Sub":"");if(this.pbShowIcons){eCell=tNode._eElem.cells[1];if(tNode.sIcon&&!tNode._bIsLoading){eCell.style.backgroundImage="url('"+tNode.sIcon+"')";eCell.style.backgroundRepeat="no-repeat";eCell.className=(tNode.bFolder?"WebTree_Folder ":"WebTree_Icon ")+"WebTree_HasIcon";}else{eCell.className=(tNode._bIsLoading?"WebTree_IconLoading ":"WebTree_NoIcon ")+(tNode.bFolder?"WebTree_Folder ":"WebTree_Icon ");eCell.style.backgroundImage="";}}}},toggle:function toggle(tNode){if(tNode.bExpanded){this.collapseNode(tNode);}else{this.expandNode(tNode);}},expandNode:function expandNode(tNode){tNode.bExpanded=true;if(tNode._bIsLoading){return;}this.fire("OnExpand",[tNode.sId,tNode.sValue,this.getLevel(tNode)]);if(!tNode._bIsLoaded&&tNode.bLoadChildren){this.loadSubNodes(tNode);}else{if(tNode._eElem){if(tNode._eSubMenuRow){df.dom.removeClass(tNode._eSubMenuRow,"WebTree_HiddenSubRow");}else{this.constructSubmenu(tNode,tNode._tParent?tNode._tParent._eSubMenuTable:this._eRootTable,tNode._eElem.rowIndex+1,this.isLast(tNode));}}this.updateNodeCSS(tNode);}},collapseNode:function collapseNode(tNode){tNode.bExpanded=false;this.fire("OnCollapse",[tNode.sId,tNode.sValue,this.getLevel(tNode)]);if(tNode._eSubMenuRow){df.dom.addClass(tNode._eSubMenuRow,"WebTree_HiddenSubRow");}if(this.isParent(this._tSelectedNode,tNode)){while(tNode&&!this.doSelect(tNode)){tNode=tNode._tParent;}}this.updateNodeCSS(tNode);},moveUp:function moveUp(){var aList,iPos,tNode;if(this._tSelectedNode){tNode=this._tSelectedNode;iPos=this.getPosition(tNode);if(iPos>0){aList=tNode._tParent?tNode._tParent._aChildren:this._aRootItems;tNode=aList[iPos-1];while(tNode.bExpanded&&tNode._aChildren.length>0){tNode=tNode._aChildren[tNode._aChildren.length-1];}this.doSelect(tNode);}else{if(tNode._tParent){this.doSelect(tNode._tParent);}}}},moveDown:function moveDown(){var tNode,aList,iPos;if(this._tSelectedNode){tNode=this._tSelectedNode;if(tNode.bExpanded&&tNode._aChildren.length>0){this.doSelect(tNode._aChildren[0]);}else{while(tNode){aList=tNode._tParent?tNode._tParent._aChildren:this._aRootItems;iPos=this.getPosition(tNode);if(iPos<aList.length-1){this.doSelect(aList[iPos+1]);break;}else{tNode=tNode._tParent;}}}}else if(this._aRootItems.length>0){this.doSelect(this._aRootItems[0]);}},doCollapse:function doCollapse(){var tNode;if(this._tSelectedNode){tNode=this._tSelectedNode;if(tNode.bExpanded&&this.hasChildren(tNode)){this.collapseNode(tNode);}else{if(tNode._tParent){this.doSelect(tNode._tParent);}}}},doExpand:function doExpand(){var tNode;if(this._tSelectedNode){tNode=this._tSelectedNode;if(!tNode.bExpanded&&this.hasChildren(tNode)){this.expandNode(tNode);}else{if(tNode._aChildren.length>0){this.doSelect(tNode._aChildren[0]);}}}else if(this._aRootItems.length>0){this.doSelect(this._aRootItems[0]);}},moveFirst:function moveFirst(){if(this._aRootItems.length>0){this.doSelect(this._aRootItems[0]);}},moveLast:function moveLast(){var tNode;if(this._aRootItems.length>0){tNode=this._aRootItems[this._aRootItems.length-1];while(tNode.bExpanded&&tNode._aChildren.length>0){tNode=tNode._aChildren[tNode._aChildren.length-1];}this.doSelect(tNode);}},doSelect:function doSelect(tNode,bOptNoOnSelect){var tPrevSelected,bChanged;this.addSync("psSelectedId");this.addSync("psSelectedValue");tPrevSelected=this._tSelectedNode;this._tSelectedNode=tNode;bChanged=this.psSelectedId!==tNode.sId;this.psSelectedId=tNode.sId;if(tPrevSelected){this.updateNodeCSS(tPrevSelected);}this.updateNodeCSS(tNode);if(tNode._eElem){this.scrollToElement(tNode._eElem);}if(!bOptNoOnSelect&&bChanged){this.fire("OnSelect",[tNode.sId,tNode.sValue,this.getLevel(tNode)]);}return true;},doRemove:function doRemove(tNode,bOptNoSelect){var i,aList,bSelect=false;function removeSub(tNode){while(tNode._aChildren.length>0){removeSub.call(this,tNode._aChildren.pop());}tNode._eElem=null;tNode._eSubMenuRow=null;tNode._eSubMenuTable=null;if(tNode===this._tSelectedNode){this._tSelectedNode=null;bSelect=true;}df.sys.data.removeFromArray(this._aItems,tNode);}removeSub.call(this,tNode);aList=tNode._tParent?tNode._tParent._aChildren:this._aRootItems;if(aList){for(i=0;i<aList.length;i++){if(aList[i]===tNode){aList.splice(i,1);break;}}}if(bSelect&&!bOptNoSelect){if(aList&&aList.length>0){this.doSelect(aList[i]||aList[i-1]);}else{this.doSelect(tNode._tParent||this._aItems[0]);}}},getPosition:function getPosition(tNode){var aList,iPos;aList=tNode._tParent?tNode._tParent._aChildren:this._aRootItems;for(iPos=0;iPos<aList.length;iPos++){if(aList[iPos]===tNode){return iPos;}}return-1;},isLast:function isLast(tNode){var aList=tNode._tParent?tNode._tParent._aChildren:this._aRootItems;return aList[aList.length-1]===tNode;},isFirst:function isFirst(tNode){var aList=tNode._tParent?tNode._tParent._aChildren:this._aRootItems;return aList[0]===tNode;},isRoot:function isRoot(tNode){return tNode._tParent?false:true;},isParent:function isParent(tNode,tParent){while(tNode){if(tNode===tParent){return true;}tNode=tNode._tParent;}return false;},getLevel:function getLevel(tNode){var iLevel=1;while(tNode._tParent){iLevel++;tNode=tNode._tParent;}return iLevel;},getNodeById:function getNodeById(sNodeId){var i;for(i=0;i<this._aItems.length;i++){if(this._aItems[i].sId===sNodeId){return this._aItems[i];}}return null;},hasChildren:function hasChildren(tNode){return tNode.bLoadChildren&&!tNode._bIsLoaded||tNode._aChildren.length>0;},scrollToElement:function scrollToElement(eElem){var iTop,oElem,oDiv;oElem=df.sys.gui.getAbsoluteOffset(eElem);oDiv=df.sys.gui.getAbsoluteOffset(this._eControl);iTop=oElem.top-oDiv.top;if(iTop<this._eControl.scrollTop){this._eControl.scrollTop=iTop;}else if(iTop+eElem.offsetHeight>this._eControl.scrollTop+this._eControl.clientHeight){this._eControl.scrollTop=iTop+eElem.offsetHeight-this._eControl.clientHeight;}},onBodyClick:function onBodyClick(oEvent){var sNodeId=null,bSelect=true,tNode,eElem=oEvent.getTarget();if(this.isEnabled()){while(eElem&&!sNodeId&&eElem!==this._eElem){if(eElem.className.indexOf("WebTree_Item")>=0){bSelect=false;}sNodeId=eElem.getAttribute("data-dftree-id");eElem=eElem.parentNode;}tNode=this.getNodeById(sNodeId);if(tNode){if(bSelect){if(this._tSelectedNode!==tNode){if(!tNode.bExpanded&&this.hasChildren(tNode)){this.expandNode(tNode);}this.doSelect(tNode);}else{this.toggle(tNode);}}else{this.toggle(tNode);}oEvent.stop();}this.focus();}},onBodyDblClick:function onBodyDblClick(oEvent){var sNodeId=null,tNode,eElem=oEvent.getTarget();if(this.isEnabled()){while(eElem&&!sNodeId&&eElem!==this._eElem){sNodeId=eElem.getAttribute("data-dftree-id");eElem=eElem.parentNode;}tNode=this.getNodeById(sNodeId);if(tNode){if(this.fireSubmit()){oEvent.stop();}}}},onKey:function onKey(oEvent){if(this.isEnabled()){if(oEvent.matchKey(df.settings.treeKeys.moveUp)){this.moveUp();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.moveDown)){this.moveDown();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.collapse)){this.doCollapse();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.extend)){this.doExpand();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.moveFirst)){this.moveFirst();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.moveLast)){this.moveLast();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.enter)){if(this.fireSubmit()){oEvent.stop();}}}},displayLoading:function displayLoading(tNode){if(tNode){this.updateNodeCSS(tNode);}else{if(this._eControl){df.dom.addClass(this._eControl,"WebTree_Loading");}}},hideLoading:function hideLoading(tNode){if(tNode){this.updateNodeCSS(tNode);}else{if(this._eControl){df.dom.removeClass(this._eControl,"WebTree_Loading");}}},focus:function focus(){if(this._bFocusAble&&this.isEnabled()&&this._eFocus){this._eFocus.focus();this.objFocus();return true;}return false;},onFocus:function onFocus(oEvent){df.WebTreeView.base.onFocus.call(this,oEvent);this._bLozingFocus=false;},onBlur:function onBlur(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){df.WebTreeView.base.onBlur.call(that,oEvent);that._bLozingFocus=false;}},100);},determineSelectorForWebUIContext:function determineSelectorForWebUIContext(eContext){switch(eContext){case df.WebUIContext.WebUIContextTreeviewFolder:case df.WebUIContext.WebUIContextTreeviewItem:return"tr[data-dftree-id]";}return null;},verifyElementForWebUIContext:function verifyElementForWebUIContext(eElem,eContext){switch(eContext){case df.WebUIContext.WebUIContextTreeviewFolder:case df.WebUIContext.WebUIContextTreeviewItem:{if(!eElem.hasAttribute('data-dftree-id'))return false;var iItemId=eElem.getAttribute("data-dftree-id");var hItem=this.getNodeById(iItemId);return hItem.bFolder&&eContext===df.WebUIContext.WebUIContextTreeviewFolder||!hItem.bFolder&&eContext===df.WebUIContext.WebUIContextTreeviewItem;}}return true;},retrieveValueFromWebUIContext:function retrieveValueFromWebUIContext(eElem,eContext){switch(eContext){case df.WebUIContext.WebUIContextTreeviewFolder:case df.WebUIContext.WebUIContextTreeviewItem:{if(!eElem.hasAttribute('data-dftree-id'))break;return eElem.getAttribute('data-dftree-id');}}return null;},getDragData:function getDragData(oEv,eDraggedElem){try{var itemId=eDraggedElem.getAttribute("data-dftree-id")||-1;var item,eAction;if(itemId&&itemId!=-1&&(itemId!=''||itemId>=0)){item=_objectSpread({},this.getNodeById(itemId));Object.keys(item).forEach(function(key){key.indexOf("_")==0&&delete item[key];});if(item.bFolder){eAction=df.dragActions.WebTreeView.ciDragFolder;}else{eAction=df.dragActions.WebTreeView.ciDragItem;}}return[{data:item},eAction];}catch(err){console.error("Attempt to perform unsupported drag action");return[null,null];}},getDropData:function getDropData(oDropZone,oPosition){if(oDropZone&&oDropZone._eDropElem){var itemId=oDropZone._eDropElem.getAttribute("data-dftree-id")||-1;var item,eAction;if(itemId&&itemId!=-1&&(itemId!=''||itemId>=0)){item=_objectSpread({},this.getNodeById(itemId));Object.keys(item).forEach(function(key){key.indexOf("_")==0&&delete item[key];});if(item.bFolder){eAction=df.dropActions.WebTreeView.ciDropOnFolder;}else{eAction=df.dropActions.WebTreeView.ciDropOnItem;}}var dropData={data:item,action:eAction};return dropData;}return null;},initDraggableElements:function initDraggableElements(){},initDropZones:function initDropZones(){this._aDropZones=[];df.WebList.base.initDropZones.call(this);if(this.isSupportedDropAction(df.dropActions.WebTreeView.ciDropOnFolder)||this.isSupportedDropAction(df.dropActions.WebTreeView.ciDropOnItem)){var eZone=df.dom.query(this._eElem,'.WebTree_Body');this.addDropZone(eZone);}},determineDropCandidate:function determineDropCandidate(oEv,aHelpers){var _this7=this;if(aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this7,df.dropActions.WebControl.ciDropOnControl);})){return[this._eElem,df.dropActions.WebControl.ciDropOnControl];}var eElem=document.elementFromPoint(oEv.e.clientX,oEv.e.clientY);var eNode=eElem===null||eElem===void 0?void 0:eElem.closest('tr[data-dftree-id]');if(eNode){var id=eNode.getAttribute('data-dftree-id');var item=this.getNodeById(id);if(item.bFolder){if(aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this7,df.dropActions.WebTreeView.ciDropOnFolder);})){return[eNode,df.dropActions.WebTreeView.ciDropOnFolder];}}else{if(aHelpers.find(function(oHelper){return oHelper.supportsDropAction(_this7,df.dropActions.WebTreeView.ciDropOnItem);})){return[eNode,df.dropActions.WebTreeView.ciDropOnItem];}}}return[null,null];},determineDropPosition:function determineDropPosition(oEv,eElem){return df.dropPositions.ciDropOn;},interactWithDropElem:function interactWithDropElem(dropZone,eElem){if(dropZone._eDropAction==df.dropActions.WebControl.ciDropOnControl){dropZone.highlightElement();}else{dropZone.highlightElement();}},doEmptyInteraction:function doEmptyInteraction(dropZone){if(this.isSupportedDropAction(df.dropActions.WebTreeView.ciDropOnRoot)){dropZone.highlightElement();return df.dropActions.WebTreeView.ciDropOnRoot;}else if(this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)){dropZone.highlightElement();return df.dropActions.WebControl.ciDropOnControl;}return null;},onControlDragOver:function onControlDragOver(oEv,oDropZone,eDropElem){var _this8=this;if(eDropElem!=this._eCurHoveredElem){this._eCurHoveredElem=eDropElem;clearTimeout(this._fHoverTimeOut);if(this._eCurHoveredElem){this._fHoverTimeOut=setTimeout(function(){_this8.expand(_this8._eCurHoveredElem.getAttribute('data-dftree-id'));},1000);}}},hasData:function hasData(){return this._aItems&&this._aItems.length>0;}});df.WebIFrame=function WebIFrame(sName,oParent){df.WebIFrame.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psUrl","");this.prop(df.tBool,"pbShowBorder",true);this.event("OnLocationChange",df.cCallModeDefault);this._eWrapper=null;this._sContentHtml=null;this._sControlClass="WebIFrame";};df.defineClass("df.WebIFrame","df.WebBaseControl",{openHtml:function openHtml(aHtml){var sName;df.WebIFrame.base.openHtml.call(this,aHtml);sName="df_webiframe_"+df.dom.piDomCounter++;aHtml.push('<div class="WebIFrm_Wrp"><iframe name="',sName,'" scrolling="auto" frameborder="no"></iframe></div>');},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"iframe");this._eWrapper=df.dom.query(this._eElem,"div.WebIFrm_Wrp");df.WebIFrame.base.afterRender.call(this);df.dom.on("load",this._eControl,this.onFrameLoad,this);this.set_pbShowBorder(this.pbShowBorder);this.set_psUrl(this.psUrl);if(this._sContentHtml!=null){this.writeHtmlContent();}},onFrameLoad:function onFrameLoad(oEv){var sNewLoc=this._eControl.contentWindow.location.href;if(sNewLoc&&this.psUrl!==sNewLoc){this.psUrl=sNewLoc;this.addSync("psUrl");this.fire("OnLocationChange",[sNewLoc]);}},set_psUrl:function set_psUrl(sVal){if(this._eControl){this._eControl.src=sVal;}},set_pbShowBorder:function set_pbShowBorder(bVal){if(this._eWrapper){df.dom.toggleClass(this._eWrapper,"WebIFrm_Box",bVal);}},setHeight:function setHeight(iHeight,bSense){if(this._eControl){if(iHeight>0){iHeight-=this.getVertHeightDiff();iHeight=iHeight<0?0:iHeight;this._eWrapper.style.height=iHeight+"px";}else{this._eWrapper.style.height="80px";}}},getVertHeightDiff:function getVertHeightDiff(){var iResult=df.WebForm.base.getVertHeightDiff.call(this);iResult+=df.sys.gui.getVertBoxDiff(this._eWrapper);return iResult;},setHtmlContent:function setHtmlContent(sHtml){this._sContentHtml=sHtml;this.writeHtmlContent();},writeHtmlContent:function writeHtmlContent(){if(this._eControl){this._eControl.contentWindow.document.open('text/htmlreplace');this._eControl.contentWindow.document.write(this._sContentHtml);this._eControl.contentWindow.document.close();}}});df.WebImage=function WebImage(sName,oParent){df.WebImage.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psUrl","");this.prop(df.tBool,"pbScroll",false);this.prop(df.tInt,"pePosition",df.cwiActual);this.prop(df.tBool,"pbShowBorder",false);this.prop(df.tBool,"pbFitZoom",true);this.event("OnClick",df.cCallModeWait);this.pbServerOnClick=false;this.psClientOnClick="";this._eImg=null;this._sLastUrl=null;this._iImageWidth=null;this._iImageHeight=null;this._bFocusAble=false;this._sControlClass="WebImage";};df.defineClass("df.WebImage","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebImage.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebImg_Wrp"><img>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebImage.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebImg_Wrp");this._eImg=df.dom.query(this._eElem,"div.WebImg_Wrp > img");df.WebImage.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onClick,this);df.dom.on("load",this._eImg,this.onImageLoaded,this);this.set_pePosition(this.pePosition);this.set_pbShowBorder(this.pbShowBorder);this.set_piHeight(this.piHeight);this.updateImage();},set_psUrl:function set_psUrl(sVal){this.psUrl=sVal;this.updateImage();},set_pbScroll:function set_pbScroll(bVal){if(this._eControl){this._eControl.style.overflowY=bVal&&this.pePosition!==df.cwiStretch?"auto":"hidden";this._eControl.style.overflowX=bVal&&this.pePosition!==df.cwiStretchHoriz&&this.pePosition!==df.cwiStretch?"auto":"hidden";}},set_pePosition:function set_pePosition(iVal){if(this._eImg){this._eControl.scrollLeft=0;this._eControl.scrollTop=0;this._eImg.style.width=iVal===df.cwiStretch||iVal===df.cwiStretchHoriz?"100%":"";this._eImg.style.height=iVal===df.cwiStretch?"100%":"";this._eImg.style.marginLeft=iVal===df.cwiCenter?"auto":"";this._eImg.style.marginRight=iVal===df.cwiCenter?"auto":"";this._eImg.style.display="block";this._eImg.style.marginTop="";this.pePosition=iVal;this.set_pbScroll(this.pbScroll);this.centerImage();}},set_pbShowBorder:function set_pbShowBorder(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebImg_Box",bVal);if(this.pbShowBorder!==bVal){this.sizeChanged();}}},set_psToolTip:function set_psToolTip(sVal){if(this._eImg){this._eImg.alt=sVal;this._eImg.title=sVal;}},updateImage:function updateImage(){this._iImageWidth=null;this._iImageHeight=null;if(this._eImg){if(this.psUrl!==this._sLastUrl){this._eImg.style.visibility="hidden";}this._eImg.src=this.psUrl;this._sLastUrl=this.psUrl;this.centerImage();}},centerImage:function centerImage(){var iVertScale,iHorizScale,iScale;if(this._eImg){if(this.pePosition===df.cwiFit){if(this._iImageWidth>0){iHorizScale=this._eControl.clientWidth/this._iImageWidth;iVertScale=this._eControl.clientHeight/this._iImageHeight;iScale=iHorizScale<iVertScale?iHorizScale:iVertScale;if(!this.pbFitZoom){iScale=iScale>1?1:iScale;}if(iScale>0){this._eImg.style.width=Math.floor(this._iImageWidth*iScale)+"px";}}}if(this.pePosition===df.cwiCenter||this.pePosition===df.cwiFit){if(this._eImg.clientHeight<this._eControl.clientHeight){this._eImg.style.marginTop=Math.floor((this._eControl.clientHeight-this._eImg.clientHeight)/2)+"px";}else{this._eImg.style.marginTop="";this._eControl.scrollTop=Math.floor((this._eControl.scrollHeight-this._eControl.clientHeight)/2);}if(this._eImg.clientWidth<this._eControl.clientWidth){this._eImg.style.marginLeft=Math.floor((this._eControl.clientWidth-this._eImg.clientWidth)/2)+"px";}else{this._eImg.style.marginLeft="";this._eControl.scrollLeft=Math.floor((this._eControl.scrollWidth-this._eControl.clientWidth)/2);}}}},resize:function resize(){if(this._iImageWidth===0){this._iImageWidth=this._eImg.clientWidth;this._iImageHeight=this._eImg.clientHeight;}this.centerImage();},onImageLoaded:function onImageLoaded(oEvent){this._iImageWidth=this._eImg.clientWidth;this._iImageHeight=this._eImg.clientHeight;this.centerImage();this._eImg.style.visibility="";},onClick:function onClick(oEvent){if(this.isEnabled()&&this.fire('OnClick')){oEvent.stop();}}});df.WebHtmlBox=function WebHtmlBox(sName,oParent){df.WebHtmlBox.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbScroll",true);this.prop(df.tString,"psHtml","");this.prop(df.tBool,"pbShowBorder",false);this.event("OnClick",df.cCallModeWait);this._sControlClass="WebHtmlBox";this._bFocusAble=false;};df.defineClass("df.WebHtmlBox","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebHtmlBox.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebHtml_Wrp">');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebHtmlBox.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebHtml_Wrp");df.WebHtmlBox.base.afterRender.call(this);this.set_piHeight(this.piHeight);this.set_pbShowBorder(this.pbShowBorder);df.dom.on("click",this._eControl,this.onHtmlClick,this);this.updateHtml(this.psHtml);},updateHtml:function updateHtml(sHtml){this.psHtml=sHtml;if(this._eControl){this._eControl.innerHTML=this.psHtml;this.sizeChanged();}},appendHtml:function appendHtml(sHtml){this.psHtml+=sHtml;if(this._eControl){this._eControl.innerHTML=this.psHtml;this.sizeChanged();}},prependHtml:function prependHtml(sHtml){this.psHtml=sHtml+this.psHtml;if(this._eControl){this._eControl.innerHTML=this.psHtml;this.sizeChanged();}},updateHtmlArray:function updateHtmlArray(){var aArray=df.sys.vt.deserialize(this._tActionData,[df.tString]);this.updateHtml(aArray.join(""));},set_pbScroll:function set_pbScroll(bVal){if(this._eControl){this._eControl.style.overflowY=this.pbFillHeight||this.piHeight>0?bVal?"auto":"hidden":"visible";this._eControl.style.overflowX=bVal?"auto":"";}},set_pbShowBorder:function set_pbShowBorder(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebHtml_Box",bVal);}},set_piHeight:function set_piHeight(iVal){if(this._eControl){df.WebHtmlBox.base.set_piHeight.call(this,iVal);this.piHeight=iVal;this.set_pbScroll(this.pbScroll);}},set_psHtml:function set_psHtml(sVal){this.updateHtml(sVal);},set_pbFillHeight:function set_pbFillHeight(bVal){df.WebHtmlBox.base.set_pbFillHeight.call(this,bVal);this.pbFillHeight=bVal;this.set_pbScroll(this.pbScroll);},onHtmlClick:function onHtmlClick(oEvent){var eElem=oEvent.getTarget();while(eElem&&eElem!==this._eControl){if(eElem.getAttribute('data-ServerOnClick')){this.fire('OnClick',[eElem.getAttribute('data-ServerOnClick'),eElem.getAttribute('data-OnClickParam')||""]);}eElem=eElem.parentNode;}}});df.WebRadio=function WebRadio(sName,oParent){df.WebRadio.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psMasterName","");this.prop(df.tString,"psGroupName","");this.prop(df.tString,"psRadioValue","");this.prop(df.tString,"psCaption","");this.event("OnSelect",df.cCallModeDefault);this._oMaster=null;this._aRadios=[];this._sPrevChangeVal=null;this._iPrevSelected=null;this._eCaption=null;this._sControlClass="WebRadio";};df.defineClass("df.WebRadio","df.WebBaseDEO",{openHtml:function openHtml(aHtml){df.WebRadio.base.openHtml.call(this,aHtml);aHtml.push('<input type="radio" name="',this.psGroupName,'" id="',this._sControlId,'"',!this.isEnabled()?' disabled="disabled" tabindex="-1"':'','><span class="WebR_Fake"></span><label class="WebRadio_Caption" for="',this._sControlId,'"></label><div style="clear: both"></div>');},afterRender:function afterRender(){var oWebApp=this.getWebApp();this._eControl=df.dom.query(this._eElem,"input");this._eCaption=df.dom.query(this._eElem,"label.WebRadio_Caption");this._eFakeBox=df.dom.query(this._eElem,".WebR_Fake");this.set_psCaption(this.psCaption);this.set_psRadioValue(this.psRadioValue);if(this.psMasterName){this._oMaster=oWebApp.findObj(this.psMasterName);this._oMaster.registerRadio(this);this.unSync('psValue');this.unSync('pbChanged');this.psValue=this._oMaster.psValue;}else{this.registerRadio(this);}df.WebRadio.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onClick,this);df.dom.on("click",this._eFakeBox,this.onFakeClick,this);},get_pbChanged:function get_pbChanged(){if(this._oMaster){return this._oMaster.get_pbChanged();}return df.WebRadio.base.get_pbChanged.call(this);},set_psValue:function set_psValue(sVal){var i;if(this._oMaster){this._oMaster.set_psValue(sVal);}else{df.WebRadio.base.set_psValue.call(this,sVal);for(i=0;i<this._aRadios.length;i++){if(this._aRadios[i]._eControl.checked){this._iPrevSelected=i;break;}}}},get_psValue:function get_psValue(){if(this._oMaster){return this._oMaster.get_psValue();}return df.WebRadio.base.get_psValue.call(this);},set_psRadioValue:function set_psRadioValue(sVal){if(this._eControl){this._eControl.value=sVal;}},set_psCaption:function set_psCaption(sVal){if(this._eCaption){df.dom.setText(this._eCaption,sVal);if(this.psCaption!==sVal){this.sizeChanged();}}},set_psTextColor:function set_psTextColor(sVal){if(this._eCaption){this._eCaption.style.color=sVal||'';}},set_psToolTip:function set_psToolTip(sVal){df.WebRadio.base.set_psToolTip.call(this,sVal);if(this._eFakeBox){this._eFakeBox.title=sVal;}},getControlValue:function getControlValue(){var i;if(this._oMaster){return this._oMaster.getControlValue();}for(i=0;i<this._aRadios.length;i++){if(this._aRadios[i]._eControl.checked){return this._aRadios[i].psRadioValue;}}return this.psValue;},setControlValue:function setControlValue(sVal){var i;if(this._oMaster){return this._oMaster.setControlValue(sVal);}if(!(this._aRadios[this._iPrevSelected]&&this._aRadios[this._iPrevSelected]._eControl.checked&&this._aRadios[this._iPrevSelected].psRadioValue===sVal)){for(i=0;i<this._aRadios.length;i++){if(this._aRadios[i].psRadioValue===sVal){this._aRadios[i]._eControl.checked=true;return;}}}},registerRadio:function registerRadio(oRadio){this._aRadios.push(oRadio);},fireChange:function fireChange(){var sNewVal,i;if(this._oMaster){return this._oMaster.fireChange();}this.updateTypeVal();sNewVal=this.getServerVal();for(i=0;i<this._aRadios.length;i++){if(this._sPrevChangeVal!==sNewVal){this._aRadios[i].fire('OnChange',[sNewVal,this._sPrevChangeVal]);}if(this._aRadios[i]._eControl.checked&&i!==this._iPrevSelected){this._aRadios[i].fire('OnSelect');this._iPrevSelected=i;}}this._sPrevChangeVal=sNewVal;},onClick:function onClick(oEvent){this.fireChange();},onFakeClick:function onFakeClick(oEvent){if(this.isEnabled()){this.focus();this._eControl.checked=true;this.fireChange();}}});df.WebSlider=function WebSlider(sName,oParent){df.WebSlider.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piMinValue",1);this.prop(df.tInt,"piMaxValue",10);this.prop(df.tInt,"piSliderValue",1);this.prop(df.tInt,"piInterval",1);this.prop(df.tBool,"pbVertical",false);this.prop(df.tInt,"piHeight",0);this.prop(df.tBool,"pbShowMarkers",false);this.prop(df.tInt,"piMaxMarkers",101);this.prop(df.tBool,"pbRanged",false);this.prop(df.tInt,"piSliderStart",0);this.prop(df.tInt,"piFrom",1);this.prop(df.tInt,"piTo",3);this.prop(df.tBool,"pbShowValue",true);this.prop(df.tBool,"pbShowRange",false);this.prop(df.tBool,"pbMouseWheelScroll",true);this._eSlider=null;this._eSliderWrp=null;this._eSliderBar=null;this._eControl=null;this._eLabels=null;this._eValueIndicator=null;this._bSelected=false;this._bFocus=false;this._eRangedSlider=null;this._iValueInterval=0;this._aLabels=[];this._aMarkers=[];this._iPrevChangePos=1;this._iPrevChangeFrom=0;this._iPrevChangeTo=0;this.unSync("psValue");this._sControlClass="WebSlider";};df.defineClass("df.WebSlider","df.WebBaseDEO",{create:function create(tDef){df.WebSlider.base.create.call(this,tDef);if(this.piSliderValue<this.piMinValue){this.piSliderValue=this.piMinValue;}else if(this.piSliderValue>this.piMaxValue){this.piSliderValue=this.piMaxValue;}this._iPrevChangePos=this.piSliderValue;this.assertions();if(this.piSliderValue>this.piMaxValue){this.piSliderValue=this.piMaxValue;}else if(this.piSliderValue<this.piMinValue){this.piSliderValue=this.piMinValue;}if(this.pbRanged){this.addSync("piFrom");this.addSync("piTo");}else{this.addSync("piSliderValue");}},openHtml:function openHtml(aHtml){df.WebSlider.base.openHtml.call(this,aHtml);if(this.pbShowValue){aHtml.push('<div class="WebSlider_ValueIndicatorWrapper">1</div>');}aHtml.push('<div class="WebSlider_Wrapper',this.pbVertical?' WebSlider_Vertical':' WebSlider_Horizontal',this.pbRanged?' WebSlider_Range':' WebSlider_NoRange','" ',!this.isEnabled()?'tabindex="-1"':'tabindex="0"','>');aHtml.push('<div class="WebSlider_BarWrapper">');aHtml.push('<div class="WebSlider_Bar">');aHtml.push('<div class="WebSlider_InnerBar">');if(this.pbShowRange){aHtml.push('<div class="WebSlider_ShowRange"></div>');}aHtml.push('</div></div>');aHtml.push('</div>');aHtml.push('<div class="WebSlider_Labels">');this.generateMarkers();this.renderLabels(aHtml);aHtml.push('</div>');aHtml.push('<div class="WebSlider_SliderWrapper">');aHtml.push('<div class="WebSlider_Slider"></div>');if(this.pbRanged){aHtml.push('<div class="WebSlider_SliderRanged WebSlider_Slider"></div>');}aHtml.push('</div>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebSlider_Wrapper");this._eSlider=df.dom.query(this._eElem,"div.WebSlider_Slider");this._eSliderWrp=df.dom.query(this._eElem,"div.WebSlider_SliderWrapper");this._eSliderBar=df.dom.query(this._eElem,"div.WebSlider_Bar");this._eSliderBarWrp=df.dom.query(this._eElem,"div.WebSlider_BarWrapper");this._eSliderBarInner=df.dom.query(this._eElem,"div.WebSlider_InnerBar");this._eLabels=df.dom.query(this._eElem,"div.WebSlider_Labels");this._eValueIndicator=df.dom.query(this._eElem,"div.WebSlider_ValueIndicatorWrapper");if(this.pbRanged){this._eRangedSlider=df.dom.query(this._eElem,"div.WebSlider_SliderRanged");}if(this.pbShowRange){this._eRangeIndicator=df.dom.query(this._eElem,"div.WebSlider_ShowRange");}df.WebSlider.base.afterRender.call(this);this.updateDisplay();if(window.PointerEvent){df.dom.on("pointerdown",this._eControl,this.onPointerDown,this);}else{df.dom.on("touchstart",this._eControl,this.onTouchDown,this);}df.events.addDomMouseWheelListener(this._eSliderWrp,this.onMouseWheelScroll,this);if(this.pbRanged){df.dom.on("mousedown",this._eRangedSlider,this.onMouseDown,this);}df.dom.on("mousedown",this._eSlider,this.onMouseDown,this);df.dom.on("click",this._eLabels,this.onLabelClick,this);df.dom.on("click",this._eControl,this.onSliderClick,this);},assertions:function assertions(){if(this.piInterval<=0){throw new df.Error(999,"The piInterval needs to be a positive number",this);}if(this.piMaxValue===this.piMinValue){throw new df.Error(999,"Please specify a Max and a Min value",this);}else if(this.piMaxValue<this.piMinValue){throw new df.Error(999,"The max value is smaller then the min value",this);}if((this.piMaxValue-this.piMinValue)%this.piInterval>0){throw new df.Error(999,"Your maximum, minimum and interval value do not match properly",this);}if(this.piSliderValue<this.piMinValue||this.piSliderValue>this.piMaxValue){throw new df.Error(999,"Please specify the piSliderValue with a number between the piMinValue and piMaxValue",this);}else if((this.piSliderValue-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piSliderValue)%this.piInterval>0){throw new df.Error(999,"The piSliderValue value is unreachable with the specified interval.",this);}if(this.pbRanged){if(this.piFrom<this.piMinValue||this.piFrom>this.piMaxValue){throw new df.Error(999,"Please specify the piFrom with a number between the piMinValue and piMaxValue",this);}else if(this.piTo<this.piMinValue||this.piTo>this.piMaxValue){throw new df.Error(999,"Please specify the piTo with a number between the piMinValue and piMaxValue",this);}else if((this.piFrom-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piFrom)%this.piInterval>0){throw new df.Error(999,"The piRangedValue value is unreachable with the specified interval.",this);}else if((this.piTo-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piTo)%this.piInterval>0){throw new df.Error(999,"The piTo value is unreachable with the specified interval.",this);}}},getVertHeightDiff:function getVertHeightDiff(){var iResult=df.WebSlider.base.getVertHeightDiff.call(this);if(this._eValueIndicator&&this.pbVertical){iResult+=this._eValueIndicator.offsetHeight;}return iResult;},resize:function resize(oEvent){this.positionLabels();this.updateDisplay();},updateDisplay:function updateDisplay(){var nOffset,nFrom,nTo,nStep,nWidth;if(this._eElem){nStep=this.getInterval()/this.piInterval;if(this.pbRanged){nFrom=nStep*(this.piFrom-this.piMinValue);nTo=nStep*(this.piTo-this.piMinValue);if(this.pbVertical){this._eRangedSlider.style.top=nFrom+"px";this._eSlider.style.top=nTo+"px";}else{this._eRangedSlider.style.left=nFrom+"px";this._eSlider.style.left=nTo+"px";}if(this.pbShowValue){this._eValueIndicator.innerHTML=this.piFrom+"-"+this.piTo;}if(this.pbShowRange){if(this.pbVertical){this._eRangeIndicator.style.top=nFrom+"px";this._eRangeIndicator.style.height=nTo-nFrom+"px";}else{this._eRangeIndicator.style.left=nFrom+"px";nWidth=nTo-nFrom;nWidth=nWidth<0?-nWidth:nWidth;this._eRangeIndicator.style.width=nWidth+"px";}}}else{nOffset=nStep*(this.piSliderValue-this.piMinValue);if(this.pbVertical){this._eSlider.style.top=nOffset+"px";}else{this._eSlider.style.left=nOffset+"px";}if(this.pbShowValue){this._eValueIndicator.innerHTML=this.piSliderValue;}if(this.pbShowRange){if(this.pbVertical){this._eRangeIndicator.style.top="0px";this._eRangeIndicator.style.height=nOffset+"px";}else{this._eRangeIndicator.style.left="0px";nOffset=nOffset<0?-nOffset:nOffset;this._eRangeIndicator.style.width=nOffset+"px";}}}}},fillLabels:function fillLabels(){if(this._tActionData){this._aLabels=df.sys.vt.deserialize(this._tActionData,[{sN:df.tString,sV:df.tString}]);this.generateMarkers();this.updateLabels();}},generateMarkers:function generateMarkers(){var aData=this._aLabels,i,oLabel,iNumberOfIntervals,iInterval,iDevide;this._aMarkers=[];if(this.pbShowMarkers){iNumberOfIntervals=this.piMaxMarkers;iDevide=(this.piMaxValue-this.piMinValue)/(iNumberOfIntervals-1);if(iDevide<this.piInterval){iInterval=this.piInterval;}else{iInterval=this.piInterval;while(iInterval<iDevide||(this.piMaxValue-this.piMinValue)%iInterval){iInterval+=this.piInterval;}}iNumberOfIntervals=(this.piMaxValue-this.piMinValue)/iInterval;for(i=0;i<=iNumberOfIntervals;i++){oLabel={};oLabel.piSliderValue=iInterval*i+this.piMinValue;oLabel.psLabel="";this._aMarkers.push(oLabel);}}if(aData){for(i=0;i<aData.length;i++){oLabel={};oLabel.piSliderValue=parseFloat(aData[i].sV,10);oLabel.psLabel=aData[i].sN;if(oLabel.piSliderValue%this.piInterval===0&&oLabel.piSliderValue<=this.piMaxValue&&oLabel.piSliderValue>=this.piMinValue){this._aMarkers.push(oLabel);}}}this._aMarkers=this._aMarkers.sort(this.sortLabels);this._aMarkers=this.removeDoubleValues(this._aMarkers);},sortLabels:function sortLabels(a,b){if(a.piSliderValue<b.piSliderValue){return-1;}if(a.piSliderValue>b.piSliderValue){return 1;}if(a.piSliderValue===b.piSliderValue){return 0;}},removeDoubleValues:function removeDoubleValues(aLabels){var i,iDummyArray=[];for(i=0;i<aLabels.length;i++){if(i+1===aLabels.length){iDummyArray.push(aLabels[i]);}else{if(aLabels[i].piSliderValue===aLabels[i+1].piSliderValue){if(aLabels[i].psLabel.length>aLabels[i+1].psLabel.length){iDummyArray.push(aLabels[i]);}else{iDummyArray.push(aLabels[i+1]);}i++;}else{iDummyArray.push(aLabels[i]);}}}return iDummyArray;},renderLabels:function renderLabels(aHtml){var i;aHtml.push('<div class="WebSlider_LabelMarkerWrapper"',this._aLabels.length===0&&!this.pbShowMarkers?' style="display: none;"':'','>');for(i=0;i<this._aMarkers.length;i++){aHtml.push('<div class="WebSlider_LabelMarker" data-labelIndex="',i,'"></div>');}aHtml.push('</div><div class="WebSlider_LabelWrapper"',this._aLabels.length===0?' style="display: none;"':'','>');for(i=0;i<this._aMarkers.length;i++){if(this._aMarkers[i].psLabel!==''){aHtml.push('<div class="WebSlider_LabelText" data-labelIndex="',i,'">',this._aMarkers[i].psLabel,'</div>');}}aHtml.push('</div>');},positionLabels:function positionLabels(){var i,iNewPosition,aMarkers,iIntervalSize,aLabels,iValue,nRel,nSliderOffset;iIntervalSize=this.getInterval()/this.piInterval;aLabels=df.dom.query(this._eLabels,"div.WebSlider_LabelText",true);aMarkers=df.dom.query(this._eLabels,"div.WebSlider_LabelMarker",true);if(this.pbVertical){nSliderOffset=this._eSlider.offsetHeight/2;}else{nSliderOffset=this._eSlider.offsetWidth/2;}for(i=0;i<aMarkers.length;i++){iNewPosition=0;iNewPosition=nSliderOffset+iIntervalSize*(this._aMarkers[i].piSliderValue-this.piMinValue);if(this.pbVertical){aMarkers[i].style.top=iNewPosition+"px";}else{aMarkers[i].style.left=iNewPosition+"px";}}for(i=0;i<aLabels.length;i++){iNewPosition=0;iValue=this._aMarkers[aLabels[i].getAttribute("data-labelIndex")].piSliderValue;iNewPosition=nSliderOffset+iIntervalSize*(iValue-this.piMinValue);if(this.pbVertical){iNewPosition=iNewPosition-aLabels[i].offsetHeight/2;aLabels[i].style.top=iNewPosition+"px";}else{nRel=(iValue-this.piMinValue)/(this.piMaxValue-this.piMinValue);nRel=(nRel-0.5)*0.6+0.5;iNewPosition=iNewPosition-nRel*aLabels[i].offsetWidth;aLabels[i].style.left=iNewPosition+"px";}}},updateLabels:function updateLabels(){var aNewLabels=[];if(this._eElem){this.renderLabels(aNewLabels);this._eLabels.innerHTML=aNewLabels.join("");this.positionLabels();}},increment:function increment(bUp,bSize){if(this.pbRanged){if(bSize){if(bUp){if(this.piTo<this.piMaxValue){this.piTo+=this.piInterval;}else if(this.piFrom>this.piMinValue){this.piFrom-=this.piInterval;}}else{if(this.piFrom<this.piTo){this.piTo-=this.piInterval;}}}else{if(bUp){if(this.piTo<this.piMaxValue){this.piTo+=this.piInterval;this.piFrom+=this.piInterval;}}else{if(this.piFrom>this.piMinValue){this.piTo-=this.piInterval;this.piFrom-=this.piInterval;}}}}else{if(bUp&&this.piSliderValue!==this.piMaxValue){this.piSliderValue+=this.piInterval;}else if(!bUp&&this.piSliderValue!==this.piMinValue){this.piSliderValue-=this.piInterval;}}this.updateDisplay();this.fireChange();},getInterval:function getInterval(){var iSliderSize,iValueInterval;iSliderSize=this.pbVertical?this._eSliderBarInner.offsetHeight:this._eSliderBarInner.offsetWidth;iValueInterval=iSliderSize/((this.piMaxValue-this.piMinValue)/this.piInterval);return iValueInterval;},toPositive:function toPositive(iValue){iValue=Math.sqrt(Math.pow(iValue,2));return iValue;},getMaximalSliderPosition:function getMaximalSliderPosition(){var iSliderSize;if(this.pbVertical){iSliderSize=this._eSliderBarInner.offsetHeight;}else{iSliderSize=this._eSliderBarInner.offsetWidth;}return iSliderSize;},onLabelClick:function onLabelClick(oEvent){var eLabel=oEvent.getTarget();if(!this.isEnabled()){return;}while(eLabel.getAttribute("data-labelindex")===null||eLabel===document){eLabel=eLabel.parentNode;if(eLabel===document){return;}}this.piSliderValue=this._aMarkers[eLabel.getAttribute("data-labelIndex")].piSliderValue;this.updateDisplay();this.fireChange();this.onFocus();},onMouseDown:function onMouseDown(oEvent){this.slide(0,this._eRangedSlider===oEvent.eSource&&this.pbRanged,oEvent);},onPointerDown:function onPointerDown(oEvent){var iD=10,iX,iY,tRec;if(oEvent.e.pointerType==="pen"||oEvent.e.pointerType==="touch"){iX=oEvent.e.clientX;iY=oEvent.e.clientY;tRec=this._eSlider.getBoundingClientRect();if(iX>tRec.left-iD&&iX<tRec.right+iD&&iY>tRec.top-iD&&iY<tRec.bottom+iD){this.slide(1,false,oEvent);}else if(this.pbRanged){tRec=this._eRangedSlider.getBoundingClientRect();if(iX>tRec.left-iD&&iX<tRec.right+iD&&iY>tRec.top-iD&&iY<tRec.bottom+iD){this.slide(1,true,oEvent);}}}},onTouchDown:function onTouchDown(oEvent){var iD=10,iX,iY,tRec;iX=oEvent.e.targetTouches[0].clientX;iY=oEvent.e.targetTouches[0].clientY;tRec=this._eSlider.getBoundingClientRect();if(iX>tRec.left-iD&&iX<tRec.right+iD&&iY>tRec.top-iD&&iY<tRec.bottom+iD){this.slide(2,false,oEvent);}else if(this.pbRanged){tRec=this._eRangedSlider.getBoundingClientRect();if(iX>tRec.left-iD&&iX<tRec.right+iD&&iY>tRec.top-iD&&iY<tRec.bottom+iD){this.slide(2,true,oEvent);}}},onMouseWheelScroll:function onMouseWheelScroll(oEvent){if(this.pbMouseWheelScroll){var iDelta=oEvent.getMouseWheelDelta();if(iDelta>0){this.increment(false,false);}else if(iDelta<0){this.increment(true,false);}oEvent.stop();}},slide:function slide(eType,bRanged,oEvent){var iMaxOffset,iMinOffset,iMouseStart,eMask,iStartValue,iTemp,iInterval,bVert=this.pbVertical;if(!this.isEnabled()){return;}function getPos(oEv){if(eType===0){return bVert?oEv.getMouseY():oEv.getMouseX();}if(eType===1){return bVert?oEv.e.clientY:oEv.e.clientX;}if(eType===2){return bVert?oEv.e.targetTouches[0].clientY:oEv.e.targetTouches[0].clientX;}return 0;}iInterval=this.getInterval();eMask=df.gui.dragMask();eMask.style.cursor=bVert?"s-resize":"e-resize";iMouseStart=getPos(oEvent);iMinOffset=0;iMaxOffset=this.getMaximalSliderPosition();if(this.pbRanged){if(bRanged){iStartValue=this.piFrom;}else{iStartValue=this.piTo;}}else{iStartValue=this.piSliderValue;}function onDragSlide(oEvent){var iNewMouseValue,iNewValue,iDiff,iPossDiff,iNumberOfIntervals;iNewMouseValue=getPos(oEvent);iDiff=iNewMouseValue-iMouseStart;iPossDiff=this.toPositive(iDiff);iNumberOfIntervals=iDiff/iInterval;iNumberOfIntervals=Math.round(this.toPositive(iNumberOfIntervals));if(iMouseStart>iNewMouseValue){iNumberOfIntervals*=-1;}iNewValue=iNumberOfIntervals*this.piInterval+iStartValue;if(iNewValue<this.piMinValue){iNewValue=this.piMinValue;}else if(iNewValue>this.piMaxValue){iNewValue=this.piMaxValue;}if(this.pbRanged){if(bRanged){this.piFrom=iNewValue;if(this.piFrom>this.piTo){bRanged=false;iTemp=this.piFrom;this.piFrom=this.piTo;this.piTo=iTemp;}}else{this.piTo=iNewValue;if(this.piTo<this.piFrom){bRanged=true;iTemp=this.piFrom;this.piFrom=this.piTo;this.piTo=iTemp;}}}else{this.piSliderValue=iNewValue;}this.updateDisplay();}function onStopSlide(oEvent){eMask.parentNode.removeChild(eMask);if(eType===0){df.dom.off("mouseup",window,onStopSlide);df.dom.off("mouseup",eMask,onStopSlide);df.dom.off("mousemove",eMask,onDragSlide);}else if(eType===1){df.dom.off("pointerup",window,onStopSlide);df.dom.off("pointerup",eMask,onStopSlide);df.dom.off("pointermove",window,onDragSlide);}else if(eType===2){df.dom.off("touchend",window,onStopSlide);df.dom.off("touchend",eMask,onStopSlide);df.dom.off("touchmove",window,onDragSlide);}this.fireChange();}if(eType===0){df.dom.on("mouseup",window,onStopSlide,this);df.dom.on("mouseup",eMask,onStopSlide,this);df.dom.on("mousemove",eMask,onDragSlide,this);}else if(eType===1){df.dom.on("pointerup",window,onStopSlide,this);df.dom.on("pointerup",eMask,onStopSlide,this);df.dom.on("pointermove",window,onDragSlide,this);}else if(eType===2){df.dom.on("touchend",window,onStopSlide,this);df.dom.on("touchend",eMask,onStopSlide,this);df.dom.on("touchmove",window,onDragSlide,this);}oEvent.stop();this.focus();},onSliderClick:function onSliderClick(oEvent){var oOffset,iOffset,iVal,iRawVal;if(!this.isEnabled()){return;}oOffset=this._eSliderBarInner.getBoundingClientRect();if(!(oEvent.getMouseY()>=oOffset.top-2&&oEvent.getMouseY()<=oOffset.bottom+2&&oEvent.getMouseX()>=oOffset.left-2&&oEvent.getMouseX()<=oOffset.right+2)){return;}if(this.pbVertical){iOffset=oEvent.getMouseY()-oOffset.top;}else{iOffset=oEvent.getMouseX()-oOffset.left;}iRawVal=iOffset/(this.getInterval()/this.piInterval);iVal=Math.round(iRawVal/this.piInterval)*this.piInterval+this.piMinValue;if(iVal<this.piMinValue){iVal=this.piMinValue;}else if(iVal>this.piMaxValue){iVal=this.piMaxValue;}if(this.pbRanged){if(iVal<this.piFrom){this.piFrom=iVal;}else if(iVal>this.iTo){this.piTo=iVal;}else if(iVal-this.piFrom<this.piTo-iVal){this.piFrom=iVal;}else{this.piTo=iVal;}}else{this.piSliderValue=iVal;}this.updateDisplay();this.fireChange();},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.sliderKeys.sliderDown)){this.increment(this.pbVertical,!this.pbVertical);oEvent.stop();return;}if(oEvent.matchKey(df.settings.sliderKeys.sliderUp)){this.increment(!this.pbVertical,!this.pbVertical);oEvent.stop();return;}if(oEvent.matchKey(df.settings.sliderKeys.sliderLeft)){this.increment(false,this.pbVertical);oEvent.stop();return;}if(oEvent.matchKey(df.settings.sliderKeys.sliderRight)){this.increment(true,this.pbVertical);oEvent.stop();return;}df.WebSlider.base.onKey.call(this,oEvent);},fireChange:function fireChange(){if(this._iPrevChangePos!==this.piSliderValue||this._iPrevChangeFrom!==this.piFrom||this._iPrevChangeTo!==this.piTo){this.pbChanged=true;this.fire('OnChange',[this.piSliderValue,this._iPrevChangePos]);this._iPrevChangePos=this.piSliderValue;this._iPrevChangeFrom=this.piFrom;this._iPrevChangeTo=this.piTo;}},set_piMinValue:function set_piMinValue(iVal){this.piMinValue=iVal;this.resize();this.generateMarkers();this.updateLabels();},set_piMaxValue:function set_piMaxValue(iVal){this.piMaxValue=iVal;this.updateDisplay();this.generateMarkers();this.updateLabels();},set_piInterval:function set_piInterval(iVal){this.piInterval=iVal;this.updateDisplay();this.generateMarkers();this.updateLabels();},set_pbShowMarkers:function set_pbShowMarkers(bVal){this.pbShowMarkers=bVal;this.generateMarkers();this.updateLabels();},set_piSliderValue:function set_piSliderValue(iVal){if(iVal>this.piMaxValue){this.piSliderValue=this.piMaxValue;}else if(iVal<this.piMinValue){this.piSliderValue=this.piMinValue;}else{this.piSliderValue=iVal;}this._iPrevChangePos=this.piSliderValue;this.updateDisplay();return false;},set_piFrom:function set_piFrom(iVal){var that=this;if(iVal>this.piMaxValue){this.piFrom=this.piMaxValue;}else if(iVal<this.piMinValue){this.piFrom=this.piMinValue;}else{this.piFrom=iVal;}this._iPrevChangeFrom=this.piFrom;if(this.piFrom>this.piTo){setTimeout(function(){var i,x;if(that.piFrom>that.piTo){i=that.piFrom;x=that._iPrevChangeFrom;that.piFrom=that.piTo;that.piTo=i;that._iPrevChangeFrom=that._iPrevChangeTo;that._iPrevChangeTo=x;}that.updateDisplay();},10);}else{this.updateDisplay();}return false;},set_piTo:function set_piTo(iVal){var that=this;if(iVal>this.piMaxValue){this.piTo=this.piMaxValue;}else if(iVal<this.piMinValue){this.piTo=this.piMinValue;}else{this.piTo=iVal;}this._iPrevChangeTo=this.piTo;if(this.piFrom>this.piTo){setTimeout(function(){var i,x;if(that.piFrom>that.piTo){i=that.piFrom;x=that._iPrevChangeFrom;that.piFrom=that.piTo;that.piTo=i;that._iPrevChangeFrom=that._iPrevChangeTo;that._iPrevChangeTo=x;}that.updateDisplay();},10);}else{this.updateDisplay();}return false;},get_pbChanged:function get_pbChanged(){return this.pbChanged;},get_psValue:function get_psValue(){return this.piSliderValue.toString();},set_psValue:function set_psValue(sVal){},attachFocusEvents:function attachFocusEvents(){if(this._eControl&&this.isEnabled()&&this.pbVisible){df.events.addDomCaptureListener("focus",this._eControl,this.onFocus,this);df.dom.on("blur",this._eControl,this.onBlur,this);}},focus:function focus(){if(this._bFocusAble&&this.isEnabled()&&this._eControl){this._eControl.focus();this.objFocus();return true;}return false;},onFocus:function onFocus(oEvent){df.WebSlider.base.onFocus.call(this,oEvent);this.focus();this._bLozingFocus=false;},onBlur:function onBlur(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){that.getWebApp().objBlur(that);if(that._eElem){df.dom.removeClass(that._eElem,"WebCon_Focus");}that._bHasFocus=false;that._bLozingFocus=false;}},100);}});df.WebSpacer=function WebSpacer(sName,oParent){df.WebSpacer.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piMinHeight",0);this._sControlClass="WebSpacer";this._bFocusAble=false;};df.defineClass("df.WebSpacer","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebSpacer.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebSpacer_Spacer">');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebSpacer.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"div.WebSpacer_Spacer");df.WebSpacer.base.afterRender.call(this);}});df.WebHorizontalLine=function(sName,oParent){df.WebHorizontalLine.base.constructor.call(this,sName,oParent);this._sControlClass="WebHorizontalLine";this._bFocusAble=false;};df.defineClass("df.WebHorizontalLine","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebHorizontalLine.base.openHtml.call(this,aHtml);aHtml.push('<hr/>');},closeHtml:function closeHtml(aHtml){df.WebHorizontalLine.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"hr");df.WebHorizontalLine.base.afterRender.call(this);},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eControl){this._eControl.style.backgroundColor=sVal||'';this._eControl.style.color=sVal||'';}}});df.WebTimer=function WebTimer(sName,oParent){df.WebTimer.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbAutoStart",true);this.prop(df.tBool,"pbAutoStop",true);this.prop(df.tInt,"piInterval",2000);this.prop(df.tBool,"pbRunning",false);this.prop(df.tBool,"pbWaitForCall",true);this.event("OnTimer",df.cCallModeDefault);this._tInterval=null;this._tTimeout=null;this._oView=null;this.addSync("pbRunning");};df.defineClass("df.WebTimer","df.WebObject",{create:function create(){df.WebTimer.base.create.call(this);this._oView=this.getView();if(this._oView){this._oView.OnShow.on(this.showView,this);this._oView.OnHide.on(this.hideView,this);}else{if(this.pbAutoStart){this.pbRunning=true;this.trigger();}}},destroy:function destroy(){df.WebTimer.base.destroy.call(this);if(this._oView){this._oView.OnShow.off(this.showView,this);this._oView.OnHide.off(this.hideView,this);}},timer:function timer(){if(this.pbRunning){this.fire("OnTimer",[],function(){this.trigger();});}},trigger:function trigger(){var that=this;if(this.pbRunning){if(this.pbWaitForCall){if(this._tInterval){clearInterval(this._tInterval);this._tInterval=null;}if(this._tTimeout){clearTimeout(this._tTimeout);}this._tTimeout=setTimeout(function(){that.timer();},this.piInterval);}else if(!this._tInterval){this._tInterval=setInterval(function(){that.timer();},this.piInterval);}}else{if(this._tInterval){clearInterval(this._tInterval);this._tInterval=null;}if(this._tTimeout){clearTimeout(this._tTimeout);this._tTimeout=null;}}},set_pbRunning:function set_pbRunning(bVal){this.pbRunning=bVal;this.trigger();},set_piInterval:function set_piInterval(iVal){if(this.piInterval!==iVal){this.piInterval=iVal;if(this._tInterval){clearInterval(this._tInterval);this._tInterval=null;}this.trigger();}},set_pbWaitForCall:function set_pbWaitForCall(bVal){this.pbWaitForCall=bVal;this.trigger();},showView:function showView(oEvent){if(this.pbAutoStart){this.pbRunning=true;this.trigger();}},hideView:function hideView(oEvent){if(this.pbAutoStop){this.pbRunning=false;this.trigger();}}});df.WebProgressBar=function WebProgressBar(sName,oParent){df.WebProgressBar.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piMaxValue",100);this.prop(df.tInt,"piValue",0);this.prop(df.tBool,"pbShowPercentage",true);this.prop(df.tString,"psCaption","");this.prop(df.tInt,"piDecimals","");this._eProgressBarWrp=null;this._eProgress=null;this._ePercentage=null;this.piColumnSpan=0;this.pbShowLabel=false;this._sControlClass="WebProgressBar";};df.defineClass("df.WebProgressBar","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebProgressBar.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebPB_Wrp',this.pbShowPercentage||this.psCaption?' WebPB_ShowPercentage':'','">');aHtml.push('<div>');aHtml.push('<div class="WebPB_Progress"></div>');if(this.psCaption!==""){aHtml.push('<div class="WebPB_Percentage">',df.dom.encodeHtml(this.psCaption),'</div>');}else{aHtml.push('<div class="WebPB_Percentage"></div>');}},closeHtml:function closeHtml(aHtml){aHtml.push('</div></div>');df.WebProgressBar.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eProgressBarWrp=df.dom.query(this._eElem,".WebPB_Wrp");this._eProgress=df.dom.query(this._eElem,".WebPB_Progress");this._ePercentage=df.dom.query(this._eElem,".WebPB_Percentage");this.set_piValue(this.piValue);df.WebProgressBar.base.afterRender.call(this);},getPercentage:function getPercentage(iCustomDecimals){var fPercentage,iDecimals=this.piDecimals;if(iCustomDecimals!==undefined){iDecimals=iCustomDecimals;}iDecimals=Math.pow(10,iDecimals);fPercentage=this.piValue/this.piMaxValue*100;return Math.round(fPercentage*iDecimals)/iDecimals;},set_piValue:function set_piValue(iVal){if(this._eProgress){iVal=iVal>=0?iVal<=this.piMaxValue?iVal:this.piMaxValue:0;this.piValue=iVal;this._eProgress.style.width=this.getPercentage(2)+"%";df.dom.toggleClass(this._eProgress,"WebPB_Zero",iVal===0);if(!this.psCaption){df.dom.setText(this._ePercentage,this.getPercentage()+"%");}}},set_pbShowPercentage:function set_pbShowPercentage(bVal){if(this._ePercentage){df.dom.toggleClass(this._eProgressBarWrp,'WebPB_ShowPercentage',bVal||this.psCaption);}},set_psCaption:function set_psCaption(sVal){if(this._ePercentage){this.psCaption=sVal;df.dom.toggleClass(this._eProgressBarWrp,'WebPB_ShowPercentage',sVal||this.pbShowPercentage);if(sVal){df.dom.setText(this._ePercentage,sVal);}else{this.set_piValue(this.piValue);}}},set_piMaxValue:function set_piMaxValue(iVal){this.piMaxValue=iVal;this.set_piValue(this.piValue);}});df.WebFileUploadButton=function WebFileUploadButton(sName,oParent){df.WebFileUploadButton.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","Select file(s)");this.prop(df.tInt,"peAlign",-1);this._sControlClass="WebButton WebUploadBtn";};df.defineClass("df.WebFileUploadButton","df.WebBaseFileUpload",{openHtml:function openHtml(aHtml){df.WebFileUploadButton.base.openHtml.call(this,aHtml);aHtml.push('<button id="',this._sControlId,'"',!this.isEnabled()?' disabled="disabled"':'');if(this.peAlign>=0){aHtml.push(' style="text-align: ',df.sys.gui.cssTextAlign(this.peAlign),'"');}aHtml.push('>',df.dom.encodeHtml(this.psCaption),'</button>');this.fileHtml(aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"button");df.WebFileUploadButton.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onBtnClick,this);},onBtnClick:function onBtnClick(oEvent){var tTimer=null,eElem=this._eElem;if(this.isEnabled()){df.dom.addClass(eElem,df.CssHit);tTimer=setTimeout(function(){df.dom.removeClass(eElem,df.CssHit);tTimer=null;},df.hitTimeout);this.selectFiles();}},set_psCaption:function set_psCaption(sVal){if(this._eControl){df.dom.setText(this._eControl,sVal);}},set_peAlign:function set_peAlign(eVal){if(this._eControl){this._eControl.style.textAlign=df.sys.gui.cssTextAlign(eVal);}},applyEnabled:function applyEnabled(bVal){df.WebFileUploadButton.base.applyEnabled.call(this,bVal);if(this._eControl){this._eControl.disabled=!bVal;}}});df.ciUploadStateEmpty=0;df.ciUploadStateDisplay=1;df.ciUploadStateSelected=2;df.ciUploadStateUploading=3;df.ciUploadStateFinished=4;df.WebFileUploadForm=function WebFileUploadForm(sName,oParent){df.WebFileUploadForm.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peState",df.ciUploadStateEmpty);this.prop(df.tBool,"pbShowMime",false);this.prop(df.tString,"psFileName","");this.prop(df.tInt,"piFileSize",0);this.prop(df.tString,"psFileMime","");this.event("OnFileClick",df.cCallModeWait);this.addSync("peState");this._sControlClass="WebFileFrm";};df.defineClass("df.WebFileUploadForm","df.WebBaseFileUpload",{openHtml:function openHtml(aHtml){df.WebFileUploadForm.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper" tabindex="0"><div><div class="WebFile_Btn">');this.fileHtml(aHtml);aHtml.push('</div><div class="WebFile_Content"></div></div></div>');},afterRender:function afterRender(){this._eControl=this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");this._eContent=df.dom.query(this._eElem,"div.WebFile_Content");this._ePrompt=df.dom.query(this._eElem,"div.WebFile_Btn");df.WebFileUploadForm.base.afterRender.call(this);df.dom.on("click",this._eContent,this.onContentClick,this);df.dom.on("click",this._ePrompt,this.onPromptClick,this);df.events.addDomKeyListener(this._eControl,this.onKey,this);this.updateDetails();},onPromptClick:function onPromptClick(oEvent){if(this.isEnabled()){this.selectFiles();}},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.formKeys.prompt)){if(this.isEnabled()){this.selectFiles();oEvent.stop();}}else if(oEvent.matchKey(df.settings.tabKeys.enter)){if(this.fireContentClick()){oEvent.stop();}}},fireContentClick:function fireContentClick(){if(this.isEnabled()){if(this.peState===df.ciUploadStateFinished||this.peState===df.ciUploadStateDisplay){this.fire("OnFileClick");return true;}}return false;},updateDetails:function updateDetails(){var sDtl;if(this._eWrap){if(this.psFileName){if(this.peState===df.ciUploadStateSelected){df.dom.addClass(this._eWrap,"WebFile_Pending");}else{df.dom.addClass(this._eWrap,"WebFile_HasFile");}sDtl=this.psFileName;if(this.pbShowMime&&this.piFileSize>0&&this.psFileMime){sDtl+=" (Size: "+df.sys.data.markupDataSize(this.piFileSize)+", Mime: "+this.psFileMime+")";}else if(this.piFileSize>0){sDtl+=" ("+df.sys.data.markupDataSize(this.piFileSize)+")";}}else{df.dom.removeClass(this._eWrap,"WebFile_HasFile");df.dom.removeClass(this._eWrap,"WebFile_Pending");sDtl=this.getWebApp().getTrans("no_file_selected");}df.dom.toggleClass(this._eContent,"WebFile_OnClick",this.pbServerOnFileClick&&(this.peState===df.ciUploadStateFinished||this.peState===df.ciUploadStateDisplay));this._eContent.innerHTML='<div class="WebFile_Details">'+sDtl+'</div>';}},displaySelectedFileDetails:function displaySelectedFileDetails(){var oFile;if(this._aFiles.length>0){oFile=this._aFiles[0].oFile;this.addSync("psFileName");this.addSync("piFileSize");this.addSync("psFileMime");this._eState=this.peState;if(this.peState===df.ciUploadDisplay){this._sDisplayFileName=this.psFileName;this._iDisplayFileSize=this.piFileSize;this._sDisplayFileMime=this.psFileMime;}this.peState=df.ciUploadStateSelected;this.psFileName=oFile.name;this.piFileSize=oFile.size;this.psFileMime=oFile.type;}this.updateDetails();},displayStartWorking:function displayStartWorking(){if(!this.pbShowDialog){this._eContent.innerHTML='<div class="WebFile_Working"></div>';}else{df.WebFileUploadForm.base.displayStartWorking.call(this);}},displayProgress:function displayProgress(iFile,iFiles,iFileLoaded,iFileTotal,iTotalLoaded,iTotal){var iPercent;if(!this.pbShowDialog){iPercent=iTotalLoaded/iTotal*100;if(!this._eBar){this._eContent.innerHTML='<div class="WebFile_Progress"><div class="WebFile_ProgressBar" style="width: 0%;"></div><div class="WebFile_ProgressLabel">0%</div></div>';this._eBar=df.dom.query(this._eContent,"div.WebFile_ProgressBar");this._eLbl=df.dom.query(this._eContent,"div.WebFile_ProgressLabel");}this._eBar.style.width=Math.round(iPercent*10)/10+"%";df.dom.setText(this._eLbl,Math.round(iPercent)+"%");}else{df.WebFileUploadForm.base.displayProgress.call(this,iFile,iFiles,iFileLoaded,iFileTotal,iTotalLoaded,iTotal);}},displayFinishWorking:function displayFinishWorking(){if(!this.pbShowDialog){if(this._eBar){this._eBar.style.width="100%";}}else{df.WebFileUploadForm.base.displayFinishWorking.call(this);}},displayFinished:function displayFinished(bSuccess){this._eBar=null;this._eLbl=null;this.peState=bSuccess?df.ciUploadStateFinished:df.ciUploadStateSelected;this.updateDetails();df.WebFileUploadForm.base.displayFinished.call(this,bSuccess);},onContentClick:function onContentClick(oEvent){this.fireContentClick();},applyEnabled:function applyEnabled(bVal){df.WebFileUploadForm.base.applyEnabled.call(this,bVal);if(this._eControl){this._eControl.tabIndex=bVal?0:-1;}}});df.WebGroupBase=df.mixin("df.WebBaseContainer_mixin","df.WebBaseControl");df.WebGroup=function WebGroup(sName,oParent){df.WebGroup.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tBool,"pbShowBorder",true);this.prop(df.tBool,"pbShowCaption",true);this.prop(df.tBool,"pbCollapsible",false);this.prop(df.tBool,"pbExpanded",true);this.event("OnExpand",df.cCallModeDefault);this.event("OnCollapse",df.cCallModeDefault);this._eCaption=null;this._sBaseClass="WebControl";this._sControlClass="WebGroup";};df.defineClass("df.WebGroup","df.WebGroupBase",{wrpOpenHtml:function wrpOpenHtml(aHtml){aHtml.push('<div class="WebContainer">');},wrpCloseHtml:function wrpCloseHtml(aHtml){aHtml.push('</div>');aHtml.push('<label class="WebGrp_Caption">',df.dom.encodeHtml(this.psCaption),'</label>');aHtml.push('<div class="WebGrp_ExpandBtn"></div>');},getRef:function getRef(){df.WebGroup.base.getRef.call(this);this._eCaption=df.dom.query(this._eElem,"label.WebGrp_Caption");this._eControl=df.dom.query(this._eElem,"div.WebCon_Inner > div");this._eExpandBtn=df.dom.query(this._eElem,"div.WebGrp_ExpandBtn");},afterRender:function afterRender(){df.WebGroup.base.afterRender.call(this);df.dom.on("click",this._eExpandBtn,this.onExpandClick,this);df.dom.on("transitionend",this._eElem,this.onTransEnd,this);if(this._eContent){df.dom.on("transitionend",this._eContent,this.onTransEndCancel,this);}},genClass:function genClass(){var sClass=df.WebGroup.base.genClass.call(this);if(this.pbShowCaption){sClass+=" WebGrp_HasCaption";}if(this.pbShowBorder){sClass+=" WebGrp_HasBorder";}if(this.pbCollapsible){sClass+=" WebGrp_Collapsible "+(this.pbExpanded?"WebGrp_Expanded":"WebGrp_Collapsed");}return sClass;},set_psCaption:function set_psCaption(sVal){if(this._eCaption){df.dom.setText(this._eCaption,sVal);this.sizeChanged();}},set_pbShowCaption:function set_pbShowCaption(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebGrp_HasCaption",bVal);this.sizeChanged();}},set_pbShowBorder:function set_pbShowBorder(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebGrp_HasBorder",bVal);this.sizeChanged();}},set_pbCollapsible:function set_pbCollapsible(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebGrp_Collapsible",bVal);if(bVal){df.dom.addClass(this._eElem,this.pbExpanded?"WebGrp_Expanded":"WebGrp_Collapsed");}else{df.dom.removeClass(this._eElem,"WebGrp_Expanded WebGrp_Collapsed");}}},set_pbExpanded:function set_pbExpanded(bVal){if(this._eElem&&this.pbCollapsible&&this.pbExpanded!==bVal){if(bVal){df.dom.addClass(this._eElem,"WebGrp_Expanded");df.dom.removeClass(this._eElem,"WebGrp_Collapsed");this.fire("OnExpand");}else{df.dom.addClass(this._eElem,"WebGrp_Collapsed");df.dom.removeClass(this._eElem,"WebGrp_Expanded");this.fire("OnCollapse");}this.sizeChanged(true);}},onExpandClick:function onExpandClick(oEv){if(this.isEnabled()){this.set('pbExpanded',!this.pbExpanded);}},onTransEnd:function onTransEnd(oEv){this.sizeChanged(true);},onTransEndCancel:function onTransEndCancel(oEv){oEv.stopPropagation();},getMinHeight:function getMinHeight(){var iHeight=0;this.resize();iHeight=this.getRequiredHeight();if(this._eControl){iHeight+=df.sys.gui.getVertBoxDiff(this._eControl);iHeight+=df.sys.gui.getVertBoxDiff(this._eInner);iHeight+=df.sys.gui.getVertBoxDiff(this._eControlWrp);}if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}return iHeight;},setHeight:function setHeight(iHeight,bSense){if(this._eControl){if(iHeight>0){iHeight-=this.getVertHeightDiff();iHeight=iHeight<0?0:iHeight;this._eContainer.style.height=iHeight+"px";}else{this._eContainer.style.height="";}}},getVertHeightDiff:function getVertHeightDiff(){var iResult=df.WebGroup.base.getVertHeightDiff.call(this);iResult+=df.sys.gui.getVertBoxDiff(this._eContainer,3);return iResult;},set_psBackgroundColor:function set_psBackgroundColor(sVal){if(this._eContainer){this._eContainer.style.background=sVal||'';}if(this._eCaption){this._eCaption.style.background=sVal||'';}},onFocus:function onFocus(oEV){},onBlur:function onBlur(oEV){}});df.tWebBreadcrumbItem={sViewName:df.tString,sCrumbCaption:df.tString,sHeadCaption:df.tString};df.WebBreadcrumb=function WebBreadcrumb(sName,oParent){df.WebBreadcrumb.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peBreadcrumbStyle",df.cCrumbHorizontal);this._eControl=null;this._eList=null;this._eCaption=null;this._eMask=null;this._aItems=[];this._bRedraw=false;this._bDropDownExpanded=false;this._tHideTimeout=null;this._bWrapDiv=true;this._sControlClass="WebBreadcrumb";};df.defineClass("df.WebBreadcrumb","df.WebBaseControl",{openHtml:function openHtml(aHtml){df.WebBreadcrumb.base.openHtml.call(this,aHtml);if(this.peBreadcrumbStyle===df.cCrumbHorizontal){aHtml.push('<div class="WebCrumbs_Body WebCrumbs_Horiz" tabindex="-1">');}else{aHtml.push('<div class="WebCrumbs_Body WebCrumbs_DropDown" tabindex="-1">');}},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebBreadcrumb.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,'div.WebCrumbs_Body');df.WebBreadcrumb.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onBodyClick,this);this.redraw();},set_peBreadcrumbStyle:function set_peBreadcrumbStyle(eVal){if(this._eControl){if(this.peBreadcrumbStyle!==eVal){this.peBreadcrumbStyle=eVal;this.redraw();}}},refresh:function refresh(){var i,aItems=this.deserializeVT(this._tActionData);this.clear();for(i=0;i<aItems.length;i++){this.append(aItems[i]);}this.redraw();},onBodyClick:function onBodyClick(oEvent){var sViewName="",eElem=oEvent.getTarget(),bStop=false,bDropDown=false;if(this.isEnabled()){if(this._tHideTimeout){clearTimeout(this._tHideTimeout);this._tHideTimeout=null;}while(eElem&&!bStop&&eElem!==this._eElem){if(eElem.className.indexOf("WebCrumb_Item")>=0){sViewName=eElem.getAttribute("data-dfview-name");if(sViewName){this.doSelect(sViewName);}bStop=true;}else if(eElem.className.indexOf("WebCrumb_DropDownBtn")>=0){this.showDropDown();bDropDown=true;bStop=true;}else{eElem=eElem.parentNode;}}if(this._bDropDownExpanded&&!bDropDown){this.hideDropDown();}if(bStop){oEvent.stop();}}},onBlur:function onBlur(oEvent){var that=this;df.WebBreadcrumb.base.onBlur.call(this,oEvent);if(this._bDropDownExpanded){if(this._tHideTimeout){clearTimeout(this._tHideTimeout);}this._tHideTimeout=setTimeout(function(){that._tHideTimeout=null;that.hideDropDown();},150);}},onMaskTouch:function onMaskTouch(oEvent){this.hideDropDown();oEvent.stop();},doSelect:function doSelect(sViewName){this.serverAction("OnSelect",[sViewName]);},showDropDown:function showDropDown(){if(this._eList&&this._aItems.length>1){df.dom.addClass(this._eList,"WebCrumbs_Expanded");this._bDropDownExpanded=true;if(df.sys.isMobile){this._eMask=df.dom.create('<div class="WebMenu_Mask">&nbsp;</div>');this._eElem.insertBefore(this._eMask,this._eElem.firstChild);df.dom.on("click",this._eMask,this.onMaskTouch,this);}}},hideDropDown:function hideDropDown(){if(this._eList){df.dom.removeClass(this._eList,"WebCrumbs_Expanded");this._bDropDownExpanded=false;if(this._eMask){df.dom.off("click",this._eMask,this.onMaskTouch);this._eMask.parentNode.removeChild(this._eMask);this._eMask=null;}}},resize:function resize(oEvent){var aElements;if(this.peBreadcrumbStyle===df.cCrumbHorizontal){if(this._eList&&this._eList.hasChildNodes()){aElements=df.dom.query(this._eList,"li div.WebCrumb_Caption",true);this.resetWidths(aElements);this.adjustWidths();}}},resetWidths:function resetWidths(aDivs){var i;for(i=0;i<aDivs.length;i++){aDivs[i].style.width="auto";aDivs[i].removeAttribute("title");}},sumElementWidths:function sumElementWidths(aElements){var iSumWidth=0,i;for(i=0;i<aElements.length;i++){iSumWidth=iSumWidth+aElements[i].offsetWidth;}return iSumWidth;},reduceWidthsToTarget_li:function reduceWidthsToTarget_li(aListItems,iTargetWidth){var eDiv=null,i,iSumWidth,iDiffTotal,iDiffPerItem,iWidth,iRemainder=0,sWidth,sTip;if(aListItems.length===0){return 0;}iSumWidth=this.sumElementWidths(aListItems);iDiffTotal=iSumWidth-iTargetWidth;if(iDiffTotal<=0){return 0;}iDiffPerItem=Math.ceil(iDiffTotal/aListItems.length);for(i=0;i<aListItems.length;i++){eDiv=df.dom.query(aListItems[i],"div.WebCrumb_Caption",false);iWidth=eDiv.offsetWidth-iDiffPerItem;iWidth=iWidth-df.sys.gui.getHorizBoxDiff(eDiv,0);if(iWidth<15){eDiv.style.width="15px";iRemainder=iRemainder+15-iWidth;}else{sWidth=iWidth.toString()+"px";eDiv.style.width=sWidth;}sTip=df.dom.getText(eDiv);if(sTip){eDiv.setAttribute("title",sTip);}}for(i=0;i<aListItems.length&&iRemainder>0;i++){eDiv=df.dom.query(aListItems[i],"div.WebCrumb_Caption",false);if(eDiv.offsetWidth>15){iRemainder=iRemainder+15-eDiv.offsetWidth;eDiv.style.width="15px";}}if(iRemainder>0){return iRemainder;}return 0;},adjustWidths:function adjustWidths(){var iSumChildWidths,iTarget,iRemainder,aListItems;if(this._eList&&this._eList.hasChildNodes()){iSumChildWidths=this.sumElementWidths(df.dom.query(this._eList,"li",true));if(this._eList.clientWidth<iSumChildWidths){aListItems=this._eList.getElementsByClassName("WebCrumb_Item");if(aListItems.length>0){iTarget=this._eList.clientWidth-this._eList.lastChild.offsetWidth;iRemainder=this.reduceWidthsToTarget_li(aListItems,iTarget);}else{iRemainder=this._eList.lastChild.offsetWidth-this._eList.clientWidth;}if(iRemainder>0){aListItems=this._eList.getElementsByClassName("WebCurrentCrumb");iTarget=this._eList.lastChild.offsetWidth-iRemainder-2;iRemainder=this.reduceWidthsToTarget_li(aListItems,iTarget);}}}},deserializeVT:df.sys.vt.generateDeserializer([df.tWebBreadcrumbItem]),append:function append(tItem){this._aItems.push(tItem);},clear:function clear(){if(this._eList){this._eList.innerHTML="";}else{if(this._eControl){this._eList=this.constructList();this._eControl.appendChild(this._eList);}}this._aItems=[];},redraw:function redraw(){var eDiv=null,aItems=this._aItems,aHtml=[],sCaption;if(this._eControl){this._bRedraw=true;if(this.peBreadcrumbStyle===df.cCrumbHorizontal){df.dom.removeClass(this._eControl,"WebCrumbs_DropDown");df.dom.addClass(this._eControl,"WebCrumbs_Horiz");}else{df.dom.removeClass(this._eControl,"WebCrumbs_Horiz");df.dom.addClass(this._eControl,"WebCrumbs_DropDown");}if(this.peBreadcrumbStyle===df.cCrumbHorizontal){if(this._eCaption){this._eControl.removeChild(this._eCaption);this._eCaption=null;}}else{if(!this._eCaption){eDiv=document.createElement("div");df.dom.addClass(eDiv,"WebCrumb_Caption");this._eControl.appendChild(eDiv);this._eCaption=eDiv;}if(aItems.length){if(aItems[aItems.length-1].sHeadCaption.trim()===""){aHtml.push("&nbsp;");}else{sCaption=aItems[aItems.length-1].sHeadCaption.trim();aHtml.push(df.dom.encodeHtml(sCaption));}this._eCaption.innerHTML=aHtml.join("");}else{this._eCaption.innerHTML='&nbsp;';}if(aItems.length>1&&this.peBreadcrumbStyle===df.cCrumbDropDown){df.dom.addClass(this._eCaption,"WebCrumb_DropDownBtn");}else{df.dom.removeClass(this._eCaption,"WebCrumb_DropDownBtn");}}if(this._eList){this._eList.innerHTML="";}else if(this.peBreadcrumbStyle!==df.cCrumbCaption){this._eList=this.constructList();this._eControl.appendChild(this._eList);}if(this.peBreadcrumbStyle!==df.cCrumbCaption){this.constructItems(aItems);}this._bRedraw=false;}},constructList:function constructList(){var eList=document.createElement("ul");eList.setAttribute("class","WebCrumbs");return eList;},constructItems:function constructItems(aItems){var iItem,bCurrent=false,sLine="",aHtml=[];if(aItems.length===0){aHtml.push('<li class="WebCurrentCrumb">');if(this.peBreadcrumbStyle===df.cCrumbHorizontal){aHtml.push('<div tabindex="-1">');}aHtml.push('<div class="WebCrumb_Caption" tabindex="-1">');aHtml.push("&nbsp;");aHtml.push('</div>');if(this.peBreadcrumbStyle===df.cCrumbHorizontal){aHtml.push('</div>');}aHtml.push('</li>');}for(iItem=0;iItem<aItems.length;iItem++){if(iItem===aItems.length-1){bCurrent=true;}if(bCurrent){sLine='<li class="WebCurrentCrumb"';}else{sLine='<li class="WebCrumb_Item"';}sLine=sLine+' data-dfview-name="'+aItems[iItem].sViewName+'">';aHtml.push(sLine);if(this.peBreadcrumbStyle===df.cCrumbHorizontal){if(bCurrent){aHtml.push('<div tabindex="-1">');}else{aHtml.push('<div class="WebCrumb_Arrow" tabindex="-1">');}}aHtml.push('<div class="WebCrumb_Caption" tabindex="-1">');if(aItems[iItem].sCrumbCaption.trim()===""){aHtml.push("&nbsp;");}else{aHtml.push(df.dom.encodeHtml(aItems[iItem].sCrumbCaption));}aHtml.push('</div>');if(this.peBreadcrumbStyle===df.cCrumbHorizontal){aHtml.push('</div>');}aHtml.push('</li>');}this._eList.innerHTML=aHtml.join("");}});df.fpFloatByControl=1;df.fpFloatLeftSqueezeWebApp=2;df.fpFloatLeftPushWebApp=3;df.fpFloatFixed=4;df.fpFloatAbsolute=5;df.WebFloatingPanel=function(sName,oPrnt){df.WebFloatingPanel.base.constructor.apply(this,arguments);this.prop(df.tInt,"piWidth",0);this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piTop",-1);this.prop(df.tInt,"piLeft",-1);this.prop(df.tInt,"piBottom",-1);this.prop(df.tInt,"piRight",-1);this.prop(df.tInt,"piContentWidth",0);this.prop(df.tString,"psFloatByControl","");this.prop(df.tBool,"pbHideOnBlur",false);this.prop(df.tBool,"pbHideOnEscape",false);this.prop(df.tBool,"pbFocusOnShow",false);this.prop(df.tInt,"pePosition",df.fpFloatByControl);this.prop(df.tBool,"pbShrinkIfNoSpace",false);this.prop(df.tBool,"pbNaturalWidth",false);this.event("OnHide");this._eMask=null;this.pbScroll=true;this.pbVisible=false;this._bViewVisible=false;this._bWrapDiv=false;this._bVisible=false;this._bFloating=true;this._sControlClass="WebFlPnl";};df.defineClass("df.WebFloatingPanel","df.WebBaseContainer",{create:function create(){var oView=this.getView();if(oView){oView.OnAfterShow.on(this.showView,this);oView.OnAfterHide.on(this.hideView,this);this._bViewVisible=oView._bShown;}else{this._bViewVisible=true;}df.WebFloatingPanel.base.create.apply(this,arguments);},destroy:function destroy(){var oView=this.getView();if(oView){oView.OnAfterShow.off(this.showView,this);oView.OnAfterHide.off(this.hideView,this);}df.WebFloatingPanel.base.destroy.apply(this,arguments);},render:function render(){var eElem=df.WebFloatingPanel.base.render.apply(this,arguments);document.body.appendChild(eElem);return null;},genClass:function genClass(){var aClasses=[df.WebFloatingPanel.base.genClass.call(this)];if(this.pePosition===df.fpFloatByControl){aClasses.push('WebFP_ArrowTop');aClasses.push('WebFP_FloatBy');}if(this.pePosition===df.fpFloatLeftSqueezeWebApp||this.pePosition===df.fpFloatLeftPushWebApp){aClasses.push("WebFP_FloatLeft");}if(!this.pbVisible){aClasses.push("WebFP_Hidden");}else{aClasses.push("WebFP_Visible");}if(this.piContentWidth>0){aClasses.push("WebFP_FixedContentWidth");}return aClasses.join(" ");},openHtml:function openHtml(aHtml){aHtml.push('<div class="',this.genClass(),'" style="display: none"');if(this.psHtmlId){aHtml.push(' id="',this.psHtmlId,'"');}aHtml.push(' data-dfobj="',this.getLongName(),'"');aHtml.push(' tabindex="0" style=" ',this.pbRender?'':'display: none;','"');aHtml.push('>');aHtml.push('<div tabindex="',this.pbHideOnBlur?'0':'-1','" class="WebFP_FocusCatcher"></div>');aHtml.push('<div class="WebContainer">');df.WebFloatingPanel.base.openHtml.apply(this,arguments);},closeHtml:function closeHtml(aHtml){df.WebFloatingPanel.base.closeHtml.apply(this,arguments);aHtml.push('</div>');aHtml.push('<div tabindex="',this.pbHideOnBlur?'0':'-1','" class="WebFP_FocusCatcher"></div>');aHtml.push('<div class="WebFP_Arrow"></div>');aHtml.push('</div>');},afterRender:function afterRender(){this._eArrow=df.dom.query(this._eElem,"div.WebFP_Arrow");this._aFocusCatchers=df.dom.query(this._eElem,"div.WebFP_FocusCatcher",true);df.WebFloatingPanel.base.afterRender.apply(this,arguments);df.events.addDomCaptureListener("focus",this._eElem,this.onCaptureFocus,this);df.events.addDomCaptureListener("blur",this._eElem,this.onCaptureBlur,this);df.events.addDomKeyListener(this._eElem,this.onKey,this);df.dom.on("focus",this._aFocusCatchers,this.onCatchFocus,this);if(this.piContentWidth>0){this._eSizer.style.width=this.piContentWidth+'px';}if(this.pbVisible&&this._bViewVisible){this.show();}else{this.positionPnl();}},show:function show(){this.pbVisible=true;this.addSync("pbVisible");if(this._bViewVisible){this.doShow();}},doShow:function doShow(){var oObj,that=this;this._bVisible=true;this._eElem.style.display="";if(this._eElem.parentNode.lastChild!==this._eElem){this._eElem.parentNode.appendChild(this._eElem);}if(this.pbHideOnBlur&&df.sys.isMobile||this.pePosition===df.fpFloatLeftPushWebApp){if(!this._eMask){this._eMask=df.dom.create('<div class="WebMenu_Mask">&nbsp;</div>');this._eElem.parentNode.insertBefore(this._eMask,this._eElem);df.dom.on("click",this._eMask,this.onMaskTouch,this);}}if(this.pePosition===df.fpFloatByControl){oObj=this.getWebApp().findObj(this.psFloatByControl);if(oObj&&oObj._eElem){this._eBlurBuddy=oObj._eElem;df.events.addDomCaptureListener("blur",oObj._eElem,this.onCaptureBlur,this);}}this.positionPnl();this.afterShow();if(this._tHideBlurTimeout){clearTimeout(this._tHideBlurTimeout);this._tHideBlurTimeout=null;}df.dom.removeClass(that._eElem,"WebFP_Hidden");df.dom.addClass(that._eElem,"WebFP_Visible");setTimeout(function(){if(that._eElem){that.positionPnl();if(that.pbFocusOnShow){if(!that.focus()){that._eElem.focus();}}}},20);if(this.pePosition===df.fpFloatByControl){this._tPositionInterval=setInterval(function(){that.positionPnl();},500);}},getFloatByRefElem:function getFloatByRefElem(){var oObj,eRef=null;oObj=this.getWebApp().findObj(this.psFloatByControl);if(oObj){eRef=oObj._eElem;if(oObj.getTooltipElem){eRef=oObj.getTooltipElem()||eRef;}}return eRef;},positionPnl:function positionPnl(){var oRect,eRef,iTop=0,iLeft=0,iRight=-1,iArrow=0,iScreenWidth,iScreenHeight,iWidth,iHeight,iActualHeight,oWebApp,bTop=true,iActualWidth;if(this._bVisible&&this._eElem){oWebApp=this.getWebApp();iWidth=this.piWidth;iHeight=this.piHeight;iScreenWidth=df.dom.windowWidth();iScreenHeight=df.dom.windowHeight();iActualHeight=this._eElem.offsetHeight;if(iHeight>iActualHeight){iActualHeight=iHeight;}iActualWidth=this._eElem.offsetWidth;if(this.pePosition===df.fpFloatByControl){if(this.psFloatByControl){eRef=this.getFloatByRefElem();if(eRef){oRect=df.sys.gui.getBoundRect(eRef);if(iWidth<=0&&!this.pbNaturalWidth){iWidth=oRect.width;}iTop=oRect.bottom;iLeft=oRect.left+oRect.width/2-(this.pbNaturalWidth?iActualWidth:iWidth)/2;if(iLeft<5){iLeft=5;}iArrow=oRect.left+oRect.width/2-iLeft;if(!oRect.top&&!oRect.left&&!oRect.width&&!oRect.height){return;}}else{iTop=this.piTop;iLeft=this.piLeft;}}if(iWidth>iScreenWidth-20){iWidth=iScreenWidth-20;}if(iLeft+iWidth>iScreenWidth){iLeft=-1;iRight=10;iArrow=iWidth-(iScreenWidth-oRect.right+oRect.width/2-iRight);}if(iTop+iActualHeight>iScreenHeight){if(!this.pbShrinkIfNoSpace){if(oRect){iTop=Math.max(0,oRect.top-iActualHeight);bTop=false;}}if(iTop+iHeight>iScreenHeight){if(iHeight>0){iHeight=iScreenHeight-iTop-30;}else{iTop=iScreenHeight-iHeight>0?iScreenHeight-iHeight:0;}}}this._eElem.style.top=iTop+"px";this._eElem.style.left=iLeft>=0?iLeft+"px":"";this._eElem.style.right=iRight>=0?iRight+"px":"";this._eArrow.style.left=iArrow+"px";this.setOuterWidth(iWidth);if(iHeight>0){this._eContainer.style.height=iHeight+"px";this._eElem.style.maxHeight="";}else{iHeight=iScreenHeight-iTop-30;this._eContainer.style.height="";this._eElem.style.maxHeight=iHeight+"px";}df.dom.toggleClass(this._eElem,"WebFP_ArrowTop",bTop);df.dom.toggleClass(this._eElem,"WebFP_ArrowBottom",!bTop);}if(this.pePosition===df.fpFloatLeftSqueezeWebApp||this.pePosition===df.fpFloatLeftPushWebApp){this._eElem.style.top=df.Designer?"17px":"0px";this._eElem.style.left="0px";this._eElem.style.bottom="0px";this._eElem.style.position="fixed";this._eContainer.style.height="100%";this.setOuterWidth(this.pbVisible&&this.pbRender?this.piWidth:0);if(oWebApp&&oWebApp._eElem){if(this.pePosition===df.fpFloatLeftSqueezeWebApp){oWebApp._eElem.style.marginLeft=(this.pbVisible&&this.pbRender?this.piWidth:0)+"px";}else{oWebApp._eElem.parentNode.style.overflow="hidden";oWebApp._eElem.style.transform="translateX("+(this.pbVisible&&this.pbRender?this.piWidth:0)+"px)";}}}if(this.pePosition===df.fpFloatFixed){this._eElem.style.top=this.piTop>=0?this.piTop+"px":"";this._eElem.style.left=this.piLeft>=0?this.piLeft+"px":"";this._eElem.style.bottom=this.piBottom>=0?this.piBottom+"px":"";this._eElem.style.right=this.piRight>=0?this.piRight+"px":"";if(iWidth>=0){if(this.pbShrinkIfNoSpace&&iWidth+Math.max(this.piLeft,0)+Math.max(this.piRight,0)>iScreenWidth){iWidth=iScreenWidth-Math.max(this.piLeft,0)-Math.max(this.piRight,0);}this.setOuterWidth(iWidth);}if(iHeight>=0||this.piBottom>=0&&this.piTop>=0){this._eContainer.style.height="100%";}if(iHeight>=0){if(this.pbShrinkIfNoSpace&&iHeight+Math.max(this.piTop,0)+Math.max(this.piBottom,0)>iScreenHeight){iHeight=iScreenHeight-Math.max(this.piTop,0)-Math.max(this.piBottom,0);}this._eElem.style.height=iHeight+"px";this._eElem.style.maxHeight="";}}}else{if(this._eElem){this._eElem.style.top="0px";this._eElem.style.left="0px";this._eElem.style.bottom="";this._eElem.style.right="";this._eElem.style.height="";this._eElem.style.maxHeight="";}}this.resizeHorizontal();df.WebFloatingPanel.base.resizeVertical.call(this);},setInnerHeight:function setInnerHeight(iHeight){if(iHeight>df.dom.clientHeight(this._eContainer)){iHeight=df.dom.clientHeight(this._eContainer);}df.WebFloatingPanel.base.setInnerHeight.call(this,iHeight);},set_piHeight:function set_piHeight(iVal){df.WebFloatingPanel.base.set_piHeight.call(this,iVal);if(this._eElem){this.piHeight=iVal;this.positionPnl();}},set_piWidth:function set_piWidth(iVal){var oWebApp=this.getWebApp();if(this._eElem){this.setOuterWidth(iVal);if(this.pePosition===df.fpFloatLeftSqueezeWebApp){if(this.pbVisible&&this.pbRender&&oWebApp&&oWebApp._eElem){oWebApp._eElem.style.marginLeft=iVal+"px";}}}},set_pbVisible:function set_pbVisible(bVal){if(this._eElem&&this.pbVisible!==bVal){if(bVal){this.show();}else{this.hide(false,"manual");}}},set_pbRender:function set_pbRender(bVal){if(this._eElem&&this.pbRender!==bVal){df.WebFloatingPanel.base.set_pbRender.call(this,bVal);this.pbRender=bVal;if(bVal&&this.pbVisible){this.show();}else{this.hide(false,"manual");}}},set_pePosition:function set_pePosition(iVal){var oWebApp;if(this._eElem&&this.pePosition!==iVal){oWebApp=this.getWebApp();if(oWebApp&&oWebApp._eElem){if(iVal!==df.fpFloatLeftSqueezeWebApp&&this.pePosition===df.fpFloatLeftSqueezeWebApp){oWebApp._eElem.style.marginLeft="";}if(iVal!==df.fpFloatLeftPushWebApp&&this.pePosition===df.fpFloatLeftPushWebApp){oWebApp._eElem.parentNode.style.overflow="";oWebApp._eElem.style.transform="";if(this._eMask){df.dom.off("click",this._eMask,this.onMaskTouch);this._eMask.parentNode.removeChild(this._eMask);this._eMask=null;}}}this.pePosition=iVal;this.positionPnl();}},set_piContentWidth:function set_piContentWidth(iVal){if(this._eContainer){this._eSizer.style.width=iVal+"px";df.dom.toggleClass(this._eElem,"WebFP_FixedContentWidth",iVal>0);}},set_pbHideOnBlur:function set_pbHideOnBlur(bVal){if(this._aFocusCatchers){this._aFocusCatchers.forEach(function(eEl){eEl.tabIndex=bVal?0:-1;});}},hide:function hide(bNoPos,sReason){this.pbVisible=false;this.addSync("pbVisible");this.doHide(bNoPos,sReason||"manual");},doHide:function doHide(bNoPos,sReason){var that=this,oWebApp=this.getWebApp();if(this._tPositionInterval){clearInterval(this._tPositionInterval);this._tPositionInterval=null;}df.dom.addClass(that._eElem,"WebFP_Hidden");df.dom.removeClass(that._eElem,"WebFP_Visible");if(!bNoPos){this.positionPnl();}this.afterHide();if(this._eMask){df.dom.off("click",this._eMask,this.onMaskTouch);this._eMask.parentNode.removeChild(this._eMask);this._eMask=null;}if(this._eBlurBuddy){df.events.removeDomCaptureListener("blur",this._eBlurBuddy,this.onCaptureBlur,this);}if(this.pePosition===df.fpFloatLeftSqueezeWebApp){if(oWebApp&&oWebApp._eElem){oWebApp._eElem.style.marginLeft="0px";}}this.fire("OnHide",[sReason]);setTimeout(function(){if(!that.pbVisible&&that._eElem){that._eElem.style.display="none";that._bVisible=false;}},1500);},showView:function showView(oEvent){this._bViewVisible=true;if(this.pbVisible&&this._eElem){this.doShow();}},hideView:function hideView(oEvent){this._bViewVisible=false;if(this.pbVisible){this.doHide(true,"auto_view");}},onCaptureFocus:function onCaptureFocus(oEvent){if(this._tHideBlurTimeout){clearTimeout(this._tHideBlurTimeout);this._tHideBlurTimeout=null;}},onCaptureBlur:function onCaptureBlur(oEvent){var that=this;if(this._tHideBlurTimeout){clearTimeout(this._tHideBlurTimeout);}this._tHideBlurTimeout=setTimeout(function(){if(that.pbHideOnBlur){that.hide(true,"auto_blur");}that._tHideBlurTimeout=null;},150);},onMaskTouch:function onMaskTouch(oEvent){if(this.pbHideOnBlur){this.hide(false,"auto_blur");}},resizeVertical:function resizeVertical(){this.positionPnl();df.WebFloatingPanel.base.resizeVertical.call(this);},resize:function resize(){if(this._eElem){this.positionPnl();}},onKey:function onKey(oEv){if(oEv.matchKey(df.settings.calendarKeys.close)&&this._bVisible){this.hide(true,"auto_escape");oEv.stop();}},onCatchFocus:function onCatchFocus(oEv){if(this.pbHideOnBlur){this.hide(false,"auto_tabout");}}});df.WebMenuButton=function WebMenuButton(sName,oPrnt){df.WebMenuButton.base.constructor.apply(this,arguments);this.prop(df.tBool,"pbRenderAsAnchor",true);this.prop(df.tBool,"pbHideOnBlur",true);this.prop(df.tString,"psCaption","");this.prop(df.tInt,"piMenuWidth",300);this.prop(df.tInt,"piMenuHeight",0);this.prop(df.tString,"psMenuCSSClass","");this.prop(df.tString,"psMenuRootCaption","");this.prop(df.tBool,"pbMenuShowCaption",true);this.prop(df.tBool,"pbMenuShowIcons",false);this.prop(df.tString,"psGroupName","");this.prop(df.tBool,"pbOpenOnRoot",false);this.pbShowLabel=false;this._oPnl=null;this._oMenuList=null;this._sRealgroupName="";this._bIsMenu=true;this._sControlClass="WebMenuButton";};df.defineClass("df.WebMenuButton","df.WebBaseMenu",{create:function create(){this._sRealgroupName=this.psGroupName;if(!this.psGroupName){this.psGroupName="_WebMenuButtonGrp_"+df.dom.genDomId().toString();}df.WebMenuButton.base.create.apply(this,arguments);},openHtml:function openHtml(aHtml){if(!this.pbRenderAsAnchor){this._sControlClass+=" WebButton";}else{this._sControlClass="WebMenuAnchor";}df.WebMenuButton.base.openHtml.apply(this,arguments);if(this.pbRenderAsAnchor){aHtml.push('<a id="',this._sControlId,'" href="javascript:void(0);"',!this.isEnabled()?' tabindex="-1"':'','></a>');}else{aHtml.push('<button id="',this._sControlId,'"',!this.isEnabled()?' disabled="disabled"':'','></button>');}},afterRender:function afterRender(){this._eControl=df.dom.query(this._eElem,"button, a");df.WebMenuButton.base.afterRender.call(this);df.dom.on("click",this._eControl,this.onBtnClick,this);df.events.addDomKeyListener(this._eElem,this.onKey,this);this.set_psCaption(this.psCaption);},onBtnClick:function onBtnClick(oEvent){if(this.isEnabled()){if(this._oPnl&&this._oPnl.pbVisible){this.hideMenu();}else{this.showMenu();}oEvent.stop();}},showMenu:function showMenu(){var oPnl,oMnu,ePnl;if(!this._oPnl){oPnl=this._oPnl=new df.WebFloatingPanel(null,this);oPnl.psFloatByControl=this.getLongName();oPnl.piWidth=this.piMenuWidth||150;oPnl.piColumnCount=1;oPnl.psCSSClass="WebMBPanel "+this.psMenuCSSClass;oPnl.pbHideOnBlur=this.pbHideOnBlur;oPnl.piHeight=this.piMenuHeight;oPnl.create();oMnu=this._oMenuList=new df.WebMenuList(null,this);oMnu._oMenuBtn=this;oMnu.psGroupName=this.psGroupName;oMnu.pbFillHeight=this.piMenuHeight>0;oMnu.pbShowCaption=this.pbMenuShowCaption;oMnu.pbShowIcons=this.pbMenuShowIcons;oMnu.psRootCaption=this.psMenuRootCaption;oMnu.pbAllowHtml=this.pbAllowHtml;oMnu.create();oPnl.addChild(oMnu);ePnl=oPnl.render();if(ePnl){this._eElem.parentNode.insertBefore(ePnl,this._eElem);}oPnl.afterRender();oPnl.resizeHorizontal();oPnl.resizeVertical();}else if(this.pbOpenOnRoot){this._oMenuList.collapseAll();}this._oPnl.show();},hideMenu:function hideMenu(){this._oPnl.hide();},collapseAll:function collapseAll(){var _this$_oMenuList;(_this$_oMenuList=this._oMenuList)===null||_this$_oMenuList===void 0?void 0:_this$_oMenuList.collapseAll();},levelUp:function levelUp(){var _this$_oMenuList2;(_this$_oMenuList2=this._oMenuList)===null||_this$_oMenuList2===void 0?void 0:_this$_oMenuList2.levelUp();},set_psCaption:function set_psCaption(sVal){if(this._eControl){if(sVal){df.dom.setText(this._eControl,sVal);}else{this._eControl.innerHTML="";}}},set_psGroupName:function set_psGroupName(sVal){this._sRealgroupName=sVal;if(!sVal){sVal=this.psGroupName="_WebMenuButtonGrp_"+df.dom.genDomId().toString();}if(this._oMenuList){this._oMenuList.set("psGroupName",sVal);}df.WebMenuButton.base.set_psGroupName.call(this,sVal);return false;},get_psGroupName:function get_psGroupName(){return this._sRealgroupName;},set_pbMenuShowCaption:function set_pbMenuShowCaption(bVal){if(this._oMenuList){this._oMenuList.set("pbShowCaption",bVal);}},set_pbMenuShowIcons:function set_pbMenuShowIcons(bVal){if(this._oMenuList){this._oMenuList.set("pbShowIcons",bVal);}},set_psMenuRootCaption:function set_psMenuRootCaption(bVal){if(this._oMenuList){this._oMenuList.set("psRootCaption",bVal);}},set_psMenuCSSClass:function set_psMenuCSSClass(sVal){if(this._oPnl){this._oPnl.set("psCSSClass","WebMBPanel "+sVal);}},set_piMenuWidth:function set_piMenuWidth(iVal){if(this._oPnl){this._oPnl.set("piWidth",iVal);}},set_piMenuHeight:function set_piMenuHeight(iVal){if(this._oPnl){this._oMenuList.set("pbFillHeight",iVal>0);this._oPnl.set("piHeight",iVal);}},set_pbHideOnBlur:function set_pbHideOnBlur(iVal){if(this._oPnl){this._oPnl.set("pbHideOnBlur",iVal);}},set_pbAllowHtml:function set_pbAllowHtml(iVal){if(this._oMenuList){this._oMenuList.set("pbAllowHtml",iVal);}},applyEnabled:function applyEnabled(bVal){df.WebMenuButton.base.applyEnabled.call(this,bVal);if(this._eControl){this._eControl.disabled=!bVal;}},onKey:function onKey(oEvent){if(oEvent.matchKey(df.settings.formKeys.submit)){oEvent.stopPropagation();}},resize:function resize(){if(this._oPnl){this._oPnl.resize();}},destroy:function destroy(){if(this._oPnl){this._oPnl.destroy();}df.WebMenuButton.base.destroy.call(this);}});df.WebMenuList=function WebMenuList(sName,oPrnt){df.WebMenuList.base.constructor.apply(this,arguments);this.prop(df.tString,"psRootCaption","");this.prop(df.tBool,"pbShowCaption",true);this.prop(df.tBool,"pbShowBackItem",true);this.prop(df.tBool,"pbShowIcons",false);this._sCurrentMenu="";this._eCurrentMenu=null;this._oMenuBtn=null;this._bIsMenuListener=true;this.pbShowLabel=false;this._bRenderChildren=false;this._sControlClass="WebMenuList";};df.defineClass("df.WebMenuList","df.WebBaseMenu",{openHtml:function openHtml(aHtml){var aMenu;df.WebMenuList.base.openHtml.apply(this,arguments);aHtml.push('<div class="WebMenuWrp" tabindex="0">','<div class="WebML_Title"',this.pbShowCaption?'':' style="display: none"','>','<span class="WebML_Caption">',this.psRootCaption,'</span>','</div>','<div class="WebML_Panel',this.pbShowIcons?' WebML_ShowIcons':'','">','<div class="WebML_Mnu WebML_Root WebML_Current" data-dfmenu-path="">');aMenu=this.getMenu();this.genMenuHtml(aHtml,aMenu,false);aHtml.push('</div>','</div>');},closeHtml:function closeHtml(aHtml){aHtml.push('</div>');df.WebMenuList.base.closeHtml.apply(this,arguments);},afterRender:function afterRender(){var eMnu,ePnl;this._eControl=df.dom.query(this._eElem,"div.WebMenuWrp");this._eMenuPanel=ePnl=df.dom.query(this._eElem,"div.WebML_Panel");this._eMenuTitle=df.dom.query(this._eElem,"div.WebML_Title");this._eMenuCaption=df.dom.query(this._eElem,"span.WebML_Caption");eMnu=this._eCurrentMenu=df.dom.query(ePnl,"div.WebML_Mnu");df.WebMenuList.base.afterRender.apply(this,arguments);df.dom.on("click",ePnl,this.onMenuClick,this);if(this.piHeight<=0&&!this.pbFillHeight){df.dom.animFrame(function(){if(eMnu.firstChild){ePnl.style.height=this.getMenuHeight(this._eCurrentMenu)+"px";this.sizeChanged();}},this);}},genMenuHtml:function genMenuHtml(aHtml,aMenu,bSub){var i,aClasses,tItem;aHtml.push('<ul>');if(bSub&&this.pbShowBackItem){aHtml.push('<li class="WebML_Item WebML_Back" data-df-path="go-back"><a href="javascript:void(0);">',this.getWebApp().getTrans("back"),'</a></li>');}for(i=0;i<aMenu.length;i++){tItem=aMenu[i];aClasses=["WebML_Item",tItem.sCSSClass,tItem.bEnabled?df.CssEnabled:df.CssDisabled];if(tItem.aChildren.length>0){aClasses.push("WebML_HasSub");}if(tItem.bBeginGroup){aHtml.push('<li class="WebML_Divider">',tItem.sGroupCaption||"",'</li>');}this.genItemHtml(aHtml,tItem,false);}aHtml.push('</ul>');},onMenuClick:function onMenuClick(oEvent){var sID=null,tItem,eElem=oEvent.getTarget(),eMnu,ePrnt,aHtml,that=this;while(!tItem&&eElem&&eElem!==this._eElem){if(eElem.hasAttribute("data-df-path")){sID=eElem.getAttribute("data-df-path");if(sID==="go-back"){this.levelUp();oEvent.stop();return;}tItem=this.getItemByPath(sID);}else{eElem=eElem.parentNode;}}if(tItem){if(tItem.bEnabled){if(tItem.aChildren.length>0){eMnu=df.dom.query(this._eMenuPanel,'div.WebML_Mnu[data-dfmenu-path="'+tItem._sPath+'"]');if(!eMnu){aHtml=[];aHtml.push('<div class="WebML_Mnu WebML_HiddenSub" data-dfmenu-path="',tItem._sPath,'">');this.genMenuHtml(aHtml,tItem.aChildren,true);aHtml.push('</div>');eMnu=df.dom.create(aHtml.join(""));this._eMenuPanel.appendChild(eMnu);}ePrnt=this._eCurrentMenu;df.dom.setText(this._eMenuCaption,tItem.sCaption);setTimeout(function fTimeout(){if(ePrnt){df.dom.addClass(ePrnt,"WebML_HiddenParent");df.dom.removeClass(ePrnt,"WebML_Current");}df.dom.addClass(eMnu,"WebML_Current");df.dom.removeClass(eMnu,"WebML_HiddenSub");that.OnUiUpdate.fire(this,{bUiDriven:true});that.updateMenuSize();},20);this._sCurrentMenu=tItem._sPath;this._eCurrentMenu=eMnu;}tItem._oHandler.itemClick(tItem,function(bExec){if(bExec&&this._oMenuBtn&&!(tItem.hRef instanceof df.WebMenuItemCheckbox)){this._oMenuBtn.hideMenu();}},this);}oEvent.stop();}},expandItem:function expandItem(tItem){if(tItem.aChildren.length>0){this._sCurrentMenu=tItem._sPath;}else{this._sCurrentMenu="";}this.refreshMenu();this.OnUiUpdate.fire(this,{bUiDriven:true});},showItem:function showItem(tItem){var tParent=this.getItemByPath(tItem._sPath.substr(0,tItem._sPath.lastIndexOf(".")));if(tParent){this.expandItem(tParent);}else{this._sCurrentMenu="";this.refreshMenu();}},collapseAll:function collapseAll(){this._sCurrentMenu="";this.refreshMenu();this.OnUiUpdate.fire(this,{bUiDriven:true});},levelUp:function levelUp(){var eMnu,eSub,tItem=null,aMenu,aHtml,that=this;if(this._sCurrentMenu){if(this._sCurrentMenu.indexOf(".")>0){this._sCurrentMenu=this._sCurrentMenu.substr(0,this._sCurrentMenu.lastIndexOf("."));tItem=this.getItemByPath(this._sCurrentMenu);}if(tItem){aMenu=tItem.aChildren;}else{this._sCurrentMenu="";aMenu=this.getMenu();}eMnu=df.dom.query(this._eMenuPanel,'div.WebML_Mnu[data-dfmenu-path="'+this._sCurrentMenu+'"]');if(!eMnu){aHtml=[];aHtml.push('<div class="WebML_Mnu WebML_HiddenParent',aMenu===this.getMenu()?' WebML_Root':'','" data-dfmenu-path="',this._sCurrentMenu,'">');this.genMenuHtml(aHtml,aMenu,!!this._sCurrentMenu);aHtml.push('</div>');eMnu=df.dom.create(aHtml.join(""));this._eMenuPanel.appendChild(eMnu);}eSub=this._eCurrentMenu;if(tItem){df.dom.setText(this._eMenuCaption,tItem.sCaption);}else{df.dom.setText(this._eMenuCaption,this.psRootCaption);}setTimeout(function fTimeout(){if(eSub){df.dom.addClass(eSub,"WebML_HiddenSub");df.dom.removeClass(eSub,"WebML_Current");}df.dom.addClass(eMnu,"WebML_Current");df.dom.removeClass(eMnu,"WebML_HiddenParent");that.OnUiUpdate.fire(this,{bUiDriven:true});that.updateMenuSize();},20);this._eCurrentMenu=eMnu;}},refreshMenu:function refreshMenu(){var tItem,aMenu,aHtml=[],eMnu;if(this._eMenuPanel){if(this._sCurrentMenu){tItem=this.getItemByPath(this._sCurrentMenu);}if(tItem){aMenu=tItem.aChildren;}else{this._sCurrentMenu="";aMenu=this.getMenu();}aHtml.push('<div class="WebML_Mnu WebML_Current',aMenu===this.getMenu()?' WebML_Root':'','" data-dfmenu-path="',this._sCurrentMenu,'">');this.genMenuHtml(aHtml,aMenu,!!this._sCurrentMenu);aHtml.push('</div>');this._eMenuPanel.innerHTML=aHtml.join("");eMnu=this._eMenuPanel.firstChild;if(tItem){df.dom.setText(this._eMenuCaption,tItem.sCaption);}else{df.dom.setText(this._eMenuCaption,this.psRootCaption);}this._eCurrentMenu=eMnu;this.updateMenuSize();}},updateMenuSize:function updateMenuSize(bNoSizeChanged){var iHeight;if(!this.pbFillHeight&&this.piHeight<=0&&this._eCurrentMenu){iHeight=this.getMenuHeight(this._eCurrentMenu);this._eMenuPanel.style.height=iHeight+"px";if(!bNoSizeChanged){this.sizeChanged();}df.dom.animFrame(function(){var iNewHeight;if(this._eCurrentMenu){iNewHeight=this.getMenuHeight(this._eCurrentMenu);if(iNewHeight!==iHeight){this._eMenuPanel.style.height=iNewHeight+"px";this.sizeChanged();}}},this);}},setHeight:function setHeight(iHeight){if(this._eMenuPanel){df.dom.toggleClass(this._eMenuPanel,"WebML_NoScollRoot",iHeight<=0);if(iHeight<=0&&this._eCurrentMenu){this._eMenuPanel.style.height=this.getMenuHeight(this._eCurrentMenu)+"px";}else{if(iHeight<=80){iHeight=80;}iHeight-=this.getVertHeightDiff();iHeight=iHeight<0?0:iHeight;this._eMenuPanel.style.height=iHeight+"px";}}},getVertHeightDiff:function getVertHeightDiff(){var _this$_eMenuTitle;var iResult=df.WebMenuList.base.getVertHeightDiff.call(this);iResult+=(_this$_eMenuTitle=this._eMenuTitle)===null||_this$_eMenuTitle===void 0?void 0:_this$_eMenuTitle.offsetHeight;iResult+=df.sys.gui.getVertBoxDiff(this._eMenuPanel);return iResult;},getMenuHeight:function getMenuHeight(eElem){var iHeight=eElem.firstChild.offsetHeight;iHeight+=df.sys.gui.getVertBoxDiff(eElem);return iHeight;},resize:function resize(){this.updateMenuSize(true);df.WebMenuList.base.resize.call(this);},set_pbShowIcons:function set_pbShowIcons(bVal){if(this._eMenuPanel){df.dom.toggleClass(this._eMenuPanel,"WebML_ShowIcons",bVal);}},set_psRootCaption:function set_psRootCaption(sVal){this.psRootCaption=sVal;this.refreshMenu();},set_pbShowBackItem:function set_pbShowBackItem(bVal){this.pbShowBackItem=bVal;this.refreshMenu();},set_pbShowCaption:function set_pbShowCaption(bVal){if(this._eMenuTitle){this._eMenuTitle.style.display=bVal?"":"none";}}});df.colorFormatHex=1;df.colorFormatRGB=2;df.settings.colorPickKeys={colorUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},colorDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},colorLeft:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},colorRight:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false},sliderUp:{iKeyCode:33,bCtrl:false,bShift:false,bAlt:false},sliderDown:{iKeyCode:34,bCtrl:false,bShift:false,bAlt:false},enter:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false}};df.tWebColorPaletteItem={sColor:df.tString,sDescription:df.tString};df.WebColorPicker=function WebColorPicker(sName,oParent){df.WebColorPicker.base.constructor.apply(this,arguments);this.prop(df.tBool,"pbShowColorBar",true);this.prop(df.tInt,"peColorFormat",df.colorFormatHex);this.prop(df.tInt,"piPaletteItemsPerRow",6);this.prop(df.tString,"psValue","#A53D40");this.event("OnChange");this.OnRealtimeChange=new df.events.JSHandler();this.OnEnter=new df.events.JSHandler();this._tDoubleClick=null;this._iDoubleClickWait=800;this._aHSV=[0,0,0];this._aColorPalette=[];this._sControlClass="WebColorPicker";};df.defineClass("df.WebColorPicker","df.WebBaseControl",{create:function create(tDef){df.WebColorPicker.base.create.apply(this,arguments);this.set_psValue(this.psValue);},openHtml:function openHtml(aHtml){var aMainClasses=['WebCP_Main'];df.WebColorPicker.base.openHtml.call(this,aHtml);if(this.pbShowColorBar){aMainClasses.push('WebCP_ShowColorBar');}if(this._aColorPalette.length>0){aMainClasses.push('WebCP_ShowPalette');}aHtml.push('<div class="',aMainClasses.join(' '),'" tabindex="0">','<div class="WebCP_ColorPalette">');this.genColorPaletteHtml(aHtml);aHtml.push('</div>','<div class="WebCP_Picker">','<div class="WebCP_ColorMap">','<canvas width="0" height="0"></canvas>','<div class="WebCP_Pointer"></div>','</div>','<div class="WebCP_GradSlider">','<canvas width="0" height="0"></canvas>','<div class="WebCP_Slide"></div>','</div>','</div>','<div class="WebCP_ColorBar"></div>','<div>');},closeHtml:function closeHtml(aHtml){df.WebColorPicker.base.closeHtml.call(this,aHtml);},afterRender:function afterRender(){this._eFocus=this._eControl=df.dom.query(this._eElem,".WebCP_Main");this._ePicker=df.dom.query(this._eElem,'.WebCP_Picker');this._eColorPalette=df.dom.query(this._eElem,'.WebCP_ColorPalette');this._eColorMap=df.dom.query(this._eElem,".WebCP_ColorMap");this._eMapCanvas=df.dom.query(this._eElem,".WebCP_ColorMap canvas");this._ePointer=df.dom.query(this._eElem,".WebCP_Pointer");this._eGradSlider=df.dom.query(this._eElem,".WebCP_GradSlider");this._eSliderCanvas=df.dom.query(this._eElem,".WebCP_GradSlider canvas");this._eSlide=df.dom.query(this._eElem,".WebCP_Slide");this._eColorBar=df.dom.query(this._eElem,".WebCP_ColorBar");df.WebColorPicker.base.afterRender.call(this);df.dom.on("mousedown",this._eColorMap,this.startMapMouse,this);df.dom.on("mousedown",this._eGradSlider,this.startSliderMouse,this);df.dom.on("click",this._eColorPalette,this.onPaletteClick,this);df.dom.on("dblclick",this._eColorPalette,this.onPaletteDblClick,this);df.events.addDomKeyListener(this._eFocus,this.onKey,this);df.events.addDomMouseWheelListener(this._eFocus,this.onMouseWheelScroll,this);this._eColorBar.style.backgroundColor=this.psValue;df.dom.setText(this._eColorBar,this.psValue);},resize:function resize(){var iPalOffset=0;if(this._aColorPalette.length>0){iPalOffset+=this._eColorPalette.offsetHeight;}this._ePicker.style.top=iPalOffset+"px";df.WebColorPicker.base.resize.call(this);if(this._eControl.clientHeight){if(this._eMapCanvas.width!==this._eColorMap.clientWidth||this._eMapCanvas.height!==this._eColorMap.clientHeight){this.drawColorMap();this.positionPointer();}if(this._eSliderCanvas.width!==this._eGradSlider.clientWidth||this._eSliderCanvas.height!==this._eGradSlider.clientHeight){this.drawGradientSlider();}}},drawColorMap:function drawColorMap(){var eCanvas=this._eMapCanvas,ctx,hGrad,vGrad;eCanvas.width=this._eColorMap.clientWidth;eCanvas.height=this._eColorMap.clientHeight;if(!this._mainctx){this._mainctx=eCanvas.getContext('2d');}ctx=this._mainctx;ctx.clearRect(0,0,eCanvas.width,eCanvas.height);hGrad=ctx.createLinearGradient(0,0,eCanvas.width,0);hGrad.addColorStop(0,'#F00');hGrad.addColorStop(1/6,'#FF0');hGrad.addColorStop(2/6,'#0F0');hGrad.addColorStop(3/6,'#0FF');hGrad.addColorStop(4/6,'#00F');hGrad.addColorStop(5/6,'#F0F');hGrad.addColorStop(1,'#F00');ctx.fillStyle=hGrad;ctx.fillRect(0,0,eCanvas.width,eCanvas.height);vGrad=ctx.createLinearGradient(0,0,0,eCanvas.height);vGrad.addColorStop(0,'rgba(255,255,255,0)');vGrad.addColorStop(1,'rgba(255,255,255,1)');ctx.fillStyle=vGrad;ctx.fillRect(0,0,eCanvas.width,eCanvas.height);},positionPointer:function positionPointer(){var iX=0,iY=0,aHSV=this.getHSV();iX=aHSV[0]*this._eMapCanvas.width;iY=(1-aHSV[1])*this._eMapCanvas.height;iX-=this._ePointer.offsetWidth/2;iY-=this._ePointer.offsetHeight/2;this._ePointer.style.left=Math.round(iX)+"px";this._ePointer.style.top=Math.round(iY)+"px";},drawGradientSlider:function drawGradientSlider(){var eCanvas=this._eSliderCanvas,ctx,vGrad,aHSV,aRGB;eCanvas.width=this._eGradSlider.clientWidth;eCanvas.height=this._eGradSlider.clientHeight;if(!this._sliderctx){this._sliderctx=eCanvas.getContext('2d');}ctx=this._sliderctx;ctx.clearRect(0,0,eCanvas.width,eCanvas.height);aHSV=this.getHSV();aHSV[2]=1;aRGB=this.HSVtoRGB(aHSV);vGrad=ctx.createLinearGradient(0,0,0,eCanvas.height);vGrad.addColorStop(0,this.RGBtoHexString(aRGB));vGrad.addColorStop(1,'#000000');ctx.fillStyle=vGrad;ctx.fillRect(0,0,eCanvas.width,eCanvas.height);this.positionSlider();},positionSlider:function positionSlider(){var iY=0,aHSV=this.getHSV();iY=(1-aHSV[2])*this._eSliderCanvas.height;iY-=Math.round(this._eSlide.offsetHeight/2);this._eSlide.style.top=iY+"px";},addPaletteItem:function addPaletteItem(sColor,sDescription){var aHtml=[];this._aColorPalette.push({sColor:sColor,sDescription:sDescription});if(this._eElem){this.genColorPaletteHtml(aHtml);this._eColorPalette.innerHTML=aHtml.join("");this.sizeChanged();}},updatePalette:function updatePalette(){var aHtml=[];this._aColorPalette=this.deserializeVT(this._tActionData);if(this._eElem){this.genColorPaletteHtml(aHtml);this._eColorPalette.innerHTML=aHtml.join("");df.dom.toggleClass(this._eControl,"WebCP_ShowPalette",this._aColorPalette.length>0);this.sizeChanged();}},genColorPaletteHtml:function genColorPaletteHtml(aHtml){var i,aPal=this._aColorPalette,sC;if(aPal.length>0){aHtml.push('<table class="WebCP_Palette"><colgroup>');for(i=0;i<this.piPaletteItemsPerRow;i++){aHtml.push('<col style="width: ',Math.floor(1000/this.piPaletteItemsPerRow)/10,'%">');}aHtml.push('</colgroup><tr>');for(i=0;i<aPal.length;i++){sC=this.RGBtoHexString(this.stringToRGB(aPal[i].sColor));if(i%this.piPaletteItemsPerRow===0&&i>0){aHtml.push('</tr><tr>');}aHtml.push('<td class="WebCP_PalColor" style="background-color: ',sC,'" data-palcolor="',sC,'" title="',aPal[i].sDescription,'"></td>');}aHtml.push('</tr></table>');}},onPaletteClick:function onPaletteClick(oEv){var aHSV,eEl=oEv.getTarget(),sPrevColor=this.psValue;if(!this.isEnabled()){return;}while(eEl&&eEl!==this._eColorPalette){if(eEl.hasAttribute("data-palcolor")){aHSV=this.RGBtoHSV(this.stringToRGB(eEl.getAttribute("data-palcolor")));this.setHSV(aHSV);this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:sPrevColor});return;}eEl=eEl.parentNode;}},onPaletteDblClick:function onPaletteDblClick(oEv){var aHSV,eEl=oEv.getTarget();if(!this.isEnabled()){return;}while(eEl&&eEl!==this._eColorPalette){if(eEl.hasAttribute("data-palcolor")){aHSV=this.RGBtoHSV(this.stringToRGB(eEl.getAttribute("data-palcolor")));this.setHSV(aHSV);this.OnEnter.fire(this,{sColor:this.psValue});oEv.stop();return;}eEl=eEl.parentNode;}},startMapMouse:function startMapMouse(oEv){var eMask,oRect,iX,iY,aHSV=this.getHSV(),that=this;if(!this.isEnabled()){return;}if(this._tDoubleClick){this.OnEnter.fire(this,{sColor:this.psValue});clearTimeout(this._tDoubleClick);this._tDoubleClick=null;oEv.stop();return;}this._tDoubleClick=setTimeout(function(){that._tDoubleClick=null;},this._iDoubleClickWait);eMask=df.gui.dragMask();eMask.style.cursor="crosshair";oRect=df.sys.gui.getBoundRect(this._eMapCanvas);iX=oEv.getMouseX()-oRect.left;iY=oEv.getMouseY()-oRect.top;function updateColor(){var sPrevColor=this.psValue;aHSV[0]=iX/oRect.width;aHSV[1]=1-iY/oRect.height;this.setHSV(aHSV,true);this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:sPrevColor});}function onDrag(oEv){iX=Math.min(Math.max(oEv.getMouseX()-oRect.left,0),oRect.width);iY=Math.min(Math.max(oEv.getMouseY()-oRect.top,0),oRect.height);updateColor.call(this);}function onStopDrag(oEv){this.fire("OnChange",[this.psValue]);this.focus();df.dom.off("mouseup",eMask,onStopDrag);df.dom.off("mouseup",window,onStopDrag);df.dom.off("mousemove",eMask,onDrag);if(eMask&&eMask.parentNode){eMask.parentNode.removeChild(eMask);}}df.dom.on("mousemove",eMask,onDrag,this);df.dom.on("mouseup",window,onStopDrag,this);df.dom.on("mouseup",eMask,onStopDrag,this);oEv.stop();updateColor.call(this);},startSliderMouse:function startSliderMouse(oEv){var eMask,oRect,iY,aHSV=this.getHSV(),that=this;if(!this.isEnabled()){return;}if(this._tDoubleClick){this.OnEnter.fire(this,{sColor:this.psValue});clearTimeout(this._tDoubleClick);this._tDoubleClick=null;return;}this._tDoubleClick=setTimeout(function(){that._tDoubleClick=null;},this._iDoubleClickWait);eMask=df.gui.dragMask();eMask.style.cursor="n-resize";oRect=df.sys.gui.getBoundRect(this._eSliderCanvas);iY=oEv.getMouseY()-oRect.top;function updateColor(){var sPrevColor=this.psValue;aHSV[2]=1-iY/oRect.height;this.setHSV(aHSV,false);this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:sPrevColor});}function onDrag(oEv){iY=Math.min(Math.max(oEv.getMouseY()-oRect.top,0),oRect.height);updateColor.call(this);}function onStopDrag(oEv){this.fire("OnChange",[this.psValue]);this.focus();df.dom.off("mouseup",eMask,onStopDrag);df.dom.off("mouseup",window,onStopDrag);df.dom.off("mousemove",eMask,onDrag);if(eMask&&eMask.parentNode){eMask.parentNode.removeChild(eMask);}}df.dom.on("mousemove",eMask,onDrag,this);df.dom.on("mouseup",window,onStopDrag,this);df.dom.on("mouseup",eMask,onStopDrag,this);oEv.stop();updateColor.call(this);},adjustColor:function adjustColor(iType,iVal){var aHSV=this.getHSV(),sPrevColor=this.psColor;aHSV[iType]=Math.max(0,Math.min(1,aHSV[iType]+iVal/20));this.setHSV(aHSV,iType!==2);this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:sPrevColor});this.fire("OnChange",[this.psValue]);},onMouseWheelScroll:function onMouseWheelScroll(oEvent){var iDelta=oEvent.getMouseWheelDelta();if(!this.isEnabled()){return;}if(iDelta>0){this.adjustColor(2,1);}else if(iDelta<0){this.adjustColor(2,-1);}oEvent.stop();},onKey:function onKey(oEvent){var dDate=this._dSelected;if(this.isEnabled()){if(oEvent.matchKey(df.settings.colorPickKeys.colorUp)){this.adjustColor(1,1);oEvent.stop();}else if(oEvent.matchKey(df.settings.colorPickKeys.colorDown)){this.adjustColor(1,-1);oEvent.stop();}else if(oEvent.matchKey(df.settings.colorPickKeys.colorLeft)){this.adjustColor(0,-1);oEvent.stop();}else if(oEvent.matchKey(df.settings.colorPickKeys.colorRight)){this.adjustColor(0,1);oEvent.stop();}else if(oEvent.matchKey(df.settings.colorPickKeys.sliderUp)){this.adjustColor(2,1);oEvent.stop();}else if(oEvent.matchKey(df.settings.colorPickKeys.sliderDown)){this.adjustColor(2,-1);oEvent.stop();}else if(oEvent.matchKey(df.settings.colorPickKeys.enter)){this.OnEnter.fire(this,{sColor:this.psValue});}}},set_psValue:function set_psValue(sV){var aHSV,aRGB;aRGB=this.stringToRGB(sV);aHSV=this.RGBtoHSV(aRGB);if(this._aHSV[0]!==aHSV[0]||this._aHSV[1]!==aHSV[1]||this._aHSV[2]!==aHSV[2]){this.setHSV(aHSV,true);}},set_pbShowColorBar:function set_pbShowColorBar(bVal){if(this._eColorBar){df.dom.toggleClass(this._eControl,"WebCP_ShowColorBar",bVal);this.drawColorMap();this.drawGradientSlider();}},getHSV:function getHSV(){return this._aHSV.slice();},setHSV:function setHSV(aHSV,bUpdateGradient){var aRGB;this._aHSV=aHSV;aRGB=this.HSVtoRGB(aHSV);if(this.peColorFormat===df.colorFormatHex){this.psValue=this.RGBtoHexString(aRGB);}else{this.psValue=this.RGBtoRgbString(aRGB);}if(this._eControl){if(this._eColorBar){this._eColorBar.style.backgroundColor=this.psValue;df.dom.setText(this._eColorBar,this.psValue);}this.positionPointer();if(bUpdateGradient){this.drawGradientSlider();}else{this.positionSlider();}}},RGBtoHSV:function RGBtoHSV(rgb){var r,g,b,h,s,v,max,min,d;r=rgb[0]/255;g=rgb[1]/255;b=rgb[2]/255;max=Math.max(r,g,b);min=Math.min(r,g,b);v=max;d=max-min;s=max===0?0:d/max;if(max===min){h=0;}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return[h,s,v];},HSVtoRGB:function HSVtoRGB(hsv){var r,g,b,h=hsv[0],s=hsv[1],v=hsv[2],i,f,p,q,t;i=Math.floor(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);switch(i%6){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break;}return[Math.round(r*255),Math.round(g*255),Math.round(b*255)];},RGBtoHexString:function RGBtoHexString(aRGB){var sV="#",i;for(i=0;i<aRGB.length;i++){sV+=df.sys.math.padZero(Math.round(aRGB[i]).toString(16),2);}return sV;},hexStringToRGB:function hexStringToRGB(sColor){if(sColor.length===7){return[parseInt(sColor.substr(1,2),16),parseInt(sColor.substr(3,2),16),parseInt(sColor.substr(5,2),16)];}if(sColor.length===4){return[parseInt(sColor.substr(1,1)+sColor.substr(1,1),16),parseInt(sColor.substr(2,1)+sColor.substr(2,1),16),parseInt(sColor.substr(3,1)+sColor.substr(3,1),16)];}return[0,0,0];},RGBtoRgbString:function RGBtoRgbString(aRGB){return"rgb("+aRGB.join(",")+")";},rgbStringToRGB:function rgbStringToRGB(sColor){var aRGB,i;sColor=sColor.substr(4);if(sColor.charAt(sColor.length-1)===';'){sColor.substr(0,sColor.length-1);}if(sColor.charAt(sColor.length-1)===')'){sColor.substr(0,sColor.length-1);}aRGB=sColor.split(",");if(aRGB.length===3){for(i=0;i<3;i++){aRGB[i]=Math.max(0,Math.min(255,parseInt(aRGB[i],10)));}return aRGB;}return[0,0,0];},stringToRGB:function stringToRGB(sColor){var aRGB=[0,0,0];if(sColor.substr(0,1)==="#"){aRGB=this.hexStringToRGB(sColor);}else if(sColor.substr(0,4).toLowerCase()==="rgb("){aRGB=this.rgbStringToRGB(sColor);}return aRGB;},deserializeVT:df.sys.vt.generateDeserializer([df.tWebColorPaletteItem])});df.WebColorForm=function WebColorForm(sName,oParent){df.WebColorForm.base.constructor.apply(this,arguments);this.prop(df.tInt,"piPickWidth",300);this.prop(df.tInt,"piPickHeight",250);this.prop(df.tInt,"piPaletteItemsPerRow",8);this.prop(df.tInt,"peColorFormat",df.colorFormatHex);this.prop(df.tBool,"pbColorBackground",false);this.prop(df.tBool,"pbAutoShow",false);this.pbPromptButton=true;this._sControlClass="WebForm WebColorForm";};df.defineClass("df.WebColorForm","df.WebForm",{afterRender:function afterRender(){df.WebColorForm.base.afterRender.call(this);df.dom.toggleClass(this._eWrap,"WebCF_ShowBox",!this.pbColorBackground);this._eColorBox=df.dom.create('<div class="WebCF_Box"></div>');this._eWrap.insertBefore(this._eColorBox,this._eWrap.firstChild);df.dom.on("click",this._eColorBox,this.onColorClick,this);this.refreshDisplay(this._tValue);},initPicker:function initPicker(){var oPnl,oPicker;oPnl=this._oFloatingPanel=new df.WebFloatingPanel(null,this);oPnl.psFloatByControl=this.getLongName();oPnl.piWidth=this.piPickWidth;oPnl.piHeight=this.piPickHeight;oPnl.piColumnCount=1;oPnl.pbHideOnBlur=true;oPnl.pbFocusOnShow=true;oPnl.pbHideOnEscape=true;oPnl.psCSSClass="NoWitespace Shadow WebColorForm_FlPnl";oPnl.OnHide.addListener(this.onPanelClose,this);oPnl.create();oPicker=this._oColorPicker=new df.WebColorPicker(null,this);oPicker.psValue=this.getServerVal();oPicker.piColumnSpan=0;oPicker.pbFillHeight=true;oPicker.pbShowLabel=false;oPicker.pbShowColorBar=false;oPicker.peColorFormat=this.peColorFormat;oPicker.psCSSClass="WebColorPicker_Form";oPicker.piPaletteItemsPerRow=this.piPaletteItemsPerRow;oPicker.OnRealtimeChange.addListener(this.onPickerChange,this);oPicker.OnEnter.addListener(this.onPickerEnter,this);oPicker.create();oPnl.addChild(oPicker);},destroy:function destroy(){if(this._oFloatingPanel){this._oFloatingPanel.destroy();}df.WebColorForm.base.destroy.call(this);},renderPicker:function renderPicker(){var ePnl,oPnl=this._oFloatingPanel;ePnl=oPnl.render();if(ePnl){this._eElem.parentNode.insertBefore(ePnl,this._eElem);}oPnl.afterRender();oPnl.resizeHorizontal();oPnl.resizeVertical();},firePrompt:function firePrompt(){this.showPicker();},showPicker:function showPicker(){if(!this._oFloatingPanel){this.initPicker();}if(!this._oFloatingPanel._eElem){this.renderPicker();}this._oColorPicker.set("psValue",this.getServerVal());this._oFloatingPanel.show();},onColorClick:function onColorClick(oEvent){if(this.isEnabled()){this.showPicker();}},onPickerChange:function onPickerChange(oEvent){this._tValue=oEvent.sColor;this.refreshDisplay(oEvent.sColor);},onPickerEnter:function onPickerEnter(oEvent){this._tValue=oEvent.sColor;this.refreshDisplay(oEvent.sColor);this._oFloatingPanel.hide();this.focus();this.fireChange();},onPanelClose:function onPanelClose(oEvent){var sReason=oEvent.aParams[0];this.fireChange();if(sReason!=="auto_blur"){this._bSkipAutoShow=true;this.focus();}},onPickerClose:function onPickerClose(oEvent){this._oFloatingPanel.hide();},set_pbColorBackground:function set_pbColorBackground(bVal){this.set_psBackgroundColor(bVal?this.getServerVal():"");if(this._eWrap){df.dom.toggleClass(this._eWrap,"WebCF_ShowBox",!bVal);}},setControlValue:function setControlValue(sVal){df.WebColorForm.base.setControlValue.call(this,sVal);if(this.pbColorBackground){this.set_psBackgroundColor(sVal);}if(this._eColorBox){this._eColorBox.style.backgroundColor=sVal;}},set_piPickHeight:function set_piPickHeight(iVal){if(this._oFloatingPanel){this._oFloatingPanel.set("piHeight",iVal);}},set_piPickWidth:function set_piPickWidth(iVal){if(this._oFloatingPanel){this._oFloatingPanel.set("piWidth",iVal);}},set_piPaletteItemsPerRow:function set_piPaletteItemsPerRow(iVal){if(this._oColorPicker){this._oColorPicker.set("piPaletteItemsPerRow",iVal);}},addPaletteItem:function addPaletteItem(sColor,sDescription){if(!this._oFloatingPanel){this.initPicker();}this._oColorPicker.addPaletteItem(sColor,sDescription);},updatePalette:function updatePalette(){if(!this._oFloatingPanel){this.initPicker();}this._oColorPicker._tActionData=this._tActionData;this._oColorPicker.updatePalette();this._oColorPicker._tActionData=null;},onFocus:function onFocus(oEvent){df.WebColorForm.base.onFocus.call(this,oEvent);if(this.pbAutoShow&&this.isEnabled()&&!this.pbReadOnly&&!this._bSkipAutoShow){this.showPicker();}this._bSkipAutoShow=false;}});df.WebColumnHighlight=function WebColumnHighlight(sName,oParent){df.WebColumnHighlight.base.constructor.apply(this,arguments);this.prop(df.tString,"psHighlightCSSClass","WebHighlight");this.prop(df.tString,"psHighlight","");this.prop(df.tBool,"pbFullText",true);this.prop(df.tBool,"pbSeparateWords",true);this.prop(df.tBool,"pbCaseSensitive",false);this._oRegEx=null;};df.defineClass("df.WebColumnHighlight","df.WebColumnBase",{cellHtml:function cellHtml(tCell){var tVal,oRegEx,sVal,sCssClass=this.psHighlightCSSClass;tVal=df.sys.data.serverToType(tCell.sValue,this.peDataType);sVal=this.typeToDisplay(tVal);if(!this.pbAllowHtml){sVal=df.dom.encodeHtml(sVal);}if(this.psHighlight){oRegEx=this.getRegEx();sVal=sVal.replace(oRegEx,function(match){return'<span class="'+sCssClass+'">'+match+'</span>';});}return sVal!==''?sVal:'&nbsp;';},set_psHighlight:function set_psHighlight(sVal){if(this.psHighlight!==sVal){this.psHighlight=sVal;this._oRegEx=null;}},set_psHighlightCSSClass:function set_psHighlightCSSClass(sVal){this.psHighlightCSSClass=sVal;this._oParent.redraw();},set_pbFullText:function set_pbFullText(bVal){this.pbFullText=bVal;this._oRegEx=null;this._oParent.redraw();},set_pbSeparateWords:function set_pbSeparateWords(bVal){this.pbSeparateWords=bVal;this._oRegEx=null;this._oParent.redraw();},set_pbCaseSensitive:function set_pbCaseSensitive(bVal){this.pbCaseSensitive=bVal;this._oRegEx=null;this._oParent.redraw();},getRegEx:function getRegEx(){var aHighlights,sRegex,i,sMod;if(!this._oRegEx){if(this.pbSeparateWords){aHighlights=this.psHighlight.split(" ");}else{aHighlights=[this.psHighlight];}for(i=0;i<aHighlights.length;i++){aHighlights[i]=df.sys.data.escapeRegExp(aHighlights[i]);}sRegex="("+aHighlights.join("|")+")";if(!this.pbFullText){sRegex="^"+sRegex;}sMod="g";if(!this.pbCaseSensitive){sMod+="i";}this._oRegEx=new RegExp(sRegex,sMod);}return this._oRegEx;}});df.WebAccordionContainer=function(sName,oPrnt){df.WebAccordionContainer.base.constructor.apply(this,arguments);this.prop(df.tBool,"pbOpenFirst",true);this.prop(df.tBool,"pbAutoHeight",true);this.prop(df.tBool,"pbMultiOpen",false);this._sControlClass="WebAccordion";this._sCardClass="WebAC";this._bCC=false;};df.defineClass("df.WebAccordionContainer","df.WebCardContainer",{headHtml:function headHtml(aHtml){},afterRender:function afterRender(){var that=this;df.WebAccordionContainer.base.afterRender.call(this);df.dom.on("transitionend",this._eElem,this.onTransEnd,this);this.openCardsAfterRender();setTimeout(function(){df.dom.addClass(that._eElem,"WebAc_Rendered");},100);},openCardsAfterRender:function openCardsAfterRender(){var i,oTab;if(this.pbMultiOpen){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab.pbExpanded||oTab._bExpanded){this.showCard(oTab,false);}}}},renderChildren:function renderChildren(eContainer){var i,eTab,aHtml,eButton,eRenderTo,bDynamic=this.hasDynamicHeight();if(this.pbOpenFirst){if(this.psCurrentCard){this._oCurrent=this.getWebApp().findObj(this.psCurrentCard);}for(i=0;i<this._aCards.length&&!this._oCurrent;i++){if(this._aCards[i].isActive()){this._oCurrent=this._aCards[i];}}}eRenderTo=this._eControl=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Body');for(i=0;i<this._aCards.length;i++){aHtml=[];this._aCards[i].tabButtonHtml(aHtml);eButton=df.dom.create(aHtml.join(""));eRenderTo.appendChild(eButton);this._aCards[i].btnRendered(eButton);if(bDynamic||this._aCards[i]===this._oCurrent){eTab=this._aCards[i].render();eRenderTo.appendChild(eTab);}}},showCard:function showCard(oDisplay,bOptFirst){var i,oTab,that=this;if(this.isEnabled()||bOptFirst){if(this.pbMultiOpen){if(oDisplay&&!bOptFirst){oDisplay._bExpanded=true;oDisplay._show();oDisplay.afterShow();}}else{if(oDisplay&&oDisplay.isActive()){if(!bOptFirst&&oDisplay!==this._oCurrent){this.fireCardChange(oDisplay._sName,this._oCurrent&&this._oCurrent._sName||"");}if(this._eElem){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab===oDisplay){oTab._show(!!bOptFirst);df.dom.setText(this._eLabel,oTab.psCaption);}else{oTab._hide(!!bOptFirst);}}}if(!this.pbMultiOpen){if(!bOptFirst&&this._oCurrent){this._oCurrent.afterHide();}}this._oCurrent=oDisplay;if(!bOptFirst){this._oCurrent.afterShow();}if(this.getWebApp()){this.getWebApp().notifyLayoutChange(this);}}}if(!this.pbFillHeight&&(!this.pbAutoHeight||this.pbMultiOpen)){this.sizeChanged(true);setTimeout(function(){that.sizeChanged(true);},1000);}}},renderAllCards:function renderAllCards(){var i,eElem,oCard;for(i=0;i<this._aCards.length;i++){oCard=this._aCards[i];if(!oCard._eElem){eElem=oCard.render();if(!oCard._eBtn){throw new df.Error(999,"Assertion: Accordion card should have a button element!");}else{if(oCard._eBtn.nextSibling){oCard._eBtn.parentNode.insertBefore(eElem,oCard._eBtn.nextSibling);}else{oCard._eBtn.parentNode.appendChild(eElem);}}oCard.afterRender();}}},sizeHeight:function sizeHeight(iExtHeight){var iHeight=-1;if(this.pbFillHeight){iHeight=iExtHeight;}else{if(this.piHeight>0){iHeight=this.piHeight;}}if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}this.setHeight(iHeight);if(iHeight>0){return iHeight;}},setHeight:function setHeight(iHeight){df.WebAccordionContainer.base.setHeight.call(this,iHeight);if(this.pbFillHeight&&this._oCurrent){this._oCurrent._eElem.style.height=this.getCardHeight(this._oCurrent)+"px";}},getCardHeight:function getCardHeight(oCard,iNaturalHeight){var iHeight;if(this.pbAutoHeight||this.pbFillHeight){if(this.piHeight>0||this.pbFillHeight){iHeight=df.dom.clientHeight(this._eControl);iHeight-=df.sys.gui.getVertBoxDiff(this._eControl,2);for(var i=0;i<this._aCards.length;i++){if(this._aCards[i]._eBtn){iHeight-=this._aCards[i]._eBtn.offsetHeight;}}return iHeight;}else{return this.getNaturalHeight()-this.getHeightDiff();}}else{return oCard&&df.dom.clientHeight(oCard._eSizer)||0;}},attachFocusEvents:function attachFocusEvents(){},resize:function resize(){var i,iCardHeight=0;if(this._eElem&&this._bRendered){if(this.pbAutoHeight||this.pbFillHeight){iCardHeight=this.getCardHeight(null);}for(i=0;i<this._aCards.length;i++){if(this._aCards[i]._eElem){if(iCardHeight>0){this._aCards[i]._eContainer.style.height=iCardHeight+"px";}else{this._aCards[i]._eContainer.style.height="";}this._aCards[i].resizeHorizontal();this._aCards[i].resizeVertical();}}if(!this.pbFillHeight){this.sizeHeight(-1);}}},onTransEnd:function onTransEnd(oEv){this.sizeChanged(true);},set_pbMultiOpen:function set_pbMultiOpen(bVal){this.pbMultiOpen=bVal;if(!bVal){for(var i=0;i<this._aCards.length;i++){this._aCards[i]._bExpanded=false;}if(this._oCurrent){this.showCard(this._oCurrent);}}},set_pbAutoHeight:function set_pbAutoHeight(bVal){if(this.pbAutoHeight!==bVal){this.pbAutoHeight=bVal;this.triggerCardResize(!bVal);}},set_pbFillHeight:function set_pbFillHeight(bVal){if(this.pbFillHeight!==bVal){df.WebAccordionContainer.base.set_pbFillHeight.call(this,bVal);this.triggerCardResize(!bVal);}},triggerCardResize:function triggerCardResize(bClearInnerHeight){var i;if(bClearInnerHeight){for(i=0;i<this._aCards.length;i++){this._aCards[i].setInnerHeight(0);}}if(this.pbMultiOpen){for(i=0;i<this._aCards.length;i++){if(this._aCards[i]._bExpanded){this._aCards[i]._show();}}}else{if(this._oCurrent){this.showCard(this._oCurrent);}}this.sizeChanged(true);}});df.WebAccordionCard=function(sName,oPrnt){df.WebAccordionCard.base.constructor.apply(this,arguments);this.prop(df.tBool,"pbExpanded",false);this.prop(df.tString,"psBtnBackgroundColor","");this._bExpanded=false;this.addSync("pbExpanded");this._sControlClass="WebAcCard";this._sBaseClass="";this._bCC=false;};df.defineClass("df.WebAccordionCard","df.WebCard",{wrpOpenHtml:function wrpOpenHtml(aHtml){aHtml.push('<div class="WebContainer">');},wrpCloseHtml:function wrpCloseHtml(aHtml){aHtml.push('</div>');},afterRender:function afterRender(){df.WebAccordionCard.base.afterRender.call(this);if(this._bPanels){df.dom.on("transitionend",this._eMainArea,this.onTransEndCancel,this);}else{df.dom.on("transitionend",this._eContent,this.onTransEndCancel,this);}if(this.psBtnBackgroundColor){this.set_psBtnBackgroundColor(this.psBtnBackgroundColor);}},show:function show(){if(!this._bExpanded){df.WebAccordionCard.base.show.call(this);}},hide:function hide(){if(this._bExpanded&&this._oParent.pbMultiOpen){this._bExpanded=false;this._hide();this.afterHide();}},onBtnClick:function onBtnClick(oEvent){if(this.isEnabled()){if(!this._bExpanded){this.show();}else if(this._oParent.pbMultiOpen){this.hide();}}oEvent.stop();},_hide:function _hide(bFirst){if(this._eElem){this._eElem.style.visibility="hidden";df.dom.addClass(this._eElem,"WebAcCard_Hidden");df.dom.removeClass(this._eElem,"WebAcCard_Visible");df.dom.removeClass(this._eBtn,"WebTab_Current");this._eElem.style.height="0px";}if(!bFirst&&this._bCurrent){this.fire('OnHide');}this._bCurrent=false;},_show:function _show(bFirst){if(!this._eElem&&this._oParent._eElem){var eElem=this.render();if(!this._eBtn){throw new df.Error(999,"Assertion: Accordion card should have a button element!");}else{if(this._eBtn.nextSibling){this._eBtn.parentNode.insertBefore(eElem,this._eBtn.nextSibling);}else{this._eBtn.parentNode.appendChild(eElem);}}this.afterRender();this._oParent.resize();}if(this._eElem){this._eElem.style.visibility="inherit";df.dom.addClass(this._eElem,"WebAcCard_Visible");df.dom.removeClass(this._eElem,"WebAcCard_Hidden");df.dom.addClass(this._eBtn,"WebTab_Current");this._eElem.style.height=this._oParent.getCardHeight(this)+"px";}if(!bFirst&&!this._bCurrent){this.fire('OnShow');}this._bCurrent=true;},get_pbExpanded:function get_pbExpanded(){return this._bExpanded;},set_pbExpanded:function set_pbExpanded(bVal){if(this._Elem&&bVal!==this._bExpanded){this.show();}},set_psBtnBackgroundColor:function set_psBtnBackgroundColor(sVal){if(this._eBtn){this._eBtn.style.background=sVal||'';}},onTransEndCancel:function onTransEndCancel(oEv){oEv.stopPropagation();}});df.WebHtmlListRowModel=function WebHtmlListRowModel(oList,oModel){df.WebHtmlListRowModel.base.constructor.call(this,oList,oModel);this.rRegEx=/{{([a-zA-Z0-9_\-]*)}}/g;};df.defineClass("df.WebHtmlListRowModel","df.WebListRowModel",{rowHtml:function rowHtml(tRow,aHtml,bZebra){var oL=this.oL,oR=this.oR,that=this;aHtml.push(oL._sHtmlTemplate.replace(this.rRegEx,function(sMatch,sP1){if(sP1=="dfrowid"){return tRow.sRowId;}var oCol=oL._oColMap[sP1];if(oCol){return that.cellHtml(oCol,tRow,tRow.aCells[oCol._iColIndex]);}return sMatch;}));}});df.WebHtmlListView=function(oList,oModel,oController){df.WebHtmlListView.base.constructor.call(this,oList,oModel,oController);};df.defineClass("df.WebHtmlListView","df.WebListView",{tableHtml:function tableHtml(aHtml){aHtml.push(this.oL.psHtmlBefore);df.WebHtmlListView.base.tableHtml.call(this,aHtml);aHtml.push(this.oL.psHtmlAfter);},onTableClick:function onTableClick(oEv){var eElem=oEv.getTarget(),eRow=null,iCol=-1,that=this,sRowId=null,sElemClick=null,bRowClick=true;if(!this.oL.isEnabled()||this.bCancelClick){return;}while(eElem.parentNode&&eElem!==this.eBody&&!sRowId){if(eElem.hasAttribute("data-ServerOnElemClick")){sElemClick=eElem.getAttribute("data-ServerOnElemClick");}if(eElem.hasAttribute("data-dfisrow")){sRowId=eElem.getAttribute("data-dfrowid");}eElem=eElem.parentNode;}if(sElemClick){bRowClick=this.oL.fire("OnElemClick",[sRowId||"",sElemClick]);}if(bRowClick&&sRowId){if(this.oC.cellClick(oEv,sRowId,iCol)){this._bPreventSubmit=true;setTimeout(function(){that.bPreventSubmit=false;},250);oEv.stop();}}},refreshCell:function refreshCell(sRowId,oCol){this.refreshDisplay();},refreshRow:function refreshRow(sRowId,sNewRowId){this.refreshDisplay();}});df.WebHtmlList=function WebHtmlList(oParent,sName){df.WebHtmlList.base.constructor.call(this,oParent,sName);this.prop(df.tString,"psHtmlBefore","");this.prop(df.tString,"psHtmlTemplate","");this.prop(df.tString,"psHtmlAfter","");this._oColMap={};this._sHtmlTemplate;this.event("OnElemClick",df.cCallModeWait);this._sControlClass="WebHtmlList";};df.defineClass("df.WebHtmlList","df.WebList",{create:function create(){this._sHtmlTemplate=this.initTemplate(this.psHtmlTemplate);df.WebHtmlList.base.create.call(this);},createTouchHandler:function createTouchHandler(){return null;},createPlaceHolder:function createPlaceHolder(){return null;},createHeaderView:function createHeaderView(){return null;},createRowModel:function createRowModel(){return new df.WebHtmlListRowModel(this,this._oModel);},createView:function createView(){return new df.WebHtmlListView(this,this._oModel,this._oController);},createController:function createController(){return new df.WebListController(this,this._oModel);},createModel:function createModel(){return new df.WebListModel(this);},openHtml:function openHtml(aHtml){df.WebList.base.openHtml.call(this,aHtml);this._oBody.genHtml(aHtml);},afterRender:function afterRender(){var oObj;this._eControl=this._eFocus=df.dom.query(this._eElem,'div.WebList_Focus');if(this._oHeader){this._oHeader.afterRender(this._eElem);}this._oBody.afterRender(this._eElem);df.WebList.base.afterRender.call(this);this._bRenderChildren=true;this.updateEnabled();},addChild:function addChild(oChild){df.WebHtmlList.base.addChild.call(this,oChild);if(oChild._bIsColumn){this._oColMap[oChild._sName]=oChild;}},initTemplate:function initTemplate(sTemplate){return sTemplate.replace(/<\/?\w+/i,function(sMatch){return sMatch+' data-dfisrow="true" data-dfrowid="{{dfrowid}}"';});},updateTemplate:function updateTemplate(sNewTemplate){this.set_psHtmlTemplate(sNewTemplate);},set_psHtmlTemplate:function set_psHtmlTemplate(sVal){this._sHtmlTemplate=this.initTemplate(sVal);this.redraw();},set_psHtmlBefore:function set_psHtmlBefore(sVal){this.psHtmlBefore=sVal;this.redraw();},set_psHtmlAfter:function set_psHtmlAfter(sVal){this.psHtmlAfter=sVal;this.redraw();}});df.WebGeoLocation=function WebGeoLocation(sName,oParent){df.WebGeoLocation.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbTracking",false);this.prop(df.tBool,"pbAutoStart",true);this.prop(df.tBool,"pbAutoStop",true);this.prop(df.tNum,"pnLatitude",0.0);this.prop(df.tNum,"pnLongitude",0.0);this.prop(df.tNum,"pnAccuracy",0.0);this.prop(df.tNum,"pnSpeed",0.0);this.prop(df.tNum,"pnHeading",0.0);this.prop(df.tBool,"pbEnableHighAccuracy",false);this.prop(df.tInt,"piMaxTimeout",0);this.prop(df.tInt,"piMinTimeout",200);this.prop(df.tInt,"piMaxAge",0);this.event("OnLocationChange",df.cCallModeDefault);this.event("OnError",df.cCallModeDefault);this.addSync("pnLatitude");this.addSync("pnLongitude");this.addSync("pnAccuracy");this.addSync("pnSpeed");this.addSync("pnHeading");this._iWatchId=null;this._oView=null;this._iLocChTime=0;this._iLocChTimer=null;};df.defineClass("df.WebGeoLocation","df.WebObject",{create:function create(){df.WebGeoLocation.base.create.call(this);this.set_pbTracking(this.pbTracking);this._oView=this.getView();if(this._oView){this._oView.OnShow.on(this.showView,this);this._oView.OnHide.on(this.hideView,this);}else{if(this.pbAutoStart){this.set("pbTracking",false);}}},destroy:function destroy(){df.WebGeoLocation.base.destroy.call(this);if(this._oView){this._oView.OnShow.off(this.showView,this);this._oView.OnHide.off(this.hideView,this);}},showView:function showView(oEvent){if(this.pbAutoStart){this.set("pbTracking",true);}},hideView:function hideView(oEvent){if(this.pbAutoStop){this.set("pbTracking",false);}},queryLocation:function queryLocation(sCallbackMsg,sCallbackObj){var that=this;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){that.updateProps(position);that.serverAction("QueryLocation_Callback",[sCallbackMsg,sCallbackObj,0,df.fromNumber(that.pnLatitude),df.fromNumber(that.pnLongitude),df.fromNumber(that.pnAccuracy),df.fromNumber(that.pnSpeed),df.fromNumber(that.pnHeading)]);},function(locationerror){that.serverAction("QueryLocation_Callback",[sCallbackMsg,sCallbackObj,locationerror.code,"0","0","0","0","0"]);that.fire("OnError",[locationerror.code,locationerror.message]);},this.geoOptions());}},updateProps:function updateProps(position){this.pnLatitude=position.coords.latitude;this.pnLongitude=position.coords.longitude;this.pnAccuracy=position.coords.accuracy||0;this.pnSpeed=position.coords.speed||0;this.pnHeading=position.coords.heading||0;},fireLocationChange:function fireLocationChange(){this.fireEx({sEvent:"OnLocationChange",aParams:[df.fromNumber(this.pnLatitude),df.fromNumber(this.pnLongitude),df.fromNumber(this.pnAccuracy),df.fromNumber(this.pnSpeed),df.fromNumber(this.pnHeading)],oEnv:this,sAltServerName:"TriggerLocationChange"});this._iLocChTime=new Date().getTime();},trackPosition:function trackPosition(position){var that=this;this.updateProps(position);var iDiff=new Date().getTime()-this._iLocChTime;if(this.piMaxTimeout>0&&iDiff<this.piMaxTimeout){if(!this._iLocChTimer){this._iLocChTimer=setTimeout(function(){that.fireLocationChange();this._iLocChTimer=null;},iDiff);}}else{that.fireLocationChange();}},set_pbTracking:function set_pbTracking(bVal){var that=this;if(bVal!==(this._iWatchId!==null)){if(bVal){if(navigator.geolocation){this._iWatchId=navigator.geolocation.watchPosition(function(position){that.trackPosition(position);},function(locationerror){that.fire("OnError",[locationerror.code,locationerror.message]);},this.geoOptions());}}else{if(navigator.geolocation&&this._iWatchId!==null){navigator.geolocation.clearWatch(this._iWatchId);}this._iWatchId=null;}}},geoOptions:function geoOptions(){return{enableHighAccuracy:this.pbEnableHighAccuracy,maximumAge:this.piMaxAge>0?this.piMaxAge:Infinity,timeout:this.piMaxTimeout>0?this.piMaxTimeout:Infinity};}});df.WebContextMenu=function WebContextMenu(sName,oParent){df.WebContextMenu.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piMaxHeight",500);this.prop(df.tString,"psControlName","");this.prop(df.tString,"psContextCSSSelector","");this.prop(df.tInt,"peContext",df.WebUIContext.WebUIContextCustom);this.prop(df.tString,"psContextValue","");this.prop(df.tBool,"pbAllowHtml");this.prop(df.tString,"psGroupName");this.prop(df.tBool,"pbShowIcons",false);this.event("OnContextMenuOpen",df.cCallModeDefault,"privateOnContextMenuOpen");this.event("OnItemClick");this.pePosition=df.fpFloatFixed;this.piWidth=200;this.piHeight=-1;this.piColumnCount=1;this.pbHideOnEscape=true;this._bIsMenuProv=true;this._oRootControl=null;this._bRendered=false;this._oMenu=null;this._oChildrenCache=[];};df.defineClass("df.WebContextMenu","df.WebFloatingPanel",{set_psControlName:function set_psControlName(sControlName,bForceInit){if(this.psControlName!==sControlName||bForceInit){this.unbind();this.psControlName=sControlName;if(this.psControlName==="window"){this._oRootControl={_eElem:document.documentElement};}else if(this.psControlName.length>0){this._oRootControl=this.getWebApp().findObj(this.psControlName);}else{this._oRootControl=this.getWebApp();}if(!this._oRootControl)throw new df.Error(999,"WebContextMenu could not find the RootControl.");this.bind();}},set_peContext:function set_peContext(eContext){if(this.peContext!==eContext){this.unbind();this.peContext=eContext;this.bind();}},set_psContextCSSSelector:function set_psContextCSSSelector(sContextCSSSelector){if(this.psContextCSSSelector!==sContextCSSSelector&&this.peContext===df.WebUIContext.WebUIContextCustom){this.unbind();this.psContextCSSSelector=sContextCSSSelector;this.bind();}},set_pbShowIcons:function set_pbShowIcons(bVal){var _this$_oMenu;(_this$_oMenu=this._oMenu)===null||_this$_oMenu===void 0?void 0:_this$_oMenu.set_pbShowIcons(this.pbShowIcons=bVal);},set_psGroupName:function set_psGroupName(sVal){var _this$_oMenu2;(_this$_oMenu2=this._oMenu)===null||_this$_oMenu2===void 0?void 0:_this$_oMenu2.set_psGroupName(this.psGroupName=sVal);},set_pbAllowHtml:function set_pbAllowHtml(bVal){var _this$_oMenu3;(_this$_oMenu3=this._oMenu)===null||_this$_oMenu3===void 0?void 0:_this$_oMenu3.set_pbAllowHtml(this.pbAllowHtml=bVal);},refresh:function refresh(){if(this._oMenu){this._oMenu._tActionData=this._tActionData;this._oMenu.refresh();this._oMenu._tActionData=null;}},updateItem:function updateItem(sId,bOverwriteSubs){if(this._oMenu){this._oMenu._tActionData=this._tActionData;this._oMenu.updateItem(sId,bOverwriteSubs);this._oMenu._tActionData=null;}},insertItem:function insertItem(sParentId){if(this._oMenu){this._oMenu._tActionData=this._tActionData;this._oMenu.insertItem(sParentId);this._oMenu._tActionData=null;}},removeItem:function removeItem(sId){var _this$_oMenu4;(_this$_oMenu4=this._oMenu)===null||_this$_oMenu4===void 0?void 0:_this$_oMenu4.removeItem(sId);},notifyChange:function notifyChange(){var _this$_oMenu5;(_this$_oMenu5=this._oMenu)===null||_this$_oMenu5===void 0?void 0:_this$_oMenu5.notifyChange();},refreshMenu:function refreshMenu(){if(this._oMenu){this._oMenu._aMenu=null;this._oMenu.refreshMenu();}},collapseAll:function collapseAll(){var _this$_oMenu6;(_this$_oMenu6=this._oMenu)===null||_this$_oMenu6===void 0?void 0:_this$_oMenu6.collapseAll();},hideMenu:function hideMenu(){df.events.removeDomCaptureListener("click",document,this.onClickGeneral,this);df.events.removeDomCaptureListener("contextmenu",document,this.hideMenu,this);this.hide();},create:function create(){this.set_psControlName(this.psControlName,true);this._oMenu=new df.WebMenuList("MenuList",this);this._oMenu.objFocus=function(){return;};this._oMenu._oMenuBtn=this;this._oMenu.pbShowCaption=false;this._oMenu.pbShowBackItem=true;this._oMenu.pbShowIcons=this.pbShowIcons;var that=this;this._oMenu.getMenuHeight=function(eElem){var iHeight=eElem.firstChild.offsetHeight;iHeight+=df.sys.gui.getVertBoxDiff(eElem);return iHeight<=that.piMaxHeight?iHeight:that.piMaxHeight;};var that=this;this._fMenuBaseClick=this._oMenu.onMenuClick;this._oMenu.onMenuClick=function(oEvent){that._fMenuBaseClick.apply(this,arguments);var tItem,eElem=oEvent.getTarget();if(!eElem)return;while(!tItem&&eElem&&eElem!==this._eElem&&eElem.hasAttribute){if(eElem.hasAttribute("data-df-path")){tItem=this.getItemByPath(eElem.getAttribute("data-df-path"));if(tItem&&tItem.bEnabled&&tItem.aChildren.length===0){if(!(tItem.hRef instanceof df.WebMenuItemCheckbox)){this._oMenuBtn.hideMenu();}that.fire("OnItemClick",[tItem.sId,tItem.sCaption]);}return;}eElem=eElem.parentNode;}};this._oMenu._hContextMenu=this;this._oMenu.create();for(var i=0;i<this._oChildrenCache.length;i++){this.addChild(this._oChildrenCache[i]);}df.WebContextMenu.base.addChild.call(this,this._oMenu);df.WebContextMenu.base.create.call(this,arguments);},destroy:function destroy(){this.unbind();df.WebContextMenu.base.destroy.apply(this,arguments);},genClass:function genClass(){var aClasses=["WebContextMenu",df.WebContextMenu.base.genClass.call(this)];return aClasses.join(" ");},afterRender:function afterRender(){this._bRendered=true;df.WebContextMenu.base.afterRender.apply(this,arguments);this.bind();},bind:function bind(){if(!this._oRootControl||!this._oRootControl._eElem||!this._eElem){if(this._bRendered)throw new df.Error(999,"WebContextMenu could not find an element for the RootControl.");return;}if(this._bRendered&&this.peContext!==df.WebUIContext.WebUIContextCustom){if(!this._oRootControl.determineSelectorForWebUIContext)throw new df.Error(999,"WebContextMenu could not contact the assigned control since it does not support the required interface.");var sCSSSelector=this._oRootControl.determineSelectorForWebUIContext(this.peContext);if(sCSSSelector===null||sCSSSelector===undefined)throw new df.Error(999,"WebContextMenu's assinged control does not support the desired peContext.");this.psContextCSSSelector=sCSSSelector;this.addSync("psContextCSSSelector");}df.dom.on("contextmenu",this._oRootControl._eElem,this.onContextMenuOpen,this);df.dom.on("contextmenu",this._eElem,function(oEv){oEv.stop();},this);},unbind:function unbind(){if(!this._oRootControl||!this._oRootControl._eElem||!this._eElem){if(this._bRendered)throw new df.Error(999,"WebContextMenu could not find a element for the RootControl.");return;}df.dom.off("contextmenu",this._oRootControl._eElem,this.onContextMenuOpen,this);df.dom.off("contextmenu",this._eElem,function(oEv){oEv.stop();},this);df.events.removeDomCaptureListener("click",document,this.onClickGeneral,this);df.events.removeDomCaptureListener("contextmenu",document,this.hideMenu,this);this.hideMenu();},rebind:function rebind(){this.unbind();this.bind();},createMenuItem:function createMenuItem(sCaption){var oItem=new df.WebMenuItem(null,this);oItem.psCaption=sCaption;oItem.create();return oItem;},createCheckedMenuItem:function createCheckedMenuItem(sCaption,bChecked){var oItem=new df.WebMenuItemCheckbox(null,this);oItem.psCaption=sCaption;oItem.pbChecked=bChecked;oItem.create();return oItem;},addChild:function addChild(oChild){if(!(oChild instanceof df.WebMenuItem))throw new df.Error(999,"WebMenuContext only supports menu items/checkboxes ("+oChild.getLongName()+").");if(this._oMenu){this._oMenu.addChild(oChild);}else{this._oChildrenCache.push(oChild);}},showView:function showView(oEvent){if(!this._bRendered){this.render();this.afterRender();}df.WebContextMenu.base.showView.apply(this,arguments);this.rebind();},hideView:function hideView(oEvent){df.WebContextMenu.base.hideView.apply(this,arguments);this.unbind();},show:function show(){if(this.isEnabled()){this.pbVisible=true;if(this._bViewVisible){this.doShow();}}},isVisible:function isVisible(){return this.pbVisible===true;},onClickGeneral:function onClickGeneral(oEv){if(this._eElem.contains(oEv.getTarget())){return;}df.events.removeDomCaptureListener("click",document,this.onClickGeneral,this);df.events.removeDomCaptureListener("contextmenu",document,this.hideMenu,this);this.hideMenu();},onContextMenuOpen:function onContextMenuOpen(oEvent){var bFound=this.psContextCSSSelector.length===0;var eElem=document.elementFromPoint(oEvent.e.clientX,oEvent.e.clientY);while(eElem&&eElem.matches&&eElem!==this._oRootControl._eElem&&!bFound){bFound=eElem.matches(this.psContextCSSSelector);if(bFound)break;eElem=eElem.parentNode;}var bValid=this._oRootControl.verifyElementForWebUIContext?this._oRootControl.verifyElementForWebUIContext(eElem,this.peContext):true;if(this.isEnabled()&&bFound&&bValid){oEvent.stop();if(this._oRootControl.retrieveValueFromWebUIContext&&this.peContext>df.WebUIContext.WebUIContextCustom){var vValue=this._oRootControl.retrieveValueFromWebUIContext(eElem,this.peContext);if(vValue===null||vValue===undefined)throw new df.Error(999,"WebContextMenu's assinged control does not support the desired peContext or we passed the wrong element.");if(vValue instanceof Object){this.psContextValue=JSON.stringify(vValue);}else if(vValue.toString){this.psContextValue=vValue.toString();}else{throw new df.Error(999,"WebContextMenu could not convert the determined Value returned by the assigned control.");}}else{var eTarget=oEvent.getTarget();while(eTarget!=this._oRootControl._eElem&&!eTarget.hasAttribute("data-dfobj")){eTarget=eTarget.parentNode;}this.psContextValue=eTarget.hasAttribute("data-dfobj")?eTarget.getAttribute("data-dfobj"):"";}this.addSync("psContextValue");df.events.addDomCaptureListener("click",document,this.onClickGeneral,this);df.events.addDomCaptureListener("contextmenu",document,this.hideMenu,this);this.fire("OnContextMenuOpen",[],function(oServerEvent){if(oServerEvent.sReturnValue==="1")return;if(this._oMenu._sCurrentMenu.length>0){this._oMenu._sCurrentMenu="";this.refreshMenu();}this.piLeft=oEvent.e.clientX;this.piTop=oEvent.e.clientY;this.show();var oRect=df.sys.gui.getBoundRect(this._oMenu._eCurrentMenu);if(oRect.right>window.innerWidth&&window.innerWidth-oRect.left<=oRect.width){this.piLeft=oRect.left-oRect.width;}else if(oRect.right>window.innerWidth){this.piLeft=window.innerWidth-oRect.width;}if(oRect.bottom>window.innerHeight&&window.innerHeight-oRect.top>=oRect.height){this.piTop=oRect.top-oRect.height;}else if(oRect.bottom>window.innerHeight){this.piTop=window.innerHeight-oRect.height;}this.positionPnl();});}},doHide:function doHide(bNoPos,sReason){var oWebApp=this.getWebApp();if(this._tPositionInterval){clearInterval(this._tPositionInterval);this._tPositionInterval=null;}df.dom.addClass(this._eElem,"WebFP_Hidden");df.dom.removeClass(this._eElem,"WebFP_Visible");if(!bNoPos){this.positionPnl();}this.afterHide();if(this._eMask){df.dom.off("click",this._eMask,this.onMaskTouch);this._eMask.parentNode.removeChild(this._eMask);this._eMask=null;}if(this._eBlurBuddy){df.events.removeDomCaptureListener("blur",this._eBlurBuddy,this.onCaptureBlur,this);}if(this.pePosition===df.fpFloatLeftSqueezeWebApp){if(oWebApp&&oWebApp._eElem){oWebApp._eElem.style.marginLeft="0px";}}this.fire("OnHide",[sReason]);if(!this.pbVisible&&this._eElem){this._eElem.style.display="none";this._bVisible=false;}this._oMenu._sCurrentMenu="";this.refreshMenu();},enable:function enable(bOptState){this.pbEnabled=bOptState!==null?bOptState:true;},disable:function disable(){this.pbEnabled=false;}});df.WebDropZone=function WebDropZone(eZone,oControl){this._eZone=eZone;this._oControl=oControl;this._eInsertedElem=null;this._aHelpers=[];this._eDropPosition=-1;this._eDropElem=null;this._eDropAction=-1;this._iEnterCount=0;};df.defineClass("df.WebDropZone",{highlight:function highlight(oHelper){df.dom.addClass(this._eZone,"WebCon_DropZone");this.attachHandlers();this._aHelpers.push(oHelper);},unhighlight:function unhighlight(){df.dom.removeClass(this._eZone,"WebCon_DropZone");this.detachHandlers();this.removeDropElemInteractions();this._aHelpers=[];this._eDropPosition=-1;this._eDropElem=null;this._eDropAction=-1;this._iEnterCount=0;},destroy:function destroy(){this.unhighlight();},attachHandlers:function attachHandlers(){df.dom.on("dragenter",this._eZone,this.onDragEnter,this);df.dom.on("dragleave",this._eZone,this.onDragLeave,this);df.dom.on("dragover",this._eZone,this.onDragOver,this);df.dom.on("drop",this._eZone,this.onDrop,this);},detachHandlers:function detachHandlers(){df.dom.off("dragenter",this._eZone,this.onDragEnter,this);df.dom.off("dragleave",this._eZone,this.onDragLeave,this);df.dom.off("dragover",this._eZone,this.onDragOver,this);df.dom.off("drop",this._eZone,this.onDrop,this);},getDropData:function getDropData(){return this._oControl.getDropData(this);},onDrop:function onDrop(oEv){oEv.e.preventDefault();this._oControl.onDrop(oEv,this,this._eDropAction);this.removeDropElemInteractions();this._iEnterCount=0;},onDragOver:function onDragOver(oEv){oEv.e.preventDefault();if(!this.controlHasData()){this._eDropPosition=df.dropPositions.ciDropOnEmpty;this._eDropElem=null;this._eDropAction=this.doEmptyInteraction();}else{var _this$getDropCandidat=this.getDropCandidate(oEv),_this$getDropCandidat2=_slicedToArray(_this$getDropCandidat,2),eDropElem=_this$getDropCandidat2[0],eDropAction=_this$getDropCandidat2[1];var bOverDropPlaceHolder=this.isOverDropPlaceHolder(oEv);var ePosition;if(eDropElem==null&&!bOverDropPlaceHolder){this.removeDropElemInteractions();this._eDropElem=null;ePosition=this._eDropPosition=0;}if(eDropElem!=null&&!bOverDropPlaceHolder){ePosition=this.getDropPosition(oEv,eDropElem);}var bInteract=ePosition>0&&eDropElem!=null&&(eDropElem!=this._eDropElem||this._eDropPosition!=ePosition);if(bInteract&&!bOverDropPlaceHolder){this.removeDropElemInteractions();this._eDropElem=eDropElem;this._eDropPosition=ePosition;this._eDropAction=eDropAction;this.interactWithDropElem();}this._oControl.onControlDragOver(oEv,this,eDropElem);}return false;},onDragEnter:function onDragEnter(oEv){oEv.e.preventDefault();this._iEnterCount++;},onDragLeave:function onDragLeave(oEv){oEv.e.preventDefault();this._iEnterCount--;if(this._iEnterCount<=0){this.removeDropElemInteractions();this._eDropElem=null;this._eDropPosition=0;this._iEnterCount=0;}},getDropCandidate:function getDropCandidate(oEv){var _this$_oControl$deter=this._oControl.determineDropCandidate(oEv,this._aHelpers),_this$_oControl$deter2=_slicedToArray(_this$_oControl$deter,2),eDropElem=_this$_oControl$deter2[0],eDropAction=_this$_oControl$deter2[1];return[eDropElem,eDropAction];},getDropPosition:function getDropPosition(oEv,eDropElem){var ePosition=this._oControl.determineDropPosition(oEv,eDropElem);return ePosition;},isOverDropPlaceHolder:function isOverDropPlaceHolder(oEv){var eElem=document.elementFromPoint(oEv.e.x,oEv.e.y);if(eElem){return eElem.classList.contains("DfDragDrop_PlaceHolder");}return false;},controlHasData:function controlHasData(){return this._oControl.hasData();},removeDropElemInteractions:function removeDropElemInteractions(){this.removeInsertedElement();this.clearHighlight();},interactWithDropElem:function interactWithDropElem(){this._oControl.interactWithDropElem(this,this._eDropElem);},doEmptyInteraction:function doEmptyInteraction(){var eDropAction=this._oControl.doEmptyInteraction(this);return eDropAction;},highlightElement:function highlightElement(){if(this._eDropElem){df.dom.addClass(this._eDropElem,"WebCon_DragHover");}},clearHighlight:function clearHighlight(){if(this._eDropElem){df.dom.removeClass(this._eDropElem,"WebCon_DragHover");}},insertElement:function insertElement(eElem,targetElem,eOptForceDropPosition){if(!this._eInsertedElem){df.dom.addClass(eElem,"DfDragDrop_PlaceHolder");eElem.setAttribute('data-dfdropplaceholder',true);var eDropPosition=eOptForceDropPosition||this._eDropPosition;switch(eDropPosition){case df.dropPositions.ciDropBefore:targetElem.insertAdjacentElement('beforebegin',eElem);break;case df.dropPositions.ciDropAfter:targetElem.insertAdjacentElement('afterend',eElem);break;case df.dropPositions.ciDropOnEmpty:targetElem.appendChild(eElem);break;}this._eInsertedElem=eElem;}},removeInsertedElement:function removeInsertedElement(){if(this._eInsertedElem){var _this$_eInsertedElem,_this$_eInsertedElem$;(_this$_eInsertedElem=this._eInsertedElem)===null||_this$_eInsertedElem===void 0?void 0:(_this$_eInsertedElem$=_this$_eInsertedElem.parentNode)===null||_this$_eInsertedElem$===void 0?void 0:_this$_eInsertedElem$.removeChild(this._eInsertedElem);this._eInsertedElem=null;}}});df.tDragDropDataKvPair={sKey:df.tString,sValue:df.tString};df.tGenericDragDropData={aDragData:[df.tDragDropDataKvPair],aDropData:[df.tDragDropDataKvPair]};df.WebDragDropHelper=function WebDragDropHelper(sName,oParent){df.WebDragDropHelper.base.constructor.call(this,sName,oParent);this.event("OnHelperReady",df.cCallModeWait);this._aSources=[];this._aTargets=[];this._oDragData=null;this._oDragObj=null;};df.defineClass("df.WebDragDropHelper","df.WebObject",{create:function create(){df.WebDragDropHelper.base.create.call(this);this.fire("OnHelperReady");},registerDragSource:function registerDragSource(sObjName,sAction){var oObj=this.getWebApp().findObj(sObjName);var bExists=false;for(var i=0;i<this._aSources.length;i++){var curSource=this._aSources[i];if(curSource.oControl==oObj){curSource.aActions.push(parseInt(sAction));bExists=true;}}if(!bExists){var newSource={oControl:oObj,aActions:[parseInt(sAction)]};this._aSources.push(newSource);}oObj.registerDragSource(this,parseInt(sAction));},registerDropTarget:function registerDropTarget(sObjName,sAction){var oObj=this.getWebApp().findObj(sObjName);var bExists=false;for(var i=0;i<this._aTargets.length;i++){var curTarget=this._aTargets[i];if(curTarget.oControl==oObj){curTarget.aActions.push(parseInt(sAction));bExists=true;}}if(!bExists){var newTarget={oControl:oObj,aActions:[parseInt(sAction)]};this._aTargets.push(newTarget);}oObj.registerDropTarget(this,parseInt(sAction));},highlightDropZones:function highlightDropZones(){var _this9=this;this._aTargets.forEach(function(oTarget){oTarget.oControl.highlightDropZones(_this9);});},onDragStart:function onDragStart(oEv,oDragObj,eElem,oDragData,eAction){if(oDragData&&this.supportsDragAction(oDragObj,eAction)){this.highlightDropZones();this._oDragData={oControl:oDragObj,eElem:eElem,oData:oDragData};}else{return false;}},onDragEnd:function onDragEnd(oEv){this.cleanupHelper();df.dragdrop.stopDropZones();},cleanupHelper:function cleanupHelper(){this._aTargets.forEach(function(oTarget){oTarget.oControl.cleanupDropZones();});this._oDragData=null;},serializeDragDropData:df.sys.vt.generateSerializer(df.tGenericDragDropData),onDrop:function onDrop(oEv,oSourceDfObj,oDropZone){var oDragData=this._oDragData;if(oDragData&&oDropZone&&this.supportsDropAction(oDropZone._oControl,oDropZone._eDropAction)){var oDropData=oDropZone.getDropData();var oDragDropData={DragData:this._oDragData.oData,DropData:oDropData};this.serverAction("Drop",[this._oDragData.oControl.getLongName(),oDropZone._oControl.getLongName(),oDropZone._eDropPosition],oDragDropData);}this.onDragEnd(oEv);},onDragOver:function onDragOver(){},destroyDragObj:function destroyDragObj(){this._oDragObj.destroy();this._oDragObj=null;},supportsDragAction:function supportsDragAction(oControl,eAction){for(var i=0;i<this._aSources.length;i++){var curSource=this._aSources[i];if(curSource.oControl==oControl){for(var j=0;j<curSource.aActions.length;j++){if(curSource.aActions[j]==eAction){return true;}}}}return false;},supportsDropAction:function supportsDropAction(oControl,eAction){for(var i=0;i<this._aTargets.length;i++){var curTarget=this._aTargets[i];if(curTarget.oControl==oControl){for(var j=0;j<curTarget.aActions.length;j++){if(curTarget.aActions[j]==eAction){return true;}}}}return false;}});df.WebDragDropUploadBase=df.mixin("df.WebFileUpload_Mixin","df.WebDragDropHelper");df.WebDragDropFileHelper=function WebDragDropFileHelper(sName,oParent){df.WebDragDropFileHelper.base.constructor.call(this,sName,oParent);this._oCurDropZone=null;};df.defineClass("df.WebDragDropFileHelper","df.WebDragDropUploadBase",{create:function create(){df.WebDragDropFileHelper.base.create.call(this);df.dragdrop.registerHelper(this);},onFileDrag:function onFileDrag(oEvent){this.highlightDropZones();},onDragEnd:function onDragEnd(oEv){df.WebDragDropFileHelper.base.onDragEnd.call(this);},onDrop:function onDrop(oEv,oSourceDfObj,oDropZone){var oDragData=this._oDragData;var oDropData=oDropZone.getDropData();var bFileDrag=df.dragdrop.containsFiles(oEv.e);if((oDragData||bFileDrag)&&oDropZone&&this.supportsDropAction(oDropZone._oControl,oDropZone._eDropAction)){if(bFileDrag){this._tempDropData=oDropData;this._oCurDropZone=oDropZone;this.initFiles(oEv.e.dataTransfer.files);this.startUpload();}else{var oDragDropData={DragData:oDragData.oData,DropData:oDropData};this.serverAction("Drop",[this._oDragData.oControl.getLongName(),oDropZone._oControl.getLongName(),oDropZone._eDropPosition],oDragDropData);}}this.onDragEnd(oEv);},doStartUpload:function doStartUpload(fUploadCallback,aRows){var oDragDropData={DragData:aRows,DropData:this._tempDropData};this.serverAction("FileDrop",[this._oCurDropZone._oControl.getLongName(),this._oCurDropZone._eDropPosition],oDragDropData,fUploadCallback);},cleanupHelper:function cleanupHelper(oEv){df.WebDragDropFileHelper.base.cleanupHelper.call(this);this._tempDropData=null;}});
/*
 * DataFlex Web Application Framework 20.1
 * Copyright 2005-2022 Data Access Corporation. All rights reserved.
 */
//# sourceMappingURL=df-min.js.map